<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>yakagika - 特別講義DS Ch7 アルゴリズムとPythonの基本構文</title>

    <!-- Stylesheets. -->
    <link rel="stylesheet" type="text/css" href="../style.css?v=0">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&display=swap" rel="stylesheet">
    <!-- RSS. -->
    <link rel="alternate" type="application/rss+xml" title="yakagika" href="https://yakagika.github.io/rss.xml">

    <!-- Metadata. -->

    <meta name="keywords" content="yakagika Haskell ExchangeAlgebra">
    <meta name="description" content="Personal home page and blog of yakagika.">

    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css" integrity="sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js" integrity="sha384-X/XCfMm41VSsqRNQgDerQczD69XqmjOOOwYQvr/uuC+j4OPoNhVgjdGFwhvN02Ja" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
    

    
      <meta property="og:description" content="資料" />
    
  </head>

  <body>

    <!-- ハンバーガーメニューのボタン（小画面時に表示） -->
     <!-- ヘッダーを上部に固定し、その中にハンバーガーを配置 -->
    <header class="site-header">
      <div class="site-title">
        <a href="../">
          <img src="../favicon.ico" alt="Home" style="width: 32px; height: 32px;">
        </a>
      </div>
      <div class="hamburger" onclick="toggleMenu()">☰</div>
    </header>

    <!-- ナビゲーションに drawer-menu クラスを付与 -->
    <div id="navigation" class="drawer-menu">
      <h1>Contents</h1>
      <a href="../">Home</a>
      <a href="../posts.html">Blog</a>
      <a href="../lectures.html">Lecture</a>
      <a href="../research.html">Research</a>
      <a href="../contact.html">Contact</a>
      <!-- <a href="/cv.html">CV</a> -->

      <h1>Links</h1>
      <a href="http://github.com/yakagika" target="_blank" rel="noopener">GitHub</a>
      <a href="https://researchmap.jp/k-akagi" target="_blank" rel="noopener">researchmap</a>

      
      <div id="lecture-toc">
        <h1>Index</h1>
        <!-- The TOC will be generated here by JavaScript -->
      </div>
      
      
    </div>

    <div id="content">
    <h1>特別講義DS Ch7 アルゴリズムとPythonの基本構文</h1>
<div class="soft">
    資料<br />
    Published on 2024-03-29 under the tag <a title="All pages tagged 'datascience'." href="../tags/datascience.html">datascience</a>, <a title="All pages tagged 'statistics'." href="../tags/statistics.html">statistics</a>, <a title="All pages tagged 'python'." href="../tags/python.html">python</a>
</div>

<!-- 前後の章へのナビゲーション -->
<div class="chapter-navigation">
    <nav>
        
            <a class="nav-link prev" href="slds6.html">← Previous Chapter</a>
        
        
            <a class="nav-link next" href="slds8.html">Next Chapter →</a>
        
    </nav>
</div>

<br>

<div class="toc"><div class="header">Table of Contents</div>
<ul>
<li><a href="#アルゴリズムとpythonの基本構文" id="toc-アルゴリズムとpythonの基本構文"><span class="toc-section-number">1</span> アルゴリズムとPythonの基本構文</a>
<ul>
<li><a href="#フローチャート" id="toc-フローチャート"><span class="toc-section-number">1.0.1</span> フローチャート</a></li>
<li><a href="#input関数" id="toc-input関数"><span class="toc-section-number">1.1</span> input関数</a></li>
<li><a href="#逐次処理インデントブロック" id="toc-逐次処理インデントブロック"><span class="toc-section-number">1.2</span> 逐次処理,インデント,ブロック</a></li>
<li><a href="#分岐" id="toc-分岐"><span class="toc-section-number">1.3</span> 分岐</a></li>
<li><a href="#反復" id="toc-反復"><span class="toc-section-number">1.4</span> 反復</a>
<ul>
<li><a href="#while文" id="toc-while文"><span class="toc-section-number">1.4.1</span> While文</a></li>
<li><a href="#for文" id="toc-for文"><span class="toc-section-number">1.4.2</span> for文</a></li>
</ul></li>
<li><a href="#pandasにおけるfor文" id="toc-pandasにおけるfor文"><span class="toc-section-number">1.5</span> <code>pandas</code>における<code>for文</code></a>
<ul>
<li><a href="#発展-高階関数" id="toc-発展-高階関数"><span class="toc-section-number">1.5.1</span> 発展: 高階関数</a></li>
</ul></li>
<li><a href="#関数とクラス" id="toc-関数とクラス"><span class="toc-section-number">1.6</span> 関数とクラス</a>
<ul>
<li><a href="#関数" id="toc-関数"><span class="toc-section-number">1.6.1</span> 関数</a></li>
<li><a href="#発展クラスとインスタンス" id="toc-発展クラスとインスタンス"><span class="toc-section-number">1.6.2</span> 発展:クラスとインスタンス</a></li>
</ul></li>
</ul></li>
<li><a href="#発展-その他のデータの処理" id="toc-発展-その他のデータの処理"><span class="toc-section-number">2</span> (発展) その他のデータの処理</a>
<ul>
<li><a href="#ファイル操作" id="toc-ファイル操作"><span class="toc-section-number">2.1</span> ファイル操作</a>
<ul>
<li><a href="#ファイルの結合" id="toc-ファイルの結合"><span class="toc-section-number">2.1.1</span> ファイルの結合</a></li>
<li><a href="#複数ディレクトリの操作" id="toc-複数ディレクトリの操作"><span class="toc-section-number">2.1.2</span> 複数ディレクトリの操作</a></li>
<li><a href="#サンプルデータの作成" id="toc-サンプルデータの作成"><span class="toc-section-number">2.1.3</span> サンプルデータの作成</a></li>
</ul></li>
<li><a href="#xml" id="toc-xml"><span class="toc-section-number">2.2</span> XML</a>
<ul>
<li><a href="#xmlの属性について" id="toc-xmlの属性について"><span class="toc-section-number">2.2.1</span> XMLの属性について</a></li>
<li><a href="#xmlデータの読み込み" id="toc-xmlデータの読み込み"><span class="toc-section-number">2.2.2</span> XMLデータの読み込み</a></li>
<li><a href="#階層が深いxmlファイルの処理例" id="toc-階層が深いxmlファイルの処理例"><span class="toc-section-number">2.2.3</span> 階層が深いXMLファイルの処理例</a></li>
</ul></li>
<li><a href="#json" id="toc-json"><span class="toc-section-number">2.3</span> JSON</a>
<ul>
<li><a href="#jsonデータの読み込み" id="toc-jsonデータの読み込み"><span class="toc-section-number">2.3.1</span> JSONデータの読み込み</a></li>
</ul></li>
<li><a href="#pickle" id="toc-pickle"><span class="toc-section-number">2.4</span> pickle</a>
<ul>
<li><a href="#dataframeをpickleで保存する" id="toc-dataframeをpickleで保存する"><span class="toc-section-number">2.4.1</span> DataFrameをpickleで保存する</a></li>
</ul></li>
<li><a href="#その他のデータ形式" id="toc-その他のデータ形式"><span class="toc-section-number">2.5</span> その他のデータ形式</a>
<ul>
<li><a href="#excelファイル.xlsx-.xls" id="toc-excelファイル.xlsx-.xls"><span class="toc-section-number">2.5.1</span> Excelファイル（.xlsx, .xls）</a></li>
<li><a href="#htmlテーブル" id="toc-htmlテーブル"><span class="toc-section-number">2.5.2</span> HTMLテーブル</a></li>
<li><a href="#sqlデータベース" id="toc-sqlデータベース"><span class="toc-section-number">2.5.3</span> SQLデータベース</a></li>
</ul></li>
<li><a href="#データ形式の変換" id="toc-データ形式の変換"><span class="toc-section-number">2.6</span> データ形式の変換</a></li>
</ul></li>
</ul>
</div>
<h2 data-number="1" id="アルゴリズムとpythonの基本構文"><span class="header-section-number">1</span> アルゴリズムとPythonの基本構文</h2>
<p>データを適切に処理するためには,これまで扱ったpandasの技法だけでは足りません.ライブラリに含まれていない処理をPythonで自分で記述する必要があります.</p>
<p>Pythonで処理を記述するためにはそのための<strong>構文</strong>を学習する必要があります.</p>
<p>プログラムで記述される処理を,<strong>アルゴリズム</strong>といいます. <strong>アルゴリズム</strong>とは,<strong>有限回適用することで問題を解くことができる規則の集まり</strong>です. プログラミングとは,プログラミング言語の<strong>データ型と構文を利用してアルゴリズムを記述すること</strong>にほかなりません.</p>
<p>基本的に,アルゴリズムを構成する要素は以下のの3つしかありません.</p>
<div class="note">
<ul>
<li><strong>逐次処理</strong></li>
</ul>
<p>手続き型言語は,プログラムは(基本的には)上から順番に実行されます.
プログラムの記述に従って処理を順番に実行することを<strong>逐次処理</strong>といいます.</p>
<ul>
<li><strong>分岐</strong></li>
</ul>
<p>条件に従って処理が分岐します. Pythonでは,<code>if</code>と<code>case</code>という構文によって実装されます.</p>
<ul>
<li><strong>反復</strong></li>
</ul>
<p>指定の回数または,条件が満たされるまで処理を繰り返すこと. Pythonでは,<code>for</code>,<code>while</code>によって実現します. より高度な実装方法として,再帰や高階関数なども利用できますがこの講義では扱いません.</p>
</div>
<p>この3つの組み合わせがプログラムで記述できれば,プログラムを利用してどのような問題でも解けます.</p>
<h4 data-number="1.0.1" id="フローチャート"><span class="header-section-number">1.0.1</span> フローチャート</h4>
<p>アルゴリズムを視覚的に表現する方法の一つにフローチャートがあります. 原理的には,フローチャートを描くことができれば,アルゴリズムが構築できますし,プログラムが記述できます.</p>
<p>フローチャートは,以下の図形と矢印の組み合わで記述されます(厳密には,ループやデータ代入などもっと細かいですが,ここでは簡単のために省略しています.)</p>
<figure>
<img src="../images/flow-chart1.png" alt="フローチャートの部品" />
<figcaption aria-hidden="true">フローチャートの部品</figcaption>
</figure>
<p>例えば,逐次処理は以下のようなフローチャートで表現されます. 以下は,なにかの野菜を育てる手順をフローチャートで表現したものになります.矢印の順番で処理が行われます.</p>
<figure>
<img src="../images/flow-chart2.png" alt="逐次処理" />
<figcaption aria-hidden="true">逐次処理</figcaption>
</figure>
<p>そこに,<strong>実がならなかった場合は刈り取る</strong>という分岐を加えると以下のようになります.</p>
<figure>
<img src="../images/flow-chart3.png" alt="分岐処理" />
<figcaption aria-hidden="true">分岐処理</figcaption>
</figure>
<p>更に,<strong>実がならなかった場合には,肥料をやり,もう一度水を撒くところからやり直す</strong>という形で,前のステップに戻る反復を追加すると以下のようになります.</p>
<figure>
<img src="../images/flow-chart4.png" alt="反復処理" />
<figcaption aria-hidden="true">反復処理</figcaption>
</figure>
<p>プログラムを用いてアルゴリズムを記述するには,①自然言語(日本語)で解きたい問題が書ける,②その解き方をフローチャートなどを利用してアルゴリズムに変換できる,③アルゴリズムをプログラムに変換できる,というステップを踏むのが一般的です.</p>
<p>最近小学生などの教育で良く耳にする<strong>論理的思考力</strong>や<strong>プログラミング的思考</strong>とは,この①から②への変換ができることを意味しているようです.
プログラミングの学習では,①から②への変換は前提として,プログラムの知識,文法,記法,利用方法などを学習し,②から③への変換を扱います.</p>
<p>最近の小学生は,この学習のために,フローチャートを作ることでプログラムが書ける<a href="https://scratch.mit.edu">Scratch</a>などを使っているようですが,この講義ではそこからやっている時間はないので,この章でフローチャートの作成と,そのプログラムへの変換の基礎を学習します.</p>
<div class="note">
<ul>
<li>演習問題</li>
</ul>
<p>以下の処理を表すシンプルなフローチャートをPowerPointを利用して作成してください.</p>
<ol type="1">
<li><p>カレーの作り方
カレーの作り方を想像して,フローチャートで表現してください.</p></li>
<li><p>自動販売機
以下の条件で自動販売機を想定して,
自動販売機にお金が投入されてから商品が出てくるまでのフローチャートを作成してください.</p>
<ul>
<li><p>100円の炭酸飲料と,150円のお茶を販売している自動販売機</p></li>
<li><p>商品を選択してくださいと最初にアナウンスする</p></li>
<li><p>選択された商品に応じた金額を投入してくださいとアナウンスする</p></li>
<li><p>投入された金額が足りている場合は商品を出しお釣りを返す</p></li>
<li><p>投入された金額が足りない場合は,投入されたお金を全部返して,最初に戻る</p></li>
</ul></li>
<li><p>100個の1から100までのランダムな数字が書かれたボールが入っている箱Aから,1つずつボールを取り出し,偶数のボールを箱B,奇数のボールを箱Cに入れる作業を小学生に説明するためのフローチャートを作成してください.</p></li>
</ol>
</div>
<h3 data-number="1.1" id="input関数"><span class="header-section-number">1.1</span> input関数</h3>
<p>これからアルゴリズムをプログラムで記述する練習をするにあたって,スクリプト内のプログラムと人間がやり取りをする場面が何度か出てきます.そのために利用される関数に<code>input()</code>があります. <code>input()</code>はプログラム内で標準入力(Terminalなどに記述された文字列)を受け取る関数です. <code>()</code>内には標準入力を受け取る前に出力される文字列を記述します. 文字列が表示された後,ユーザーが入力した文字列が入力されます.</p>
<p>以下のプログラム(<code>input_test.py</code>)を記述して実行してみましょう.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="bu">input</span>(<span class="st">'あなたの名前を入力してください. </span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'あなたの名前は</span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">ですね. よろしく!'</span>)</span></code></pre></div>
<p>以下のように,<code>()</code>の中の文字列が表示されて,入力された文字列が代入された<code>x</code>が表示されるはずです.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 input_test.py</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">あなたの名前を入力してください.</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">akagi</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">あなたの名前はakagiですね.</span> よろしく!</span></code></pre></div>
<h3 data-number="1.2" id="逐次処理インデントブロック"><span class="header-section-number">1.2</span> 逐次処理,インデント,ブロック</h3>
<p>pythonは手続き型言語なので,基本的に上から1行ずつプログラムが実行されます. これによってアルゴリズムの構成要素における逐次処理が実現されています.</p>
<p>これまでにこの講義で扱ってきたプログラムは,基本的に1行に1処理を記述しており,処理は上から1行ずつ実行されていました.</p>
<p>しかし,プログラムがより複雑になると,一つの処理が1行では記述できなくなってきます. そこで,プログラムの中で<strong>処理の塊</strong>を作って,その処理の塊を順番に実行していくことになります. Pythonではこの処理の塊を<code>ブロック</code>と呼び,<code>インデント</code>によって表現します.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sample():</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'sample'</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">####</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#↑def のブロックをインデントで表現</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    total <span class="op">+=</span> i</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(total)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">####</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">#↑forのブロックをインデントで表現</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(i<span class="op">*</span>j)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co">####</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co">########</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co">#↑ インデントの中でインデントを使って</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># ブロックの中のブロックを表現</span></span></code></pre></div>
<p><code>インデント</code>は,パワーポイントと同様に,行頭からの空白を意味します.<code>半角スペース4つ</code>が一つの単位となります. <code>TABキー</code>で入力される<code>TAB</code>をインデントとして利用することもできますが,プログラム中にタブとスペースが混在することになり編集が複雑になるので推奨しません.</p>
<p>しかし,いちいちスペースキーを4回テキストエディタで入力するのは面倒なので,
テキストエディタの設定でタブをスペース4つに変換するように設定しておくと楽です.</p>
<p>Sublime Textでは, <code>View &gt; Indentation &gt; Indent Using Spaces</code> をクリックして, <code>TAB Width: 4</code>を選択すると,自動でタブがスペースになります.</p>
<figure>
<img src="../images/tab-to-spaces.png" alt="TAB to Spaces" />
<figcaption aria-hidden="true">TAB to Spaces</figcaption>
</figure>
<h3 data-number="1.3" id="分岐"><span class="header-section-number">1.3</span> 分岐</h3>
<p>Pythonで分岐を表す基本的な構文として<code>if</code>文があります. <code>if</code>は英語の通り,<strong>もしXXなら</strong>を表しており, <code>if XXX:</code> のインデントブロックに,その条件下で行って欲しい処理を記述します.<code>XXX</code>の部分には,<code>Bool</code>型あるいは<code>Bool</code> 型を返す論理式が入ります. 文の最後に<code>:</code>を記述するのを忘れないようにしましょう. また,続けて, <code>elif YYY:</code>と記述することで条件を追加することができます. 条件を網羅的に書かなくても, <code>if</code>と<code>elif</code>で指定された条件以外のすべての場合の処理を<code>else:</code>で指定することができます.</p>
<figure>
<img src="../images/if1.png" alt="ifのイメージ" />
<figcaption aria-hidden="true">ifのイメージ</figcaption>
</figure>
<p>具体的に,ある変数<code>x</code>の大きさによる分岐は以下のように書かれます. 以下の例では,変数<code>x</code>と<code>10</code>の大小比較の結果によって,表示する文字列を変更しています.</p>
<figure>
<img src="../images/if2.png" alt="ifのイメージ" />
<figcaption aria-hidden="true">ifのイメージ</figcaption>
</figure>
<div class="warn">
<ul>
<li>発展:Bool以外のデータ型とif文の挙動</li>
</ul>
<p><code>if</code>文の<code>if</code>,<code>elif</code>以下の部分には基本的にBool型を記述しますが,<code>Int</code>型や<code>str</code>型なども利用可能です. <code>int</code>の場合<code>1</code>は<code>True</code>,それ以外の数値は<code>False</code>とみなされます. <code>str</code>の場合,<code>''</code>(空白)のみが<code>False</code>それ以外は<code>True</code>となります.こちらのほうが<code>True</code>や<code>False</code>より高速なので,サンプルコードなどで利用されている場合がありますので注意しましょう.</p>
<p>例として下のプログラムを実行すると,<code>1</code>,<code>b</code>,<code>c</code>とだけ表示されるはずですので,確認してみましょう.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="dv">1</span> :</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'1'</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="dv">0</span>:</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'0'</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">''</span>:</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'a'</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">' '</span>:</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'b'</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'c'</span>:</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'c'</span>)</span></code></pre></div>
</div>
<p>それでは,具体的なプログラムを記述してみましょう.以下のプログラムについて考えてみます.</p>
<div class="note">
<p>動物の名前をうけとって,それが<code>'イヌ'</code>なら,<code>'ワンワン'</code>,<code>'ネコ'</code>なら,<code>'ニャンニャン'</code>,どちらでもないなら<code>'???'</code>と表示するプログラム</p>
</div>
<p>これを,まずは日本語のフローチャートで表現して,日本語の部分をプログラムの構文に書き換えてみると以下のようになります.これくらいのプログラムだと,フローチャートを経由して変換するのは面倒かと思いますが,今後より複雑なプログラムを書くにあたっての訓練ですので,取り組んでみましょう.</p>
<figure>
<img src="../images/if5.png" alt="動物の名前" />
<figcaption aria-hidden="true">動物の名前</figcaption>
</figure>
<p>フローチャートが書けたら,そのままプログラムを上から書いてみましょう. <code>else</code>の部分だけはフローチャートに現れていないので注意してください.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>kind <span class="op">=</span> <span class="bu">input</span>(<span class="st">'動物の名前をカタカナで入力してください. </span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> kind <span class="op">==</span> <span class="st">'イヌ'</span>:</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'ワンワン'</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> kind <span class="op">==</span> <span class="st">'ネコ'</span>:</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'ニャンニャン'</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'???'</span>)</span></code></pre></div>
<p>実行して,意図通りに動くかを確認しましょう.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 pet_name.py</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">動物の名前をカタカナで入力してください.</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ex">イヌ</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="ex">ワンワン</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 pet_name.py</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="ex">動物の名前をカタカナで入力してください.</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="ex">サカナ</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="ex">???</span></span></code></pre></div>
<div class="note">
<ul>
<li>演習問題</li>
</ul>
<p>以下の,処理のフローチャートと,プログラムを作成してください.</p>
<ol type="1">
<li><p>関東の都県を標準入力から受け取り,その都県の県庁所在地を返す.</p></li>
<li><p><code>input()</code>関数で数値を受け取って, 偶数なら偶数, 奇数なら奇数という文字列を返す.</p>
<ul>
<li>ヒント: <code>input()</code>関数の返り値は文字列なので, <code>int(input(‘数値を入力してください /n’))</code> のように<code>int()</code>関数を利用することで数値に変換できる.</li>
</ul></li>
<li><p>ランダムな1から10の数値を発生させて, その数値が5より大きければ<code>'BIG'</code>,小さければ<code>'SMALL'</code>と表示する.</p>
<ul>
<li>ヒント: 一行目に <code>import random</code> と記述して <code>x = random.randint(1,10)</code>と書くと, 1から10のランダムな整数がxに入ります.</li>
</ul></li>
</ol>
</div>
<h3 data-number="1.4" id="反復"><span class="header-section-number">1.4</span> 反復</h3>
<p>Pythonにおいて,処理を繰り返す<strong>反復</strong>を実装する構文はいくつか存在しますが,代表的なものに <code>while文</code> 及び <code>for文</code>があります. 利用頻度からしても,<code>for文</code>の方が重要ですが, ここではフローチャートと相性が良く,意味が分かりやすい<code>while文</code>で反復の感覚を掴んでから<code>for文</code>を学習しましょう.</p>
<h4 data-number="1.4.1" id="while文"><span class="header-section-number">1.4.1</span> While文</h4>
<p>プログラムは,コンピュータに何かしらの命令をする文を書くものです. <code>while文</code>も<code>if</code>のように英文の意味に沿って,プログラムに命令を与えています.
例えば以下の英語の命令文について考えてみましょう.</p>
<ul>
<li>Keep working while the timer is running.</li>
</ul>
<p>(タイマーが動いている間は,働いてください.)</p>
<ul>
<li>Water the plants every day while they are not bearing fruit.</li>
</ul>
<p>(植物に実が成っていない間は毎日水やりをしてください.)</p>
<ul>
<li>Continue reading while the light is on.</li>
</ul>
<p>(電気がついている間は, 読み続けてください.)</p>
<p>これらの文はいずれも, <strong>命令 while 条件</strong> という形を取っており, <strong>条件が真である限り,命令を実行してください</strong>という意味になっています.</p>
<p>プログラムにおける<code>while文</code>は上の英文の順序を少し入れ替えて, <code>while 条件: 命令</code>の形をとり,<code>条件</code>が真である限り,<code>命令</code>を実行するという意味のプログラムになります.</p>
<figure>
<img src="../images/while1.png" alt="whileのイメージ" />
<figcaption aria-hidden="true">whileのイメージ</figcaption>
</figure>
<p><code>while文</code>は条件によって,プログラムの継続を判断するので,条件の真偽値が変更されない限り,プログラムが終了しません.
試しに以下のコードを実行してみましょう.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#実行されない</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">False</span>:</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'never printed'</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#永遠に数字が増え続ける</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#終了するには Ctrl + C</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    x <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x)</span></code></pre></div>
<p>1つ目の<code>while文</code>は,条件が最初から<code>False</code>になっているため実行されません.
2つ目の<code>while文</code>は,条件が永遠に<code>True</code>なので<code>x</code>が<code>1</code>から増え続けて<code>print()</code>によって標準出力され続けます(このように反復を表すプログラムでは, 変数への再代入を多用しますので,忘れている人は復習しましょう.) <strong>プログラムを強制終了するには<code>Ctrl + C</code>を押しましょう.</strong></p>
<p>ウェブサイトやソフトウェアの表示などでは<code>while文</code>を利用して永遠にプログラムを動かし続けることをしますが,通常の反復では,何かしらの条件の変更によってプログラムを終了するように条件部分を変更する必要があります.</p>
<p>先程のプログラムを少し変更して, <code>x</code>の値が<code>1</code>ずつ増えていき,<code>10</code>になったら終了するようにしてみるとどうなるでしょうか.</p>
<p><code>while文</code>のような反復は, フローチャートでは,<strong>条件</strong>部分を表す分岐と,前に戻る矢印で表されます. 分岐のあとに,何かしら条件に関わる値が変更されることで,分岐が終了します.</p>
<figure>
<img src="../images/while2.png" alt="whileのイメージ" />
<figcaption aria-hidden="true">whileのイメージ</figcaption>
</figure>
<div class="sourceCode" id="cb8"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> x <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x)</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 while_and_for.py</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span></span></code></pre></div>
<p>続いて,標準入力の結果によって反復の終了条件を判定するための,以下のフローチャートで表されるプログラムを考えてみましょう.</p>
<figure>
<img src="../images/while3.png" alt="whileのイメージ" />
<figcaption aria-hidden="true">whileのイメージ</figcaption>
</figure>
<p>このフローチャートをプログラムに直すと以下のようになり, 問題文に正解しない限りプログラムが終了しません.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="dv">2</span> <span class="op">!=</span> x:</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(<span class="st">'1 + 1 = ? </span><span class="ch">\n</span><span class="st">'</span>))</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 while_and_for.py</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span> + 1 = <span class="pp">?</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span> + 1 = <span class="pp">?</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span> + 1 = <span class="pp">?</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span></span></code></pre></div>
<h5 data-number="1.4.1.1" id="while文とif文の組み合わせ"><span class="header-section-number">1.4.1.1</span> <code>while文</code>と<code>if文</code>の組み合わせ</h5>
<p><code>while文</code>の中でも<code>if文</code>を利用した分岐が可能です. 先程のプログラムに少し加えて,ヒントを出すようにしてみましょう.</p>
<figure>
<img src="../images/while4.png" alt="whileのイメージ" />
<figcaption aria-hidden="true">whileのイメージ</figcaption>
</figure>
<p><code>while文</code>のインデントの中で,更に<code>if文</code>のインデントが組まれていることに注意しましょう.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="dv">2</span> <span class="op">!=</span> x:</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(<span class="st">'1 + 1 = ? </span><span class="ch">\n</span><span class="st">'</span>))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">&gt;</span> <span class="dv">2</span>:</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'少し数が大きいかも'</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> x <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'少し数が小さいかも'</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'大正解!!'</span>)</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 while_and_for.py</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span> + 1 = <span class="pp">?</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="ex">少し数が大きいかも</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span> + 1 = <span class="pp">?</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="ex">少し数が小さいかも</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span> + 1 = <span class="pp">?</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="ex">大正解!!</span></span></code></pre></div>
<h5 data-number="1.4.1.2" id="真偽値以外のwhile文"><span class="header-section-number">1.4.1.2</span> 真偽値以外の<code>while文</code></h5>
<p><code>while文</code>では,<code>if文</code>と同様にTrue,False以外の値を条件部分に用いることがあります.
<code>while文</code>では<code>リスト</code>を条件部分に与えることが可能で, <strong>リストが空のとき<code>False</code></strong>として判定されます.</p>
<figure>
<img src="../images/while5.png" alt="whileのイメージ" />
<figcaption aria-hidden="true">whileのイメージ</figcaption>
</figure>
<p>以下のプログラムでは,リストの先頭要素を表示したのち,リストの先頭要素を<code>pop()</code>メソッドによって削除しています. 削除を続けて,リストが空になるとプログラムが終了します.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> xs:</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(xs[<span class="dv">0</span>])</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#リストの先頭要素を削除(pop())</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    xs.pop(<span class="dv">0</span>)</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 while_and_for.py</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span></span></code></pre></div>
<div class="note">
<ul>
<li>演習問題</li>
</ul>
<p>以下のプログラムのフローチャートを作成し,while文を利用してプログラムを記述してください.</p>
<ol type="1">
<li><p><code>x = 1</code> に<code>3</code>ずつ数を足しながら<code>x</code>の値を<code>print()</code>する. <code>x</code>が<code>1000</code>を超えたら終了する.</p></li>
<li><p><code>1</code>から<code>100</code>までの数の和を求める.</p>
<ul>
<li>ヒント: 1ずつ値が増える変数とは別に,増えた値を足す変数を最初に作ろう.</li>
</ul></li>
<li><p><code>100</code>から<code>150</code>までの数のうち,<code>５</code>で割り切れるかつ<code>２</code>で割り切れる数の和を求める</p>
<ul>
<li>ヒント</li>
<li>まずは100から150の数を表示するプログラムを作ってみよう</li>
<li>次に, 100から150までの数のうち<code>5</code>と<code>2</code>で割り切れる数を表示するプログラムを作ってみよう</li>
<li>最後に,表示した和を足すようにしてみよう</li>
</ul></li>
</ol>
</div>
<h4 data-number="1.4.2" id="for文"><span class="header-section-number">1.4.2</span> for文</h4>
<p>続いてもう一つの代表的な反復の表現方法である<code>for文</code>について見ていきましょう <code>while文</code>の説明の最後に扱った,<strong>リストから一つずつ値を取り出す操作</strong>のように<strong>なにかから値を取り出す操作を繰り返すこと</strong>に特化したのが,<code>for文</code>です.</p>
<p><code>for文</code>は, <code>for x in y: z</code>の形で,<strong>yから一つずつxを抜き出して,zをしてください</strong>という意味になります.</p>
<p>英文では,以下の用に<strong>For each x in y,</strong>の形で表されますが, プログラムでは<strong>each</strong>が省略されます.</p>
<div class="note">
<ul>
<li>For each mandarin in the box, take it out and peel it</li>
</ul>
<p>(みかんの入った箱から一つずつみかんを取り出して,皮を剥いてください)</p>
<ul>
<li>For each student in the class, collect the handout from them.</li>
</ul>
<p>(クラスの学生一人ひとりからプリントを回収してください.)</p>
<ul>
<li>For each panda in the cage, take it out one by one and line them up.</li>
</ul>
<p>(パンダの檻からパンダを一匹ずつ連れ出して並べてください.)</p>
</div>
<p><code>for文</code>をプログラムの世界で利用するには,現実を対象とした英語における,<strong>みかんの入った箱</strong>や<strong>パンダの檻</strong>のようになにか中身を取り出せる入れ物が必要になります.</p>
<p><code>python</code>では,この入れ物として,リストのように,中身を順番に取り出せるもの(オブジェクト)を<strong>イテラブルオブジェクト( iterable object)</strong>を利用します.</p>
<div class="note">
<ul>
<li><p>Iterable object の例</p>
<ul>
<li>リスト <code>xs = [1,2,3,4,5]</code></li>
</ul>
<p>順番に取り出すと, <code>1,2,3,4,5</code>の順番で一つずつ出てくる</p>
<ul>
<li>辞書 <code>animal_count = {'cat':2,'dog':4,'bird':8}</code></li>
</ul>
<p><code>key</code>を順番に取り出すと, <code>'cat','dog','bird'</code>が順番に一つずつ出てくる</p>
<ul>
<li>タプル <code>xs = ('a','b','c','d')</code></li>
</ul>
<p>順番に取り出すと,<code>'a','b','c','d'</code>の順番で一つずつ出てくる</p>
<ul>
<li>DataFrameの列や行(<code>DataSeries</code>)</li>
</ul></li>
</ul>
</div>
<figure>
<img src="../images/for1.png" alt="forのイメージ" />
<figcaption aria-hidden="true">forのイメージ</figcaption>
</figure>
<p><code>for文</code>における終了条件は,<code>iterable object</code>が空になることです.
リストから要素を取り出して,以下のフローチャートで表されるような合計を求める処理について考えてみましょう.</p>
<figure>
<img src="../images/for2.png" alt="forのイメージ" />
<figcaption aria-hidden="true">forのイメージ</figcaption>
</figure>
<p>プログラムに直すと以下のようになります.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>]</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> xs:</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    total <span class="op">+=</span> x</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(total)</span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 while_and_for.py</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="ex">15</span></span></code></pre></div>
<p>xs から取り出した値が<code>x</code>に毎回代入されていることに注意しましょう.なお,<code>x</code>は変数名なので,任意の名前をつけることが可能です.
また,<code>pop</code>を利用した<code>while文</code>と違って,元の<code>xs</code>の要素数は実際には減っていません.</p>
<ul>
<li><code>range()</code>関数</li>
</ul>
<p>上の例のように,<strong><code>m</code>から<code>n</code></strong>までの連続した数値が欲しい場合に,毎回リストを作っていると大変です. 単純に数値の列が欲しい場合は<code>range()</code>関数を使いましょう.
<code>range(x)</code>は<code>0</code>から始まる<code>x</code>個の<code>シーケンス</code>(インデックスで位置を指定できるイテラブルオブジェクト)を返します.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x)</span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span></span></code></pre></div>
<p><code>range(始端,終端,ステップ)</code>の形で複数の引数を指定することで,始端,終端,ステップ(何個とばしにするか)を定めることができます.
終端は,一つ前の値までしか出力されないので注意しましょう.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>,<span class="dv">10</span>):</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x)</span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">2</span>):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x)</span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span></span></code></pre></div>
<h5 data-number="1.4.2.1" id="for文とif文の組み合わせ"><span class="header-section-number">1.4.2.1</span> <code>for文</code>と<code>if文</code>の組み合わせ</h5>
<p><code>while文</code>と同様に<code>for文</code>の中で<code>if文</code>を利用したり,<code>if文</code>の中で<code>for文</code>を利用することができます.</p>
<p>以下のプログラムでは, <code>1</code>から<code>5</code>までの値の中で偶数のものだけを<code>print()</code>しています.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">6</span>):</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(x)</span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 while_and_for.py</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span></span></code></pre></div>
<h5 data-number="1.4.2.2" id="多重ループ"><span class="header-section-number">1.4.2.2</span> 多重ループ</h5>
<p><code>for文</code>の中で<code>for文</code>を複数回繰り返して多重ループを実現できます. 以下のプログラムでは, リスト<code>xs</code>からリスト<code>x</code>を取り出し,取り出したリスト<code>x</code>から取り出した要素<code>y</code>の合計値を求めています.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> [[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>],[<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>],[<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>]]</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> xs:</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> y <span class="kw">in</span> x:</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>        total <span class="op">+=</span> y</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(total)</span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 while_and_for.py</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="ex">45</span></span></code></pre></div>
<div class="note">
<ul>
<li>演習</li>
</ul>
<p>以下の処理のフローチャートとプログラムを作ってみよう.</p>
<ol type="1">
<li><p><code>x=0</code>に<code>[1,3,5,7,9,12]</code>を順番に足して更新する. <code>x</code>の値を更新するたびに<code>print()</code>する.</p></li>
<li><p>人物の名前と成績を記録した辞書型<code>xs={'taro':'S','hanako':'B','yumi':'A','jiro':'D'}</code>から成績A以上の人物名だけをリスト<code>upper=[]</code>に追加し,<code>upper</code>を表示する.</p></li>
<li><p><code>100</code>から<code>150</code>までの数のうち,<code>５</code>で割り切れるかつ<code>２</code>で割り切れる数の和を求める</p></li>
<li><p><code>xs = [[1,2,3,4,5],[6,7,8,9,10],[11,12,13,14,15],[16,17,18,19,20]]</code>として, <code>for文</code>の多重ループを利用して, <code>xs[0]</code>から<code>xs[3]</code>の合計値が入ったリストを求める</p></li>
<li><p><code>FizzBuzz</code>とはプログラミングの動作確認でよく用いられる欧米圏の言葉遊びゲームです..
以下のルールに則って<code>1</code>から<code>100</code>までの数を順番に<code>FizzBuzz</code>の判定を行ってください.</p>
<ul>
<li><p>3の倍数ならFizzと表示する</p></li>
<li><p>5の倍数ならBuzzと表示する</p></li>
<li><p>両方の倍数ならFizzBuzz</p></li>
<li><p>どちらでもないならその数をPrintする.</p></li>
</ul></li>
</ol>
</div>
<h5 data-number="1.4.2.3" id="発展-リスト内包表記"><span class="header-section-number">1.4.2.3</span> 発展: リスト内包表記</h5>
<p>Pythonには<code>for文</code>と<code>while文</code>以外にも,反復を実現するための手法がいくつか存在します.
そのうち良く使われるものに<strong>リスト内包表記</strong>があります.</p>
<p>リスト内包表記は,集合論の記法を取り入れた書き方で,関数型言語からPythonに取り入れられました.
リスト内包表記は,短い行で簡潔に書けるためリストを生成する際に良く用いられます.</p>
<p>例えば, 1~10までの数値のうち,偶数だけが入ったリストを生成することを考えます.
<code>for文</code>を利用すると,例えば以下のようにして得ることができます.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>even_numbers <span class="op">=</span> []</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">11</span>):</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">%</span> <span class="dv">2</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">11</span>):</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>        even_numbers.append(i)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'for文:'</span>, even_numbers)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co">#結果&gt;&gt;&gt; for文: [2, 4, 6, 8, 10]</span></span></code></pre></div>
<p>1つのリストを生成するのに4行かかっています.
リスト内包表記で同じリストを作成してみます.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>even_numbers <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">11</span>) <span class="cf">if</span> x <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'内包表記:'</span>,even_numbers)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co">#結果&gt;&gt;&gt; 内包表記: [2, 4, 6, 8, 10]</span></span></code></pre></div>
<p>同じ結果を一行で得ることができました.</p>
<p>リスト内包表記では<code>[]</code>の中に</p>
<p><code>[得たい値 for 使いたい要素を代入した変数 in イテラブルオブジェクト if 条件]</code></p>
<p>という書き方で,<code>for文</code>や<code>if文</code>を利用します.</p>
<p>詳細は省きますが,これは数学の集合論における内包表記を真似た記述法になります.</p>
<figure>
<img src="../images/list_complehension.png" alt="リスト内包表記" />
<figcaption aria-hidden="true">リスト内包表記</figcaption>
</figure>
<p>なれるまで難しいかと思いますので,いくつか他の例も見てみましょう.</p>
<ul>
<li>1から10までの数字のうち,奇数のものに3を足したリスト</li>
</ul>
<div class="sourceCode" id="cb30"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> [x <span class="op">+</span> <span class="dv">3</span> <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">11</span>) <span class="cf">if</span> x <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(xs) <span class="co">#[5, 7, 9, 11, 13]</span></span></code></pre></div>
<ul>
<li><code>animals_small = ['cat','dog','bird']</code>を大文字に変換したリスト</li>
</ul>
<div class="sourceCode" id="cb31"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>animals_small <span class="op">=</span> [<span class="st">'cat'</span>,<span class="st">'dog'</span>,<span class="st">'bird'</span>]</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>animals_large <span class="op">=</span> [x.upper() <span class="cf">for</span> x <span class="kw">in</span> animals_small]</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(animals_large) <span class="co">#['CAT', 'DOG', 'BIRD']</span></span></code></pre></div>
<ul>
<li><code>['CAT', 'DOG', 'BIRD']</code>のうち文字数が3文字以下の文字列の頭文字のリスト</li>
</ul>
<div class="sourceCode" id="cb32"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> [x[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> animals_large <span class="cf">if</span> <span class="bu">len</span>(x) <span class="op">&lt;=</span><span class="dv">3</span> ]</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(xs) <span class="co"># ['C', 'D']</span></span></code></pre></div>
<ul>
<li><code>100</code>から<code>150</code>までの数のうち,<code>５</code>で割り切れるかつ<code>２</code>で割り切れる数の和</li>
</ul>
<div class="sourceCode" id="cb33"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">sum</span>([x <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>,<span class="dv">150</span>) <span class="cf">if</span> x <span class="op">%</span> <span class="dv">10</span> <span class="op">==</span> <span class="dv">0</span>]))</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co">#600</span></span></code></pre></div>
<h5 data-number="1.4.2.4" id="発展-breakとcontinue"><span class="header-section-number">1.4.2.4</span> 発展: breakとcontinue</h5>
<p><code>for文</code>や<code>while文</code>の処理を途中で分岐させたい場合には <code>break</code>, <code>continue</code>, <code>else</code> が利用できます.</p>
<div class="note">
<ul>
<li><p><code>continue</code>: <code>continue</code> 後の処理を行わずに反復の最初に戻る</p></li>
<li><p><code>break</code>: 反復を抜け出す</p></li>
<li><p><code>else</code>: <code>break</code>以外で<code>while文</code>が終了したら実行</p></li>
</ul>
</div>
<p>例として,あなたはなんの動物か尋ねてニンゲンですと答えないと終わらない以下のような処理を作ってみます.</p>
<figure>
<img src="../images/while6.png" alt="whileのイメージ" />
<figcaption aria-hidden="true">whileのイメージ</figcaption>
</figure>
<div class="note">
<p>この処理はユーザーに「あなたはなんの動物ですか?(カタカナで回答)」と質問し,正しい答え「ニンゲン」を得るまで質問を繰り返します.</p>
<p>まず,answer変数にユーザーの入力を格納します.whileループを使って,answerが「ニンゲン」でない限りループを続けます.</p>
<p>もし,ユーザーが「ウチュウジン」と答えた場合,「本当に!? 怖いのでさようなら!」と表示し,<code>break</code>でループを終了します.</p>
<p>ユーザーが「カミサマ」と答えた場合,「わお!! 初めて会いました! … 馬鹿にしないでちゃんと答えてください!」と表示し,再度質問を行います.<code>continue</code>で反復の最初に戻ります.</p>
<p>「ニンゲン」「ウチュウジン」「カミサマ」以外の答えの場合,「嘘をつかないで! XXX は喋れません.」と表示し,再度質問を行います.</p>
<p>ループが「ニンゲン」の答えで終了すると,<code>else</code>で定義された「そうですよね!ニンゲンに決まっています!」と表示されます.</p>
<p>プログラムに直すと以下のようになります.
それぞれの行がどのような条件で実行されるのか, 確認してみましょう.</p>
</div>
<div class="sourceCode" id="cb34"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 先に変数を用意します</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>answer <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;あなたはなんの動物ですか?(カタカナで回答)</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># while文でニンゲンですと答えるまで終わらないプログラムを書きます</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> answer <span class="op">!=</span> <span class="st">&quot;ニンゲン&quot;</span>:</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 答えによっていろいろな反応を組み込んでみましょう</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> answer <span class="op">==</span> <span class="st">&quot;ウチュウジン&quot;</span>:</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;本当に!? 怖いのでさようなら!</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># while ループを終了します</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> answer <span class="op">==</span> <span class="st">&quot;カミサマ&quot;</span>:</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;わお!! 初めて会いました! ... 馬鹿にしないでちゃんと答えてください!&quot;</span>)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># もう一度値を更新して,ループの最初に戻ります</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>        answer <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;本当はあなたはなんの動物ですか?</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ニンゲンとウチュウジン,カミサマ以外は多分喋れないのでもう一度訪ねます</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;嘘をつかないで!&quot;</span> <span class="op">+</span> answer <span class="op">+</span> <span class="st">&quot;は喋れません.&quot;</span>)</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># もう一度値を更新します</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>        answer <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;本当はあなたはなんの動物ですか?</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># これはcontinue も breakもされなかった場合だけ実行されます</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;今度は真面目に答えましたか?</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a><span class="co"># breakで終わらなかった == ニンゲンだった場合の処理を書きます</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;そうですよね!ニンゲンに決まっています!&quot;</span>)</span></code></pre></div>
<div class="note">
<ul>
<li>演習問題</li>
</ul>
<p>質問に対する回答をinput関数で受け取り,それに対して返答をする簡単なBotプログラムを作成してください. なお,分岐は最低5つ以上とすること.</p>
</div>
<h3 data-number="1.5" id="pandasにおけるfor文"><span class="header-section-number">1.5</span> <code>pandas</code>における<code>for文</code></h3>
<p>PandasのDataFrameの処理においても<code>for文</code>は良く利用されます.
例えば以下のようなデータについて考えてみます.</p>
<p>なお,こちらのデータは以下のコードで作成できます. コピーして使いましょう.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>years <span class="op">=</span> [<span class="bu">str</span>(x) <span class="op">+</span> <span class="st">'年'</span> <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1800</span>,<span class="dv">1820</span>)]</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> [<span class="st">'101'</span>,<span class="st">'187'</span>,<span class="st">'150'</span>,<span class="st">'117'</span>,<span class="st">''</span>,<span class="st">'168'</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>         ,<span class="st">'195'</span>,<span class="st">'140'</span>,<span class="st">'151'</span>,<span class="st">'123'</span>,<span class="st">'192'</span>,<span class="st">'137'</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>         ,<span class="st">'なし'</span>,<span class="st">'184'</span>,<span class="st">'136'</span>,<span class="st">'192'</span>,<span class="st">'150'</span>,<span class="st">'163'</span>,<span class="st">'141'</span>,<span class="st">'122'</span>]</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'year'</span>:years</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>                  ,<span class="st">'value'</span>:values})</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 while_and_for.py</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>     <span class="ex">year</span> value</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>   1800年   101</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   1801年   187</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>   1802年   150</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>   1803年   117</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>   1804年</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>   1805年   168</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>   1806年   195</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>   1807年   140</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>   1808年   151</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>   1809年   123</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>  1810年   192</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>  1811年   137</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>  1812年    なし</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>  1813年   184</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="ex">14</span>  1814年   136</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="ex">15</span>  1815年   192</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="ex">16</span>  1816年   150</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="ex">17</span>  1817年   163</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="ex">18</span>  1818年   141</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a><span class="ex">19</span>  1819年   122</span></code></pre></div>
<p>このデータは<code>year</code>列に<code>'年'</code>がついており,<code>value</code>列に空白や<code>'なし'</code>があります.こういったデータを数値として処理できるようにすることを考えてみましょう.
まずは,<code>print(df.dtypes)</code>でそれぞれのデータ型を確認して見ましょう.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="ex">year</span>     object</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="ex">value</span>    object</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="ex">dtype:</span> object</span></code></pre></div>
<p>すべて文字列型であることが分かります.</p>
<p>このまま,<code>year</code>列を<code>astype()</code>を利用して<code>int</code>型に変換してみます.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'year'</span>] <span class="op">=</span> df[<span class="st">'year'</span>].astype(<span class="st">'int'</span>)</span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Traceback</span> <span class="er">(</span><span class="ex">most</span> recent call last<span class="kw">)</span><span class="bu">:</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">File</span> <span class="st">&quot;/Users/akagi/Documents/Programs/Python/slds/while_and_for.py&quot;</span>, line 74, in <span class="op">&lt;</span>module<span class="op">&gt;</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">df</span><span class="op">[</span><span class="st">'year'</span><span class="op">]</span> <span class="ex">=</span> df<span class="pp">[</span><span class="st">'year'</span><span class="pp">]</span>.astype<span class="er">(</span><span class="st">'int'</span><span class="kw">)</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                 <span class="ex">^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="ex">ValueError:</span> invalid literal for int<span class="er">(</span><span class="kw">)</span> <span class="ex">with</span> base 10: <span class="st">'1800年'</span></span></code></pre></div>
<p><code>年</code>の部分が数値に変換出来ないというエラーが出ます.
では,<code>year</code>列から<code>'年'</code>を除外してみましょう.</p>
<p>先程の<code>df['year'] = df['year'].astype('int')</code>をコメントアウトしてから,以下を実行してみましょう.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># year列をInt型にする</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># year列から&quot;年&quot;を抜かす</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 上から順番に処理するので</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 行番号をdf.indexで取得</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> df.index:</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 一番右の文字をなくせば良い</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    df.at[i, <span class="st">'year'</span>] <span class="op">=</span> df.at[i, <span class="st">'year'</span>][:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 確認してみる</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'year'</span>])</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 年が消えたので,変換してみる</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'year'</span>] <span class="op">=</span> df[<span class="st">'year'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'year'</span>].dtype) <span class="co">#int64</span></span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>     1800</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>     1801</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>     1802</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>     1803</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>     1804</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     1805</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>     1806</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>     1807</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>     1808</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>     1809</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>    1810</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>    1811</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>    1812</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>    1813</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="ex">14</span>    1814</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="ex">15</span>    1815</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="ex">16</span>    1816</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="ex">17</span>    1817</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="ex">18</span>    1818</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="ex">19</span>    1819</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="ex">Name:</span> year, dtype: object</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="ex">int64</span></span></code></pre></div>
<p>上手く数値に変換できたようです.</p>
<p>続いて,<code>value</code>列を数値のみにして<code>float</code>型にしてみましょう.</p>
<p>こちらも同じように<code>df['value'] = df['value'].astype(float)</code>ではエラー(<code>ValueError: could not convert string to float: 'なし'</code>)が出ます.</p>
<p>色々方法はありますが,<code>NaN</code>と<code>'なし'</code>の列は適当な値(<code>150</code>)を入れることにしてみましょう.
数値に変換できる場合に<code>True</code>を返す<code>str.isdecimal()</code>を利用して,上から一つひとつ数値に変換可能か識別して,できない場合”150”を入れてみます.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># value列をfloat型にする</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> df.index:</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 数値型に変換可能か調べるには</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># isdecimal関数を使う</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 変換可能でない場合'150'を入れる</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span>(<span class="bu">str</span>.isdecimal(df.at[i, <span class="st">'value'</span>])):</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>        df.at[i, <span class="st">'value'</span>] <span class="op">=</span> <span class="st">'150'</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 確認</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'value'</span>])</span></code></pre></div>
<div class="sourceCode" id="cb43"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>     101</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>     187</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>     150</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>     117</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>     150</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     168</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>     195</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>     140</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>     151</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>     123</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>    192</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>    137</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>    150</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>    184</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="ex">14</span>    136</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="ex">15</span>    192</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="ex">16</span>    150</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="ex">17</span>    163</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="ex">18</span>    141</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="ex">19</span>    122</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="ex">Name:</span> value, dtype: object</span></code></pre></div>
<p>無事に数値に変換できました.</p>
<p>このように, <code>pandas</code>ではイテラブルオブジェクトとして<code>index</code>や<code>columns</code>を利用し,<code>.at[]</code>などを利用してデータを編集する必要がある場合が多いです.
<code>pandas</code>で<code>for文</code>,<code>if文</code>などの組み合わせた処理に慣れておきましょう.</p>
<p>もう少し複雑な例についても見てみましょう. 以下のDataFrameにおいて,グループ別の平均点を求めてみましょう.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span>  {<span class="st">'group'</span>: [<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                  , <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                  , <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>]</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>        ,<span class="st">'points'</span>: [ <span class="dv">45</span>, <span class="dv">23</span>, <span class="dv">58</span>, <span class="dv">96</span>, <span class="dv">38</span>, <span class="dv">41</span>, <span class="dv">33</span>, <span class="dv">30</span>, <span class="dv">82</span>, <span class="dv">42</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>                   , <span class="dv">42</span>, <span class="dv">89</span>, <span class="dv">66</span>, <span class="dv">94</span>, <span class="dv">25</span>, <span class="dv">36</span>, <span class="dv">52</span>, <span class="dv">40</span>, <span class="dv">93</span>, <span class="dv">80</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>                   , <span class="dv">44</span>, <span class="dv">39</span>, <span class="dv">79</span>, <span class="dv">67</span>, <span class="dv">38</span>, <span class="dv">43</span>, <span class="dv">100</span>, <span class="dv">62</span>, <span class="dv">54</span>]}</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<div class="sourceCode" id="cb45"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>    <span class="ex">group</span>  points</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>       5      45</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>       5      23</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       1      58</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>       2      96</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>       1      38</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>       5      41</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       4      33</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>       3      30</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>       2      82</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>       1      42</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>      5      42</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>      3      89</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>      4      66</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>      1      94</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="ex">14</span>      2      25</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a><span class="ex">15</span>      4      36</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a><span class="ex">16</span>      5      52</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="ex">17</span>      1      40</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a><span class="ex">18</span>      1      93</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a><span class="ex">19</span>      1      80</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a><span class="ex">20</span>      2      44</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a><span class="ex">21</span>      3      39</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a><span class="ex">22</span>      1      79</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a><span class="ex">23</span>      2      67</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a><span class="ex">24</span>      4      38</span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a><span class="ex">25</span>      4      43</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a><span class="ex">26</span>      3     100</span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a><span class="ex">27</span>      4      62</span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a><span class="ex">28</span>      4      54</span></code></pre></div>
<p>一度, 以下の解答例を見ずに,自分でフローチャートとプログラムを考えてみましょう.</p>
<ul>
<li><h3 id="回答例">回答例</h3></li>
</ul>
<div class="note">
<p>このような処理のプログラムが書けるかどうかは,どのような手順でデータを操作するかをイメージできるかで決まります. これは,プログラミングの文法知識などの問題ではなく,パズルを解くようないわゆる論理的思考や,プログラミング的思考と呼ばれる能力です.</p>
<p>こういった処理を｢どのようにしたら思いつくことができるのか｣はなかなか教えるのが難しいのですが,一つの手順として,<strong>一旦プログラムのことは忘れて,紙と鉛筆でどのように同じ問題を解くかを考えてみる</strong>というのが有効な場合があります.プログラムになれると,直接プログラムで記述することが出来るようになります. しかし,プログラム的思考に慣れていない人はそもそも何をすればいいのかわからないのでプログラムが書けません.</p>
<p>何をすればいいのか皆目検討がつかないという人は, 自分が,紙と鉛筆でどのように解くのかを考えて,それをアルゴリズムに変更し,プログラムに直すという手順を踏んでみましょう.</p>
</div>
<p>求めなければならないものをまずはイメージしてみましょう.求めるものは,以下のように,グループごとの値の合計値をグループの数で割ったものです.</p>
<figure>
<img src="../images/average_by_group.png" alt="問題のイメージ" />
<figcaption aria-hidden="true">問題のイメージ</figcaption>
</figure>
<p>この問題を紙と鉛筆で求める場合,どのような方法があるでしょうか.</p>
<p>一例として,上から1行ずつデータを確認し,グループ別に<code>points</code>の値をメモする. すべての行を記録し終えたら,グループ別のメモの値を合計値とデータの数を求めて,平均値を計算するという方法でやってみましょう.
小学生でも順番を守れば可能な方法ですね.</p>
<figure>
<img src="../images/average_by_group2.png" alt="解き方のイメージ" />
<figcaption aria-hidden="true">解き方のイメージ</figcaption>
</figure>
<p>まず,グループ別のメモをする場所を作成します.どのようなデータ型でも構いませんが,ここでは辞書型で作成してみます.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>memo <span class="op">=</span> {<span class="dv">1</span>:[]</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>       ,<span class="dv">2</span>:[]</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>       ,<span class="dv">3</span>:[]</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>       ,<span class="dv">4</span>:[]</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>       ,<span class="dv">5</span>:[]}</span></code></pre></div>
<p>データを1行ずつ確認し,メモ帳に記録していきます.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> df.index:</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    memo[df.at[i,<span class="st">'group'</span>]] <span class="op">+=</span> [df.at[i,<span class="st">'points'</span>]]</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(memo)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co">{ 1: [58, 38, 42, 94, 40, 93, 80, 79]</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co">, 2: [96, 82, 25, 44, 67]</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co">, 3: [30, 89, 39, 100]</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co">, 4: [33, 66, 36, 38, 43, 62, 54]</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co">, 5: [45, 23, 41, 42, 52]}</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>記録したメモを元に,一つひとつ合計値とデータ数を求め,平均値を計算してみます.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#グループ1からグループ5まで順番に作業する</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">6</span>):</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    length <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">#グループ別のリストを足していく</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> memo[i]:</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>        total <span class="op">+=</span> x</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>        length <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'group:</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">, mean:</span><span class="sc">{</span>total<span class="op">/</span>length<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="co">group:1, mean:65.5</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="co">group:2, mean:62.8</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="co">group:3, mean:64.5</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="co">group:4, mean:47.42857142857143</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a><span class="co">group:5, mean:40.6</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>これで無事に,グループ別のデータが求められました.
当然,もっと効率的で,簡単に計算する方法は沢山あります. 似た問題を検索し特定のメソッドを利用したり,AIに聞くことで,何も考えずに計算することも可能です.</p>
<p>例えば, 先程の平均値の計算部分に関しては,組み込み関数の<code>sum()</code>や<code>len()</code>を利用することで,自分で書かなくても計算が可能です.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">6</span>):</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'group:</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">,mean:</span><span class="sc">{</span><span class="bu">sum</span>(memo[i])<span class="op">/</span><span class="bu">len</span>(memo[i])<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co">group:1,mean:65.5</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co">group:2,mean:62.8</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co">group:3,mean:64.5</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co">group:4,mean:47.42857142857143</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="co">group:5,mean:40.6</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>また,以前扱った条件抽出を使えば,一つ一つデータを集める必要もありません. 以下の3行で同じことが可能です.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">6</span>):</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    group_mean <span class="op">=</span> df[df[<span class="st">'group'</span>] <span class="op">==</span> i][<span class="st">'points'</span>].mean()</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'group:</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">,mean:</span><span class="sc">{</span>group_mean<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co">group:1,mean:65.5</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co">group:2,mean:62.8</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co">group:3,mean:64.5</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co">group:4,mean:47.42857142857143</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co">group:5,mean:40.6</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>更に,<code>pandas</code>の<code>.groupby()</code>メソッドを使えば,1行で同じような処理が可能です.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.groupby(<span class="st">'group'</span>).mean())</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co">         points</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co">group</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="co">1      65.500000</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co">2      62.800000</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co">3      64.500000</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="co">4      47.428571</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co">5      40.600000</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>しかし,そのような方法ではいつまでたっても自分でプログラムが書けるようにはなりません.また,便利なメソッドが使えても,その背後で何をしているのかを理解していないと,計算した値の意味を理解したり,正しく利用することができません.</p>
<p>まずは自分の頭でどのように処理することで,求めたい値が計算できるのかの手順を考えて,プログラムが書けるようになったあとで,便利なメソッドなどの利用法を覚えることをおすすめします.</p>
<h4 data-number="1.5.1" id="発展-高階関数"><span class="header-section-number">1.5.1</span> 発展: 高階関数</h4>
<p>Pythonで反復を実現するもう一つの方法として<strong>高階関数</strong>があります.高階関数とは,関数を引数にとる関数であり,こちらも関数型言語から取り入れられ,<code>pandas</code>において<strong>各行に同じ処理を適用したい場合</strong>に良く用いられます.</p>
<p>本資料ではまだ,関数に関して扱っていませんが,発展的内容としてここだけで完結する範囲で簡単に説明します.
興味がある方は, 関数を学んだあとにもう一度こちらを見てみると理解が深まるかもしれません.</p>
<p>以下の<code>DataFrame</code>を事例に考えてみましょう.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'kind'</span>:[<span class="st">'cat'</span>,<span class="st">'dog'</span>,<span class="st">'fish'</span>]</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>                  ,<span class="st">'weight'</span>:[<span class="dv">30</span>,<span class="dv">20</span>,<span class="dv">10</span>]})</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="co">   kind  weight</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co">0   cat      30</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co">1   dog      20</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="co">2  fish      10</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>このデータの<code>kind列</code>を大文字にすることを考えてみましょう.
<code>for文</code>を利用すると以下のようになりますね.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> df.index:</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    df.at[i,<span class="st">'kind'</span>] <span class="op">=</span> df.at[i,<span class="st">'kind'</span>].upper()</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co">   kind  weight</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co">0   CAT      30</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="co">1   DOG      20</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="co">2  FISH      10</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>この処理を,高階関数<code>map()</code>を利用すると,以下のようになります.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'kind'</span>] <span class="op">=</span> df[<span class="st">'kind'</span>].<span class="bu">map</span>(<span class="kw">lambda</span> x : x.upper())</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co">   kind  weight</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co">0   CAT      30</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co">1   DOG      20</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co">2  FISH      10</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p><code>map()</code>は,与えられた<code>DataFrame</code>の列(<code>DataSeries</code>)の各行に対して,<code>()</code>内の処理を適用した結果を返す高階関数です.</p>
<p><code>lambda x: x.upper()</code>を<code>無名関数</code>や<code>ラムダ式</code>といい, <code>lambda 変数: 変数に適用したい処理</code>の形で書きます. 今は,<code>DataSeries</code>の各行を<code>x</code>として,その<code>x</code>に<code>.upper()</code>を適用しています.</p>
<p><code>条件に合致する場合の処理 if 条件 else 合致しない場合の処理</code> と書くことで条件を加えることも可能です.</p>
<p>以下の例では, <code>weight</code>列の値が<code>15</code>より大きければ2倍するという処理を行っています.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'weight'</span>] <span class="op">=</span> df[<span class="st">'weight'</span>].<span class="bu">map</span>(<span class="kw">lambda</span> x: x<span class="op">*</span><span class="dv">2</span> <span class="cf">if</span> x <span class="op">&gt;</span> <span class="dv">15</span> <span class="cf">else</span> x)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="co">   kind  weight</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="co">0   CAT      60</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co">1   DOG      40</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co">2  FISH      10</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>高階関数を使った処理は,<code>for文</code>より簡潔に書けて,かつ処理速度も高速です. 機会があれば積極的に使ってみましょう.</p>
<p>例えば,先程の以下のDataFrameで,<code>year列</code>から年を削除し,<code>value列</code>の空白を<code>150</code>に置き換える処理は高階関数を利用すると以下のように書けます.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>years <span class="op">=</span> [<span class="bu">str</span>(x) <span class="op">+</span> <span class="st">'年'</span> <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1800</span>,<span class="dv">1820</span>)]</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> [<span class="st">'101'</span>,<span class="st">'187'</span>,<span class="st">'150'</span>,<span class="st">'117'</span>,<span class="st">''</span>,<span class="st">'168'</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>         ,<span class="st">'195'</span>,<span class="st">'140'</span>,<span class="st">'151'</span>,<span class="st">'123'</span>,<span class="st">'192'</span>,<span class="st">'137'</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>         ,<span class="st">'なし'</span>,<span class="st">'184'</span>,<span class="st">'136'</span>,<span class="st">'192'</span>,<span class="st">'150'</span>,<span class="st">'163'</span>,<span class="st">'141'</span>,<span class="st">'122'</span>]</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'year'</span>:years</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>                  ,<span class="st">'value'</span>:values})</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>f[<span class="st">'year'</span>] <span class="op">=</span> df[<span class="st">'year'</span>].<span class="bu">map</span>(<span class="kw">lambda</span> x : x[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>f[<span class="st">'value'</span>] <span class="op">=</span> df[<span class="st">'value'</span>].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="st">'150'</span> <span class="cf">if</span> <span class="bu">str</span>.isdecimal(<span class="bu">str</span>(x)) <span class="cf">else</span> x)</span></code></pre></div>
<div class="note">
<ul>
<li>演習問題</li>
</ul>
<p>以下のURLから近世経済データのEXCELファイルをダウンロードし, 米相場の列に欠損値がないように変更し,データの基本的な構造を確認したのち米相場の西暦ごとの平均値を計算し,辞書型に格納してください.</p>
<p><a href="https://www.rieb.kobe-u.ac.jp/project/kinsei-db/database_excel.html">https://www.rieb.kobe-u.ac.jp/project/kinsei-db/database_excel.html</a></p>
</div>
<h3 data-number="1.6" id="関数とクラス"><span class="header-section-number">1.6</span> 関数とクラス</h3>
<p>これまでは,基本的に記述したコードは,コード内で一度しか利用せず,上から順番に一つずつ行いたい処理を記述してきました. しかし,プログラミングを続けていると,同じ処理を何度も適用する場合が出てきます.その場合に,毎回処理を記述するのは労力がかかります.</p>
<p>ここでは, 同じ処理を再利用可能な形でまとめ,様々な場所で利用する方法を学びます.</p>
<p>Pythonでは,基本的に小さな一つの処理は<strong>関数</strong>にまとめて利用します.また,複数の関数やデータ型などを<strong>クラス</strong>という単位にまとめることも可能です.そのようなまとめた塊を組み合わせてプログラムを構築する手法を<strong>オブジェクト指向プログラミング</strong>といいます. 更に,いくつかの関数やクラスをまとめたものを再利用形なファイルにまとめることで<strong>モジュール</strong>が作られ,モジュールに階層構造を設定したものを<strong>ライブラリ</strong>といいます.</p>
<p>この講義では関数の利用法を学びますがクラスやオブジェクト指向プログラミング,モジュールの作成に関しては少し触れるだけにします. 興味がある方は, より専門的なプログラミングの講義などで学習してください.</p>
<h4 data-number="1.6.1" id="関数"><span class="header-section-number">1.6.1</span> 関数</h4>
<p>皆さんはこれまでにもいくつかの関数を利用してきました. 例えば,リストの要素数を求めるための<code>len()</code>や,標準出力するための<code>print()</code>などは関数です.</p>
<p>関数は基本的に<code>()</code>の中に<strong>引数</strong>を与えられて,<strong>返り値</strong>を返します.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>])) <span class="co">#&gt;&gt;&gt; 3</span></span></code></pre></div>
<p>上の<code>len()</code>では,<code>()</code>の中に引数としてリスト<code>[1,2,3]</code>が与えられ,返り値として<code>3</code>を返しています.</p>
<div class="warn">
<p>一方で,関数と似ているが異なる概念として,<code>.mean()</code>のようにオブジェクトの後ろに<code>.</code>を利用してつなげる<strong>メソッド</strong>もあります.
メソッドに関しては, クラスの部分で説明します.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'x'</span>:[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]})</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.mean()) <span class="co">#&gt;&gt;&gt; 2.0</span></span></code></pre></div>
</div>
<p>このように,最初からPythonに実装されている関数を<strong>組み込み関数</strong>といいます.また,特定のライブラリで定義された関数もあります.</p>
<p>組み込み関数としては,<code>len()</code>以外にも,合計値を返す<code>sum()</code>や,文字列に変更する<code>str()</code>などを利用してきました. Pythonの組み込み関数は<a href="https://docs.python.org/ja/3/library/functions.html">こちら</a>で確認できます. 利用法のわからないものに関しては調べてみましょう.</p>
<p>これまでは,無名関数を除いて基本的にすでに作成された関数を利用してきましたが,関数は自分で作成することも可能です.</p>
<p>関数は, <code>def 関数名(引数を表す変数):</code>という構文で定義することができます. インデントブロックの中で,引数に加えた処理を記述し, <code>return 返り値</code>の形で,関数の返り値を定義します.</p>
<p>例えば,要素数を数える<code>length()</code>という関数を実装してみましょう.
まずは,関数にする前に今まで通りにリストの要素数を数えるプログラムを書いてみましょう.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> xs:</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(count) <span class="op">&gt;&gt;&gt;</span> <span class="dv">3</span></span></code></pre></div>
<p>これを関数にしてみます. <code>def length(xs):</code>のインデントブロックに,行いたい処理を記述し,<code>return count</code>で<code>count</code>を返します.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> length(xs):</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> xs:</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>        count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> count</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(length([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>])) <span class="co">#&gt;&gt;&gt; 3</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(length([<span class="st">'a'</span>,<span class="st">'b'</span>])) <span class="co">#&gt;&gt;&gt; 2</span></span></code></pre></div>
<p>関数として定義することで,毎回数を数える処理を記述しなくても,様々なリストの要素数を数えることが可能になりました.</p>
<p>引数には複数の値を指定することも出来ます. 例えば以下の関数<code>get_larger_than(xs,y)</code>は<code>xs</code>の中から<code>y</code>より大きな値のみを返します.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_larger_than(xs,y):</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> []</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> xs:</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> x <span class="op">&gt;</span> y:</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>            result.append(x)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>get_larger_than([<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>],<span class="dv">3</span>) <span class="co">#&gt;&gt;&gt;[4, 5, 6]</span></span></code></pre></div>
<p><code>引数名=デフォルト引数</code> と書くことで,引数にあらかじめ値を指定することも可能です. 関数を実行する際に,何も指定しなければ,デフォルト引数が利用されます.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> greet(name<span class="op">=</span><span class="st">'guest'</span>, greeting<span class="op">=</span><span class="st">&quot;Hello&quot;</span>):</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f'</span><span class="sc">{</span>greeting<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">!'</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co"># デフォルト引数を利用する場合</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(greet())  <span class="co"># Hello, guest!</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="co"># デフォルトの引数の一部を上書きする場合</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(greet(name<span class="op">=</span><span class="st">'Taro'</span>))  <span class="co"># Hello, Taro!</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(greet(greeting<span class="op">=</span><span class="st">'Good Morning'</span>))  <span class="co"># Good Morning, guest!</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 全ての引数を指定する場合</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(greet(name<span class="op">=</span><span class="st">'Taro'</span>, greeting<span class="op">=</span><span class="st">'Good Morning'</span>))  <span class="co"># Good Morning, Taro!</span></span></code></pre></div>
<div class="note">
<ul>
<li>演習問題</li>
</ul>
<ol type="1">
<li><p>与えられた数値のリストの合計値を返す関数</p></li>
<li><p>与えられた数値のリストの最大値を返す関数</p></li>
<li><p>与えられた数値にFizzBuzzの結果を,文字列で返す関数</p></li>
<li><p>組み込み関数の<code>filter()</code>の仕様を調べて自分で実装してください.</p></li>
</ol>
</div>
<h4 data-number="1.6.2" id="発展クラスとインスタンス"><span class="header-section-number">1.6.2</span> 発展:クラスとインスタンス</h4>
<p>先ほど関数を自分で定義して使う方法を学習しましたが,Pythonではデータ型も自分で定義することができます.</p>
<div class="note">
<p><strong>クラス(Class)</strong> とは, データ型,データ型の保有するデータ(<strong>属性</strong>)とデータ型に付随する機能(<strong>メソッド</strong>)を定義する機能です.
クラスを具体化したものを<strong>インスタンス</strong>と呼びます.
また,インスタンスが生成される際に実行されるメソッドを<strong>コンストラクタ</strong>といいます.</p>
</div>
<p>これまでに見た例では,pandasの<code>DataFrame</code>などはライブラリによって新たに定義されたデータ型です. <code>.DataFrame()</code>という<strong>コンストラクタ</strong>によって具体的な<code>DataFrame</code><strong>インスタンス</strong>が生成されます.</p>
<p><code>DataFrame</code>オブジェクトの属性として,<code>shape</code>などを取得することができ,<code>.to_csv()</code>などの<code>DataFrame</code>に特有の機能(<strong>メソッド</strong>)を利用することができました.</p>
<p>それでは,具体的にクラスを作成してみましょう.
ここでは,これまでに何度か出てきた,<code>FizzBuzz</code>専用のクラスを作成してみましょう.</p>
<div class="note">
<p>新しいクラスを宣言するには <code>class クラス名:</code> と記述します. インデントブロック内に,コンストラクタと,メソッドを記述します. クラス名は大文字で始めます.</p>
<p>コンストラクタは, <code>def __init__(self,必要な情報):</code>の形で宣言します. <code>__init__(self,</code>の部分は基本的にすべてのクラスで共通です.
<code>FizzBuzz</code>クラスでは, 数値を引数に取ります. <code>self</code>は,属性やメソッドが属するインスタンスを表す変数でコンストラクタやメソッドの第1引数は常に<code>self</code>となります. <code>self.属性</code>,<code>self.メソッド()</code>などの形で,そのインスタンスの属性やメソッドを定義します.</p>
<p>各インスタンスに固有の属性をインスタンス属性といい,ここでは生成された<code>FizzBuzz</code>インスタンスは<code>.number</code>という属性を持ちます. <code>self.number = number</code>と買うことで生成時に引数として与えられた数値<code>number</code>をインスタンス属性として保存します.</p>
<p>最後に,<code>FizzBuzz</code>ゲームを実行するための機能,<code>.evaluate()</code>を実行します.</p>
</div>
<div class="sourceCode" id="cb63"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># FizzBuzzというクラスを宣言します.</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FizzBuzz:</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">#コンストラクタの定義</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#FizzBazzインスタンスを生成する際に必要となるデータを定義する</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, number):</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">#インスタンス属性</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.number <span class="op">=</span> number</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#メソッド eveluateの定義</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#FizzBuzzインスタンスは,evaluateすることで,`FizzBuzz`の</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">#ゲームが実行されます</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> evaluate(<span class="va">self</span>):</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.number <span class="op">%</span> <span class="dv">3</span> <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> <span class="va">self</span>.number <span class="op">%</span> <span class="dv">5</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;FizzBuzz&quot;</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>.number <span class="op">%</span> <span class="dv">3</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;Fizz&quot;</span></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>.number <span class="op">%</span> <span class="dv">5</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;Buzz&quot;</span></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">str</span>(<span class="va">self</span>.number)</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用例</span></span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 単一の数値を評価</span></span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>fb <span class="op">=</span> FizzBuzz(<span class="dv">15</span>)</span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fb.evaluate())  <span class="co"># FizzBuzz</span></span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>fb <span class="op">=</span> FizzBuzz(<span class="dv">9</span>)</span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fb.evaluate())  <span class="co"># Fizz</span></span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>fb <span class="op">=</span> FizzBuzz(<span class="dv">10</span>)</span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fb.evaluate())  <span class="co"># Buzz</span></span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>fb <span class="op">=</span> FizzBuzz(<span class="dv">7</span>)</span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fb.evaluate())  <span class="co"># 7</span></span></code></pre></div>
<p>クラスの重要な機能に<strong>継承</strong>があります. 継承は新しいクラス(<strong>サブクラス</strong>)を作成する際に,すでにあるクラス(<strong>スーパークラス</strong>)の属性やメソッドを引き継ぐことを意味します. これによって,コードの再利用や,拡張が用意になります.</p>
<p>以下では,先程定義した <code>FizzBuzz</code>クラスを継承して,<code>3</code>と<code>5</code>以外の場合にも特別な挙動をする<code>AdvancedFizzBuzz</code>クラスを定義してみましょう.</p>
<p>サブクラスを定義するには, <code>class サブクラス名(スーパークラス名)</code>と記述します.
インデントブロック内では, <code>super().属性</code>や<code>super().メソッド</code>と書くことで,スーパークラスの属性やメソッドを利用することができます.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 派生クラス AdvancedFizzBuzz</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ()内にスーパークラスを書きます</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AdvancedFizzBuzz(FizzBuzz):</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, number, custom_message<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># スーパークラスの__init__を呼び出す</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(number)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.custom_message <span class="op">=</span> custom_message</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> evaluate(<span class="va">self</span>):</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># スーパークラスのevaluateメソッドを拡張</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># self.custom_message が定義されている場合のみ実行されます</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.custom_message <span class="kw">and</span> <span class="va">self</span>.number <span class="op">%</span> <span class="dv">7</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.custom_message</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>            <span class="co"># スーパークラスのevaluateメソッドを呼び出す</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">super</span>().evaluate()</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a><span class="co"># サブクラスの使用例</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>afb <span class="op">=</span> AdvancedFizzBuzz(<span class="dv">21</span>, custom_message<span class="op">=</span><span class="st">&quot;Hozz&quot;</span>)</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(afb.evaluate())  <span class="co"># Hozz (7で割り切れるためカスタムメッセージ)</span></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>afb <span class="op">=</span> AdvancedFizzBuzz(<span class="dv">10</span>)</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(afb.evaluate())  <span class="co"># Buzz (スーパークラスのメソッドが呼ばれる)</span></span></code></pre></div>
<div class="note">
<ul>
<li>演習</li>
</ul>
<ol type="1">
<li><p>FizzBuzzクラスを拡張して, <code>3</code>かつ<code>5</code>かつ<code>7</code>の倍数のときに<code>Hozz</code>と表示されるようにしてください.</p></li>
<li><p>ジャンケンを行うためのクラスを定義してください.</p></li>
</ol>
</div>
<h2 data-number="2" id="発展-その他のデータの処理"><span class="header-section-number">2</span> (発展) その他のデータの処理</h2>
<p>本講義では基本的に, 扱うデータの種類をExcel及びCSVに限定しています. しかし, 世の中には多くのデータが存在し,選択したテーマによってはCSV以外のデータを読み込む必要があります. ここでは, 本講義において過去に使用されたデータの基本と,その処理方法に関して扱います. ただし,他の章と整合性を取るため基本的な方針として,それらのデータを直接操作するのではなくCSVに変換,あるいは直接pandasのDataFrameオブジェクトへ変換する方針を取ります.</p>
<h3 data-number="2.1" id="ファイル操作"><span class="header-section-number">2.1</span> ファイル操作</h3>
<p>実際のデータ分析では, 以下のような状況に遭遇することがよくあります:</p>
<ul>
<li>データが複数のファイルに分割されている</li>
<li>異なる期間のデータが別々のファイルに保存されている</li>
<li>複数のソースからデータを収集する必要がある</li>
<li>ファイル名やディレクトリ構造に規則性がある</li>
</ul>
<p>このような場合, 個別のファイルを手動で読み込んで結合するのは非効率的です. そのため, プログラムを使って自動的にファイルを探索し, 必要なデータを抽出・結合することが重要になります.</p>
<p>例えば, 以下のような状況を考えてみましょう:
- 毎月のデータが<code>sales_202301.csv</code>, <code>sales_202302.csv</code>のように保存されている
- 複数の店舗のデータが<code>store1/</code>, <code>store2/</code>のように別々のディレクトリに保存されている
- データファイルの中には破損や形式の不一致があるかもしれない</p>
<p>このような場合, ファイル操作のライブラリを使用して, データを効率的に収集・統合することができます.
以下の例では, 月次データが複数のCSVファイルに分割されている状況を想定します.</p>
<p>ファイル操作では主に以下のライブラリを使用します.</p>
<div class="note">
<ul>
<li><code>os</code>: ファイルシステム操作の基本機能を提供</li>
<li><code>glob</code>: ファイル名パターンマッチングに使用</li>
<li><code>pathlib.Path</code>: モダンなファイルパス操作を提供</li>
</ul>
<p>パターンマッチとは, ファイル名やパスに含まれる文字列を特定のパターンで検索する機能です. 例えば, <code>*.csv</code>は「任意の文字列で終わりが.csvのファイル」を表し, <code>data_*.txt</code>は「data_で始まり.txtで終わる任意のファイル」を表します. これにより, 多数のファイルから条件に合うものを効率的に見つけることができます.</p>
<p>これらのライブラリを組み合わせることで、以下のような操作が可能になります.</p>
<ul>
<li><code>glob</code>: ワイルドカード(<code>*</code>)を使用したファイル検索</li>
<li><code>os.path</code>: ファイルの存在確認、サイズ取得など</li>
<li><code>Path</code>: オブジェクト指向的なパス操作</li>
</ul>
</div>
<h4 data-number="2.1.1" id="ファイルの結合"><span class="header-section-number">2.1.1</span> ファイルの結合</h4>
<p>まず, サンプルデータを作成してみましょう.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co"># データディレクトリを作成</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>data_dir <span class="op">=</span> Path(<span class="st">&quot;monthly_data&quot;</span>)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>data_dir.mkdir(exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 2023年の月次データを作成</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> month <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">13</span>):</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 各月のデータを生成</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>    dates <span class="op">=</span> pd.date_range(<span class="ss">f'2023-</span><span class="sc">{</span>month<span class="sc">:02d}</span><span class="ss">-01'</span>, </span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>                         <span class="ss">f'2023-</span><span class="sc">{</span>month<span class="sc">:02d}</span><span class="ss">-28'</span>, freq<span class="op">=</span><span class="st">'D'</span>)</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'date'</span>: dates,</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sales'</span>: np.random.randint(<span class="dv">1000</span>, <span class="dv">5000</span>, <span class="bu">len</span>(dates)),</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'customers'</span>: np.random.randint(<span class="dv">50</span>, <span class="dv">200</span>, <span class="bu">len</span>(dates)),</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'month'</span>: month</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame(data)</span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> data_dir <span class="op">/</span> <span class="ss">f&quot;sales_2023</span><span class="sc">{</span>month<span class="sc">:02d}</span><span class="ss">.csv&quot;</span></span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>    df.to_csv(filename, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;作成: </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;サンプルデータの作成が完了しました&quot;</span>)</span></code></pre></div>
<div class="note">
<ul>
<li><p><code>Path("monthly_data")</code>: pathlibのPathクラスを使用してパスオブジェクトを作成します.
これにより, WindowsやMacなどOSに依存しない形でパス操作が可能になります.</p></li>
<li><p><code>mkdir(exist_ok=True)</code>: ディレクトリを作成するメソッドです.
exist_ok=Trueを指定することで, 既にディレクトリが存在する場合でもエラーを発生させません.</p></li>
<li><p><code>filename = data_dir / f"sales_2023{month:02d}.csv"</code>:
Pathオブジェクトでは, /演算子を使用してパスを結合できます.
この例では, data_dirディレクトリパスと各月のファイル名を結合して,
完全なファイルパスを生成しています.</p></li>
</ul>
</div>
<p><code>ls</code>コマンドでファイルが存在してるか確認してみましょう.
~~~ shell
ls monthly_data
sales_202301.csv sales_202303.csv sales_202305.csv sales_202307.csv sales_202309.csv sales_202311.csv
sales_202302.csv sales_202304.csv sales_202306.csv sales_202308.csv sales_202310.csv sales_202312.csv
~~~</p>
<p>データの中身を<code>cat</code>コマンドで確認してみます.
catコマンドは, ファイルの内容を表示するためのUNIXコマンドです. 複数のファイルを指定すると, それらを連結して表示することもできます.</p>
<pre class="shell"><code>❯ cat monthly_data/sales_202301.csv
date,sales,customers,month
2023-01-01,1575,100,1
2023-01-02,4531,79,1
2023-01-03,4385,142,1
2023-01-04,4350,64,1
2023-01-05,4718,197,1
2023-01-06,4782,126,1
2023-01-07,4322,146,1
2023-01-08,3027,52,1
2023-01-09,3671,102,1
2023-01-10,2535,158,1
2023-01-11,4810,66,1
2023-01-12,3868,162,1
2023-01-13,1770,145,1
2023-01-14,2280,162,1
2023-01-15,3904,76,1
2023-01-16,4240,151,1
2023-01-17,3532,54,1
2023-01-18,3114,172,1
2023-01-19,3107,91,1
2023-01-20,1123,83,1
2023-01-21,1076,139,1
2023-01-22,2953,77,1
2023-01-23,1324,156,1
2023-01-24,4330,180,1
2023-01-25,4154,57,1
2023-01-26,4398,126,1
2023-01-27,2964,190,1
2023-01-28,4372,173,1</code></pre>
<p>次に, 作成したファイルを自動的に読み込んで結合する処理を行います.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co"># パターンにマッチするファイルを検索</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>pattern <span class="op">=</span> <span class="st">&quot;monthly_data/sales_*.csv&quot;</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>files <span class="op">=</span> glob.glob(pattern)</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ファイルが見つからない場合の処理</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> files:</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;パターン '</span><span class="sc">{</span>pattern<span class="sc">}</span><span class="ss">' にマッチするファイルが見つかりません&quot;</span>)</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 各ファイルを読み込んでリストに格納</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>    dataframes <span class="op">=</span> []</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> <span class="bu">sorted</span>(files):  <span class="co"># ファイル名でソート</span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> pd.read_csv(<span class="bu">file</span>)</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>            <span class="co"># ファイル名から月を抽出</span></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 例: &quot;monthly_data/sales_202301.csv&quot; → &quot;202301&quot; → &quot;01&quot; → 1</span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>            month <span class="op">=</span> <span class="bu">int</span>(<span class="bu">file</span>.split(<span class="st">'.'</span>)[<span class="dv">0</span>][<span class="op">-</span><span class="dv">2</span>:])</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>            df[<span class="st">'source_file'</span>] <span class="op">=</span> <span class="bu">file</span>  <span class="co"># 元のファイル名を記録</span></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>            df[<span class="st">'month'</span>] <span class="op">=</span> month       <span class="co"># 月の数字を追加</span></span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>            dataframes.append(df)     <span class="co"># リストにDataFrameを追加</span></span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;読み込み完了: </span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">}</span><span class="ss"> 行)&quot;</span>)</span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;エラー - </span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 読み込んだファイルがある場合の処理</span></span>
<span id="cb67-33"><a href="#cb67-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> dataframes:</span>
<span id="cb67-34"><a href="#cb67-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># すべてのDataFrameを縦方向に結合</span></span>
<span id="cb67-35"><a href="#cb67-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ignore_index=True: 元のインデックスを無視して新しい連続したインデックスを付与</span></span>
<span id="cb67-36"><a href="#cb67-36" aria-hidden="true" tabindex="-1"></a>        combined_df <span class="op">=</span> pd.concat(dataframes, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb67-37"><a href="#cb67-37" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">結合完了: 総行数 </span><span class="sc">{</span><span class="bu">len</span>(combined_df)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb67-38"><a href="#cb67-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb67-39"><a href="#cb67-39" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">結合されたデータの概要:&quot;</span>)</span>
<span id="cb67-40"><a href="#cb67-40" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(combined_df.head())</span>
<span id="cb67-41"><a href="#cb67-41" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">月別の行数:&quot;</span>)</span>
<span id="cb67-42"><a href="#cb67-42" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(combined_df.groupby(<span class="st">'month'</span>).size())</span>
<span id="cb67-43"><a href="#cb67-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb67-44"><a href="#cb67-44" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;読み込めるファイルがありませんでした&quot;</span>)</span></code></pre></div>
<div class="note">
<p><strong>重要なポイントの説明:</strong></p>
<ul>
<li><p><code>not files</code>: filesリストが空の場合（パターンにマッチするファイルが見つからない場合）にTrueになります</p></li>
<li><p><code>month = int(file.split('_')[1].split('.')[0][-2:])</code>:
ファイル名から月の数字を抽出する処理です. 例として”monthly_data/sales_202301.csv”から”01”を抽出して整数1に変換します</p></li>
<li><p><code>dataframes.append(df)</code>:
読み込んだDataFrameをリストに追加します. これにより各ファイルのデータを順次蓄積していきます</p></li>
<li><p><code>pd.concat(dataframes, ignore_index=True)</code>:
複数のDataFrameを縦方向（行方向）に結合します. ignore_index=Trueにより元のインデックスを無視して新しい連続したインデックスを付与します</p></li>
</ul>
</div>
<p>複数ファイルの結合において,<code>pandas</code>の<code>concat</code>メソッドは重要です.</p>
<div class="note">
<p><code>pd.concat()</code>は複数のDataFrameを結合するための関数です. 主なパラメータは以下の通りです.</p>
<p><strong>横結合/縦結合</strong>
- <code>axis=0</code>（デフォルト）: 縦方向（行方向）に結合 - <strong>列名が同じ場合に使用</strong>
- <code>axis=1</code>: 横方向（列方向）に結合 - <strong>列名が異なる場合に使用</strong></p>
<p><strong>ignore_index</strong>
- <code>ignore_index=True</code>: 元のインデックスを無視して新しい連続したインデックスを付与
- <code>ignore_index=False</code>: 元のインデックスを保持</p>
<p><strong>jpin</strong>
- <code>join='inner'</code>: 両方のDataFrameに共通するインデックスのみを保持
- <code>join='outer'</code>: すべてのインデックスを保持（欠損値はNaN）</p>
</div>
<p><strong>縦結合（axis=0）の例 - 列名が同じ場合:</strong></p>
<div class="sourceCode" id="cb68"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 同じ列名を持つDataFrame</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> pd.DataFrame({</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'date'</span>: [<span class="st">'2023-01-01'</span>, <span class="st">'2023-01-02'</span>],</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sales'</span>: [<span class="dv">1000</span>, <span class="dv">2000</span>],</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'month'</span>: [<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pd.DataFrame({</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'date'</span>: [<span class="st">'2023-02-01'</span>, <span class="st">'2023-02-02'</span>],</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sales'</span>: [<span class="dv">3000</span>, <span class="dv">4000</span>],</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'month'</span>: [<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;df1:&quot;</span>)</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df1)</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">df2:&quot;</span>)</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df2)</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a><span class="co">df1:</span></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a><span class="co">         date  sales  month</span></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a><span class="co">0  2023-01-01   1000      1</span></span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a><span class="co">1  2023-01-02   2000      1</span></span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a><span class="co">df2:</span></span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a><span class="co">         date  sales  month</span></span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a><span class="co">0  2023-02-01   3000      2</span></span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a><span class="co">1  2023-02-02   4000      2</span></span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 縦方向に結合 (ignore_index=True)</span></span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a>combined <span class="op">=</span> pd.concat([df1, df2], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">ignor_index=True:&quot;</span>)</span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(combined)</span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a><span class="co">         date  sales  month</span></span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a><span class="co">0  2023-01-01   1000      1</span></span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a><span class="co">1  2023-01-02   2000      1</span></span>
<span id="cb68-40"><a href="#cb68-40" aria-hidden="true" tabindex="-1"></a><span class="co">2  2023-02-01   3000      2</span></span>
<span id="cb68-41"><a href="#cb68-41" aria-hidden="true" tabindex="-1"></a><span class="co">3  2023-02-02   4000      2</span></span>
<span id="cb68-42"><a href="#cb68-42" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb68-43"><a href="#cb68-43" aria-hidden="true" tabindex="-1"></a><span class="co"># 縦方向に結合 (ignore_index=False)</span></span>
<span id="cb68-44"><a href="#cb68-44" aria-hidden="true" tabindex="-1"></a>combined <span class="op">=</span> pd.concat([df1, df2], ignore_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb68-45"><a href="#cb68-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">ignor_index=False:&quot;</span>)</span>
<span id="cb68-46"><a href="#cb68-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(combined)</span>
<span id="cb68-47"><a href="#cb68-47" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb68-48"><a href="#cb68-48" aria-hidden="true" tabindex="-1"></a><span class="co">ignor_index=False:</span></span>
<span id="cb68-49"><a href="#cb68-49" aria-hidden="true" tabindex="-1"></a><span class="co">         date  sales  month</span></span>
<span id="cb68-50"><a href="#cb68-50" aria-hidden="true" tabindex="-1"></a><span class="co">0  2023-01-01   1000      1</span></span>
<span id="cb68-51"><a href="#cb68-51" aria-hidden="true" tabindex="-1"></a><span class="co">1  2023-01-02   2000      1</span></span>
<span id="cb68-52"><a href="#cb68-52" aria-hidden="true" tabindex="-1"></a><span class="co">0  2023-02-01   3000      2</span></span>
<span id="cb68-53"><a href="#cb68-53" aria-hidden="true" tabindex="-1"></a><span class="co">1  2023-02-02   4000      2</span></span>
<span id="cb68-54"><a href="#cb68-54" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p><strong>横結合（axis=1）の例 - 列名が異なる場合:</strong></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 異なる列名を持つDataFrame</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>df_sales <span class="op">=</span> pd.DataFrame({</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'date'</span>: [<span class="st">'2023-01-01'</span>, <span class="st">'2023-01-02'</span>, <span class="st">'2023-01-03'</span>],</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sales'</span>: [<span class="dv">1000</span>, <span class="dv">2000</span>, <span class="dv">1500</span>]</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>df_customers <span class="op">=</span> pd.DataFrame({</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'date'</span>: [<span class="st">'2023-01-01'</span>, <span class="st">'2023-01-02'</span>, <span class="st">'2023-01-03'</span>],</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'customers'</span>: [<span class="dv">50</span>, <span class="dv">80</span>, <span class="dv">60</span>]</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;売上データ:&quot;</span>)</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_sales)</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">顧客数データ:&quot;</span>)</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_customers)</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a><span class="co">売上データ:</span></span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a><span class="co">         date  sales</span></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a><span class="co">0  2023-01-01   1000</span></span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a><span class="co">1  2023-01-02   2000</span></span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a><span class="co">2  2023-01-03   1500</span></span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a><span class="co">顧客数データ:</span></span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a><span class="co">         date  customers</span></span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a><span class="co">0  2023-01-01         50</span></span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a><span class="co">1  2023-01-02         80</span></span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a><span class="co">2  2023-01-03         60</span></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 横方向に結合（列名が異なるので横結合が適切）</span></span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>combined <span class="op">=</span> pd.concat([df_sales, df_customers], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">横結合後:&quot;</span>)</span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(combined)</span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a><span class="co">横結合後:</span></span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a><span class="co">         date  sales        date  customers</span></span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true" tabindex="-1"></a><span class="co">0  2023-01-01   1000  2023-01-01         50</span></span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true" tabindex="-1"></a><span class="co">1  2023-01-02   2000  2023-01-02         80</span></span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a><span class="co">2  2023-01-03   1500  2023-01-03         60</span></span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a><span class="co"># 重複するdate列を削除</span></span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true" tabindex="-1"></a><span class="co"># combined.columns.duplicated() で重複する列名をTrue/Falseで判定</span></span>
<span id="cb69-47"><a href="#cb69-47" aria-hidden="true" tabindex="-1"></a><span class="co"># 論理否定演算子~ を用いて ~combined.columns.duplicated() で重複していない列のみをTrueに変換</span></span>
<span id="cb69-48"><a href="#cb69-48" aria-hidden="true" tabindex="-1"></a><span class="co"># combined.loc[:, ~combined.columns.duplicated()] で重複していない列のみを選択</span></span>
<span id="cb69-49"><a href="#cb69-49" aria-hidden="true" tabindex="-1"></a>combined_clean <span class="op">=</span> combined.loc[:, <span class="op">~</span>combined.columns.duplicated()]</span>
<span id="cb69-50"><a href="#cb69-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">重複列を削除後:&quot;</span>)</span>
<span id="cb69-51"><a href="#cb69-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(combined_clean)</span>
<span id="cb69-52"><a href="#cb69-52" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb69-53"><a href="#cb69-53" aria-hidden="true" tabindex="-1"></a><span class="co">重複列を削除後:</span></span>
<span id="cb69-54"><a href="#cb69-54" aria-hidden="true" tabindex="-1"></a><span class="co">         date  sales  customers</span></span>
<span id="cb69-55"><a href="#cb69-55" aria-hidden="true" tabindex="-1"></a><span class="co">0  2023-01-01   1000         50</span></span>
<span id="cb69-56"><a href="#cb69-56" aria-hidden="true" tabindex="-1"></a><span class="co">1  2023-01-02   2000         80</span></span>
<span id="cb69-57"><a href="#cb69-57" aria-hidden="true" tabindex="-1"></a><span class="co">2  2023-01-03   1500         60</span></span>
<span id="cb69-58"><a href="#cb69-58" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p><strong>joinパラメータを使用した結合の例:</strong></p>
<div class="sourceCode" id="cb70"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># インデックスが異なるDataFrame</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>df_left <span class="op">=</span> pd.DataFrame({</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sales'</span>: [<span class="dv">1000</span>, <span class="dv">2000</span>, <span class="dv">3000</span>]</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>}, index<span class="op">=</span>[<span class="st">'2023-01-01'</span>, <span class="st">'2023-01-02'</span>, <span class="st">'2023-01-03'</span>])</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>df_right <span class="op">=</span> pd.DataFrame({</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'customers'</span>: [<span class="dv">50</span>, <span class="dv">80</span>, <span class="dv">60</span>, <span class="dv">90</span>]</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>}, index<span class="op">=</span>[<span class="st">'2023-01-01'</span>, <span class="st">'2023-01-02'</span>, <span class="st">'2023-01-04'</span>, <span class="st">'2023-01-05'</span>])</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;左側のデータ:&quot;</span>)</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_left)</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">右側のデータ:&quot;</span>)</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_right)</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a><span class="co">左側のデータ:</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a><span class="co">            sales</span></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a><span class="co">2023-01-01   1000</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a><span class="co">2023-01-02   2000</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a><span class="co">2023-01-03   3000</span></span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a><span class="co">右側のデータ:</span></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a><span class="co">            customers</span></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a><span class="co">2023-01-01         50</span></span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a><span class="co">2023-01-02         80</span></span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a><span class="co">2023-01-04         60</span></span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a><span class="co">2023-01-05         90</span></span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a><span class="co"># inner join（共通のインデックスのみ）</span></span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a>combined_inner <span class="op">=</span> pd.concat([df_left, df_right], axis<span class="op">=</span><span class="dv">1</span>, join<span class="op">=</span><span class="st">'inner'</span>)</span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">inner join:&quot;</span>)</span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(combined_inner)</span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a><span class="co">inner join:</span></span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a><span class="co">            sales  customers</span></span>
<span id="cb70-38"><a href="#cb70-38" aria-hidden="true" tabindex="-1"></a><span class="co">2023-01-01   1000         50</span></span>
<span id="cb70-39"><a href="#cb70-39" aria-hidden="true" tabindex="-1"></a><span class="co">2023-01-02   2000         80</span></span>
<span id="cb70-40"><a href="#cb70-40" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb70-41"><a href="#cb70-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-42"><a href="#cb70-42" aria-hidden="true" tabindex="-1"></a><span class="co"># outer join（すべてのインデックス）</span></span>
<span id="cb70-43"><a href="#cb70-43" aria-hidden="true" tabindex="-1"></a>combined_outer <span class="op">=</span> pd.concat([df_left, df_right], axis<span class="op">=</span><span class="dv">1</span>, join<span class="op">=</span><span class="st">'outer'</span>)</span>
<span id="cb70-44"><a href="#cb70-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">outer join:&quot;</span>)</span>
<span id="cb70-45"><a href="#cb70-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(combined_outer)</span>
<span id="cb70-46"><a href="#cb70-46" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb70-47"><a href="#cb70-47" aria-hidden="true" tabindex="-1"></a><span class="co">outer join:</span></span>
<span id="cb70-48"><a href="#cb70-48" aria-hidden="true" tabindex="-1"></a><span class="co">             sales  customers</span></span>
<span id="cb70-49"><a href="#cb70-49" aria-hidden="true" tabindex="-1"></a><span class="co">2023-01-01  1000.0       50.0</span></span>
<span id="cb70-50"><a href="#cb70-50" aria-hidden="true" tabindex="-1"></a><span class="co">2023-01-02  2000.0       80.0</span></span>
<span id="cb70-51"><a href="#cb70-51" aria-hidden="true" tabindex="-1"></a><span class="co">2023-01-03  3000.0        NaN</span></span>
<span id="cb70-52"><a href="#cb70-52" aria-hidden="true" tabindex="-1"></a><span class="co">2023-01-04     NaN       60.0</span></span>
<span id="cb70-53"><a href="#cb70-53" aria-hidden="true" tabindex="-1"></a><span class="co">2023-01-05     NaN       90.0</span></span>
<span id="cb70-54"><a href="#cb70-54" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<h4 data-number="2.1.2" id="複数ディレクトリの操作"><span class="header-section-number">2.1.2</span> 複数ディレクトリの操作</h4>
<p>複数の店舗や部門のデータが別々のディレクトリに保存されている場合の処理例です.</p>
<h4 data-number="2.1.3" id="サンプルデータの作成"><span class="header-section-number">2.1.3</span> サンプルデータの作成</h4>
<p>まずは,ディレクトリとデータを生成してみます.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 店舗名のリスト</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>stores <span class="op">=</span> [<span class="st">'store1'</span>, <span class="st">'store2'</span>, <span class="st">'store3'</span>]</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 各店舗のデータを作成</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> store <span class="kw">in</span> stores:</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 店舗ディレクトリを作成</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>    store_dir <span class="op">=</span> Path(<span class="ss">f&quot;store_data/</span><span class="sc">{</span>store<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>    store_dir.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 各店舗の月次データを作成</span></span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> month <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">13</span>):</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>        dates <span class="op">=</span> pd.date_range(<span class="ss">f'2023-</span><span class="sc">{</span>month<span class="sc">:02d}</span><span class="ss">-01'</span>, </span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>                             <span class="ss">f'2023-</span><span class="sc">{</span>month<span class="sc">:02d}</span><span class="ss">-28'</span>, freq<span class="op">=</span><span class="st">'D'</span>)</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 店舗ごとに異なる売上パターンを設定</span></span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>        base_sales <span class="op">=</span> {<span class="st">'store1'</span>: <span class="dv">2000</span>, <span class="st">'store2'</span>: <span class="dv">3000</span>, <span class="st">'store3'</span>: <span class="dv">1500</span>}</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>        sales <span class="op">=</span> np.random.normal(base_sales[store], <span class="dv">500</span>, <span class="bu">len</span>(dates))</span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> {</span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">'date'</span>: dates,</span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">'sales'</span>: sales,</span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">'store'</span>: store,</span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">'month'</span>: month</span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.DataFrame(data)</span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a>        filename <span class="op">=</span> store_dir <span class="op">/</span> <span class="ss">f&quot;sales_</span><span class="sc">{</span>store<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>month<span class="sc">:02d}</span><span class="ss">.csv&quot;</span></span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true" tabindex="-1"></a>        df.to_csv(filename, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb71-33"><a href="#cb71-33" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;作成: </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb71-34"><a href="#cb71-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-35"><a href="#cb71-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;店舗別データの作成が完了しました&quot;</span>)</span></code></pre></div>
<p>データを確認してみます.</p>
<pre><code>❯ tree store_data
store_data
├── store1
│   ├── sales_store1_01.csv
│   ├── sales_store1_02.csv
│   ├── sales_store1_03.csv
│   ├── sales_store1_04.csv
│   ├── sales_store1_05.csv
│   ├── sales_store1_06.csv
│   ├── sales_store1_07.csv
│   ├── sales_store1_08.csv
│   ├── sales_store1_09.csv
│   ├── sales_store1_10.csv
│   ├── sales_store1_11.csv
│   └── sales_store1_12.csv
├── store2
│   ├── sales_store2_01.csv
│   ├── sales_store2_02.csv
│   ├── sales_store2_03.csv
│   ├── sales_store2_04.csv
│   ├── sales_store2_05.csv
│   ├── sales_store2_06.csv
│   ├── sales_store2_07.csv
│   ├── sales_store2_08.csv
│   ├── sales_store2_09.csv
│   ├── sales_store2_10.csv
│   ├── sales_store2_11.csv
│   └── sales_store2_12.csv
└── store3
    ├── sales_store3_01.csv
    ├── sales_store3_02.csv
    ├── sales_store3_03.csv
    ├── sales_store3_04.csv
    ├── sales_store3_05.csv
    ├── sales_store3_06.csv
    ├── sales_store3_07.csv
    ├── sales_store3_08.csv
    ├── sales_store3_09.csv
    ├── sales_store3_10.csv
    ├── sales_store3_11.csv
    └── sales_store3_12.csv</code></pre>
<p>作成した店舗別データを収集して結合します.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ベースディレクトリのパス</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>base_dir <span class="op">=</span> <span class="st">&quot;store_data&quot;</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>base_path <span class="op">=</span> Path(base_dir)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>all_data <span class="op">=</span> []</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 各店舗ディレクトリを処理</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> store_dir <span class="kw">in</span> base_path.iterdir():</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> store_dir.is_dir():</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>        store_name <span class="op">=</span> store_dir.name</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;処理中: </span><span class="sc">{</span>store_name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 店舗ディレクトリ内のCSVファイルを検索</span></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>        csv_files <span class="op">=</span> <span class="bu">list</span>(store_dir.glob(<span class="st">&quot;*.csv&quot;</span>))</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> csv_file <span class="kw">in</span> <span class="bu">sorted</span>(csv_files):</span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>                df <span class="op">=</span> pd.read_csv(csv_file)</span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>                df[<span class="st">'store'</span>] <span class="op">=</span> store_name</span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>                df[<span class="st">'source_file'</span>] <span class="op">=</span> <span class="bu">str</span>(csv_file)</span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>                all_data.append(df)</span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f&quot;  読み込み: </span><span class="sc">{</span>csv_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f&quot;  エラー - </span><span class="sc">{</span>csv_file<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a><span class="co"># データが収集できた場合の処理</span></span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> all_data:</span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;読み込めるデータがありませんでした&quot;</span>)</span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># すべてのデータを結合</span></span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true" tabindex="-1"></a>    combined_df <span class="op">=</span> pd.concat(all_data, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb73-37"><a href="#cb73-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">収集完了: 総行数 </span><span class="sc">{</span><span class="bu">len</span>(combined_df)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb73-38"><a href="#cb73-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(combined_df)</span>
<span id="cb73-39"><a href="#cb73-39" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb73-40"><a href="#cb73-40" aria-hidden="true" tabindex="-1"></a><span class="co">収集完了: 総行数 1008</span></span>
<span id="cb73-41"><a href="#cb73-41" aria-hidden="true" tabindex="-1"></a><span class="co">            date        sales   store  month                            source_file</span></span>
<span id="cb73-42"><a href="#cb73-42" aria-hidden="true" tabindex="-1"></a><span class="co">0     2023-01-01  1224.888300  store1      1  store_data/store1/sales_store1_01.csv</span></span>
<span id="cb73-43"><a href="#cb73-43" aria-hidden="true" tabindex="-1"></a><span class="co">1     2023-01-02  2598.341936  store1      1  store_data/store1/sales_store1_01.csv</span></span>
<span id="cb73-44"><a href="#cb73-44" aria-hidden="true" tabindex="-1"></a><span class="co">2     2023-01-03  1632.373470  store1      1  store_data/store1/sales_store1_01.csv</span></span>
<span id="cb73-45"><a href="#cb73-45" aria-hidden="true" tabindex="-1"></a><span class="co">3     2023-01-04  2807.153794  store1      1  store_data/store1/sales_store1_01.csv</span></span>
<span id="cb73-46"><a href="#cb73-46" aria-hidden="true" tabindex="-1"></a><span class="co">4     2023-01-05  1835.156832  store1      1  store_data/store1/sales_store1_01.csv</span></span>
<span id="cb73-47"><a href="#cb73-47" aria-hidden="true" tabindex="-1"></a><span class="co">...          ...          ...     ...    ...                                    ...</span></span>
<span id="cb73-48"><a href="#cb73-48" aria-hidden="true" tabindex="-1"></a><span class="co">1003  2023-12-24  2300.085257  store3     12  store_data/store3/sales_store3_12.csv</span></span>
<span id="cb73-49"><a href="#cb73-49" aria-hidden="true" tabindex="-1"></a><span class="co">1004  2023-12-25  2537.667225  store3     12  store_data/store3/sales_store3_12.csv</span></span>
<span id="cb73-50"><a href="#cb73-50" aria-hidden="true" tabindex="-1"></a><span class="co">1005  2023-12-26  1482.390704  store3     12  store_data/store3/sales_store3_12.csv</span></span>
<span id="cb73-51"><a href="#cb73-51" aria-hidden="true" tabindex="-1"></a><span class="co">1006  2023-12-27  1283.915166  store3     12  store_data/store3/sales_store3_12.csv</span></span>
<span id="cb73-52"><a href="#cb73-52" aria-hidden="true" tabindex="-1"></a><span class="co">1007  2023-12-28  1517.512984  store3     12  store_data/store3/sales_store3_12.csv</span></span>
<span id="cb73-53"><a href="#cb73-53" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<div class="note">
<ul>
<li><p><code>base_dir = "store_data"</code>: データが格納されているベースディレクトリを指定します</p></li>
<li><p><code>base_path = Path(base_dir)</code>: pathlibのPathオブジェクトを作成し、パス操作を簡単にします</p></li>
<li><p><code>base_path.iterdir()</code>: ディレクトリ内のすべてのファイル/ディレクトリを列挙します</p></li>
<li><p><code>store_dir.is_dir()</code>: パスがディレクトリであることを確認します</p></li>
<li><p><code>store_dir.glob("*.csv")</code>: 指定ディレクトリ内の全CSVファイルを検索します</p></li>
<li><p><code>df['store'] = store_name</code>: 各データに店舗名を追加します</p></li>
<li><p><code>df['source_file'] = str(csv_file)</code>: データの出所を追跡できるようにファイル名を記録します</p></li>
<li><p><code>pd.concat(all_data, ignore_index=True)</code>: 全てのデータフレームを結合します</p></li>
</ul>
</div>
<h3 data-number="2.2" id="xml"><span class="header-section-number">2.2</span> XML</h3>
<p>XMLは<strong>Extensible Markup Language</strong>の略で, データを階層構造(ツリー構造)で表現するためのマークアップ言語です.</p>
<p>XMLの基本的な構造は以下のようになっています.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;UTF-8&quot;</span><span class="fu">?&gt;</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">root</span>&gt;</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">person</span><span class="ot"> id=</span><span class="st">&quot;001&quot;</span><span class="ot"> age=</span><span class="st">&quot;25&quot;</span><span class="ot"> city=</span><span class="st">&quot;Tokyo&quot;</span>&gt;</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">name</span>&gt;田中太郎&lt;/<span class="kw">name</span>&gt;</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">email</span>&gt;tanaka@example.com&lt;/<span class="kw">email</span>&gt;</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">person</span>&gt;</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">person</span><span class="ot"> id=</span><span class="st">&quot;002&quot;</span><span class="ot"> age=</span><span class="st">&quot;30&quot;</span><span class="ot"> city=</span><span class="st">&quot;Osaka&quot;</span>&gt;</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">name</span>&gt;佐藤花子&lt;/<span class="kw">name</span>&gt;</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">email</span>&gt;sato@example.com&lt;/<span class="kw">email</span>&gt;</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">person</span>&gt;</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">person</span><span class="ot"> id=</span><span class="st">&quot;003&quot;</span><span class="ot"> age=</span><span class="st">&quot;28&quot;</span><span class="ot"> city=</span><span class="st">&quot;Kyoto&quot;</span>&gt;</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">name</span>&gt;鈴木一郎&lt;/<span class="kw">name</span>&gt;</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">email</span>&gt;suzuki@example.com&lt;/<span class="kw">email</span>&gt;</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">person</span>&gt;</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">root</span>&gt;</span></code></pre></div>
<p>XMLでは, <code>&lt;タグ名&gt;</code>と<code>&lt;/タグ名&gt;</code>で囲まれた部分を<strong>要素</strong>と呼び, 要素の中に他の要素やデータを格納できます. また, <code>&lt;タグ名 属性名="値"&gt;</code>の形で<strong>属性</strong>を指定することもできます.</p>
<h4 data-number="2.2.1" id="xmlの属性について"><span class="header-section-number">2.2.1</span> XMLの属性について</h4>
<p>XMLの属性は, 要素に関する追加情報を提供するために使用されます. 属性は要素の開始タグ内に記述され, <code>属性名="値"</code>の形式で指定します.</p>
<h5 data-number="2.2.1.1" id="属性の例"><span class="header-section-number">2.2.1.1</span> 属性の例</h5>
<div class="sourceCode" id="cb75"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">person</span><span class="ot"> id=</span><span class="st">&quot;001&quot;</span><span class="ot"> age=</span><span class="st">&quot;25&quot;</span><span class="ot"> city=</span><span class="st">&quot;Tokyo&quot;</span>&gt;</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">name</span>&gt;田中太郎&lt;/<span class="kw">name</span>&gt;</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">email</span>&gt;tanaka@example.com&lt;/<span class="kw">email</span>&gt;</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">person</span>&gt;</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">book</span><span class="ot"> isbn=</span><span class="st">&quot;978-4-1234-5678-9&quot;</span><span class="ot"> price=</span><span class="st">&quot;1500&quot;</span><span class="ot"> category=</span><span class="st">&quot;小説&quot;</span>&gt;</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">title</span>&gt;データサイエンス入門&lt;/<span class="kw">title</span>&gt;</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">author</span>&gt;山田花子&lt;/<span class="kw">author</span>&gt;</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">book</span>&gt;</span></code></pre></div>
<p>上記の例では:
- <code>person</code>要素には<code>id</code>, <code>age</code>, <code>city</code>という属性があります
- <code>book</code>要素には<code>isbn</code>, <code>price</code>, <code>category</code>という属性があります</p>
<h5 data-number="2.2.1.2" id="属性の特徴"><span class="header-section-number">2.2.1.2</span> 属性の特徴</h5>
<ol type="1">
<li><strong>要素の識別</strong>: <code>id</code>属性を使って要素を一意に識別できます</li>
<li><strong>メタデータの格納</strong>: 要素に関する追加情報（年齢, 価格, カテゴリなど）を格納できます</li>
<li><strong>検索・フィルタリング</strong>: 属性値を使って要素を検索したり, フィルタリングしたりできます</li>
<li><strong>データの分類</strong>: <code>category</code>や<code>type</code>などの属性でデータを分類できます</li>
</ol>
<h5 data-number="2.2.1.3" id="属性と子要素の使い分け"><span class="header-section-number">2.2.1.3</span> 属性と子要素の使い分け</h5>
<p>同じ情報を属性としても子要素としても表現できますが, 使い分けの指針があります:</p>
<p><strong>属性を使う場合:</strong>
- 要素の識別子（ID, 名前など）
- 単純な値（数値, 真偽値など）
- メタデータ（作成日, バージョンなど）</p>
<p><strong>子要素を使う場合:</strong>
- 複雑な構造を持つデータ
- 長いテキスト
- 複数の値を持つデータ</p>
<p>上記のXMLデータをツリー構造で表現すると以下のようになります.</p>
<pre><code>root
├── person (id=&quot;001&quot;, age=&quot;25&quot;, city=&quot;Tokyo&quot;)
│   ├── name: &quot;田中太郎&quot;
│   └── email: &quot;tanaka@example.com&quot;
├── person (id=&quot;002&quot;, age=&quot;30&quot;, city=&quot;Osaka&quot;)
│   ├── name: &quot;佐藤花子&quot;
│   └── email: &quot;sato@example.com&quot;
└── person (id=&quot;003&quot;, age=&quot;28&quot;, city=&quot;Kyoto&quot;)
    ├── name: &quot;鈴木一郎&quot;
    └── email: &quot;suzuki@example.com&quot;</code></pre>
<p>このツリー構造では, 各要素がノードとして表現され, 親子関係が矢印で示されています. <code>person</code>要素には<code>id</code>, <code>age</code>, <code>city</code>という属性が付いており, その下に<code>name</code>と<code>email</code>の子要素があります.</p>
<h4 data-number="2.2.2" id="xmlデータの読み込み"><span class="header-section-number">2.2.2</span> XMLデータの読み込み</h4>
<p>PythonでXMLデータを扱うには, <code>xml.etree.ElementTree</code>モジュールを使用します. 以下の例では, XMLファイルを読み込んでpandasのDataFrameに変換する方法を示します.
<code>xml.etree.ElementTree</code>はPythonの標準ライブラリなので, 追加インストールは不要です.</p>
<p>xmlをどのようなテーブルデータに変更するかは,目的と元のxmlファイルによりますが,ここでは属性を含むサンプルxmlファイルを<code>test.xml</code>として保存し,<code>person</code>毎に<code>id</code>,<code>age</code>,<code>city</code>,<code>name</code>,<code>email</code>を持つテーブルデータに変換してみます.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xml.etree.ElementTree <span class="im">as</span> ET  <span class="co"># XMLファイルを解析するためのライブラリ</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co"># XMLファイルを読み込んで解析する</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>tree <span class="op">=</span> ET.parse(<span class="st">'test.xml'</span>)         <span class="co"># XMLファイルをパースしてツリー構造を作成</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>root <span class="op">=</span> tree.getroot()               <span class="co"># ルート要素を取得</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="co"># XMLからデータを抽出してリストに格納</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> []                           <span class="co"># 最終的なデータを格納するリスト</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> person <span class="kw">in</span> root.findall(<span class="st">'person'</span>):  <span class="co"># 'person'タグを持つすべての要素を検索</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 属性の値を取得</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>    person_id <span class="op">=</span> person.get(<span class="st">'id'</span>)     <span class="co"># id属性の値を取得</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>    age <span class="op">=</span> person.get(<span class="st">'age'</span>)          <span class="co"># age属性の値を取得</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>    city <span class="op">=</span> person.get(<span class="st">'city'</span>)        <span class="co"># city属性の値を取得</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 子要素の値を取得</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> person.find(<span class="st">'name'</span>).text  <span class="co"># name要素のテキストを取得</span></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>    email <span class="op">=</span> person.find(<span class="st">'email'</span>).text  <span class="co"># email要素のテキストを取得</span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>    data.append({</span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'id'</span>: person_id,             <span class="co"># 属性値を辞書に追加</span></span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'age'</span>: age,</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">'city'</span>: city,</span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">'name'</span>: name,                <span class="co"># 子要素の値を辞書に追加</span></span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'email'</span>: email</span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a><span class="co"># 抽出したデータをpandasのDataFrameに変換</span></span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data)             <span class="co"># リストをDataFrameに変換</span></span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)                          <span class="co"># 結果を表示</span></span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a><span class="co">    id age   city  name               email</span></span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true" tabindex="-1"></a><span class="co">0  001  25  Tokyo  田中太郎  tanaka@example.com</span></span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true" tabindex="-1"></a><span class="co">1  002  30  Osaka  佐藤花子    sato@example.com</span></span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true" tabindex="-1"></a><span class="co">2  003  28  Kyoto  鈴木一郎  suzuki@example.com</span></span>
<span id="cb77-37"><a href="#cb77-37" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<h4 data-number="2.2.3" id="階層が深いxmlファイルの処理例"><span class="header-section-number">2.2.3</span> 階層が深いXMLファイルの処理例</h4>
<p>複雑な階層構造を持つXMLファイルから特定の情報を抽出する例を示します. 以下のような漫画のデータを想定します:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;UTF-8&quot;</span><span class="fu">?&gt;</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">book</span><span class="ot"> title=</span><span class="st">&quot;DataScienceStory&quot;</span>&gt;</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">characters</span>&gt;</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">character</span><span class="ot"> id=</span><span class="st">&quot;char001&quot;</span><span class="ot"> name=</span><span class="st">&quot;田中太郎&quot;</span>/&gt;</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">character</span><span class="ot"> id=</span><span class="st">&quot;char002&quot;</span><span class="ot"> name=</span><span class="st">&quot;佐藤花子&quot;</span>/&gt;</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">character</span><span class="ot"> id=</span><span class="st">&quot;char003&quot;</span><span class="ot"> name=</span><span class="st">&quot;鈴木一郎&quot;</span>/&gt;</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">character</span><span class="ot"> id=</span><span class="st">&quot;char004&quot;</span><span class="ot"> name=</span><span class="st">&quot;高橋美咲&quot;</span>/&gt;</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">character</span><span class="ot"> id=</span><span class="st">&quot;char005&quot;</span><span class="ot"> name=</span><span class="st">&quot;渡辺健太&quot;</span>/&gt;</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  &lt;/<span class="kw">characters</span>&gt;</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">pages</span>&gt;</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">page</span><span class="ot"> index=</span><span class="st">&quot;0&quot;</span><span class="ot"> width=</span><span class="st">&quot;1200&quot;</span><span class="ot"> height=</span><span class="st">&quot;800&quot;</span>/&gt;</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">page</span><span class="ot"> index=</span><span class="st">&quot;1&quot;</span><span class="ot"> width=</span><span class="st">&quot;1200&quot;</span><span class="ot"> height=</span><span class="st">&quot;800&quot;</span>&gt;</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">text</span><span class="ot"> id=</span><span class="st">&quot;text001&quot;</span><span class="ot"> xmin=</span><span class="st">&quot;100&quot;</span><span class="ot"> ymin=</span><span class="st">&quot;150&quot;</span><span class="ot"> xmax=</span><span class="st">&quot;300&quot;</span><span class="ot"> ymax=</span><span class="st">&quot;200&quot;</span>&gt;データサイエンスって面白そうだね&lt;/<span class="kw">text</span>&gt;</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">text</span><span class="ot"> id=</span><span class="st">&quot;text002&quot;</span><span class="ot"> xmin=</span><span class="st">&quot;400&quot;</span><span class="ot"> ymin=</span><span class="st">&quot;250&quot;</span><span class="ot"> xmax=</span><span class="st">&quot;600&quot;</span><span class="ot"> ymax=</span><span class="st">&quot;300&quot;</span>&gt;Pythonで分析してみよう&lt;/<span class="kw">text</span>&gt;</span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">text</span><span class="ot"> id=</span><span class="st">&quot;text003&quot;</span><span class="ot"> xmin=</span><span class="st">&quot;200&quot;</span><span class="ot"> ymin=</span><span class="st">&quot;350&quot;</span><span class="ot"> xmax=</span><span class="st">&quot;500&quot;</span><span class="ot"> ymax=</span><span class="st">&quot;400&quot;</span>&gt;pandasが便利だよ&lt;/<span class="kw">text</span>&gt;</span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">text</span><span class="ot"> id=</span><span class="st">&quot;text004&quot;</span><span class="ot"> xmin=</span><span class="st">&quot;300&quot;</span><span class="ot"> ymin=</span><span class="st">&quot;450&quot;</span><span class="ot"> xmax=</span><span class="st">&quot;550&quot;</span><span class="ot"> ymax=</span><span class="st">&quot;500&quot;</span>&gt;統計学の基礎も重要だね&lt;/<span class="kw">text</span>&gt;</span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">text</span><span class="ot"> id=</span><span class="st">&quot;text005&quot;</span><span class="ot"> xmin=</span><span class="st">&quot;150&quot;</span><span class="ot"> ymin=</span><span class="st">&quot;550&quot;</span><span class="ot"> xmax=</span><span class="st">&quot;450&quot;</span><span class="ot"> ymax=</span><span class="st">&quot;600&quot;</span>&gt;機械学習もやってみたい&lt;/<span class="kw">text</span>&gt;</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">page</span>&gt;</span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">page</span><span class="ot"> index=</span><span class="st">&quot;2&quot;</span><span class="ot"> width=</span><span class="st">&quot;1200&quot;</span><span class="ot"> height=</span><span class="st">&quot;800&quot;</span>&gt;</span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">text</span><span class="ot"> id=</span><span class="st">&quot;text006&quot;</span><span class="ot"> xmin=</span><span class="st">&quot;100&quot;</span><span class="ot"> ymin=</span><span class="st">&quot;100&quot;</span><span class="ot"> xmax=</span><span class="st">&quot;350&quot;</span><span class="ot"> ymax=</span><span class="st">&quot;150&quot;</span>&gt;データの前処理が大切だよ&lt;/<span class="kw">text</span>&gt;</span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">text</span><span class="ot"> id=</span><span class="st">&quot;text007&quot;</span><span class="ot"> xmin=</span><span class="st">&quot;450&quot;</span><span class="ot"> ymin=</span><span class="st">&quot;200&quot;</span><span class="ot"> xmax=</span><span class="st">&quot;700&quot;</span><span class="ot"> ymax=</span><span class="st">&quot;250&quot;</span>&gt;可視化も重要だね&lt;/<span class="kw">text</span>&gt;</span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">text</span><span class="ot"> id=</span><span class="st">&quot;text008&quot;</span><span class="ot"> xmin=</span><span class="st">&quot;250&quot;</span><span class="ot"> ymin=</span><span class="st">&quot;300&quot;</span><span class="ot"> xmax=</span><span class="st">&quot;500&quot;</span><span class="ot"> ymax=</span><span class="st">&quot;350&quot;</span>&gt;matplotlibでグラフを作ろう&lt;/<span class="kw">text</span>&gt;</span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">text</span><span class="ot"> id=</span><span class="st">&quot;text009&quot;</span><span class="ot"> xmin=</span><span class="st">&quot;350&quot;</span><span class="ot"> ymin=</span><span class="st">&quot;400&quot;</span><span class="ot"> xmax=</span><span class="st">&quot;600&quot;</span><span class="ot"> ymax=</span><span class="st">&quot;450&quot;</span>&gt;seabornも使いやすいよ&lt;/<span class="kw">text</span>&gt;</span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">text</span><span class="ot"> id=</span><span class="st">&quot;text010&quot;</span><span class="ot"> xmin=</span><span class="st">&quot;200&quot;</span><span class="ot"> ymin=</span><span class="st">&quot;500&quot;</span><span class="ot"> xmax=</span><span class="st">&quot;450&quot;</span><span class="ot"> ymax=</span><span class="st">&quot;550&quot;</span>&gt;データの品質チェックを忘れずに&lt;/<span class="kw">text</span>&gt;</span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">page</span>&gt;</span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">page</span><span class="ot"> index=</span><span class="st">&quot;3&quot;</span><span class="ot"> width=</span><span class="st">&quot;1200&quot;</span><span class="ot"> height=</span><span class="st">&quot;800&quot;</span>&gt;</span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">text</span><span class="ot"> id=</span><span class="st">&quot;text011&quot;</span><span class="ot"> xmin=</span><span class="st">&quot;100&quot;</span><span class="ot"> ymin=</span><span class="st">&quot;120&quot;</span><span class="ot"> xmax=</span><span class="st">&quot;400&quot;</span><span class="ot"> ymax=</span><span class="st">&quot;170&quot;</span>&gt;仮説検定も理解しよう&lt;/<span class="kw">text</span>&gt;</span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">text</span><span class="ot"> id=</span><span class="st">&quot;text012&quot;</span><span class="ot"> xmin=</span><span class="st">&quot;500&quot;</span><span class="ot"> ymin=</span><span class="st">&quot;220&quot;</span><span class="ot"> xmax=</span><span class="st">&quot;750&quot;</span><span class="ot"> ymax=</span><span class="st">&quot;270&quot;</span>&gt;回帰分析で予測してみよう&lt;/<span class="kw">text</span>&gt;</span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">text</span><span class="ot"> id=</span><span class="st">&quot;text013&quot;</span><span class="ot"> xmin=</span><span class="st">&quot;300&quot;</span><span class="ot"> ymin=</span><span class="st">&quot;320&quot;</span><span class="ot"> xmax=</span><span class="st">&quot;550&quot;</span><span class="ot"> ymax=</span><span class="st">&quot;370&quot;</span>&gt;分類問題も面白いね&lt;/<span class="kw">text</span>&gt;</span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">text</span><span class="ot"> id=</span><span class="st">&quot;text014&quot;</span><span class="ot"> xmin=</span><span class="st">&quot;400&quot;</span><span class="ot"> ymin=</span><span class="st">&quot;420&quot;</span><span class="ot"> xmax=</span><span class="st">&quot;650&quot;</span><span class="ot"> ymax=</span><span class="st">&quot;470&quot;</span>&gt;深層学習も挑戦してみたい&lt;/<span class="kw">text</span>&gt;</span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">text</span><span class="ot"> id=</span><span class="st">&quot;text015&quot;</span><span class="ot"> xmin=</span><span class="st">&quot;250&quot;</span><span class="ot"> ymin=</span><span class="st">&quot;520&quot;</span><span class="ot"> xmax=</span><span class="st">&quot;500&quot;</span><span class="ot"> ymax=</span><span class="st">&quot;570&quot;</span>&gt;データサイエンスの未来は明るい&lt;/<span class="kw">text</span>&gt;</span>
<span id="cb78-32"><a href="#cb78-32" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">page</span>&gt;</span>
<span id="cb78-33"><a href="#cb78-33" aria-hidden="true" tabindex="-1"></a>  &lt;/<span class="kw">pages</span>&gt;</span>
<span id="cb78-34"><a href="#cb78-34" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">book</span>&gt;</span></code></pre></div>
<p>このXMLファイルから, 各ページのテキスト情報を抽出してDataFrameにまとめるコードを作成します.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xml.etree.ElementTree <span class="im">as</span> ET  <span class="co"># XMLファイルを解析するためのライブラリ</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd                 <span class="co"># データ処理用のライブラリ</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co"># XMLファイルを読み込んで解析する</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>tree <span class="op">=</span> ET.parse(<span class="st">'manga_data.xml'</span>)   <span class="co"># XMLファイルをパースしてツリー構造を作成</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>root <span class="op">=</span> tree.getroot()               <span class="co"># ルート要素を取得</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="co"># テキストデータを格納するリスト</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>text_data <span class="op">=</span> []</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 各ページを処理</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> page <span class="kw">in</span> root.findall(<span class="st">'.//page'</span>):  <span class="co"># すべてのpage要素を検索</span></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>    page_index <span class="op">=</span> page.get(<span class="st">'index'</span>)    <span class="co"># ページ番号を取得</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 各ページ内のテキスト要素を処理</span></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> text_elem <span class="kw">in</span> page.findall(<span class="st">'text'</span>):</span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>        text_id <span class="op">=</span> text_elem.get(<span class="st">'id'</span>)           <span class="co"># テキストIDを取得</span></span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>        text_content <span class="op">=</span> text_elem.text           <span class="co"># テキスト内容を取得</span></span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>        xmin <span class="op">=</span> text_elem.get(<span class="st">'xmin'</span>)            <span class="co"># X座標最小値を取得</span></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>        ymin <span class="op">=</span> text_elem.get(<span class="st">'ymin'</span>)            <span class="co"># Y座標最小値を取得</span></span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>        xmax <span class="op">=</span> text_elem.get(<span class="st">'xmax'</span>)            <span class="co"># X座標最大値を取得</span></span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>        ymax <span class="op">=</span> text_elem.get(<span class="st">'ymax'</span>)            <span class="co"># Y座標最大値を取得</span></span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># データを辞書に格納</span></span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>        text_data.append({</span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">'page_index'</span>: page_index,</span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">'text_id'</span>: text_id,</span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">'text_content'</span>: text_content,</span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">'xmin'</span>: xmin,</span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ymin'</span>: ymin,</span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">'xmax'</span>: xmax,</span>
<span id="cb79-32"><a href="#cb79-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ymax'</span>: ymax</span>
<span id="cb79-33"><a href="#cb79-33" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb79-34"><a href="#cb79-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-35"><a href="#cb79-35" aria-hidden="true" tabindex="-1"></a><span class="co"># DataFrameに変換</span></span>
<span id="cb79-36"><a href="#cb79-36" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(text_data)</span>
<span id="cb79-37"><a href="#cb79-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-38"><a href="#cb79-38" aria-hidden="true" tabindex="-1"></a><span class="co"># データ型を適切に変換</span></span>
<span id="cb79-39"><a href="#cb79-39" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'page_index'</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">'page_index'</span>])</span>
<span id="cb79-40"><a href="#cb79-40" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'xmin'</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">'xmin'</span>])</span>
<span id="cb79-41"><a href="#cb79-41" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'ymin'</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">'ymin'</span>])</span>
<span id="cb79-42"><a href="#cb79-42" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'xmax'</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">'xmax'</span>])</span>
<span id="cb79-43"><a href="#cb79-43" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'ymax'</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">'ymax'</span>])</span>
<span id="cb79-44"><a href="#cb79-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-45"><a href="#cb79-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-46"><a href="#cb79-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;抽出されたテキストデータ:&quot;</span>)</span>
<span id="cb79-47"><a href="#cb79-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.head(<span class="dv">10</span>))  <span class="co"># 最初の10行を表示</span></span>
<span id="cb79-48"><a href="#cb79-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-49"><a href="#cb79-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">総テキスト数: </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb79-50"><a href="#cb79-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;ページ数: </span><span class="sc">{</span>df[<span class="st">'page_index'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb79-51"><a href="#cb79-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-52"><a href="#cb79-52" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb79-53"><a href="#cb79-53" aria-hidden="true" tabindex="-1"></a><span class="co">抽出されたテキストデータ:</span></span>
<span id="cb79-54"><a href="#cb79-54" aria-hidden="true" tabindex="-1"></a><span class="co">   page_index text_id                                    text_content  xmin  ymin  xmax  ymax</span></span>
<span id="cb79-55"><a href="#cb79-55" aria-hidden="true" tabindex="-1"></a><span class="co">0           1  text001                    データサイエンスって面白そうだね   100   150   300   200</span></span>
<span id="cb79-56"><a href="#cb79-56" aria-hidden="true" tabindex="-1"></a><span class="co">1           1  text002                     Pythonで分析してみよう   400   250   600   300</span></span>
<span id="cb79-57"><a href="#cb79-57" aria-hidden="true" tabindex="-1"></a><span class="co">2           1  text003                         pandasが便利だよ   200   350   500   400</span></span>
<span id="cb79-58"><a href="#cb79-58" aria-hidden="true" tabindex="-1"></a><span class="co">3           1  text004                  統計学の基礎も重要だね   300   450   550   500</span></span>
<span id="cb79-59"><a href="#cb79-59" aria-hidden="true" tabindex="-1"></a><span class="co">4           1  text005                    機械学習もやってみたい   150   550   450   600</span></span>
<span id="cb79-60"><a href="#cb79-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-61"><a href="#cb79-61" aria-hidden="true" tabindex="-1"></a><span class="co">総テキスト数: 15</span></span>
<span id="cb79-62"><a href="#cb79-62" aria-hidden="true" tabindex="-1"></a><span class="co">ページ数: 3</span></span>
<span id="cb79-63"><a href="#cb79-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-64"><a href="#cb79-64" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb79-65"><a href="#cb79-65" aria-hidden="true" tabindex="-1"></a><span class="co"># csvとして保存</span></span>
<span id="cb79-66"><a href="#cb79-66" aria-hidden="true" tabindex="-1"></a><span class="co"># 分析はこのcsvを読み込む</span></span>
<span id="cb79-67"><a href="#cb79-67" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'manga_data.csv'</span>)</span></code></pre></div>
<div class="note">
<ol type="1">
<li><strong>XMLの階層構造の理解</strong>:
<ul>
<li><code>book</code> → <code>pages</code> → <code>page</code> → <code>text</code> という深い階層構造</li>
<li>各要素には属性（<code>id</code>, <code>index</code>, <code>xmin</code>など）が付いている</li>
</ul></li>
<li><strong>データ抽出の手順</strong>:
<ul>
<li>ルート要素から<code>page</code>要素をすべて検索（<code>.//page</code>）</li>
<li>各ページ内の<code>text</code>要素を検索</li>
<li>属性値とテキスト内容を取得</li>
</ul></li>
<li><strong>重要なポイント</strong>:
<ul>
<li><code>findall('.//page')</code>: 現在の要素以下のすべての<code>page</code>要素を検索</li>
<li><code>get('属性名')</code>: 要素の属性値を取得</li>
<li><code>text</code>: 要素のテキスト内容を取得</li>
</ul></li>
<li><strong>データの整理</strong>:
<ul>
<li>数値データは<code>pd.to_numeric()</code>で適切な型に変換</li>
<li>DataFrameに変換して分析しやすい形式に整理</li>
</ul></li>
</ol>
</div>
<p>このように, 階層が深いXMLファイルからも, 適切なパスを指定することで必要な情報を抽出できます.</p>
<h3 data-number="2.3" id="json"><span class="header-section-number">2.3</span> JSON</h3>
<p>JSONは<strong>JavaScript Object Notation</strong>の略で, データを階層構造で表現する軽量なデータ交換形式です. XMLと比べて読み書きが簡単で, Web APIなどでよく使用されます.</p>
<p>JSONの基本的な構造は以下のようになっています:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;string&quot;</span><span class="fu">:</span> <span class="st">&quot;文字列&quot;</span><span class="fu">,</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;number&quot;</span><span class="fu">:</span> <span class="dv">123</span><span class="fu">,</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;boolean&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;array&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">,</span> <span class="dv">3</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;object&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;key&quot;</span><span class="fu">:</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>JSONでは, キーと値のペアでデータを表現し, オブジェクト（<code>{}</code>で囲まれた部分）や配列（<code>[]</code>で囲まれた部分）を使って階層構造を作ります. XMLと比べて, タグ名が不要でより簡潔に記述できます.</p>
<h4 data-number="2.3.1" id="jsonデータの読み込み"><span class="header-section-number">2.3.1</span> JSONデータの読み込み</h4>
<p>PythonでJSONデータを扱うには, <code>json</code>モジュールを使用します. <code>json</code>はPythonの標準ライブラリなので, 追加インストールは不要です</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 必要なライブラリをインポート</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json                        <span class="co"># JSONデータを処理するためのライブラリ</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd                <span class="co"># データ処理用のライブラリ</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="co"># JSONファイルを読み込む</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'data.json'</span>, <span class="st">'r'</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>) <span class="im">as</span> f:  <span class="co"># ファイルをUTF-8エンコーディングで開く</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> json.load(f)            <span class="co"># JSONデータをPythonオブジェクトに変換</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="co"># JSONデータをDataFrameに変換</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data)            <span class="co"># 辞書やリストのデータをDataFrameに変換</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)                         <span class="co"># 結果を表示</span></span></code></pre></div>
<h3 data-number="2.4" id="pickle"><span class="header-section-number">2.4</span> pickle</h3>
<p><code>pickle</code>は, Pythonオブジェクトをシリアライズ（直列化）してファイルに保存したり, ファイルから読み込んだりするためのモジュールです. Python固有の形式ですが, 複雑なオブジェクト構造をそのまま保存できる利点があります.
大規模なCSVファイルを利用すると,読み書きだけで非常に長い時間がかかることがあります.そのような場合には,<code>pickle</code>ファイルとして保存することで高速化・効率化が可能となります.
<code>pickle</code>はPythonの標準ライブラリなので, 追加インストールは不要です</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 必要なライブラリをインポート</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle                      <span class="co"># Pythonオブジェクトのシリアライズ用ライブラリ</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd                <span class="co"># データ処理用のライブラリ</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="co"># pickleファイルからデータを読み込む</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'data.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> f:  <span class="co"># バイナリモードでファイルを開く</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> pickle.load(f)          <span class="co"># pickleデータをPythonオブジェクトに復元</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 読み込んだデータの種類を判定して処理</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">isinstance</span>(data, pd.DataFrame):  <span class="co"># データがDataFrame型かどうかをチェック</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(data)                    <span class="co"># DataFrameの場合はそのまま表示</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 他のオブジェクトの場合</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">type</span>(data))              <span class="co"># オブジェクトの型を表示</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(data)                    <span class="co"># オブジェクトの内容を表示</span></span></code></pre></div>
<h4 data-number="2.4.1" id="dataframeをpickleで保存する"><span class="header-section-number">2.4.1</span> DataFrameをpickleで保存する</h4>
<div class="sourceCode" id="cb83"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 必要なライブラリをインポート</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle                      <span class="co"># Pythonオブジェクトのシリアライズ用ライブラリ</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd                <span class="co"># データ処理用のライブラリ</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="co"># サンプルDataFrameを作成</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'name'</span>: [<span class="st">'Alice'</span>, <span class="st">'Bob'</span>, <span class="st">'Charlie'</span>],  <span class="co"># 名前の列</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'age'</span>: [<span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">35</span>],                  <span class="co"># 年齢の列</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'city'</span>: [<span class="st">'Tokyo'</span>, <span class="st">'Osaka'</span>, <span class="st">'Kyoto'</span>]   <span class="co"># 都市の列</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a><span class="co"># DataFrameをpickleファイルに保存</span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'data.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f:  <span class="co"># バイナリ書き込みモードでファイルを開く</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>    pickle.dump(df, f)             <span class="co"># DataFrameをpickle形式でファイルに保存</span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;DataFrameをpickleファイルに保存しました&quot;</span>)  <span class="co"># 保存完了のメッセージ</span></span></code></pre></div>
<h3 data-number="2.5" id="その他のデータ形式"><span class="header-section-number">2.5</span> その他のデータ形式</h3>
<h4 data-number="2.5.1" id="excelファイル.xlsx-.xls"><span class="header-section-number">2.5.1</span> Excelファイル（.xlsx, .xls）</h4>
<p>Excelファイルは<code>openpyxl</code>や<code>xlrd</code>ライブラリを使用して読み込むことができますが, pandasの<code>read_excel()</code>関数を使用するのが最も簡単です.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 必要なライブラリをインポート</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd                <span class="co"># データ処理用のライブラリ</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Excelファイルを読み込む</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_excel(<span class="st">'data.xlsx'</span>, sheet_name<span class="op">=</span><span class="st">'Sheet1'</span>)  <span class="co"># Excelファイルの指定シートを読み込み</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)                         <span class="co"># 読み込んだデータを表示</span></span></code></pre></div>
<h4 data-number="2.5.2" id="htmlテーブル"><span class="header-section-number">2.5.2</span> HTMLテーブル</h4>
<p>WebページのHTMLテーブルからデータを抽出するには, <code>read_html()</code>関数を使用します.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 必要なライブラリをインポート</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd                <span class="co"># データ処理用のライブラリ</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="co"># HTMLファイルまたはURLからテーブルを読み込む</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>tables <span class="op">=</span> pd.read_html(<span class="st">'https://example.com/table.html'</span>)  <span class="co"># HTMLからすべてのテーブルを抽出</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> tables[<span class="dv">0</span>]                    <span class="co"># 最初のテーブルをDataFrameとして取得</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)                         <span class="co"># 読み込んだテーブルを表示</span></span></code></pre></div>
<h4 data-number="2.5.3" id="sqlデータベース"><span class="header-section-number">2.5.3</span> SQLデータベース</h4>
<p>SQLデータベースからデータを読み込むには, <code>sqlite3</code>や<code>pymysql</code>などのライブラリを使用します.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 必要なライブラリをインポート</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd                <span class="co"># データ処理用のライブラリ</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlite3                     <span class="co"># SQLiteデータベース操作用のライブラリ</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="co"># SQLiteデータベースに接続</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>conn <span class="op">=</span> sqlite3.<span class="ex">connect</span>(<span class="st">'database.db'</span>)  <span class="co"># データベースファイルに接続</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="co"># SQLクエリを実行してDataFrameに変換</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_sql_query(<span class="st">&quot;SELECT * FROM table_name&quot;</span>, conn)  <span class="co"># SQLクエリの結果をDataFrameに変換</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)                         <span class="co"># クエリ結果を表示</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a><span class="co"># データベース接続を閉じる</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>conn.close()                      <span class="co"># 接続を適切に閉じる（重要）</span></span></code></pre></div>
<h3 data-number="2.6" id="データ形式の変換"><span class="header-section-number">2.6</span> データ形式の変換</h3>
<p>異なるデータ形式間で変換する際は, まずpandasのDataFrameに変換してから, 目的の形式で保存するのが一般的です.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 必要なライブラリをインポート</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd                <span class="co"># データ処理用のライブラリ</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json                        <span class="co"># JSONデータ処理用のライブラリ</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xml.etree.ElementTree <span class="im">as</span> ET <span class="co"># XMLデータ処理用のライブラリ</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="co"># CSVファイルからデータを読み込む</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'data.csv'</span>)      <span class="co"># CSVファイルをDataFrameに読み込み</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="co"># DataFrameをJSON形式に変換して保存</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>df.to_json(<span class="st">'data.json'</span>, orient<span class="op">=</span><span class="st">'records'</span>, force_ascii<span class="op">=</span><span class="va">False</span>)  <span class="co"># 日本語文字を正しく保存</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a><span class="co"># DataFrameをExcel形式に変換して保存</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>df.to_excel(<span class="st">'data.xlsx'</span>, index<span class="op">=</span><span class="va">False</span>)  <span class="co"># インデックス列は含めない</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a><span class="co"># DataFrameをpickle形式に変換して保存</span></span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>df.to_pickle(<span class="st">'data.pkl'</span>)          <span class="co"># Pythonオブジェクトとして保存</span></span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;データ形式の変換が完了しました&quot;</span>)  <span class="co"># 変換完了のメッセージ</span></span></code></pre></div>
<p>このように, 様々なデータ形式をpandasのDataFrameに変換することで, 統一された方法でデータを処理することができます.</p>


<!-- 前後の章へのナビゲーション -->
<div class="chapter-navigation">
    <nav>
        
            <a class="nav-link prev" href="slds6.html">← Previous Chapter</a>
        
        
            <a class="nav-link next" href="slds8.html">Next Chapter →</a>
        
    </nav>
</div>

    <div style="clear: both"></div>

    <div id="footer">
        Site proudly generated by
        <a href="http://jaspervdj.be/hakyll">Hakyll</a>.
    </div>
</div>


    <!-- GUID -->
    <div style="display: none">ce0f13b2-4a83-4c1c-b2b9-b6d18f4ee6d2</div>




    <!-- JavaScript TOC generator (only runs on lecture pages) -->
    <script>
    document.addEventListener("DOMContentLoaded", function() {
      var tocContainer = document.getElementById('lecture-toc');
      if (!tocContainer) return;

      // メインコンテンツから h2, h3, h4 を抽出
      var content = document.querySelector('article') || document.getElementById('content') || document.body;
      var headings = content.querySelectorAll('h2, h3, h4');
      if (headings.length === 0) return;

      // 目次用のUL要素を作成
      var tocList = document.createElement('ul');

      // 章番号カウンタ (h2, h3, h4に対応して配列を用意)
      var chapterNumbers = [0, 0, 0];

      headings.forEach(function(heading) {
        if (heading.closest('li')) return;

        var level;
        switch (heading.tagName.toLowerCase()) {
          case 'h2': level = 0; break;
          case 'h3': level = 1; break;
          case 'h4': level = 2; break;
          default: return;
        }

        chapterNumbers[level]++;
        for (var i = level + 1; i < chapterNumbers.length; i++) {
          chapterNumbers[i] = 0;
        }


        var li = document.createElement('li');
        li.classList.add('toc-level-' + (level + 1));

        var anchor = document.createElement('a');
        anchor.href = '#' + heading.id;
        anchor.textContent =  heading.textContent;

        li.appendChild(anchor);
        tocList.appendChild(li);
      });

      tocContainer.appendChild(tocList);
    });
    </script>
     <script>
  document.addEventListener("DOMContentLoaded", function() {
    // すべての <pre><code> 要素を走査
    const codeBlocks = document.querySelectorAll('pre code');
    codeBlocks.forEach(function(codeBlock) {
      // 親<pre>要素を取得
      const pre = codeBlock.parentNode;

      // <pre> を相対配置にし、子要素を絶対配置できるようにする
      pre.style.position = 'relative';

      // コピーボタンを作成
      const copyButton = document.createElement('button');
      copyButton.textContent = 'Copy';
      // ボタンのデザインはCSSで指定するのが望ましいが、簡易的にスタイルを直接指定する例:
      copyButton.style.position = 'absolute';
      copyButton.style.top = '8px';
      copyButton.style.right = '8px';
      copyButton.style.backgroundColor = '#add8e6'; // 水色
      copyButton.style.color = '#fff';             // 白文字
      copyButton.style.border = 'none';
      copyButton.style.padding = '6px 10px';
      copyButton.style.borderRadius = '4px';
      copyButton.style.cursor = 'pointer';

      // クリックされたらクリップボードにコピー
      copyButton.addEventListener('click', function() {
        const codeText = codeBlock.innerText;
        navigator.clipboard.writeText(codeText).then(function() {
          copyButton.textContent = 'Copied!';
          setTimeout(function() {
            copyButton.textContent = 'Copy';
          }, 2000);
        }, function(err) {
          console.error('Failed to copy: ', err);
        });
      });

      // ボタンを <pre> の子要素として挿入
      pre.appendChild(copyButton);
    });
  });
  </script>
  <script>
    function toggleMenu() {
      var nav = document.getElementById('navigation');
      nav.classList.toggle('open');
    }
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      var mathElements = document.querySelectorAll('.math');
      for (var i = 0; i < mathElements.length; i++) {
        var texText = mathElements[i].firstChild
        if (mathElements[i].tagName == "SPAN") {
            katex.render( texText.data
                        , mathElements[i]
                        , { displayMode: mathElements[i].classList.contains("display")
                          , throwOnError: true
                         }
                        );
          }
      }
    });
  </script>

  </body>
</html>