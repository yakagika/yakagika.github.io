<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>yakagika - 特別講義DS Ch11 線形回帰分析</title>

    <!-- Stylesheets. -->
    <link rel="stylesheet" type="text/css" href="../style.css?v=0">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&display=swap" rel="stylesheet">
    <!-- RSS. -->
    <link rel="alternate" type="application/rss+xml" title="yakagika" href="https://yakagika.github.io/rss.xml">

    <!-- Metadata. -->

    <meta name="keywords" content="yakagika Haskell ExchangeAlgebra">
    <meta name="description" content="Personal home page and blog of yakagika.">

    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css" integrity="sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js" integrity="sha384-X/XCfMm41VSsqRNQgDerQczD69XqmjOOOwYQvr/uuC+j4OPoNhVgjdGFwhvN02Ja" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
    

    
      <meta property="og:description" content="資料" />
    
  </head>

  <body>

    <!-- ハンバーガーメニューのボタン（小画面時に表示） -->
     <!-- ヘッダーを上部に固定し、その中にハンバーガーを配置 -->
    <header class="site-header">
      <div class="site-title">
        <a href="../">
          <img src="../favicon.ico" alt="Home" style="width: 32px; height: 32px;">
        </a>
      </div>
      <div class="hamburger" onclick="toggleMenu()">☰</div>
    </header>

    <!-- ナビゲーションに drawer-menu クラスを付与 -->
    <div id="navigation" class="drawer-menu">
      <h1>Contents</h1>
      <a href="../">Home</a>
      <a href="../posts.html">Blog</a>
      <a href="../lectures.html">Lecture</a>
      <a href="../research.html">Research</a>
      <a href="../contact.html">Contact</a>
      <!-- <a href="/cv.html">CV</a> -->

      <h1>Links</h1>
      <a href="http://github.com/yakagika" target="_blank" rel="noopener">GitHub</a>
      <a href="https://researchmap.jp/k-akagi" target="_blank" rel="noopener">researchmap</a>

      
      <div id="lecture-toc">
        <h1>Index</h1>
        <!-- The TOC will be generated here by JavaScript -->
      </div>
      
      
    </div>

    <div id="content">
    <h1>特別講義DS Ch11 線形回帰分析</h1>
<div class="soft">
    資料<br />
    Published on 2024-03-29 under the tag <a title="All pages tagged 'datascience'." href="../tags/datascience.html">datascience</a>, <a title="All pages tagged 'statistics'." href="../tags/statistics.html">statistics</a>, <a title="All pages tagged 'python'." href="../tags/python.html">python</a>
</div>

<!-- 前後の章へのナビゲーション -->
<div class="chapter-navigation">
    <nav>
        
            <a class="nav-link prev" href="slds10.html">← Previous Chapter</a>
        
        
            <a class="nav-link next" href="slds12.html">Next Chapter →</a>
        
    </nav>
</div>

<br>

<div class="toc"><div class="header">Table of Contents</div>
<ul>
<li><a href="#線形回帰分析" id="toc-線形回帰分析"><span class="toc-section-number">1</span> 線形回帰分析</a>
<ul>
<li><a href="#発展-回帰分析は何を行っているのか" id="toc-発展-回帰分析は何を行っているのか"><span class="toc-section-number">1.1</span> 発展: 回帰分析は何を行っているのか</a>
<ul>
<li><a href="#母回帰方程式" id="toc-母回帰方程式"><span class="toc-section-number">1.1.1</span> 母回帰方程式</a></li>
<li><a href="#誤差項撹乱項" id="toc-誤差項撹乱項"><span class="toc-section-number">1.1.2</span> 誤差項,撹乱項</a></li>
<li><a href="#最小二乗法" id="toc-最小二乗法"><span class="toc-section-number">1.1.3</span> 最小二乗法</a></li>
<li><a href="#回帰係数の検定" id="toc-回帰係数の検定"><span class="toc-section-number">1.1.4</span> 回帰係数の検定</a></li>
</ul></li>
<li><a href="#単回帰分析" id="toc-単回帰分析"><span class="toc-section-number">1.2</span> 単回帰分析</a>
<ul>
<li><a href="#データの準備" id="toc-データの準備"><span class="toc-section-number">1.2.1</span> データの準備</a></li>
<li><a href="#散布図の作成" id="toc-散布図の作成"><span class="toc-section-number">1.2.2</span> 散布図の作成</a></li>
<li><a href="#単回帰" id="toc-単回帰"><span class="toc-section-number">1.2.3</span> 単回帰</a></li>
<li><a href="#回帰係数p値区間推定値" id="toc-回帰係数p値区間推定値"><span class="toc-section-number">1.2.4</span> 回帰係数(P値,区間推定値)</a></li>
<li><a href="#式全体の評価指標r2f" id="toc-式全体の評価指標r2f"><span class="toc-section-number">1.2.5</span> 式全体の評価指標(<span class="math inline">R^2</span>,F)</a></li>
<li><a href="#結果の可視化" id="toc-結果の可視化"><span class="toc-section-number">1.2.6</span> 結果の可視化</a></li>
</ul></li>
<li><a href="#重回帰分析" id="toc-重回帰分析"><span class="toc-section-number">1.3</span> 重回帰分析</a></li>
<li><a href="#重回帰分析-1" id="toc-重回帰分析-1"><span class="toc-section-number">1.4</span> 重回帰分析</a>
<ul>
<li><a href="#正規化標準化" id="toc-正規化標準化"><span class="toc-section-number">1.4.1</span> 正規化・標準化</a></li>
<li><a href="#多重共線性multi-colinearlity" id="toc-多重共線性multi-colinearlity"><span class="toc-section-number">1.4.2</span> 多重共線性(multi-colinearlity)</a></li>
<li><a href="#回帰分析の精度と判断" id="toc-回帰分析の精度と判断"><span class="toc-section-number">1.4.3</span> 回帰分析の精度と判断</a></li>
<li><a href="#結果の図示" id="toc-結果の図示"><span class="toc-section-number">1.4.4</span> 結果の図示</a></li>
</ul></li>
</ul></li>
</ul>
</div>
<h2 data-number="1" id="線形回帰分析"><span class="header-section-number">1</span> 線形回帰分析</h2>
<p>相関分析では,ある変数間に関係があることを示すことができました. しかし,相関分析で示せるのは,変数Aによって変数Bが増加するか,減少するかということのみです. 具体的に,どの程度変数Aが動くことで,変数Bがどの程度変動するかを式によって<strong>説明する</strong>手法に<strong>回帰分析(Regression Analysis)</strong>があります.</p>
<p>また,回帰分析は検定の手法によって求められた式がどの程度信頼できるのかを検定によって確かめることも可能です.</p>
<div class="note">
<p>回帰分析では,データ</p>
<p><span class="math display">
y = \beta_0 + \beta_1 x
</span></p>
<p>のような式で変数yとxの関係を説明し,この式を<strong>回帰式,回帰方程式</strong>と呼びます. このとき,</p>
<ul>
<li><p>説明される変数yを <strong>被説明変数</strong>,<strong>目的変数</strong>などと呼びます.</p></li>
<li><p>説明する変数xを<strong>説明変数</strong>,<strong>従属変数</strong>などと呼びます.</p></li>
<li><p>回帰式における <strong><span class="math inline">\beta_0</span></strong>のような変数に乗じられていない値を<strong>切片</strong>といいます.</p>
<p>切片は, <span class="math inline">x = 0</span> のときのyの値を意味しています.</p></li>
<li><p>変数に乗じられている<strong><span class="math inline">\beta_1</span></strong>のような値を<strong>傾き</strong>といい,<span class="math inline">\beta_0,\beta_1</span> などを併せて<strong>回帰係数</strong>といいます.</p>
<p>傾きは,xが1変化した際のyの変化量を表しています.</p></li>
</ul>
<p><img src="../images/ch11-regression-image.png" /></p>
<ul>
<li><p>説明変数が一つの回帰式を求める分析を<strong>単回帰分析</strong>, 2つ以上の説明変数を用いる場合を<strong>重回帰分析</strong>といいます.</p></li>
<li><p>yがxの線形関数である場合を <strong>線形回帰(Linear regression)</strong>,それ以外のものを<strong>非線形回帰(non-linear regression)</strong>といいます.</p></li>
</ul>
<p><img src="../images/ch11-regression-image2.png" /></p>
</div>
<h3 data-number="1.1" id="発展-回帰分析は何を行っているのか"><span class="header-section-number">1.1</span> 発展: 回帰分析は何を行っているのか</h3>
<p>回帰分析が何を行っているのかについて,単回帰で行っている最小二乗法を事例に確認していきましょう.
重回帰に関しては, 線形計画問題など異なる学習が必要になるので,今回は扱いません. あくまで,回帰というものがどのような意味であるかに関して簡単に説明します.</p>
<p>こちらの詳細は統計学入門で扱っていますので, この講義ではあまり深く扱いません.興味のある方は読んでみてください.</p>
<h4 data-number="1.1.1" id="母回帰方程式"><span class="header-section-number">1.1.1</span> 母回帰方程式</h4>
<p>体重<span class="math inline">y</span>を慎重<span class="math inline">x</span>によって説明する回帰方程式として, <span class="math inline">y = \beta_0 + \beta_1 x</span> を考えてみます.
しかし, 実際の体重は身長以外の要素によってばらつきます. そのような<strong>ばらつき</strong>を考慮して,データの<span class="math inline">i</span>人目の体重,身長をそれぞれ,<span class="math inline">Y_i,X_i</span>として,身長以外の要素によるばらつきを<span class="math inline">\epsilon_i</span>とすると,母集団において,以下のような式が立てられます.</p>
<p><span class="math display">
Y_i = \beta_0 + \beta_1 X_i + \epsilon_i ~(i=1,2,...,n)
</span></p>
<p>これを<strong>母回帰方程式(Population Regression Equation)</strong>と呼びます.
また, <span class="math inline">\beta_0, \beta_1</span>を<strong>母(偏)回帰係数</strong>といい,これを<strong>推定,検定すること</strong>を回帰分析といいます.</p>
<h4 data-number="1.1.2" id="誤差項撹乱項"><span class="header-section-number">1.1.2</span> 誤差項,撹乱項</h4>
<p>母回帰方程式</p>
<p><span class="math display">
Y_i = \beta_0 + \beta_1 X_i + \epsilon_i ~(i=1,2,...,n)
</span></p>
<p>における <span class="math inline">\epsilon_i</span>は<span class="math inline">X_i</span>で説明できない誤差を表す確率変数であり,<strong>誤差項</strong>,<strong>撹乱項</strong>といいます.</p>
<p><img src="../images/ch11-regression-images3.png" /></p>
<p>回帰分析において,誤差項は以下の仮定をおいています.</p>
<div class="note">
<ul>
<li>期待値0: <span class="math inline">E(\epsilon_i) = 0 ~ (i=1,2,...,n)</span></li>
<li>分散一定: <span class="math inline">V(\epsilon_i) = \sigma^2 ~ (i=1,2,...,n)</span></li>
<li>無相関: <span class="math inline">i \neq j \Rightarrow Cov(\epsilon_i, \epsilon_j) = 0</span></li>
<li>正規分布: <span class="math inline">\epsilon_i \sim N(0,\sigma^2)</span></li>
</ul>
</div>
<p>これによって,</p>
<p><span class="math display">
E(Y_i) = \beta_1 + \beta_2 X_i
</span></p>
<p>が得られます.</p>
<h4 data-number="1.1.3" id="最小二乗法"><span class="header-section-number">1.1.3</span> 最小二乗法</h4>
<p>母回帰方程式</p>
<p><span class="math display">
Y_i = \beta_0 + \beta_1 X_i + \epsilon_i ~(i=1,2,...,n)
</span>
における母回帰係数<span class="math inline">\beta_0, \beta_1</span>は観測できないので,<strong>誤差項を最小化する母回帰係数</strong>を統計的推測することで求めます.</p>
<p>この誤差項を最小化する母回帰係数の推定方法を<strong>最小二乗法(least squares method)</strong>といいます.</p>
<p>母回帰方程式を変形して,</p>
<p><span class="math display">
\epsilon_i = Y_i - (\beta_0 + \beta_1 X_i)
</span></p>
<p>が少ないほど, <span class="math inline">X_i</span>による<span class="math inline">Y_i</span>の説明力が上がります(モデルによってよく関係が説明できている.)</p>
<p>なので,モデル全体で,<span class="math inline">\epsilon_i</span>を最小化することを考えてみます.</p>
<figure>
<img src="../images/least-squares-method1.png" alt="least squares method" />
<figcaption aria-hidden="true">least squares method</figcaption>
</figure>
<p>誤差の正負を打ち消すために,モデル全体の誤差項の二乗の和</p>
<p><span class="math display">
\begin{align*}
S &amp; = \sum_{i=1} \epsilon_{1}^{2} \\
&amp;= \sum_{i=1} \{Y_i - (\beta_0 + \beta_1 X_i)\}^2
\end{align*}
</span></p>
<p>Sを最小化する<strong>(最小二乗)推定量</strong> <span class="math inline">\hat{\beta_0},\hat{\beta_1}</span> を求める問題として整理できます.</p>
<p><span class="math inline">S</span>の偏微分を0とおいて,</p>
<p><span class="math display">
\frac{\partial S}{ \partial \beta_0} = -2 \sum (Y_i = \beta_0 - \beta_1 X_i) = 0 \\
\frac{\partial S}{ \partial \beta_1} = -2 \sum (Y_i = \beta_0 - \beta_1 X_i)X_i = 0 \\
</span></p>
<p>これを解いて,</p>
<p><span class="math display">
\hat{\beta_0} = \bar{Y} - \hat{\beta_1}\bar{X} \\
\hat{\beta_1} = \frac{\sum(X_i - \bar{X})(Y_i - \bar(Y))}{\sum(X_i - \bar{X})^2}
</span>
が得られます.</p>
<h4 data-number="1.1.4" id="回帰係数の検定"><span class="header-section-number">1.1.4</span> 回帰係数の検定</h4>
<p>最小二乗推定量によって得られた方程式</p>
<p><span class="math display">
Y = \hat{\beta_0} + \hat{\beta_1}X
</span></p>
<p>を<strong>標本回帰方程式</strong>といいます.</p>
<p>求めた標本回帰方程式が,XとYの関係を説明できているのかを考えます. XがYを全く説明できていない場合, <span class="math inline">\epsilon_i</span> だけで説明ができるため, <span class="math inline">\beta_1 \neq 0</span> と言えれば,統計的にXがYを説明できていると言えます.</p>
<p>そこで, 帰無仮説 <span class="math inline">H_0:\beta_1 = 0</span> として,偏回帰係数に関する統計的仮説検定を実施します.</p>
<p>母数 <span class="math inline">\beta_1</span> に関する仮説検定を行うために, <span class="math inline">\beta_1</span> の確率分布を考えます.</p>
<p>誤差項 <span class="math inline">\epsilon_i \sim N(o,\sigma^2)</span> として,</p>
<p><span class="math display">
\hat{\beta_0} = \bar{Y} - \hat{\beta_1}\bar{X} \\
\hat{\beta_1} = \frac{\sum(X_i - \bar{X})(Y_i - \bar(Y))}{\sum(X_i - \bar{X})^2}
</span>
であるから,</p>
<p><span class="math display">
V(\hat{\beta_0}) = \frac{\sigma^2 \sum X_i^2}{n\sum(X_i - \bar{X})^2} \\
E(\hat{\beta_0}) = \beta_0 \\
V(\hat{\beta_2}) = \frac{\sigma^2 }{\sum(X_i - \bar{X})^2} \\
E(\hat{\beta_1}) = \beta_1
</span>
なので,</p>
<p><span class="math display">
\hat{\beta_1} \sim N(\beta_1,\frac{\sigma^2}{\sum(X_i - \bar{X})^2})
</span></p>
<p>となる.</p>
<p>誤差項の母標準偏差 <span class="math inline">\sigma</span> が含まれるので,推定する.</p>
<p>標本回帰方程式 <span class="math inline">Y=\hat{\beta_0}+\hat{\beta_1}X</span> によって求められる各 <span class="math inline">i</span> の値(回帰値)</p>
<p><span class="math display">
\hat{Y_i} = \hat{\beta_0} + \hat{\beta_1}X_i
</span></p>
<p>と実際に観測された実測値 <span class="math inline">Y_i</span>との差を</p>
<p><span class="math display">
\hat{e_i} = Y_i - \hat{Y_i} = Y_i - \hat{\beta_0} - \hat{\beta_1}X_i
</span></p>
<p>を<strong>回帰残渣(residual)</strong>といい,Xで説明されなかった残渣を表す.</p>
<p>回帰残渣を母回帰方程式 <span class="math inline">Y_i = \beta_0 + \beta_1 X_i + \epsilon_i</span> における誤差項 <span class="math inline">\epsilon_i</span> の推定値として利用する.</p>
<p>求める必要があるのは,誤差項の分散の推定値としての分散</p>
<p><span class="math display">
V(\hat{e_i}) = E(\hat{e_i^2}) - (E(\hat{e_i}))^2
</span></p>
<p>であるが,</p>
<p><span class="math display">
\frac{\partial S}{\partial \beta_1} = -2 \sum (Y_i - \beta_0 - \beta_1 X_i)X_i = 0
</span>
なので,</p>
<p><span class="math display">
\sum (Y_i - \beta_0 - \beta_1 X_i) = \sum \hat{e_i} = 0
</span></p>
<p>となり,</p>
<p><span class="math display">
\bar{e_i} = \frac{1}{n} \sum \hat{e_i} = 0
</span></p>
<p>なので,</p>
<p><span class="math display">
\begin{align*}
V(\hat{e_i}) &amp;= E(\hat{eI^2}) \\
&amp;= \frac{1}{n-2}\sum (\hat{e_i}^2 - \bar{e_i}^2) \\
&amp;= \frac{\sum \hat{e_i}^2}{n-2}
\end{align*}
</span></p>
<p>となります.</p>
<p>これを誤差項の分散<span class="math inline">\sigma^2</span>の推定値</p>
<p><span class="math display">
S^2 = \frac{\sum \hat{e_i}^2}{n-2}
</span>
として利用します.</p>
<p>なお,この累乗根は回帰式がどの程度実測値に当てはまっているかを表す,<strong>推定値の標準誤差(standard error of estimates)</strong>と呼ばれます.</p>
<p><span class="math display">
s.e. = \sqrt{S^2} = \sqrt{\frac{\sum \hat{e_i}^2}{n-2}}
</span></p>
<p>これを誤差項の母標準偏差<span class="math inline">\sigma</span>の推定値として利用して,<span class="math inline">\hat{\beta_2}</span>の標準誤差の推定値は,</p>
<p><span class="math display">
V(\hat{\beta_1}) = \frac{\sigma^2 }{\sum(X_i - \bar{X})^2}
</span></p>
<p>から,</p>
<p><span class="math display">
s.e.(\hat{\beta_1}) = \frac{s.e.}{\sqrt{\sum(X_i - \bar{X})^2}}
</span></p>
<p>となり,<span class="math inline">s.e.(\hat{\beta_2})</span>を用いて標準化した値は, <span class="math inline">t(n-2)</span>に従うので,</p>
<p><span class="math display">
t_2 = \frac{\hat{\beta_1} - \beta_1}{s.e.(\hat{\beta_1})} \sim t(n-2)
</span></p>
<p>あとは得られた推定量を用いて,帰無仮説に関するt検定を実施する.</p>
<h3 data-number="1.2" id="単回帰分析"><span class="header-section-number">1.2</span> 単回帰分析</h3>
<p>それでは,実際に単回帰分析を実施してみる. 事例として,以下の分析にどのような問題点があるのかを考えてみよう.</p>
<blockquote class="twitter-tweet">
<p lang="ja" dir="ltr">
今回に限らず毎度毎度のことだけど、日本「経済」新聞を名乗りながら、お粗末な統計リテラシーだからな。。。<br>日経に限らず、本邦の大手紙は例外なく全てお粗末な統計リテラシー。<br>統計の基礎を勉強したい人はツッコミを入れると良いよ。ツッコミを入れるところだらけで勉強になるから。<a href="https://twitter.com/IsayaShimizu?ref_src=twsrc%5Etfw"><span class="citation" data-cites="IsayaShimizu">@IsayaShimizu</span></a> <a href="https://t.co/cxMAFDPRfM">https://t.co/cxMAFDPRfM</a>
</p>
— 糸石 浩司 (<span class="citation" data-cites="itoishi">@itoishi</span>) <a href="https://twitter.com/itoishi/status/1445026338885103618?ref_src=twsrc%5Etfw">October 4, 2021</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<blockquote class="twitter-tweet">
<p lang="ja" dir="ltr">
相関があることを言いたいなら散布図を描くべきでは？ あと，この16カ国はどうやって選んだのか？ <a href="https://t.co/ncWWtQ8A8L">https://t.co/ncWWtQ8A8L</a>
</p>
— Haruhiko Okumura (<span class="citation" data-cites="h_okumura">@h_okumura</span>) <a href="https://twitter.com/h_okumura/status/1444983348862996485?ref_src=twsrc%5Etfw">October 4, 2021</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>これらのPOSTは何を懸念しているのでしょうか.</p>
<p>元POSTでは, 日本経済新聞が<a href="https://www.oecd.org/en/data/datasets/oecd-family-database.html">OECD Family Database</a>のデータから作成したグラフを用いて男性の育児・家事時間の少なさが日本の少子化の原因であると主張しています.</p>
<figure>
<img src="../images/ch11-oecd-nikkei.png" alt="出典：日本経済新聞,「男性の育児・家事時間、出生率に影響　日本は女性の二割" />
<figcaption aria-hidden="true"><a href="https://www.nikkei.com/article/DGXZQOFE308UG0Q1A830C2000000/">出典：日本経済新聞,「男性の育児・家事時間、出生率に影響　日本は女性の二割</a></figcaption>
</figure>
<div class="note">
<p>この分析の問題点は主に以下の2つです.</p>
<ol type="1">
<li><p>元のPOSTの通り,この記事ではグラフを主張の根拠としていますが,棒グラフと散布図を組み合わせたような独自のグラフを作成しており,これを持って何が主張できるのかが明確ではありません. 2つの量的データの関係性を示す場合は散布図が適当です.</p></li>
<li><p>また,グラフが適当であったとしても,グラフはデータの概観の把握にや役立ちますが,グラフのみから明確な主張が主張できるわけではない場合が多いです.</p></li>
</ol>
</div>
<p>まずは,グラフに関して考えてみましょう. 実は,内閣府もこのデータを利用して同様の主張をしています. 内閣府のグラフでは,独自のグラフではなく,散布図が作成されています.</p>
<figure>
<img src="../images/ch11-oecd-cabinet.png" alt="出典：内閣府　政策統括官（経済社会システム担当）第４回会議資料　選択する未来2.0, 資料２　参考資料②(事務局資料)" />
<figcaption aria-hidden="true"><a href="https://www5.cao.go.jp/keizai2/keizai-syakai/future2/20200409/shiryou2.pdf">出典：内閣府　政策統括官（経済社会システム担当）第４回会議資料　選択する未来2.0, 資料２　参考資料②(事務局資料)</a></figcaption>
</figure>
<p>内閣府の資料でも,同じデータを利用して,同じ主張をしています. しかし,こちらの資料では独自のグラフではなく,散布図を作成しており,追加的に回帰式(<span class="math inline">y=0.0132x + 1.2027</span>)及びR2も求めています.</p>
<div class="note">
<p>しかし,先程説明した通り,<strong>回帰分析</strong>とは回帰式に関する検定であり,回帰式のみをもって,y(合計特殊出生率)にx(育児・家事労働時間割合)が影響を及ぼしているとは<strong>言えません</strong>.</p>
</div>
<p>では,実際に回帰分析を実施してみるとどのような結果になるでしょうか?</p>
<h4 data-number="1.2.1" id="データの準備"><span class="header-section-number">1.2.1</span> データの準備</h4>
<p>まずはデータを準備する必要があります. <a href="https://www.oecd.org/en/data/datasets/oecd-family-database.html">OECD Family Database</a>から,<code>SF2.1 Fertility rates</code>及び<code>LMF2.5 Time used for work, care and daily household chores</code>のExcelファイルをダウンロードしました.
それぞれから<a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/fertility_rates.csv"><code>fertility_rates.csv</code></a>及び,<a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/time_used.csv"><code>time_used.csv</code></a>を作成しました.以下これらのデータをダウンロードして,作業を進めてください.</p>
<div class="warn">
<p>可能であれば,練習として以下のコードは見ないで,元の内閣府の資料から何をする必要があるのか,自分でどのように計算するかを考えて実行してみましょう.</p>
</div>
<p>まずはデータをそれぞれ読み込んでみましょう.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>df_f <span class="op">=</span> pd.read_csv(<span class="st">'fertility_rates.csv'</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>df_t <span class="op">=</span> pd.read_csv(<span class="st">'time_used.csv'</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_f)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_t)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">            Country  Fertility</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">0             Korea       0.92</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">1             Spain       1.23</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">2             Italy       1.27</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">3             Japan       1.36</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">4            Poland       1.42</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co">5          Portugal       1.43</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">6         Lithuania       1.61</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">7        Luxembourg       1.34</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co">8            Canada       1.47</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co">9            Greece       1.34</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co">10          Finland       1.35</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co">11          Austria       1.46</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co">12      Switzerland       1.48</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co">13   United Kingdom       1.63</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co">14       Costa Rica       1.63</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co">15            Chile       1.55</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co">16           Norway       1.53</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co">17           Latvia       1.61</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co">18          Germany       1.54</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co">19     OECD average       1.60</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co">20          Hungary       1.49</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co">21          Belgium       1.60</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co">22          Estonia       1.66</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co">23      Netherlands       1.57</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co">24  Slovak Republic       1.57</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co">25      New Zealand       1.72</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="co">26         Slovenia       1.61</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co">27    United States       1.71</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="co">28           Sweden       1.70</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="co">29        Australia       1.67</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="co">30          Türkiye       1.88</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="co">31         Colombia       1.77</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="co">32          Ireland       1.70</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="co">33          Denmark       1.70</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="co">34           France       1.83</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="co">35          Iceland       1.75</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="co">36           Mexico       1.92</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="co">37   Czech Republic       1.71</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="co">38           Israel       3.01</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="co">           Country  Paid  Unpaid  Care</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="co">0        Australia  20.3    10.5   2.2</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="co">1          Austria  22.5     9.4   1.5</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="co">2          Belgium  15.6     9.7   0.8</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="co">3           Canada  22.1    10.3   1.7</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="co">4          Estonia  21.0    11.5   1.8</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="co">5          Finland  15.4    11.2   1.0</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="co">6           France  14.5     9.7   1.0</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="co">7          Germany  17.4     9.8   1.4</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="co">8            Italy  14.5     8.2   1.2</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="co">9            Japan  26.3     4.7   0.5</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a><span class="co">10           Korea  26.5     3.0   0.8</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="co">11          Latvia  24.2     8.8   1.2</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="co">12          Mexico  30.0     4.4   3.5</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a><span class="co">13     New Zealand  19.9    11.3   1.1</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="co">14          Norway  18.6    11.7   1.6</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a><span class="co">15          Poland  21.7     6.2   1.5</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a><span class="co">16        Slovenia  18.9    11.4   1.6</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="co">17           Spain  14.8     8.9   2.0</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="co">18          Sweden  20.1    10.0   1.8</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a><span class="co">19          Turkey  20.2     2.6   3.5</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a><span class="co">20  United Kingdom  20.1     9.5   1.6</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a><span class="co">21   United States  20.4    10.2   1.6</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>確認してみると,政府のデータは国ごとに異なる年代を使用しており,年代も国の選択もOECDのデータベースで公開されているものとは異なるようです.実際に,日本経済新聞のデータとも値が異なっていることから,おそらく公開されていないデータを独自に集計しているようです.
今回は日本経済新聞で採用されている値から2019年の出生率及びデータベースで公開されている1999-2013年の家事・育児時間を採用します.</p>
<p>続いて,政府のグラフに合わせて男性の労働時間,家事及び育児の時間(Paid,Unpaid,Care)に占める家事及び育児(Unpaid, Care)の割合を計算します.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df_t[<span class="st">'r'</span>] <span class="op">=</span> df_t[[<span class="st">'Unpaid'</span>,<span class="st">'Care'</span>]].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>) <span class="op">/</span> df_t[[<span class="st">'Paid'</span>,<span class="st">'Unpaid'</span>,<span class="st">'Care'</span>]].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_t)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">           Country  Paid  Unpaid  Care         r</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">0        Australia  20.3    10.5   2.2  0.384848</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">1          Austria  22.5     9.4   1.5  0.326347</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">2          Belgium  15.6     9.7   0.8  0.402299</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">3           Canada  22.1    10.3   1.7  0.351906</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">4          Estonia  21.0    11.5   1.8  0.387755</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">5          Finland  15.4    11.2   1.0  0.442029</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">6           France  14.5     9.7   1.0  0.424603</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">7          Germany  17.4     9.8   1.4  0.391608</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">8            Italy  14.5     8.2   1.2  0.393305</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">9            Japan  26.3     4.7   0.5  0.165079</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">10           Korea  26.5     3.0   0.8  0.125413</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">11          Latvia  24.2     8.8   1.2  0.292398</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">12          Mexico  30.0     4.4   3.5  0.208443</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co">13     New Zealand  19.9    11.3   1.1  0.383901</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co">14          Norway  18.6    11.7   1.6  0.416928</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co">15          Poland  21.7     6.2   1.5  0.261905</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co">16        Slovenia  18.9    11.4   1.6  0.407524</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co">17           Spain  14.8     8.9   2.0  0.424125</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co">18          Sweden  20.1    10.0   1.8  0.369906</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co">19          Turkey  20.2     2.6   3.5  0.231939</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co">20  United Kingdom  20.1     9.5   1.6  0.355769</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co">21   United States  20.4    10.2   1.6  0.366460</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p><code>df_t</code>と<code>df_f</code>は表示されている国が異なるので,<code>df_t</code>から情報を抽出します.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#照合のためにCountryをindexにします.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df_t.set_index(<span class="st">'Country'</span>,inplace<span class="op">=</span><span class="va">True</span>,drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>df_f.set_index(<span class="st">'Country'</span>,inplace<span class="op">=</span><span class="va">True</span>,drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>df_f[<span class="st">'r'</span>] <span class="op">=</span> pd.NA</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> df_f.index:</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        df_f.at[i,<span class="st">'r'</span>] <span class="op">=</span> df_t.at[i,<span class="st">'r'</span>]</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_f)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co">                 Fertility         r</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">Country</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">Korea                 0.92  0.125413</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co">Spain                 1.23  0.424125</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co">Italy                 1.27  0.393305</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co">Japan                 1.36  0.165079</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co">Poland                1.42  0.261905</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co">Portugal              1.43      &lt;NA&gt;</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co">Lithuania             1.61      &lt;NA&gt;</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co">Luxembourg            1.34      &lt;NA&gt;</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co">Canada                1.47  0.351906</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co">Greece                1.34      &lt;NA&gt;</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co">Finland               1.35  0.442029</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="co">Austria               1.46  0.326347</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co">Switzerland           1.48      &lt;NA&gt;</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="co">United Kingdom        1.63  0.355769</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co">Costa Rica            1.63      &lt;NA&gt;</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="co">Chile                 1.55      &lt;NA&gt;</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="co">Norway                1.53  0.416928</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="co">Latvia                1.61  0.292398</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="co">Germany               1.54  0.391608</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="co">OECD average          1.60      &lt;NA&gt;</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="co">Hungary               1.49      &lt;NA&gt;</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="co">Belgium               1.60  0.402299</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="co">Estonia               1.66  0.387755</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="co">Netherlands           1.57      &lt;NA&gt;</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="co">Slovak Republic       1.57      &lt;NA&gt;</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="co">New Zealand           1.72  0.383901</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="co">Slovenia              1.61  0.407524</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="co">United States         1.71   0.36646</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="co">Sweden                1.70  0.369906</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a><span class="co">Australia             1.67  0.384848</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="co">Türkiye               1.88      &lt;NA&gt;</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="co">Colombia              1.77      &lt;NA&gt;</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="co">Ireland               1.70      &lt;NA&gt;</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="co">Denmark               1.70      &lt;NA&gt;</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="co">France                1.83  0.424603</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a><span class="co">Iceland               1.75      &lt;NA&gt;</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="co">Mexico                1.92  0.208443</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="co">Czech Republic        1.71      &lt;NA&gt;</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="co">Israel                3.01      &lt;NA&gt;</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p><code>df_t</code>にデータの無い国を除外します.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#NAを削除</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df_f.dropna(how<span class="op">=</span><span class="st">'any'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_f)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">                Fertility         r</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">Country</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">Korea                0.92  0.125413</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">Spain                1.23  0.424125</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">Italy                1.27  0.393305</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">Japan                1.36  0.165079</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">Poland               1.42  0.261905</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">Canada               1.47  0.351906</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">Finland              1.35  0.442029</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">Austria              1.46  0.326347</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">United Kingdom       1.63  0.355769</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">Norway               1.53  0.416928</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">Latvia               1.61  0.292398</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co">Germany              1.54  0.391608</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co">Belgium              1.60  0.402299</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co">Estonia              1.66  0.387755</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co">New Zealand          1.72  0.383901</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co">Slovenia             1.61  0.407524</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co">United States        1.71   0.36646</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co">Sweden               1.70  0.369906</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="co">Australia            1.67  0.384848</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co">France               1.83  0.424603</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co">Mexico               1.92  0.208443</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>全てのデータが揃った国はこの21ヵ国となりました.</p>
<div class="note">
<p>このとき問題となるのが,どの国を採用するかです.
元のPOSTにも指摘がありましたが,内閣府の計算ではなぜかメキシコが除外されていますので,それに従って実行してみます.</p>
</div>
<div class="sourceCode" id="cb5"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#メキシコを除外</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>df_f.drop(<span class="st">'Mexico'</span>,axis<span class="op">=</span><span class="dv">0</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_f)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">               Fertility         r</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">Country</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">Korea                0.92  0.125413</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">Spain                1.23  0.424125</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">Italy                1.27  0.393305</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">Japan                1.36  0.165079</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">Poland               1.42  0.261905</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">Canada               1.47  0.351906</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">Finland              1.35  0.442029</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co">Austria              1.46  0.326347</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co">United Kingdom       1.63  0.355769</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co">Norway               1.53  0.416928</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co">Latvia               1.61  0.292398</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co">Germany              1.54  0.391608</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co">Belgium              1.60  0.402299</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co">Estonia              1.66  0.387755</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co">New Zealand          1.72  0.383901</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co">Slovenia             1.61  0.407524</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co">United States        1.71   0.36646</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co">Sweden               1.70  0.369906</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co">Australia            1.67  0.384848</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co">France               1.83  0.424603</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p><code>Fertility</code>は<code>%</code>になっているので単位を揃えて<code>r</code>も<code>%</code>表示にし,データ型も<code>float</code>にしておきます.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df_f[<span class="st">'r'</span>] <span class="op">=</span> (df_f[<span class="st">'r'</span>] <span class="op">*</span> <span class="dv">100</span>).astype(<span class="st">'float'</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_f)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">                Fertility          r</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">Country</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">Korea                0.92  12.541254</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">Spain                1.23  42.412451</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">Italy                1.27  39.330544</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">Japan                1.36  16.507937</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">Poland               1.42  26.190476</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">Canada               1.47  35.190616</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">Finland              1.35  44.202899</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">Austria              1.46  32.634731</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">United Kingdom       1.63  35.576923</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">Norway               1.53  41.692790</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">Latvia               1.61  29.239766</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">Germany              1.54  39.160839</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co">Belgium              1.60  40.229885</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co">Estonia              1.66  38.775510</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co">New Zealand          1.72  38.390093</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co">Slovenia             1.61  40.752351</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="co">United States        1.71  36.645963</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co">Sweden               1.70  36.990596</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co">Australia            1.67  38.484848</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="co">France               1.83  42.460317</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<h4 data-number="1.2.2" id="散布図の作成"><span class="header-section-number">1.2.2</span> 散布図の作成</h4>
<p>データが完成したので,散布図を作成してみます. ラベルを表示するためにライブラリ<code>adjustText</code>を利用しています. この方法で作成する場合は<code>pip install</code>してください.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> adjustText <span class="im">import</span> adjust_text</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>plt.scatter(df_f[<span class="st">'r'</span>],df_f[<span class="st">'Fertility'</span>])</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> [plt.text(df_f.at[c,<span class="st">'r'</span>],df_f.at[c,<span class="st">'Fertility'</span>],c) <span class="cf">for</span> c <span class="kw">in</span> df_f.index]</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>adjust_text(text, arrowprops<span class="op">=</span><span class="bu">dict</span>(arrowstyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'gray'</span>, lw<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>plt.xlim<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">50</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>plt.ylim<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">2</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Fertility'</span>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Unpaid and Care Work'</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Fertility vs Unpaid and Care Work with Country Labels'</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="../images/ch11_oecd_scatter_no_line.png" /></p>
<p>おおよそ政府と同じグラフが完成しました.</p>
<h4 data-number="1.2.3" id="単回帰"><span class="header-section-number">1.2.3</span> 単回帰</h4>
<p>つづいて,これらのデータを利用して単回帰分析を実施してみます. 回帰分析が可能なライブラリはいくつかありますが,ここでは<code>statsmodels.api</code>を利用してみます. <code>pip install statsmodels</code> をしておきましょう.</p>
<p>まずは,切片 <span class="math inline">\beta_0</span> として定数1をデータに追加します. <code>statsmodels</code>では <code>.add_constant()</code>メソッドで追加できます.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 説明変数(X)と目的変数(y)に分割</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_f[[<span class="st">'r'</span>]]</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_f[<span class="st">'Fertility'</span>]</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 切片(定数項)を追加</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co">                const          r</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co">Country</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co">Korea             1.0  12.541254</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co">Spain             1.0  42.412451</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co">Italy             1.0  39.330544</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co">Japan             1.0  16.507937</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co">Poland            1.0  26.190476</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co">Canada            1.0  35.190616</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co">Finland           1.0  44.202899</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="co">Austria           1.0  32.634731</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="co">United Kingdom    1.0  35.576923</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co">Norway            1.0  41.692790</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="co">Latvia            1.0  29.239766</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="co">Germany           1.0  39.160839</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="co">Belgium           1.0  40.229885</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="co">Estonia           1.0  38.775510</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="co">New Zealand       1.0  38.390093</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="co">Slovenia          1.0  40.752351</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="co">United States     1.0  36.645963</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="co">Sweden            1.0  36.990596</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="co">Australia         1.0  38.484848</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="co">France            1.0  42.460317</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>回帰分析を実施するには <code>OLS(y,X).fit()</code>を利用します. <code>OLS</code>は<code>Ordinary Least Squares</code>の頭文字で最小二乗法を意味しています.</p>
<p>回帰分析の結果は<code>.result()</code>メソッドで確認します.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰モデルを作成・フィット</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果を表示</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result.summary())</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">                            OLS Regression Results</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">==============================================================================</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">Dep. Variable:              Fertility   R-squared:                       0.282</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">Model:                            OLS   Adj. R-squared:                  0.243</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">Method:                 Least Squares   F-statistic:                     7.085</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">Date:                Sat, 29 Mar 2025   Prob (F-statistic):             0.0159</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">Time:                        13:27:03   Log-Likelihood:                 6.4233</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">No. Observations:                  20   AIC:                            -8.847</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">Df Residuals:                      18   BIC:                            -6.855</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">Df Model:                           1</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">Covariance Type:            nonrobust</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">==============================================================================</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co">                 coef    std err          t      P&gt;|t|      [0.025      0.975]</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co">------------------------------------------------------------------------------</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co">const          1.0390      0.183      5.666      0.000       0.654       1.424</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co">r              0.0134      0.005      2.662      0.016       0.003       0.024</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co">==============================================================================</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="co">Omnibus:                        3.229   Durbin-Watson:                   0.868</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="co">Prob(Omnibus):                  0.199   Jarque-Bera (JB):                2.595</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="co">Skew:                          -0.852   Prob(JB):                        0.273</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co">Kurtosis:                       2.539   Cond. No.                         161.</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="co">==============================================================================</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>様々な数値が出てきましたが,単回帰において注目すべきは,<code>(Adj.)R-squared</code>,<code>Prob (F-statistic)</code>,<code>coef</code>,<code>P&gt;|t|</code>,<code>[0.025      0.975]</code>です.
それぞれ何を見ればよいのかを順に見ていきましょう.</p>
<h4 data-number="1.2.4" id="回帰係数p値区間推定値"><span class="header-section-number">1.2.4</span> 回帰係数(P値,区間推定値)</h4>
<div class="sourceCode" id="cb10"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">                coef    std err          t      P&gt;|t|      [0.025      0.975]</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">------------------------------------------------------------------------------</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">const          1.0390      0.183      5.666      0.000       0.654       1.424</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">r              0.0134      0.005      2.662      0.016       0.003       0.024</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>回帰係数から今回推定された標本回帰方程式(<span class="math inline">y=\hat{\beta}_0+\hat{\beta}_1x</span>)は</p>
<p><span class="math display">
y=1.0390+0.0134x
</span></p>
<p>となります.
この <span class="math inline">\hat{\beta}_0</span> と <span class="math inline">\hat{\beta}_1</span> に対して<span class="math inline">H_0: \beta_i =0,H_1: \beta_i \neq 0</span> で検定した結果が,<code>P&gt;|t|</code>として示されています.
また, <span class="math inline">\hat{\beta}_0</span> と <span class="math inline">\hat{\beta}_1</span> の下側信頼限界が<code>0.025</code>,上側信頼限界が<code>0.975</code>として示されています.
2つの値は基本的に同じことを違う方法で表しています.</p>
<div class="note">
<p>それぞれの説明変数のP値(<code>P&gt;|t|</code>)は,その説明変数に対する回帰係数が0である(影響がない)という仮説に対する仮説検定のP値を表しています. また, <code>[0.025      0.975]</code>はそれぞれ上側と下側の95%信頼区間を表しています.</p>
<p>有意水準5%の場合, <code>P値 &lt; 0.05</code>で有意となり, 信頼区間が0をまたぎません.
(ここで両側検定ですが,<code>P値 &lt; 0.025</code>とならないのは,両側の外側累積確率を合算した値が算出されるためです.)
したがって,これらの値はいずれも同じ判断の基準となりますが,最近は論文などには両方載せることが主流です.
(仮説検定や区間推定,P値の意味などに関しては,統計学入門で詳細を扱っています.分からない人はそちらを履修しましょう.)</p>
</div>
<p><strong>｢P値 &lt; 0.05｣ かつ ｢下側信頼限界と上側信頼限界が0をまたいでいない｣</strong>場合には,それぞれの回帰係数が有意となります.</p>
<p>したがって今回の回帰分析の結果としては, いずれの回帰係数も有意であり,出生率に影響を及ぼしていると考えることができます.</p>
<p>あまり良くない回帰分析の方法として,有意でない回帰係数が混じっていても,有意な回帰係数のみを分析対象としている場合がしばしばありますが,基本的には, 式を構成するすべての回帰係数が有意である場合にはじめてその式は利用できます.
一つでも有意でない式がある場合には,その回帰式は利用できないとみなしてください.</p>
<h4 data-number="1.2.5" id="式全体の評価指標r2f"><span class="header-section-number">1.2.5</span> 式全体の評価指標(<span class="math inline">R^2</span>,F)</h4>
<p>回帰係数のP値,区間推定値は回帰係数一つ一つに関する検定の結果でした. 個別の係数が問題ないとしても,切片と傾きを合わせた式全体の評価はどうなのでしょうか. その判断に利用するのが,
<span class="math inline">R^2</span> と 有意Fです.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">R-squared:                       0.282</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">Adj. R-squared:                  0.243</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">F-statistic:                     7.085</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">Prob (F-statistic):             0.0159</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<div class="note">
<ul>
<li><h3 id="調整済決定係数adj.-r-squared"><strong>調整済決定係数(Adj. R-squared)</strong></h3></li>
</ul>
<p>自由度調整済み決定係数 <span class="math inline">Adj R^2</span> は,<strong>モデルがどの程度当てはまっているかの基準</strong>です.
基本的に <span class="math inline">0 \leq Adj R^2 \leq 1</span> の値をとり,目安として <span class="math inline">0.5 \leq Adj 𝑅^2</span> であればある程度予測できていると考えられます.</p>
<p>どんな散布図になっても回帰式自体は作成可能ですが,以下の左右どちらの予測値の方が信頼できそうでしょうか.</p>
<figure>
<img src="../images/regression14.png" alt="R2" />
<figcaption aria-hidden="true">R2</figcaption>
</figure>
<p>直感的には左の方が<strong>回帰直線が実際の値にフィットしており</strong>信頼できそうな気がしますね. <span class="math inline">R^2</span> はその感覚を数値化したものになります.</p>
<figure>
<img src="../images/regression15.png" alt="R2" />
<figcaption aria-hidden="true">R2</figcaption>
</figure>
<p><span class="math inline">R^2</span> は,式から作られた直線と,実際のデータの点の距離の和を変更したものです.
$R^2 が1に近いほど, 式が点によく当てはまっていることを表します.</p>
<ul>
<li><p>0.5以上で予測に利用できる.</p></li>
<li><p>0.8以上でかなり正確に予測ができる という解釈になります.</p></li>
</ul>
<p>この値は説明変数の数が多いほど1に近づく特徴があるので,説明変数が多い場合には説明変数の数を補正した 自由度調整済み決定係数 (𝐴𝑑𝑗.<span class="math inline">𝑅^2</span>)を用います.</p>
</div>
<p>今回のモデルを見てみると,<code>Adj. R-squared:0.243</code>であり,予測精度が高くないことが分かります.</p>
<div class="note">
<ul>
<li><h3 id="有意f-prob-f-statistic"><strong>有意F (Prob (F-statistic))</strong></h3></li>
</ul>
<p>有意Fは求めた標本回帰式でどの程度データの散らばりを説明できるかを検定した結果です.
どのような意味であるか見ていきましょう.</p>
<p>求めた回帰式と,データそれぞれの散らばりは,<strong>全変動</strong>,<strong>回帰変動</strong>,<strong>残渣変動</strong>によって表現可能です.</p>
<p><img src="../images/ch11-prob-f.png" /></p>
<ul>
<li>全変動:データと平均値の差の合計(の二乗和)</li>
</ul>
<p>データの散らばり具合</p>
<p><span class="math display">
\sum_{i=1}^n (y_i-y)^2
</span></p>
<ul>
<li>回帰変動:予測値とデータの平均値の差(の二乗和)</li>
</ul>
<p>データに対する回帰式の予測値の散らばり具合
<span class="math display">
\sum_{i=1}^n (\hat{y}_i-\bar{y})^2
</span></p>
<ul>
<li>残差変動:予測値とデータの差(の二乗和)</li>
</ul>
<p>回帰式とデータのズレの散らばり具合</p>
<p><span class="math display">
\sum_{i=1}^n (y_i-\hat{y})^2
</span></p>
<p>このとき</p>
<p><code>全変動 = 回帰変動+残差変動</code> すなわち,
<span class="math display">
\sum_{i=1}^n (y_i-y)^2 = \sum_{i=1}^n (\hat{y}_i-\bar{y})^2 + \sum_{i=1}^n (y_i-\hat{y})^2
</span>
がなりたちます.</p>
<p>これは言い換えると,</p>
<p><code>データの散らばり=回帰式で説明できる散らばり+回帰式で説明できない散らばり</code></p>
<p>を表しています.</p>
<p>回帰変動の平均と,残差変動の平均の比率を考えると,kを説明変数の数として,</p>
<p><span class="math display">
\begin{align*}
&amp;\frac{回帰変動の平均}{残差変動の平均}
&amp;=\frac{\sum_{i=1}^n (\hat{y}_i-\bar{y})^2 /𝑘}{\sum_{i=1}^n (y_i-\hat{y})^2/(n−k−1)}
\end{align*}
</span></p>
<p>すなわち</p>
<p><span class="math display">
\frac{回帰式で説明できる散らばり}{回帰式で説明できない散らばり}= 回帰式が説明できている割合
</span></p>
<p>が成り立ちます.</p>
<p><img src="../images/ch11-prob-f2.png" /></p>
<p>また,この説明の割合はF分布に従うことが知られており,</p>
<p><span class="math display">
F = \frac{\sum_{i=1}^n (\hat{y}_i-\bar{y})^2 /𝑘}{\sum_{i=1}^n (y_i-\hat{y})^2/(n−k−1)} \sim F(k,n-k-1)
</span></p>
<p><span class="math inline">H_0:F=1</span>(回帰式が説明できる散らばりが説明できないものと等しい)</p>
<p><span class="math inline">H_1:F&gt;1</span> (説明できる量の方が大きい)</p>
<p>として検定した結果のP値が有意Fです.</p>
<p>したがって,有意水準5%のとき,
<code>有意F &lt; 0.05</code> であれば,回帰式全体はデータを説明しているとみなすことができます.</p>
</div>
<p>今回は<code>Prob (F-statistic):0.0159</code>であり,有意に説明できていると言えます.</p>
<div class="note">
<p>したがって今回の結果をまとめると,</p>
<ul>
<li><p><span class="math inline">y=1.03+0.01x</span></p>
<ul>
<li><p>男性の仕事時間に対する家事育児の割合が1%が増えると,出生率が0.01増える</p></li>
<li><p>切片,傾き,式全体は有意(回帰式でデータを説明できる)</p></li>
</ul></li>
<li><p>予測精度は低い(予測には使えない)</p></li>
</ul>
<p>という結果が得られます.</p>
<p>内閣府の分析では,回帰式と<span class="math inline">R^2</span>のみが記載されており,検定結果は載っていませんでしたが,概ね正しい推論と言えます.
ただし,この結果を持って,日本の男性の家事育児参加時間をXに増やせば出生率がYになるというような予測はできません.</p>
</div>
<h4 data-number="1.2.6" id="結果の可視化"><span class="header-section-number">1.2.6</span> 結果の可視化</h4>
<p>最後に,このモデルを可視化してみましょう. まずは,内閣府の資料と同じ用に散布図に回帰直線を可視化してみます.
<code>OLS().fit()</code>で得られた予測モデルは,<code>.params[]</code>で値を得ることができます.回帰式をxの値と回帰係数から計算し,<code>plt.plot()</code>で直線を引いています.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰直線のためのx軸データとy軸データ</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>x_vals <span class="op">=</span> np.linspace(df_f[<span class="st">'r'</span>].<span class="bu">min</span>(), df_f[<span class="st">'r'</span>].<span class="bu">max</span>(), <span class="dv">100</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x_vals)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>y_vals <span class="op">=</span> result.params[<span class="st">'const'</span>] <span class="op">+</span> result.params[<span class="st">'r'</span>] <span class="op">*</span> x_vals</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 描画</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 散布図</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>plt.scatter(df_f[<span class="st">'r'</span>], df_f[<span class="st">'Fertility'</span>], color<span class="op">=</span><span class="st">'blue'</span>, label<span class="op">=</span><span class="st">'Data Points'</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ラベル付け</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>texts <span class="op">=</span> [plt.text(df_f.at[c, <span class="st">'r'</span>], df_f.at[c, <span class="st">'Fertility'</span>], c) <span class="cf">for</span> c <span class="kw">in</span> df_f.index]</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>adjust_text(texts, arrowprops<span class="op">=</span><span class="bu">dict</span>(arrowstyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'gray'</span>, lw<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰直線</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>plt.plot(x_vals, y_vals, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="st">'Regression Line'</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 軸・タイトル・その他</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>plt.xlim <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>plt.ylim <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Unpaid and Care Work'</span>)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Fertility'</span>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Fertility vs Unpaid and Care Work with Regression Line'</span>)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="../images/ch11_oecd_scatter_with_line.png" /></p>
<p>このようなグラフによって実測値に対する回帰直線の当てはまりを確認することもできますが,もう少しわかりやすい手法として,縦軸に実測値 <span class="math inline">Y</span> ,横軸に予測値 <span class="math inline">\hat{\beta}_0 + \sum \hat{\beta}_i X_i</span> をプロットした散布図もよく用いられます.</p>
<p>先ほどとは異なり, <code>.predict()</code>メソッドで元データから計算された予測値を求めています.ここにxの等差級数を渡すことで先程のように回帰直線の値を得ることも可能です.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> result.predict(X)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(y, pred, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolors<span class="op">=</span><span class="st">&quot;k&quot;</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Predicted&quot;</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Actual&quot;</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Actual vs. Predicted&quot;</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>plt.plot([y.<span class="bu">min</span>(), y.<span class="bu">max</span>()], [y.<span class="bu">min</span>(), y.<span class="bu">max</span>()], color<span class="op">=</span><span class="st">&quot;red&quot;</span>, linestyle<span class="op">=</span><span class="st">&quot;--&quot;</span>)  <span class="co"># 完全一致のライン</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="../images/ch11_oecd_pred_actual.png" /></p>
<p>実測値と予測値が一致していれば,この散布図はグラフの45度線(赤い点線)上に一直線になります.
<span class="math inline">R^2</span>の結果通り,あまり予測精度が高くないことがわかります.</p>
<p>実測値と予測値の<code>カーネル密度プロット(KDE; Karnel Densiti Estimation Plot)</code>を重ねたグラフもベイズモデルなどでよく利用される手法です.
実測値の分布と予測値の分布を見比べることで,値全体でどの部分が過大/過少に推測されているかモデルの想定する分布がデータの分布と近いかが視覚化されます.</p>
<p><code>kde</code>の描画には<code>seaborn</code>ライブラリが必要になるので<code>pip install</code>しておきましょう.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>,<span class="dv">8</span>))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(pred, label <span class="op">=</span> <span class="st">'Predicted'</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(y, label <span class="op">=</span> <span class="st">'Actual'</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Actual/Predicted'</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Fertility'</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Density'</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code></pre></div>
<p><img src="../images/ch11_oecd_density.png" /></p>
<p>実測値と予測値で大きく分布が異なることがわかり,やはりあまり良いモデルとはいえなさそうです.</p>
<div class="note">
<ul>
<li>演習問題</li>
</ul>
<p>内閣府の計算で何故か除外されていたMexicoのデータを加えて回帰分析を行い,その結果を解釈してください.</p>
</div>
<h3 data-number="1.3" id="重回帰分析"><span class="header-section-number">1.3</span> 重回帰分析</h3>
<h3 data-number="1.4" id="重回帰分析-1"><span class="header-section-number">1.4</span> 重回帰分析</h3>
<p>説明変数も被説明変数も量的変数のときに,</p>
<p><span class="math display">
y_i = \beta_0 + \beta_1 x_{1i} + \beta_2 x_{2i} + ... + \beta_n x_{ni}
</span></p>
<p>のような回帰式を求めます.</p>
<p>それでは,Pythonで重回帰分析を行ってみましょう.</p>
<p>題材として以下の｢日本教育新聞｣の記事(<a href="https://www.kyoiku-press.com/post-223665/">https://www.kyoiku-press.com/post-223665/</a>)について考えてみます.</p>
<div class="note">
<blockquote>
<p><strong>Wi-Fi電磁波で学力低下を懸念,市議ら意見交換会</strong></p>
<p>2020年12月7日
電磁波が人体に影響を与え,学力の低下を招くことなどを懸念する市議会議員らは11月8日,無線LANにより生じる「電磁波過敏症」への対策などについて,意見交換会をオンラインで開催した.
　GIGAスクール構想でICT環境を整備するに当たって,電磁波による問題点とそれへの対策を話し合った.
　東京都新宿区議会のよだかれん議員は,学力と健康の2つの観点から,「大人でもICT機器を使用すると前頭前野の機能が低下するという様々な研究報告がある.小学1年生からの使用で脳の発達への影響は懸念されないのか」と指摘した.
　よだ議員は,9月議会の質疑の一部で,令和元年の全国学力テストの結果に基づき,電子黒板やプロジェクターなどの大型電子機器の整備率が1位の佐賀県は正答率が全国で43位だった一方,整備率最下位の秋田県は正答率が1位だったことを紹介した.
　意見交換会を主催した「いのち環境ネットワーク」の加藤やすこ代表によると,電磁波過敏症は短い時間でも発症の可能性があり,一度の発症が長期に及んで続くという.
　埼玉県日高市議会の松尾まよか議員は,GIGAスクール構想を進める上で,Wi-Fiのアクセスポイントの位置を児童・生徒から遠ざけた場所に設置する,使用していない時は電源を落とすことを重要な点に位置付けた.
　松尾議員は,「発症者が出てからでは遅い.発症後の対策に予算をかけるよりも,事前に対策しておく方がよい」と強調した.
　今回の意見交換会に参加した市議らは,9月議会の発言内容なども報告した.</p>
</blockquote>
<p>こちらの記事では,</p>
<blockquote>
<p>令和元年の全国学力テストの結果に基づき,電子黒板やプロジェクターなどの大型電子機器の整備率が1位の佐賀県は正答率が全国で43位だった一方,整備率最下位の秋田県は正答率が1位だった</p>
</blockquote>
<p>ことから,</p>
<p>｢学校教育におけるICT機器の導入が学力低下を招いている｣ということを主張しています.</p>
</div>
<p>最下位と1位の2つの観測対象のデータだけでこのような主張が可能なのでしょうか. データを使ってこの主張を検証してみましょう. 必要なデータは<a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/math_correct.csv">こちら</a>からダウンロード可能ですが,データの取得手順に興味がある方は,以下から確認して自分でデータを作成してみましょう.</p>
<div class="note">
<ul>
<li>教育データの作成</li>
</ul>
<details open>
<summary>
開く/ 閉じる
</summary>
<p>まずは全国の県別の学力データを探してみます.</p>
<p>国立教育政策研究所の行っている全国学力・学習状況調査(<a href="https://www.nier.go.jp/19chousakekkahoukoku/index.html">https://www.nier.go.jp/18chousakekkahoukoku/index.html</a>)から,令和元年の県別の小学生の学力データを取得します.</p>
<figure>
<img src="../images/regression1.png" alt="全国学力･学習状況調査" />
<figcaption aria-hidden="true">全国学力･学習状況調査</figcaption>
</figure>
<p>ただし,こちらのデータはPDFでのみ公開されているためExcelやAIなどを利用して,CSVに変換する必要があります. 今回私はPDFからテキストエディタにコピー&amp;ペーストして, 不要な記号を置換しましたが,好きな方法でやりましょう.</p>
<figure>
<img src="../images/regression2.png" alt="全国学力･学習状況調査" />
<figcaption aria-hidden="true">全国学力･学習状況調査</figcaption>
</figure>
<p>続いて, 記事にある,電子黒板やプロジェクターなどの大型電子機器の整備率に関するデータを<a href="https://www.e-stat.go.jp">e-stat</a>から取得します.</p>
<p>今回は県別データなので,｢地域｣から,データを取得します.</p>
<figure>
<img src="../images/regression3.png" alt="e-stat 地域" />
<figcaption aria-hidden="true">e-stat 地域</figcaption>
</figure>
<p>｢都道府県データ｣にチェックを入れて｢データ表示｣に進みます.</p>
<figure>
<img src="../images/regression4.png" alt="都道府県データ" />
<figcaption aria-hidden="true">都道府県データ</figcaption>
</figure>
<p>｢地域選択｣において｢全て選択｣をクリックしたあと選択中地域から全国をクリックし,｢地域を削除｣
を押し,47都道府県のみを選び,確定します.</p>
<figure>
<img src="../images/regression5.png" alt="地域選択" />
<figcaption aria-hidden="true">地域選択</figcaption>
</figure>
<p>｢分野｣から｢教育｣を選び関連のありそうな
- ｢教育用コンピュータ一台あたりの児童数(小学校)｣
- ｢普通教室の電子黒板整備率(小学校)｣
- ｢デジタル教科書の整備率(小学校)｣
などを選択し,｢項目を選択｣を押し,確定します.</p>
<figure>
<img src="../images/regression6.png" alt="教育関連データの選択" />
<figcaption aria-hidden="true">教育関連データの選択</figcaption>
</figure>
<p>｢調査年｣からデータが揃っている2017年度を選択し,｢再表示｣を押します.</p>
<figure>
<img src="../images/regression7.png" alt="調査年の選択" />
<figcaption aria-hidden="true">調査年の選択</figcaption>
</figure>
<p>｢ダウンロード｣から,右の図のように選択して,ダウンロードします.</p>
<figure>
<img src="../images/regression8.png" alt="ダウンロード" />
<figcaption aria-hidden="true">ダウンロード</figcaption>
</figure>
<p>学力のデータにダウンロードした黒板などのデータをコピーして,適切にヘッダーをつけ,Utf-8で作業フォルダの中のDataフォルダに保存しましょう.例ではmath_correct.csvと名前をつけています.
- 数学正答率 → math
- 一台あたりのPC → pc
- 黒板 → board
- 電子教科書 → text</p>
<p>Excelで貼り付けた際に文字列情報になっている場合があり,!マークが表示されていたら数値に変換しておきましょう.</p>
<figure>
<img src="../images/regression9.png" alt="データの編集" />
<figcaption aria-hidden="true">データの編集</figcaption>
</figure>
<p>データが読み込めるか確認してみましょう.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'Data/math_correct.csv'</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">   pref  math   pc  board  text</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">0   北海道    64  5.8   20.8  38.5</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">1   青森県    67  5.3   22.4  30.9</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">2   岩手県    66  5.4   19.6  35.9</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">3   宮城県    65  6.8   14.0  66.6</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">4   秋田県    70  5.6   22.4  36.8</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">5   山形県    65  5.7   16.6  44.0</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">6   福島県    65  5.3   24.6  47.2</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">7   茨城県    66  6.5   22.0  49.5</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co">8   栃木県    65  5.9   42.6  70.8</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co">9   群馬県    65  6.1   15.4  39.3</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co">10  埼玉県    66  9.6   23.9  58.8</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co">...</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
</details>
</div>
<p>それでは,このデータを利用して重回帰分析を行っていきます.</p>
<div class="note">
<p>Pythonで重回帰を行えるライブラリは多数ありますが, 今回は統計モデリングのためのライブラリ<code>statsmodels</code>を利用します. pip install し, プログラムの最初に, <code>import statsmodels.api as sm</code>と記述し<code>import</code>しておきましょう.</p>
</div>
<p>ただし, 重回帰を実施する前に,いくつか必要な前処理があります. 順番に見ていきましょう.</p>
<h4 data-number="1.4.1" id="正規化標準化"><span class="header-section-number">1.4.1</span> 正規化・標準化</h4>
<p>重回帰分析では,複数の説明変数の目的変数に対する影響を比較します. 各説明変数の目的変数への影響力は,回帰係数として現れますが説明変数1の単位がmm,説明変数2の単位がm, 説明変数3の単位がKgなどとなると,それぞれの回帰係数は,それぞれ1mmの変化,1mの変化,1Kgの変化に対する目的変数の変化量を表しているために,同じ基準で比較できません.そこで,<strong>正規化/標準化</strong>というデータの単位などを揃える操作を行う必要があります.</p>
<div class="note">
<ul>
<li>正規化(Normalization)</li>
</ul>
<p>最大値を1,最小値を0に揃えること.</p>
<p>データを <span class="math inline">X = {x_1,x_2,...,x_n}</span> とすると, 正規化後の値 <span class="math inline">x_i'</span> は</p>
<p><span class="math display">
x_i' = \frac{x_i - min(X)}{max(X) - min(X)}
</span></p>
<p><code>pandas</code>では<code>X</code>が対象のデータ列名のリストだとすると,以下のように正規化列<code>X_n</code>が求められる.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>X_n <span class="op">=</span> (df[X] <span class="op">-</span> df[X].<span class="bu">min</span>()) <span class="op">\</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span> (df[X].<span class="bu">max</span>() <span class="op">-</span> df[X].<span class="bu">min</span>())</span></code></pre></div>
</div>
<div class="note">
<ul>
<li>標準化(Standarization)</li>
</ul>
<p>標準得点を求めて,平均0,分散1に揃える.</p>
<p><span class="math display">
\sum
</span></p>
<p><span class="math display">
z_i = \frac{x_i - \bar{x}}{\sigma}
</span></p>
<p><code>pandas</code>では<code>X</code>が対象のデータ列名のリストだとすると,以下のように標準化列<code>X_z</code>が求められる.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>X_z <span class="op">=</span> (df[X] <span class="op">-</span> df[X].mean()) <span class="op">\</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span> df[X].std()</span></code></pre></div>
</div>
<p>それでは, 先ほど得られた教育データを標準化してみましょう.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>Y_label <span class="op">=</span> <span class="st">'math'</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">#標準化</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> (df[Y_label] <span class="op">-</span> df[Y_label].mean()) <span class="op">\</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span> df[Y_label].std()</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>plt.hist(Y)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>plt.title(Y_label)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 説明変数のヘッダーを指定</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>X_labels <span class="op">=</span> [<span class="st">'pc'</span>,<span class="st">'board'</span>,<span class="st">'text'</span>]</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co">#標準化</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>X  <span class="op">=</span> (df[X_labels] <span class="op">-</span> df[X_labels].mean()) <span class="op">\</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span> df[X_labels].std()</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span> <span class="dv">3</span> <span class="co">#行数の指定</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>                        ,ncols<span class="op">=</span> <span class="dv">1</span> <span class="co">#列数の指定</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>                        ,sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="co">#連番に変換</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> axes.flatten()</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    col <span class="op">=</span> X_labels[i] <span class="co">#countをiで共通化</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    axes[i].hist(X[col])</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    axes[i].set_title(col)</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="../images/regression10.png" alt="Yのヒストグラム" />
<img src="../images/regression11.png" alt="Xのヒストグラム" /></p>
<div class="warn">
<p>本来ならば,ここで<code>math</code>が左右対称ではないことから正規分布を仮定した回帰を行うべきではなく,ベータ分布などを仮定した一般化線形モデルにすることを検討します.</p>
<p>また, <code>text</code>に外れ値(長崎県)があることなども考慮するべきですが,今回は線形回帰の事例ですのでそのまま進めてみます.</p>
</div>
<h4 data-number="1.4.2" id="多重共線性multi-colinearlity"><span class="header-section-number">1.4.2</span> 多重共線性(multi-colinearlity)</h4>
<div class="note">
<p>説明変数 <span class="math inline">x_1,x_2,\dots,x_n</span> において, 特定の変数 <span class="math inline">x_i</span> が他の変数によって</p>
<p><span class="math display">
x_{i} = \sum_{i \neq j} \alpha_j x_j
</span></p>
<p>として,少なくとも1つが0でない <span class="math inline">\alpha_j</span> によって表すことができる場合に,すなわち各変数が一次独立でなくなる場合に,説明変数に<strong>完全な多重共線性</strong>が成り立っているといいます.</p>
<p>このとき, 最小二乗法では, <span class="math inline">y = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + ... + \beta_n x_n</span> を解くことができなくなるため,解が得られなくなります.</p>
</div>
<p>例えば, <span class="math inline">x_1 = \alpha_2 x_2</span> であったとすると,</p>
<p><span class="math display">
y = \beta_0 + (\beta_1 + \alpha_2 \beta_2) x_1 + \beta_3 x_3 + ... + \beta_n x_n \\
</span></p>
<p>となり,推定値が <span class="math inline">\hat{\beta_{12}} = \hat{\beta_1} + \alpha_2 \hat{\beta_2}</span> であったとすると, <span class="math inline">\hat{\beta_{12}}</span> となる <span class="math inline">\hat{\beta_1}</span> と <span class="math inline">\hat{\beta_2}</span> の組み合わせは無数にあるため, <span class="math inline">\hat{\beta_1}</span> と <span class="math inline">\hat{\beta_2}</span> を特定することができなくなります.</p>
<p>このような<strong>完全な多重共線性</strong>は,主に特定の説明変数を,他の説明変数の変形によって作成している場合に生じるため,変形した変数を利用するならば,変形前の変数はモデルに利用しないようにしましょう.</p>
<p>例えば, これから使い方を学習する<code>statsmodels</code>を利用して,あえて<strong>完全な多重共線性</strong>が存在するような重回帰分析を行ってみます.
(<code>statsmodels</code>や重回帰の実施については,後述するのでこの時点では変数の生成以外は意味を理解する必要はありません.)</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">#乱数で目的変数と説明変数を生成</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.random.rand(<span class="dv">100</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>x_1 <span class="op">=</span> np.random.rand(<span class="dv">100</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'y'</span>:y,<span class="st">'x_1'</span>:x_1})</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co">#説明変数x_2をx_1から生成</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'x_2'</span>] <span class="op">=</span> df[<span class="st">'x_1'</span>] <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> [<span class="st">'x_1'</span>,<span class="st">'x_2'</span>]</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co">#予測モデルを作成(重回帰)</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(df[X])</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(df[<span class="st">'y'</span>],X)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> model.fit()</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result.summary())</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co">                            OLS Regression Results</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="co">==============================================================================</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="co">Dep. Variable:                      y   R-squared:                       0.000</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="co">Model:                            OLS   Adj. R-squared:                 -0.010</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a><span class="co">Method:                 Least Squares   F-statistic:                   0.01870</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a><span class="co">Date:                Mon, 08 Jul 2024   Prob (F-statistic):              0.892</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a><span class="co">Time:                        18:24:01   Log-Likelihood:                -11.013</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="co">No. Observations:                 100   AIC:                             26.03</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a><span class="co">Df Residuals:                      98   BIC:                             31.24</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a><span class="co">Df Model:                           1</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a><span class="co">Covariance Type:            nonrobust</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a><span class="co">==============================================================================</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a><span class="co">                 coef    std err          t      P&gt;|t|      [0.025      0.975]</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a><span class="co">------------------------------------------------------------------------------</span></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a><span class="co">const          0.4896      0.060      8.121      0.000       0.370       0.609</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a><span class="co">x_1            0.0028      0.021      0.137      0.892      -0.038       0.044</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a><span class="co">x_2            0.0056      0.041      0.137      0.892      -0.076       0.087</span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a><span class="co">==============================================================================</span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a><span class="co">Omnibus:                       19.023   Durbin-Watson:                   2.250</span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a><span class="co">Prob(Omnibus):                  0.000   Jarque-Bera (JB):                5.214</span></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a><span class="co">Skew:                           0.170   Prob(JB):                       0.0738</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a><span class="co">Kurtosis:                       1.934   Cond. No.                     8.65e+16</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a><span class="co">==============================================================================</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a><span class="co">Notes:</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a><span class="co">[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</span></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a><span class="co">[2] The smallest eigenvalue is 3.44e-32. This might indicate that there are</span></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a><span class="co">strong multicollinearity problems or that the design matrix is singular.</span></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p><code>statsmodels</code>では,一応重回帰自体は実施できるものの,</p>
<blockquote>
<p>The smallest eigenvalue is 3.44e-32. This might indicate that there are
strong multicollinearity problems or that the design matrix is singular.</p>
</blockquote>
<p>のように,多重共線性の存在を教えてくれます. (乱数を利用していることもあり)当然モデルの精度も非常に悪くなっているため, このモデルは利用できません.</p>
<p>一方で,</p>
<div class="note">
<p><span class="math display">
x_i \approx \sum_{i \neq j} \alpha_j x_j
</span></p>
<p>で成り立つ(完全ではない/弱い)<strong>多重共線性</strong>という概念もあります. これは簡単に言えば, 説明変数間に相関関係が成り立つような場合を指しています.</p>
<p>変数間に相関がある場合,</p>
<ul>
<li><p>サンプルサイズによって,推定値が大きく変わる</p></li>
<li><p>データによって推定値が大きく変わる</p></li>
</ul>
<p>など, 利用するデータに対して推定値が不安定になると言われています. これはサンプルサイズを増やすことで対処できますが,一般には変数間の相関が強い場合には, 片方の変数は説明変数から除外することが望ましいとされています.</p>
</div>
<p>それでは,先程の教育データの多重共線性をチェックしてみましょう.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 多重共線性のチェック</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 散布図行列を作成してみる</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>pd.plotting.scatter_matrix(df, range_padding<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">#ヒートマップで確認</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>sns.heatmap(df.corr()</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>            ,vmax<span class="op">=</span><span class="dv">1</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>            ,vmin<span class="op">=-</span><span class="dv">1</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>            ,annot<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="../images/regression12.png" alt="クロスプロット" />
<img src="../images/regression13.png" alt="相関係数のヒートマップ" /></p>
<p>相関係数を確認すると,<code>board</code>と<code>text</code>の間に<code>0.56</code>の相関があることが分かります.
<code>0.56</code>程度であればそれほど影響はないのでそのままにしても構いませんが,練習として片方を除外してみます. <code>text</code>のほうが<code>math</code>との相関が強いので,<code>board</code>を除外したいところですが,市議の主張では電子黒板の普及率が問題と成っていたので<code>text</code>を除外します.</p>
<h4 data-number="1.4.3" id="回帰分析の精度と判断"><span class="header-section-number">1.4.3</span> 回帰分析の精度と判断</h4>
<p>それでは, データの標準化,多重共線性を考慮して,実際に回帰分析を行ってみましょう.
<code>statsmodels</code>では, <code>sm.add_constant(説明変数)</code>の形で,定数を追加し,切片をモデルに追加することができます.</p>
<p><code>sm.OLS(Y,X)</code>で線形回帰モデルインスタンスを宣言し, <code>.fit()</code>で推定を行います.
推定結果は<code>.summary()</code>で確認できます.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#相関が見られるため,textを除外</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>X.drop(<span class="st">'text'</span>,axis<span class="op">=</span><span class="st">'columns'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">#予測モデルを作成(重回帰)</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(Y,X)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> model.fit()</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">#結果の表示</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result.summary())</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co">==============================================================================</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co">Dep. Variable:                   math   R-squared:                       0.004</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co">Model:                            OLS   Adj. R-squared:                 -0.042</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co">Method:                 Least Squares   F-statistic:                   0.07867</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co">Date:                Mon, 08 Jul 2024   Prob (F-statistic):              0.924</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co">Time:                        23:55:07   Log-Likelihood:                -66.101</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co">No. Observations:                  47   AIC:                             138.2</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co">Df Residuals:                      44   BIC:                             143.8</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="co">Df Model:                           2</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="co">Covariance Type:            nonrobust</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="co">==============================================================================</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="co">                 coef    std err          t      P&gt;|t|      [0.025      0.975]</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="co">------------------------------------------------------------------------------</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="co">const       3.995e-15      0.149   2.68e-14      1.000      -0.300       0.300</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="co">pc             0.0493      0.162      0.305      0.762      -0.276       0.375</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="co">board          0.0560      0.162      0.347      0.730      -0.270       0.382</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="co">==============================================================================</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a><span class="co">Omnibus:                       13.834   Durbin-Watson:                   1.557</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="co">Prob(Omnibus):                  0.001   Jarque-Bera (JB):               14.866</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a><span class="co">Skew:                           1.170   Prob(JB):                     0.000591</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a><span class="co">Kurtosis:                       4.454   Cond. No.                         1.46</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a><span class="co">==============================================================================</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>さて,推定結果には様々な情報が記述されていますが,どこをどのように見ればいいのでしょうか.</p>
<p><code>statsmodels</code>の<code>.summary()</code>では中央部分に各説明変数の評価が記載されています.</p>
<ul>
<li>各説明変数の評価</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">==============================================================================</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                 <span class="ex">coef</span>    std err          t      P<span class="op">&gt;|</span>t<span class="kw">|</span>      <span class="ex">[0.025</span>      0.975]</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="ex">------------------------------------------------------------------------------</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="ex">const</span>       3.995e-15      0.149   2.68e-14      1.000      <span class="at">-0.300</span>       0.300</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="ex">pc</span>             0.0493      0.162      0.305      0.762      <span class="at">-0.276</span>       0.375</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="ex">board</span>          0.0560      0.162      0.347      0.730      <span class="at">-0.270</span>       0.382</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="ex">==============================================================================</span></span></code></pre></div>
<p>それぞれいくつか重要なポイントを順に確認していきましょう.</p>
<div class="note">
<ul>
<li><h3 id="回帰係数coef"><strong>回帰係数(coef)</strong></h3></li>
</ul>
<p>回帰係数は,説明変数毎に目的変数にどの程度影響力があるかを示したものになります.</p>
</div>
<p>今回の事例では, 切片(<code>const</code>)が<code>3.995e-15</code>であり,<code>pc</code>,<code>text</code>が0のとき<code>math</code>が<code>3.995e-15</code>となります. <code>pc</code>の回帰係数が<code>0.0493</code>,<code>text</code>の回帰係数が<code>0.0560</code>であり,それぞれの説明変数が1変化する毎に,回帰係数の分だけ目的変数が変化します.</p>
<p>したがって,回帰式は,</p>
<p><span class="math display">
math = 3.995*10^{-15} + 0.0493 pc + 0.0560 text
</span></p>
<p>となり,いずれの変数も正の影響を持っており,市議の主張である電子黒板が普及するほどに成績が下がるという主張と逆の結果が出ています.値が標準化されているため,それぞれの回帰係数は相対的な影響力を表しており,実際の変化ではありません. <code>pc</code>の一人あたりの台数よりも,<code>text</code>の影響が強いことが分かります.</p>
<p>しかし,回帰係数だけを見て,回帰の結果を判断することはできません. 出てきた値が,信頼に値するか,利用可能であるかを他の値を用いて判断する必要があります.</p>
<div class="note">
<ul>
<li><h3 id="p値ptと95信頼区間0.025-0.975"><strong>P値(<code>P&gt;|t|</code>)と95%信頼区間(<code>[0.025 0.975]</code>)</strong></h3></li>
</ul>
<p>それぞれの説明変数のP値(<code>P&gt;|t|</code>)は,その説明変数に対する回帰係数が0である(影響がない)という仮説に対する仮説検定のP値を表しています. また, <code>[0.025      0.975]</code>はそれぞれ上側と下側の95%信頼区間を表しています.</p>
<p>有意水準5%の場合, <code>P値 &lt; 0.05</code>で有意となり, 信頼区間が0をまたぎません.
(ここで両側検定ですが,<code>P値 &lt; 0.025</code>とならないのは,両側の外側累積確率を合算した値が算出されるためです.)
したがって,これらの値はいずれも同じ判断の基準となりますが,最近は論文などには両方載せることが主流です.
(仮説検定や区間推定,P値の意味などに関しては,統計学入門で詳細を扱っています.分からない人はそちらを履修しましょう.)</p>
</div>
<p>今回の値を見てみると,いずれの説明変数も有意ではなく,区間推定の結果も0をまたいでいます. したがって,これらの回帰係数の推定値の解釈は, <strong>｢今回のデータと説明変数の組み合わせでは, 電子黒板や電子教科書が学業成績に影響を与えるかどうかは判断できない.｣</strong>ということになります.</p>
<div class="warn">
<p>有意でない説明変数は, 基本的にモデルから除外することが望ましいので,仮により良いモデルを構築する場合には,別の変数やモデルの組み合わせを探すことになります.</p>
<p>それらの手法は,モデル選択などと呼ばれますが,モデル同士の比較の方法に関してはここでは扱わず,後の一般化線形モデルの章で扱うことにします.</p>
</div>
<p>これまで各説明変数の影響を見てみましたが, 変数毎ではなく,モデル全体の評価はどのように行うのでしょうか.
<code>.summary()</code>の前半部分にはモデル全体での評価が記載されています.</p>
<ul>
<li>モデル全体の評価</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>                            <span class="ex">OLS</span> Regression Results</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="ex">==============================================================================</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Dep.</span> Variable:                   math   R-squared:                       0.004</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Model:</span>                            OLS   Adj. R-squared:                 <span class="at">-0.042</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Method:</span>                 Least Squares   F-statistic:                   0.07867</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Date:</span>                Mon, 08 Jul 2024   Prob <span class="er">(</span><span class="ex">F-statistic</span><span class="kw">)</span><span class="bu">:</span>              0.924</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Time:</span>                        23:55:07   Log-Likelihood:                <span class="at">-66.101</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="ex">No.</span> Observations:                  47   AIC:                             138.2</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Df</span> Residuals:                      44   BIC:                             143.8</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Df</span> Model:                           2</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Covariance</span> Type:            nonrobust</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="ex">==============================================================================</span></span></code></pre></div>
<div class="note">
<ul>
<li><h3 id="調整済決定係数adj.-r-squared-1"><strong>調整済決定係数(Adj. R-squared)</strong></h3></li>
</ul>
<p>自由度調整済み決定係数<span class="math inline">Adj R^2</span>は,<strong>モデルがどの程度当てはまっているかの基準</strong>です.
基本的に<span class="math inline">0 \leq Adj R^2 \leq 1</span>の値をとり,目安として<span class="math inline">0.5 \leq Adj 𝑅^2</span>であればある程度予測できていると考えられます.</p>
<p>どんな散布図になっても回帰式自体は作成可能ですが,以下の左右どちらの予測値の方が信頼できそうでしょうか.</p>
<figure>
<img src="../images/regression14.png" alt="R2" />
<figcaption aria-hidden="true">R2</figcaption>
</figure>
<p>直感的には左の方が<strong>回帰直線が実際の値にフィットしており</strong>信頼できそうな気がしますね. <span class="math inline">R^2</span>はその感覚を数値化したものになります.</p>
<figure>
<img src="../images/regression15.png" alt="R2" />
<figcaption aria-hidden="true">R2</figcaption>
</figure>
<p><span class="math inline">R^2</span>は,式から作られた直線と,実際のデータの点の距離の和であり,<span class="math inline">Adj R^2</span>は,0から1に収まるように変換してものになります.
<span class="math inline">AdjR^2</span>が1に近いほど, 式が点によく当てはまっていることを表します.</p>
</div>
<p>今回のモデルを見てみると,<code>Adj. R-squared:-0.042</code>であり,全く予測精度が高くないことが分かります.</p>
<div class="note">
<ul>
<li><h3 id="有意f-prob-f-statistic-1"><strong>有意F (Prob (F-statistic))</strong></h3></li>
</ul>
<p>検定にはそれぞれの係数ごとにt検定,全体にF検定を用います.
有意F(Prob (F-statistic))は,モデル全体にF検定を実施した際のp値を表し,値が小さいほど回帰式が有意であることを表します(0.05 &gt; F で有意).
(検定に関しては,検定の章を参照してください.)</p>
<p>以下の回帰式とデータを見るとどちらも,当てはまり方は同じだとしても, 左の方が信頼性が高いように感じます.</p>
<figure>
<img src="../images/regression16.png" alt="Prob F" />
<figcaption aria-hidden="true">Prob F</figcaption>
</figure>
<p>点が少ないと,他のデータを持ってきたら全然違うところに点が行く可能性が高まります.
この感覚=式が偶然の産物ではないかを検定したP値が有意Fです.
0.05 以下で, 信頼できるといえます.</p>
</div>
<p>今回のモデルを見てみると<code>Prob (F-statistic):0.924</code>であり,回帰式全体は有意ではなく,このモデルは信頼できないことが分かります.</p>
<h4 data-number="1.4.4" id="結果の図示"><span class="header-section-number">1.4.4</span> 結果の図示</h4>
<p>これまでは数値によって,モデルの結果を確認してきましたが,結果を図示することでより直感的に説明が可能になります. 回帰分析の結果を図示する方法は様々ありますが,ここでは結果の散布図と,密度プロットによって確認してみましょう.</p>
<p>各説明変数が,どの程度目的変数を説明しているかを確認する方法として,グラフに<code>Partial Regression Plot</code>や<code>Added-Variable Plot(AV Plot)</code>と呼ばれるグラフがあります.</p>
<ul>
<li><p>縦軸に<span class="math inline">X_i</span>以外の変数でYを回帰した際の残差(他の変数の影響を取り除いたYの変動)</p></li>
<li><p>横軸に<span class="math inline">X_i</span>以外の変数で<span class="math inline">X_i</span>を回帰した際の残差(他の変数の影響を取り除いた𝑋_𝑖の変動)</p></li>
</ul>
<p>がプロットされています.</p>
<p>このグラフでは他の変数の影響を取り除いた上でのYと<span class="math inline">X_i</span>の関係を可視化する手法であり,回帰直線の傾きが大きいほど他の変数の影響を取り除いた上での<span class="math inline">X_i</span>のYへの影響力が強いことが分かります.</p>
<p><code>statsmodels</code>では,そのための<code>plot_partregress_grid</code>というメソッドが準備されています.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#回帰グラフの作成</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.regressionplots <span class="im">import</span> plot_partregress_grid</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>,<span class="dv">8</span>))</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>plot_partregress_grid(result, fig<span class="op">=</span>fig)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="../images/regression17.png" alt="3変数 Partial Plot" />
<figcaption aria-hidden="true">3変数 Partial Plot</figcaption>
</figure>
<p>どの変数にもあまり説明力がない様子が視覚的に把握できます.</p>
<p>また,モデルによって予測される値と実際の値のヒストグラムや密度プロットを比較することも良く行われます.
ここでは<code>seaborn</code>の<code>kdeplot</code>を利用してカーネル密度プロットを行ってみます.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#予測結果の作成</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> result.predict(X)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>,<span class="dv">8</span>))</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(pred, label <span class="op">=</span> <span class="st">'Predicted'</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(Y, label <span class="op">=</span> <span class="st">'Actual'</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Actual/Predicted'</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'math'</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Density'</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="../images/regression18.png" alt="3変数 Density Plot" />
<figcaption aria-hidden="true">3変数 Density Plot</figcaption>
</figure>
<p>実測値と予測値が全く違う分布をしており,予測がうまく行っていないことが視覚的に把握できます.</p>
<p>結論として, 今回のモデルでは市議の主張に対しては,否定も肯定もできないが,市議の根拠とするデータでは,市議の主張が導かれないということになりました.</p>
<p>実際に,どのような影響があるかを調べるためには,データかモデルのいずれかを変えて,説明可能なモデルを構築する必要があります.</p>
<div class="note">
<ul>
<li>演習問題</li>
</ul>
<p>数学の成績と関連のありそうなデータをe-statから複数探し,重回帰分析を行い,その結果を解釈してください.</p>
</div>


<!-- 前後の章へのナビゲーション -->
<div class="chapter-navigation">
    <nav>
        
            <a class="nav-link prev" href="slds10.html">← Previous Chapter</a>
        
        
            <a class="nav-link next" href="slds12.html">Next Chapter →</a>
        
    </nav>
</div>

    <div style="clear: both"></div>

    <div id="footer">
        Site proudly generated by
        <a href="http://jaspervdj.be/hakyll">Hakyll</a>.
    </div>
</div>


    <!-- GUID -->
    <div style="display: none">ce0f13b2-4a83-4c1c-b2b9-b6d18f4ee6d2</div>




    <!-- JavaScript TOC generator (only runs on lecture pages) -->
    <script>
    document.addEventListener("DOMContentLoaded", function() {
      var tocContainer = document.getElementById('lecture-toc');
      if (!tocContainer) return;

      // メインコンテンツから h2, h3, h4 を抽出
      var content = document.querySelector('article') || document.getElementById('content') || document.body;
      var headings = content.querySelectorAll('h2, h3, h4');
      if (headings.length === 0) return;

      // 目次用のUL要素を作成
      var tocList = document.createElement('ul');

      // 章番号カウンタ (h2, h3, h4に対応して配列を用意)
      var chapterNumbers = [0, 0, 0];

      headings.forEach(function(heading) {
        if (heading.closest('li')) return;

        var level;
        switch (heading.tagName.toLowerCase()) {
          case 'h2': level = 0; break;
          case 'h3': level = 1; break;
          case 'h4': level = 2; break;
          default: return;
        }

        chapterNumbers[level]++;
        for (var i = level + 1; i < chapterNumbers.length; i++) {
          chapterNumbers[i] = 0;
        }


        var li = document.createElement('li');
        li.classList.add('toc-level-' + (level + 1));

        var anchor = document.createElement('a');
        anchor.href = '#' + heading.id;
        anchor.textContent =  heading.textContent;

        li.appendChild(anchor);
        tocList.appendChild(li);
      });

      tocContainer.appendChild(tocList);
    });
    </script>
     <script>
  document.addEventListener("DOMContentLoaded", function() {
    // すべての <pre><code> 要素を走査
    const codeBlocks = document.querySelectorAll('pre code');
    codeBlocks.forEach(function(codeBlock) {
      // 親<pre>要素を取得
      const pre = codeBlock.parentNode;

      // <pre> を相対配置にし、子要素を絶対配置できるようにする
      pre.style.position = 'relative';

      // コピーボタンを作成
      const copyButton = document.createElement('button');
      copyButton.textContent = 'Copy';
      // ボタンのデザインはCSSで指定するのが望ましいが、簡易的にスタイルを直接指定する例:
      copyButton.style.position = 'absolute';
      copyButton.style.top = '8px';
      copyButton.style.right = '8px';
      copyButton.style.backgroundColor = '#add8e6'; // 水色
      copyButton.style.color = '#fff';             // 白文字
      copyButton.style.border = 'none';
      copyButton.style.padding = '6px 10px';
      copyButton.style.borderRadius = '4px';
      copyButton.style.cursor = 'pointer';

      // クリックされたらクリップボードにコピー
      copyButton.addEventListener('click', function() {
        const codeText = codeBlock.innerText;
        navigator.clipboard.writeText(codeText).then(function() {
          copyButton.textContent = 'Copied!';
          setTimeout(function() {
            copyButton.textContent = 'Copy';
          }, 2000);
        }, function(err) {
          console.error('Failed to copy: ', err);
        });
      });

      // ボタンを <pre> の子要素として挿入
      pre.appendChild(copyButton);
    });
  });
  </script>
  <script>
    function toggleMenu() {
      var nav = document.getElementById('navigation');
      nav.classList.toggle('open');
    }
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      var mathElements = document.querySelectorAll('.math');
      for (var i = 0; i < mathElements.length; i++) {
        var texText = mathElements[i].firstChild
        if (mathElements[i].tagName == "SPAN") {
            katex.render( texText.data
                        , mathElements[i]
                        , { displayMode: mathElements[i].classList.contains("display")
                          , throwOnError: true
                         }
                        );
          }
      }
    });
  </script>

  </body>
</html>