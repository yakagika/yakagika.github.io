<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>yakagika - 特別講義DS Ch11 線形回帰分析</title>

    <!-- Stylesheets. -->
    <link rel="stylesheet" type="text/css" href="../style.css?v=0">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&display=swap" rel="stylesheet">
    <!-- RSS. -->
    <link rel="alternate" type="application/rss+xml" title="yakagika" href="https://yakagika.github.io/rss.xml">

    <!-- Metadata. -->

    <meta name="keywords" content="yakagika Haskell ExchangeAlgebra">
    <meta name="description" content="Personal home page and blog of yakagika.">

    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css" integrity="sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js" integrity="sha384-X/XCfMm41VSsqRNQgDerQczD69XqmjOOOwYQvr/uuC+j4OPoNhVgjdGFwhvN02Ja" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
    

    
      <meta property="og:description" content="資料" />
    
  </head>

  <body>

    <!-- ハンバーガーメニューのボタン（小画面時に表示） -->
     <!-- ヘッダーを上部に固定し、その中にハンバーガーを配置 -->
    <header class="site-header">
      <div class="site-title">
        <a href="../">
          <img src="../favicon.ico" alt="Home" style="width: 32px; height: 32px;">
        </a>
      </div>
      <div class="hamburger" onclick="toggleMenu()">☰</div>
    </header>

    <!-- ナビゲーションに drawer-menu クラスを付与 -->
    <div id="navigation" class="drawer-menu">
      <h1>Contents</h1>
      <a href="../">Home</a>
      <a href="../posts.html">Blog</a>
      <a href="../lectures.html">Lecture</a>
      <a href="../research.html">Research</a>
      <a href="../contact.html">Contact</a>
      <!-- <a href="/cv.html">CV</a> -->

      <h1>Links</h1>
      <a href="http://github.com/yakagika" target="_blank" rel="noopener">GitHub</a>
      <a href="https://researchmap.jp/k-akagi" target="_blank" rel="noopener">researchmap</a>

      
      <div id="lecture-toc">
        <h1>Index</h1>
        <!-- The TOC will be generated here by JavaScript -->
      </div>
      
      
    </div>

    <div id="content">
    <h1>特別講義DS Ch11 線形回帰分析</h1>
<div class="soft">
    資料<br />
    Published on 2024-03-29 under the tag <a title="All pages tagged 'datascience'." href="../tags/datascience.html">datascience</a>, <a title="All pages tagged 'statistics'." href="../tags/statistics.html">statistics</a>, <a title="All pages tagged 'python'." href="../tags/python.html">python</a>
</div>

<!-- 前後の章へのナビゲーション -->
<div class="chapter-navigation">
    <nav>
        
            <a class="nav-link prev" href="slds10.html">← Previous Chapter</a>
        
        
            <a class="nav-link next" href="slds12.html">Next Chapter →</a>
        
    </nav>
</div>

<br>

<div class="toc"><div class="header">Table of Contents</div>
<ul>
<li><a href="#線形回帰分析" id="toc-線形回帰分析"><span class="toc-section-number">1</span> 線形回帰分析</a>
<ul>
<li><a href="#発展-回帰分析は何を行っているのか" id="toc-発展-回帰分析は何を行っているのか"><span class="toc-section-number">1.1</span> 発展: 回帰分析は何を行っているのか</a>
<ul>
<li><a href="#母回帰方程式" id="toc-母回帰方程式"><span class="toc-section-number">1.1.1</span> 母回帰方程式</a></li>
<li><a href="#誤差項撹乱項" id="toc-誤差項撹乱項"><span class="toc-section-number">1.1.2</span> 誤差項,撹乱項</a></li>
<li><a href="#最小二乗法" id="toc-最小二乗法"><span class="toc-section-number">1.1.3</span> 最小二乗法</a></li>
<li><a href="#回帰係数の検定" id="toc-回帰係数の検定"><span class="toc-section-number">1.1.4</span> 回帰係数の検定</a></li>
</ul></li>
<li><a href="#単回帰分析" id="toc-単回帰分析"><span class="toc-section-number">1.2</span> 単回帰分析</a>
<ul>
<li><a href="#データの準備" id="toc-データの準備"><span class="toc-section-number">1.2.1</span> データの準備</a></li>
<li><a href="#散布図の作成" id="toc-散布図の作成"><span class="toc-section-number">1.2.2</span> 散布図の作成</a></li>
<li><a href="#単回帰" id="toc-単回帰"><span class="toc-section-number">1.2.3</span> 単回帰</a></li>
<li><a href="#回帰係数p値区間推定値" id="toc-回帰係数p値区間推定値"><span class="toc-section-number">1.2.4</span> 回帰係数(P値,区間推定値)</a></li>
<li><a href="#式全体の評価指標r2f" id="toc-式全体の評価指標r2f"><span class="toc-section-number">1.2.5</span> 式全体の評価指標(<span class="math inline">R^2</span>,F)</a></li>
<li><a href="#結果の可視化" id="toc-結果の可視化"><span class="toc-section-number">1.2.6</span> 結果の可視化</a></li>
</ul></li>
<li><a href="#重回帰分析" id="toc-重回帰分析"><span class="toc-section-number">1.3</span> 重回帰分析</a>
<ul>
<li><a href="#データ準備" id="toc-データ準備"><span class="toc-section-number">1.3.1</span> データ準備</a></li>
<li><a href="#可視化散布図行列" id="toc-可視化散布図行列"><span class="toc-section-number">1.3.2</span> 可視化(散布図行列)</a></li>
<li><a href="#可視化ヒートマップ" id="toc-可視化ヒートマップ"><span class="toc-section-number">1.3.3</span> 可視化(ヒートマップ)</a></li>
<li><a href="#多重共線性完全な多重共線性" id="toc-多重共線性完全な多重共線性"><span class="toc-section-number">1.3.4</span> 多重共線性(完全な多重共線性)</a></li>
<li><a href="#多重共線性弱い多重共線性" id="toc-多重共線性弱い多重共線性"><span class="toc-section-number">1.3.5</span> 多重共線性(弱い多重共線性)</a></li>
<li><a href="#可視化層別とペアプロット" id="toc-可視化層別とペアプロット"><span class="toc-section-number">1.3.6</span> 可視化(層別とペアプロット)</a></li>
<li><a href="#可視化層別とジョイントプロット" id="toc-可視化層別とジョイントプロット"><span class="toc-section-number">1.3.7</span> 可視化(層別とジョイントプロット)</a></li>
<li><a href="#ダミー変数化数量化1類" id="toc-ダミー変数化数量化1類"><span class="toc-section-number">1.3.8</span> ダミー変数化(数量化1類)</a></li>
<li><a href="#正規化標準化" id="toc-正規化標準化"><span class="toc-section-number">1.3.9</span> 正規化・標準化</a></li>
<li><a href="#モデル選択" id="toc-モデル選択"><span class="toc-section-number">1.3.10</span> モデル選択</a></li>
<li><a href="#aicについて" id="toc-aicについて"><span class="toc-section-number">1.3.11</span> AICについて</a></li>
<li><a href="#結果の可視化-1" id="toc-結果の可視化-1"><span class="toc-section-number">1.3.12</span> 結果の可視化</a></li>
</ul></li>
</ul></li>
</ul>
</div>
<h2 data-number="1" id="線形回帰分析"><span class="header-section-number">1</span> 線形回帰分析</h2>
<p>相関分析では,ある変数間に関係があることを示すことができました. しかし,相関分析で示せるのは,変数Aによって変数Bが増加するか,減少するかということのみです. 具体的に,どの程度変数Aが動くことで,変数Bがどの程度変動するかを式によって<strong>説明する</strong>手法に<strong>回帰分析(Regression Analysis)</strong>があります.</p>
<p>また,回帰分析は求められた式がどの程度信頼できるのかを検定によって確かめることも可能です.</p>
<div class="note">
<p>回帰分析では,データ</p>
<p><span class="math display">
y = \beta_0 + \beta_1 x
</span></p>
<p>のような式で変数yとxの関係を説明し,この式を<strong>回帰式,回帰方程式</strong>と呼びます. このとき,</p>
<ul>
<li><p>説明される変数yを <strong>被説明変数</strong>,<strong>目的変数</strong>などと呼びます.</p></li>
<li><p>説明する変数xを<strong>説明変数</strong>,<strong>従属変数</strong>などと呼びます.</p></li>
<li><p>回帰式における <strong><span class="math inline">\beta_0</span></strong>のような変数に乗じられていない値を<strong>切片</strong>といいます.</p>
<p>切片は, <span class="math inline">x = 0</span> のときのyの値を意味しています.</p></li>
<li><p>変数に乗じられている<strong><span class="math inline">\beta_1</span></strong>のような値を<strong>傾き</strong>といい,<span class="math inline">\beta_0,\beta_1</span> などを併せて<strong>回帰係数</strong>といいます.</p>
<p>傾きは,xが1変化した際のyの変化量を表しています.</p></li>
</ul>
<p><img src="../images/ch11-regression-image.png" /></p>
<ul>
<li><p>説明変数が一つの回帰式を求める分析を<strong>単回帰分析</strong>, 2つ以上の説明変数を用いる場合を<strong>重回帰分析</strong>といいます.</p></li>
<li><p>yがxの線形関数である場合を <strong>線形回帰(Linear regression)</strong>,それ以外のものを<strong>非線形回帰(non-linear regression)</strong>といいます.</p></li>
</ul>
<p><img src="../images/ch11-regression-image2.png" /></p>
</div>
<h3 data-number="1.1" id="発展-回帰分析は何を行っているのか"><span class="header-section-number">1.1</span> 発展: 回帰分析は何を行っているのか</h3>
<p>回帰分析が何を行っているのかについて,単回帰で行っている最小二乗法を事例に確認していきましょう.
重回帰に関しては, 線形計画問題など異なる学習が必要になるので,今回は扱いません. あくまで,回帰というものがどのような意味であるかに関して簡単に説明します.</p>
<p>なお,こちらの詳細は統計学に関する別講義で扱っていますので, この講義ではあまり深く扱いません. 興味のある方は統計学の講義を受講して下さい.</p>
<h4 data-number="1.1.1" id="母回帰方程式"><span class="header-section-number">1.1.1</span> 母回帰方程式</h4>
<p>体重<span class="math inline">y</span>を慎重<span class="math inline">x</span>によって説明する回帰方程式として, <span class="math inline">y = \beta_0 + \beta_1 x</span> を考えてみます.
しかし, 実際の体重は身長以外の要素によってばらつきます. そのような<strong>ばらつき</strong>を考慮して,データの<span class="math inline">i</span>人目の体重,身長をそれぞれ,<span class="math inline">Y_i,X_i</span>として,身長以外の要素によるばらつきを<span class="math inline">\epsilon_i</span>とすると,母集団において,以下のような式が立てられます.</p>
<p><span class="math display">
Y_i = \beta_0 + \beta_1 X_i + \epsilon_i ~(i=1,2,...,n)
</span></p>
<p>これを<strong>母回帰方程式(Population Regression Equation)</strong>と呼びます.
また, <span class="math inline">\beta_0, \beta_1</span>を<strong>母(偏)回帰係数</strong>といい,これを<strong>推定,検定すること</strong>を回帰分析といいます.</p>
<h4 data-number="1.1.2" id="誤差項撹乱項"><span class="header-section-number">1.1.2</span> 誤差項,撹乱項</h4>
<p>母回帰方程式</p>
<p><span class="math display">
Y_i = \beta_0 + \beta_1 X_i + \epsilon_i ~(i=1,2,...,n)
</span></p>
<p>における <span class="math inline">\epsilon_i</span>は<span class="math inline">X_i</span>で説明できない誤差を表す確率変数であり,<strong>誤差項</strong>,<strong>撹乱項</strong>といいます.</p>
<p><img src="../images/ch11-regression-images3.png" /></p>
<p>回帰分析において,誤差項は以下の仮定をおいています.</p>
<div class="note">
<ul>
<li>期待値0: <span class="math inline">E(\epsilon_i) = 0 ~ (i=1,2,...,n)</span></li>
<li>分散一定: <span class="math inline">V(\epsilon_i) = \sigma^2 ~ (i=1,2,...,n)</span></li>
<li>無相関: <span class="math inline">i \neq j \Rightarrow Cov(\epsilon_i, \epsilon_j) = 0</span></li>
<li>正規分布: <span class="math inline">\epsilon_i \sim N(0,\sigma^2)</span></li>
</ul>
</div>
<p>これによって,</p>
<p><span class="math display">
E(Y_i) = \beta_1 + \beta_2 X_i
</span></p>
<p>が得られます.</p>
<h4 data-number="1.1.3" id="最小二乗法"><span class="header-section-number">1.1.3</span> 最小二乗法</h4>
<p>母回帰方程式</p>
<p><span class="math display">
Y_i = \beta_0 + \beta_1 X_i + \epsilon_i ~(i=1,2,...,n)
</span>
における母回帰係数<span class="math inline">\beta_0, \beta_1</span>は観測できないので,<strong>誤差項を最小化する母回帰係数</strong>を統計的推測することで求めます.</p>
<p>この誤差項を最小化する母回帰係数の推定方法を<strong>最小二乗法(least squares method)</strong>といいます.</p>
<p>母回帰方程式を変形して,</p>
<p><span class="math display">
\epsilon_i = Y_i - (\beta_0 + \beta_1 X_i)
</span></p>
<p>が少ないほど, <span class="math inline">X_i</span>による<span class="math inline">Y_i</span>の説明力が上がります(モデルによってよく関係が説明できている.)</p>
<p>なので,モデル全体で,<span class="math inline">\epsilon_i</span>を最小化することを考えてみます.</p>
<figure>
<img src="../images/least-squares-method1.png" alt="least squares method" />
<figcaption aria-hidden="true">least squares method</figcaption>
</figure>
<p>誤差の正負を打ち消すために,モデル全体の誤差項の二乗の和</p>
<p><span class="math display">
\begin{align*}
S &amp; = \sum_{i=1} \epsilon_{1}^{2} \\
&amp;= \sum_{i=1} \{Y_i - (\beta_0 + \beta_1 X_i)\}^2
\end{align*}
</span></p>
<p>Sを最小化する<strong>(最小二乗)推定量</strong> <span class="math inline">\hat{\beta_0},\hat{\beta_1}</span> を求める問題として整理できます.</p>
<p><span class="math inline">S</span>の偏微分を0とおいて,</p>
<p><span class="math display">
\frac{\partial S}{ \partial \beta_0} = -2 \sum (Y_i = \beta_0 - \beta_1 X_i) = 0 \\
\frac{\partial S}{ \partial \beta_1} = -2 \sum (Y_i = \beta_0 - \beta_1 X_i)X_i = 0 \\
</span></p>
<p>これを解いて,</p>
<p><span class="math display">
\hat{\beta_0} = \bar{Y} - \hat{\beta_1}\bar{X} \\
\hat{\beta_1} = \frac{\sum(X_i - \bar{X})(Y_i - \bar(Y))}{\sum(X_i - \bar{X})^2}
</span>
が得られます.</p>
<h4 data-number="1.1.4" id="回帰係数の検定"><span class="header-section-number">1.1.4</span> 回帰係数の検定</h4>
<p>最小二乗推定量によって得られた方程式</p>
<p><span class="math display">
Y = \hat{\beta_0} + \hat{\beta_1}X
</span></p>
<p>を<strong>標本回帰方程式</strong>といいます.</p>
<p>求めた標本回帰方程式が,XとYの関係を説明できているのかを考えます. XがYを全く説明できていない場合, <span class="math inline">\epsilon_i</span> だけで説明ができるため, <span class="math inline">\beta_1 \neq 0</span> と言えれば,統計的にXがYを説明できていると言えます.</p>
<p>そこで, 帰無仮説 <span class="math inline">H_0:\beta_1 = 0</span> として,偏回帰係数に関する統計的仮説検定を実施します.</p>
<p>母数 <span class="math inline">\beta_1</span> に関する仮説検定を行うために, <span class="math inline">\beta_1</span> の確率分布を考えます.</p>
<p>誤差項 <span class="math inline">\epsilon_i \sim N(o,\sigma^2)</span> として,</p>
<p><span class="math display">
\hat{\beta_0} = \bar{Y} - \hat{\beta_1}\bar{X} \\
\hat{\beta_1} = \frac{\sum(X_i - \bar{X})(Y_i - \bar(Y))}{\sum(X_i - \bar{X})^2}
</span>
であるから,</p>
<p><span class="math display">
V(\hat{\beta_0}) = \frac{\sigma^2 \sum X_i^2}{n\sum(X_i - \bar{X})^2} \\
E(\hat{\beta_0}) = \beta_0 \\
V(\hat{\beta_2}) = \frac{\sigma^2 }{\sum(X_i - \bar{X})^2} \\
E(\hat{\beta_1}) = \beta_1
</span>
なので,</p>
<p><span class="math display">
\hat{\beta_1} \sim N(\beta_1,\frac{\sigma^2}{\sum(X_i - \bar{X})^2})
</span></p>
<p>となる.</p>
<p>誤差項の母標準偏差 <span class="math inline">\sigma</span> が含まれるので,推定する.</p>
<p>標本回帰方程式 <span class="math inline">Y=\hat{\beta_0}+\hat{\beta_1}X</span> によって求められる各 <span class="math inline">i</span> の値(回帰値)</p>
<p><span class="math display">
\hat{Y_i} = \hat{\beta_0} + \hat{\beta_1}X_i
</span></p>
<p>と実際に観測された実測値 <span class="math inline">Y_i</span>との差を</p>
<p><span class="math display">
\hat{e_i} = Y_i - \hat{Y_i} = Y_i - \hat{\beta_0} - \hat{\beta_1}X_i
</span></p>
<p>を<strong>回帰残渣(residual)</strong>といい,Xで説明されなかった残渣を表す.</p>
<p>回帰残渣を母回帰方程式 <span class="math inline">Y_i = \beta_0 + \beta_1 X_i + \epsilon_i</span> における誤差項 <span class="math inline">\epsilon_i</span> の推定値として利用する.</p>
<p>求める必要があるのは,誤差項の分散の推定値としての分散</p>
<p><span class="math display">
V(\hat{e_i}) = E(\hat{e_i^2}) - (E(\hat{e_i}))^2
</span></p>
<p>であるが,</p>
<p><span class="math display">
\frac{\partial S}{\partial \beta_1} = -2 \sum (Y_i - \beta_0 - \beta_1 X_i)X_i = 0
</span>
なので,</p>
<p><span class="math display">
\sum (Y_i - \beta_0 - \beta_1 X_i) = \sum \hat{e_i} = 0
</span></p>
<p>となり,</p>
<p><span class="math display">
\bar{e_i} = \frac{1}{n} \sum \hat{e_i} = 0
</span></p>
<p>なので,</p>
<p><span class="math display">
\begin{align*}
V(\hat{e_i}) &amp;= E(\hat{eI^2}) \\
&amp;= \frac{1}{n-2}\sum (\hat{e_i}^2 - \bar{e_i}^2) \\
&amp;= \frac{\sum \hat{e_i}^2}{n-2}
\end{align*}
</span></p>
<p>となります.</p>
<p>これを誤差項の分散<span class="math inline">\sigma^2</span>の推定値</p>
<p><span class="math display">
S^2 = \frac{\sum \hat{e_i}^2}{n-2}
</span>
として利用します.</p>
<p>なお,この累乗根は回帰式がどの程度実測値に当てはまっているかを表す,<strong>推定値の標準誤差(standard error of estimates)</strong>と呼ばれます.</p>
<p><span class="math display">
s.e. = \sqrt{S^2} = \sqrt{\frac{\sum \hat{e_i}^2}{n-2}}
</span></p>
<p>これを誤差項の母標準偏差<span class="math inline">\sigma</span>の推定値として利用して,<span class="math inline">\hat{\beta_2}</span>の標準誤差の推定値は,</p>
<p><span class="math display">
V(\hat{\beta_1}) = \frac{\sigma^2 }{\sum(X_i - \bar{X})^2}
</span></p>
<p>から,</p>
<p><span class="math display">
s.e.(\hat{\beta_1}) = \frac{s.e.}{\sqrt{\sum(X_i - \bar{X})^2}}
</span></p>
<p>となり,<span class="math inline">s.e.(\hat{\beta_2})</span>を用いて標準化した値は, <span class="math inline">t(n-2)</span>に従うので,</p>
<p><span class="math display">
t_2 = \frac{\hat{\beta_1} - \beta_1}{s.e.(\hat{\beta_1})} \sim t(n-2)
</span></p>
<p>あとは得られた推定量を用いて,帰無仮説に関するt検定を実施する.</p>
<h3 data-number="1.2" id="単回帰分析"><span class="header-section-number">1.2</span> 単回帰分析</h3>
<p>それでは,実際に単回帰分析を実施してみる. 事例として,以下の分析にどのような問題点があるのかを考えてみよう.</p>
<blockquote class="twitter-tweet">
<p lang="ja" dir="ltr">
今回に限らず毎度毎度のことだけど、日本「経済」新聞を名乗りながら、お粗末な統計リテラシーだからな。。。<br>日経に限らず、本邦の大手紙は例外なく全てお粗末な統計リテラシー。<br>統計の基礎を勉強したい人はツッコミを入れると良いよ。ツッコミを入れるところだらけで勉強になるから。<a href="https://twitter.com/IsayaShimizu?ref_src=twsrc%5Etfw"><span class="citation" data-cites="IsayaShimizu">@IsayaShimizu</span></a> <a href="https://t.co/cxMAFDPRfM">https://t.co/cxMAFDPRfM</a>
</p>
— 糸石 浩司 (<span class="citation" data-cites="itoishi">@itoishi</span>) <a href="https://twitter.com/itoishi/status/1445026338885103618?ref_src=twsrc%5Etfw">October 4, 2021</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<blockquote class="twitter-tweet">
<p lang="ja" dir="ltr">
相関があることを言いたいなら散布図を描くべきでは？ あと，この16カ国はどうやって選んだのか？ <a href="https://t.co/ncWWtQ8A8L">https://t.co/ncWWtQ8A8L</a>
</p>
— Haruhiko Okumura (<span class="citation" data-cites="h_okumura">@h_okumura</span>) <a href="https://twitter.com/h_okumura/status/1444983348862996485?ref_src=twsrc%5Etfw">October 4, 2021</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>これらのPOSTは何を懸念しているのでしょうか.</p>
<p>元POSTでは, 日本経済新聞が<a href="https://www.oecd.org/en/data/datasets/oecd-family-database.html">OECD Family Database</a>のデータから作成したグラフを用いて男性の育児・家事時間の少なさが日本の少子化の原因であると主張しています.</p>
<figure>
<img src="../images/ch11-oecd-nikkei.png" alt="出典：日本経済新聞,「男性の育児・家事時間、出生率に影響　日本は女性の二割" />
<figcaption aria-hidden="true"><a href="https://www.nikkei.com/article/DGXZQOFE308UG0Q1A830C2000000/">出典：日本経済新聞,「男性の育児・家事時間、出生率に影響　日本は女性の二割</a></figcaption>
</figure>
<div class="note">
<p>この分析の問題点は主に以下の2つです.</p>
<ol type="1">
<li><p>元のPOSTの通り,この記事ではグラフを主張の根拠としていますが,棒グラフと散布図を組み合わせたような独自のグラフを作成しており,これを持って何が主張できるのかが明確ではありません. 2つの量的データの関係性を示す場合は散布図が適当です.</p></li>
<li><p>また,グラフが適当であったとしても,グラフはデータの概観の把握にや役立ちますが,グラフのみから明確な主張が主張できるわけではない場合が多いです.</p></li>
</ol>
</div>
<p>まずは,グラフに関して考えてみましょう. 実は,内閣府もこのデータを利用して同様の主張をしています. 内閣府のグラフでは,独自のグラフではなく,散布図が作成されています.</p>
<figure>
<img src="../images/ch11-oecd-cabinet.png" alt="出典：内閣府　政策統括官（経済社会システム担当）第４回会議資料　選択する未来2.0, 資料２　参考資料②(事務局資料)" />
<figcaption aria-hidden="true"><a href="https://www5.cao.go.jp/keizai2/keizai-syakai/future2/20200409/shiryou2.pdf">出典：内閣府　政策統括官（経済社会システム担当）第４回会議資料　選択する未来2.0, 資料２　参考資料②(事務局資料)</a></figcaption>
</figure>
<p>内閣府の資料でも,同じデータを利用して,同じ主張をしています. しかし,こちらの資料では独自のグラフではなく,散布図を作成しており,追加的に回帰式(<span class="math inline">y=0.0132x + 1.2027</span>)及びR2も求めています.</p>
<div class="note">
<p>しかし,先程説明した通り,<strong>回帰分析</strong>とは回帰式に関する検定であり,回帰式のみをもって,y(合計特殊出生率)にx(育児・家事労働時間割合)が影響を及ぼしているとは<strong>言えません</strong>.</p>
</div>
<p>では,実際に回帰分析を実施してみるとどのような結果になるでしょうか?</p>
<h4 data-number="1.2.1" id="データの準備"><span class="header-section-number">1.2.1</span> データの準備</h4>
<p>まずはデータを準備する必要があります. <a href="https://www.oecd.org/en/data/datasets/oecd-family-database.html">OECD Family Database</a>から,<code>SF2.1 Fertility rates</code>及び<code>LMF2.5 Time used for work, care and daily household chores</code>のExcelファイルをダウンロードしました.
それぞれから<a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/fertility_rates.csv"><code>fertility_rates.csv</code></a>及び,<a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/time_used.csv"><code>time_used.csv</code></a>を作成しました.以下これらのデータをダウンロードして,作業を進めてください.</p>
<div class="warn">
<p>可能であれば,練習として以下のコードは見ないで,元の内閣府の資料から何をする必要があるのか,自分でどのように計算するかを考えて実行してみましょう.</p>
</div>
<p>まずはデータをそれぞれ読み込んでみましょう.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>df_f <span class="op">=</span> pd.read_csv(<span class="st">'fertility_rates.csv'</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>df_t <span class="op">=</span> pd.read_csv(<span class="st">'time_used.csv'</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_f)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_t)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">            Country  Fertility</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">0             Korea       0.92</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">1             Spain       1.23</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">2             Italy       1.27</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">3             Japan       1.36</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">4            Poland       1.42</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co">5          Portugal       1.43</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">6         Lithuania       1.61</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">7        Luxembourg       1.34</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co">8            Canada       1.47</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co">9            Greece       1.34</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co">10          Finland       1.35</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co">11          Austria       1.46</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co">12      Switzerland       1.48</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co">13   United Kingdom       1.63</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co">14       Costa Rica       1.63</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co">15            Chile       1.55</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co">16           Norway       1.53</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co">17           Latvia       1.61</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co">18          Germany       1.54</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co">19     OECD average       1.60</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co">20          Hungary       1.49</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co">21          Belgium       1.60</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co">22          Estonia       1.66</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co">23      Netherlands       1.57</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co">24  Slovak Republic       1.57</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co">25      New Zealand       1.72</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="co">26         Slovenia       1.61</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co">27    United States       1.71</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="co">28           Sweden       1.70</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="co">29        Australia       1.67</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="co">30          Türkiye       1.88</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="co">31         Colombia       1.77</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="co">32          Ireland       1.70</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="co">33          Denmark       1.70</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="co">34           France       1.83</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="co">35          Iceland       1.75</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="co">36           Mexico       1.92</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="co">37   Czech Republic       1.71</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="co">38           Israel       3.01</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="co">           Country  Paid  Unpaid  Care</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="co">0        Australia  20.3    10.5   2.2</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="co">1          Austria  22.5     9.4   1.5</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="co">2          Belgium  15.6     9.7   0.8</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="co">3           Canada  22.1    10.3   1.7</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="co">4          Estonia  21.0    11.5   1.8</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="co">5          Finland  15.4    11.2   1.0</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="co">6           France  14.5     9.7   1.0</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="co">7          Germany  17.4     9.8   1.4</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="co">8            Italy  14.5     8.2   1.2</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="co">9            Japan  26.3     4.7   0.5</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a><span class="co">10           Korea  26.5     3.0   0.8</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="co">11          Latvia  24.2     8.8   1.2</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="co">12          Mexico  30.0     4.4   3.5</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a><span class="co">13     New Zealand  19.9    11.3   1.1</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="co">14          Norway  18.6    11.7   1.6</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a><span class="co">15          Poland  21.7     6.2   1.5</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a><span class="co">16        Slovenia  18.9    11.4   1.6</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="co">17           Spain  14.8     8.9   2.0</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="co">18          Sweden  20.1    10.0   1.8</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a><span class="co">19          Turkey  20.2     2.6   3.5</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a><span class="co">20  United Kingdom  20.1     9.5   1.6</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a><span class="co">21   United States  20.4    10.2   1.6</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>確認してみると,政府のデータは国ごとに異なる年代を使用しており,年代も国の選択もOECDのデータベースで公開されているものとは異なるようです.実際に,日本経済新聞のデータとも値が異なっていることから,おそらく公開されていないデータを独自に集計しているようです.
今回は日本経済新聞で採用されている値から2019年の出生率及びデータベースで公開されている1999-2013年の家事・育児時間を採用します.</p>
<p>続いて,政府のグラフに合わせて男性の労働時間,家事及び育児の時間(Paid,Unpaid,Care)に占める家事及び育児(Unpaid, Care)の割合を計算します.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df_t[<span class="st">'r'</span>] <span class="op">=</span> df_t[[<span class="st">'Unpaid'</span>,<span class="st">'Care'</span>]].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>) <span class="op">/</span> df_t[[<span class="st">'Paid'</span>,<span class="st">'Unpaid'</span>,<span class="st">'Care'</span>]].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_t)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">           Country  Paid  Unpaid  Care         r</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">0        Australia  20.3    10.5   2.2  0.384848</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">1          Austria  22.5     9.4   1.5  0.326347</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">2          Belgium  15.6     9.7   0.8  0.402299</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">3           Canada  22.1    10.3   1.7  0.351906</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">4          Estonia  21.0    11.5   1.8  0.387755</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">5          Finland  15.4    11.2   1.0  0.442029</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">6           France  14.5     9.7   1.0  0.424603</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">7          Germany  17.4     9.8   1.4  0.391608</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">8            Italy  14.5     8.2   1.2  0.393305</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">9            Japan  26.3     4.7   0.5  0.165079</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">10           Korea  26.5     3.0   0.8  0.125413</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">11          Latvia  24.2     8.8   1.2  0.292398</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">12          Mexico  30.0     4.4   3.5  0.208443</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co">13     New Zealand  19.9    11.3   1.1  0.383901</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co">14          Norway  18.6    11.7   1.6  0.416928</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co">15          Poland  21.7     6.2   1.5  0.261905</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co">16        Slovenia  18.9    11.4   1.6  0.407524</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co">17           Spain  14.8     8.9   2.0  0.424125</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co">18          Sweden  20.1    10.0   1.8  0.369906</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co">19          Turkey  20.2     2.6   3.5  0.231939</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co">20  United Kingdom  20.1     9.5   1.6  0.355769</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co">21   United States  20.4    10.2   1.6  0.366460</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p><code>df_t</code>と<code>df_f</code>は表示されている国が異なるので,<code>df_t</code>から情報を抽出します.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#照合のためにCountryをindexにします.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df_t.set_index(<span class="st">'Country'</span>,inplace<span class="op">=</span><span class="va">True</span>,drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>df_f.set_index(<span class="st">'Country'</span>,inplace<span class="op">=</span><span class="va">True</span>,drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>df_f[<span class="st">'r'</span>] <span class="op">=</span> pd.NA</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> df_f.index:</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        df_f.at[i,<span class="st">'r'</span>] <span class="op">=</span> df_t.at[i,<span class="st">'r'</span>]</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_f)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co">                 Fertility         r</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">Country</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">Korea                 0.92  0.125413</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co">Spain                 1.23  0.424125</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co">Italy                 1.27  0.393305</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co">Japan                 1.36  0.165079</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co">Poland                1.42  0.261905</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co">Portugal              1.43      &lt;NA&gt;</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co">Lithuania             1.61      &lt;NA&gt;</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co">Luxembourg            1.34      &lt;NA&gt;</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co">Canada                1.47  0.351906</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co">Greece                1.34      &lt;NA&gt;</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co">Finland               1.35  0.442029</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="co">Austria               1.46  0.326347</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co">Switzerland           1.48      &lt;NA&gt;</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="co">United Kingdom        1.63  0.355769</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co">Costa Rica            1.63      &lt;NA&gt;</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="co">Chile                 1.55      &lt;NA&gt;</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="co">Norway                1.53  0.416928</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="co">Latvia                1.61  0.292398</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="co">Germany               1.54  0.391608</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="co">OECD average          1.60      &lt;NA&gt;</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="co">Hungary               1.49      &lt;NA&gt;</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="co">Belgium               1.60  0.402299</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="co">Estonia               1.66  0.387755</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="co">Netherlands           1.57      &lt;NA&gt;</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="co">Slovak Republic       1.57      &lt;NA&gt;</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="co">New Zealand           1.72  0.383901</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="co">Slovenia              1.61  0.407524</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="co">United States         1.71   0.36646</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="co">Sweden                1.70  0.369906</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a><span class="co">Australia             1.67  0.384848</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="co">Türkiye               1.88      &lt;NA&gt;</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="co">Colombia              1.77      &lt;NA&gt;</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="co">Ireland               1.70      &lt;NA&gt;</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="co">Denmark               1.70      &lt;NA&gt;</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="co">France                1.83  0.424603</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a><span class="co">Iceland               1.75      &lt;NA&gt;</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="co">Mexico                1.92  0.208443</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="co">Czech Republic        1.71      &lt;NA&gt;</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="co">Israel                3.01      &lt;NA&gt;</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p><code>df_t</code>にデータの無い国を除外します.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#NAを削除</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df_f.dropna(how<span class="op">=</span><span class="st">'any'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_f)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">                Fertility         r</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">Country</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">Korea                0.92  0.125413</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">Spain                1.23  0.424125</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">Italy                1.27  0.393305</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">Japan                1.36  0.165079</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">Poland               1.42  0.261905</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">Canada               1.47  0.351906</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">Finland              1.35  0.442029</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">Austria              1.46  0.326347</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">United Kingdom       1.63  0.355769</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">Norway               1.53  0.416928</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">Latvia               1.61  0.292398</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co">Germany              1.54  0.391608</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co">Belgium              1.60  0.402299</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co">Estonia              1.66  0.387755</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co">New Zealand          1.72  0.383901</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co">Slovenia             1.61  0.407524</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co">United States        1.71   0.36646</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co">Sweden               1.70  0.369906</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="co">Australia            1.67  0.384848</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co">France               1.83  0.424603</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co">Mexico               1.92  0.208443</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>全てのデータが揃った国はこの21ヵ国となりました.</p>
<div class="note">
<p>このとき問題となるのが,どの国を採用するかです.
元のPOSTにも指摘がありましたが,内閣府の計算ではなぜかメキシコが除外されていますので,それに従って実行してみます.</p>
</div>
<div class="sourceCode" id="cb5"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#メキシコを除外</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>df_f.drop(<span class="st">'Mexico'</span>,axis<span class="op">=</span><span class="dv">0</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_f)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">               Fertility         r</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">Country</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">Korea                0.92  0.125413</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">Spain                1.23  0.424125</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">Italy                1.27  0.393305</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">Japan                1.36  0.165079</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">Poland               1.42  0.261905</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">Canada               1.47  0.351906</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">Finland              1.35  0.442029</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co">Austria              1.46  0.326347</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co">United Kingdom       1.63  0.355769</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co">Norway               1.53  0.416928</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co">Latvia               1.61  0.292398</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co">Germany              1.54  0.391608</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co">Belgium              1.60  0.402299</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co">Estonia              1.66  0.387755</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co">New Zealand          1.72  0.383901</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co">Slovenia             1.61  0.407524</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co">United States        1.71   0.36646</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co">Sweden               1.70  0.369906</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co">Australia            1.67  0.384848</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co">France               1.83  0.424603</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p><code>Fertility</code>は<code>%</code>になっているので単位を揃えて<code>r</code>も<code>%</code>表示にし,データ型も<code>float</code>にしておきます.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df_f[<span class="st">'r'</span>] <span class="op">=</span> (df_f[<span class="st">'r'</span>] <span class="op">*</span> <span class="dv">100</span>).astype(<span class="st">'float'</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_f)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">                Fertility          r</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">Country</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">Korea                0.92  12.541254</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">Spain                1.23  42.412451</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">Italy                1.27  39.330544</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">Japan                1.36  16.507937</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">Poland               1.42  26.190476</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">Canada               1.47  35.190616</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">Finland              1.35  44.202899</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">Austria              1.46  32.634731</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">United Kingdom       1.63  35.576923</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">Norway               1.53  41.692790</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">Latvia               1.61  29.239766</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">Germany              1.54  39.160839</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co">Belgium              1.60  40.229885</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co">Estonia              1.66  38.775510</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co">New Zealand          1.72  38.390093</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co">Slovenia             1.61  40.752351</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="co">United States        1.71  36.645963</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co">Sweden               1.70  36.990596</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co">Australia            1.67  38.484848</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="co">France               1.83  42.460317</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<h4 data-number="1.2.2" id="散布図の作成"><span class="header-section-number">1.2.2</span> 散布図の作成</h4>
<p>データが完成したので,散布図を作成してみます. ラベルを表示するためにライブラリ<code>adjustText</code>を利用しています. この方法で作成する場合は<code>pip install</code>してください.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> adjustText <span class="im">import</span> adjust_text</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>plt.scatter(df_f[<span class="st">'r'</span>],df_f[<span class="st">'Fertility'</span>])</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> [plt.text(df_f.at[c,<span class="st">'r'</span>],df_f.at[c,<span class="st">'Fertility'</span>],c) <span class="cf">for</span> c <span class="kw">in</span> df_f.index]</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>adjust_text(text, arrowprops<span class="op">=</span><span class="bu">dict</span>(arrowstyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'gray'</span>, lw<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>plt.xlim<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">50</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>plt.ylim<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">2</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Fertility'</span>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Unpaid and Care Work'</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Fertility vs Unpaid and Care Work with Country Labels'</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="../images/ch11_oecd_scatter_no_line.png" /></p>
<p>おおよそ政府と同じグラフが完成しました.</p>
<h4 data-number="1.2.3" id="単回帰"><span class="header-section-number">1.2.3</span> 単回帰</h4>
<p>つづいて,これらのデータを利用して単回帰分析を実施してみます. 回帰分析が可能なライブラリはいくつかありますが,ここでは<code>statsmodels.api</code>を利用してみます. <code>pip install statsmodels</code> をしておきましょう.</p>
<p>まずは,切片 <span class="math inline">\beta_0</span> として定数1をデータに追加します. <code>statsmodels</code>では <code>.add_constant()</code>メソッドで追加できます.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 説明変数(X)と目的変数(y)に分割</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_f[[<span class="st">'r'</span>]]</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_f[<span class="st">'Fertility'</span>]</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 切片(定数項)を追加</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co">                const          r</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co">Country</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co">Korea             1.0  12.541254</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co">Spain             1.0  42.412451</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co">Italy             1.0  39.330544</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co">Japan             1.0  16.507937</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co">Poland            1.0  26.190476</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co">Canada            1.0  35.190616</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co">Finland           1.0  44.202899</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="co">Austria           1.0  32.634731</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="co">United Kingdom    1.0  35.576923</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co">Norway            1.0  41.692790</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="co">Latvia            1.0  29.239766</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="co">Germany           1.0  39.160839</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="co">Belgium           1.0  40.229885</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="co">Estonia           1.0  38.775510</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="co">New Zealand       1.0  38.390093</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="co">Slovenia          1.0  40.752351</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="co">United States     1.0  36.645963</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="co">Sweden            1.0  36.990596</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="co">Australia         1.0  38.484848</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="co">France            1.0  42.460317</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>回帰分析を実施するには <code>OLS(y,X).fit()</code>を利用します. <code>OLS</code>は<code>Ordinary Least Squares</code>の頭文字で最小二乗法を意味しています.</p>
<p>回帰分析の結果は<code>.result()</code>メソッドで確認します.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰モデルを作成・フィット</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果を表示</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result.summary())</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">                            OLS Regression Results</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">==============================================================================</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">Dep. Variable:              Fertility   R-squared:                       0.282</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">Model:                            OLS   Adj. R-squared:                  0.243</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">Method:                 Least Squares   F-statistic:                     7.085</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">Date:                Sat, 29 Mar 2025   Prob (F-statistic):             0.0159</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">Time:                        13:27:03   Log-Likelihood:                 6.4233</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">No. Observations:                  20   AIC:                            -8.847</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">Df Residuals:                      18   BIC:                            -6.855</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">Df Model:                           1</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">Covariance Type:            nonrobust</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">==============================================================================</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co">                 coef    std err          t      P&gt;|t|      [0.025      0.975]</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co">------------------------------------------------------------------------------</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co">const          1.0390      0.183      5.666      0.000       0.654       1.424</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co">r              0.0134      0.005      2.662      0.016       0.003       0.024</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co">==============================================================================</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="co">Omnibus:                        3.229   Durbin-Watson:                   0.868</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="co">Prob(Omnibus):                  0.199   Jarque-Bera (JB):                2.595</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="co">Skew:                          -0.852   Prob(JB):                        0.273</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co">Kurtosis:                       2.539   Cond. No.                         161.</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="co">==============================================================================</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>様々な数値が出てきましたが,単回帰において注目すべきは,<code>(Adj.)R-squared</code>,<code>Prob (F-statistic)</code>,<code>coef</code>,<code>P&gt;|t|</code>,<code>[0.025      0.975]</code>です.
それぞれ何を見ればよいのかを順に見ていきましょう.</p>
<h4 data-number="1.2.4" id="回帰係数p値区間推定値"><span class="header-section-number">1.2.4</span> 回帰係数(P値,区間推定値)</h4>
<div class="sourceCode" id="cb10"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">                coef    std err          t      P&gt;|t|      [0.025      0.975]</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">------------------------------------------------------------------------------</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">const          1.0390      0.183      5.666      0.000       0.654       1.424</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">r              0.0134      0.005      2.662      0.016       0.003       0.024</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>回帰係数から今回推定された標本回帰方程式(<span class="math inline">y=\hat{\beta}_0+\hat{\beta}_1x</span>)は</p>
<p><span class="math display">
y=1.0390+0.0134x
</span></p>
<p>となります.
この <span class="math inline">\hat{\beta}_0</span> と <span class="math inline">\hat{\beta}_1</span> に対して<span class="math inline">H_0: \beta_i =0,H_1: \beta_i \neq 0</span> で検定した結果が,<code>P&gt;|t|</code>として示されています.
また, <span class="math inline">\hat{\beta}_0</span> と <span class="math inline">\hat{\beta}_1</span> の下側信頼限界が<code>0.025</code>,上側信頼限界が<code>0.975</code>として示されています.
2つの値は基本的に同じことを違う方法で表しています.</p>
<div class="note">
<p>それぞれの説明変数のP値(<code>P&gt;|t|</code>)は,その説明変数に対する回帰係数が0である(影響がない)という仮説に対する仮説検定のP値を表しています. また, <code>[0.025      0.975]</code>はそれぞれ上側と下側の95%信頼区間を表しています.</p>
<p>有意水準5%の場合, <code>P値 &lt; 0.05</code>で有意となり, 信頼区間が0をまたぎません.
(ここで両側検定ですが,<code>P値 &lt; 0.025</code>とならないのは,両側の外側累積確率を合算した値が算出されるためです.)
したがって,これらの値はいずれも同じ判断の基準となりますが,最近は論文などには両方載せることが主流です.
(仮説検定や区間推定,P値の意味などに関しては,統計学入門で詳細を扱っています.分からない人はそちらを履修しましょう.)</p>
</div>
<p><strong>｢P値 &lt; 0.05｣ かつ ｢下側信頼限界と上側信頼限界が0をまたいでいない｣</strong>場合には,それぞれの回帰係数が有意となります.</p>
<p>したがって今回の回帰分析の結果としては, いずれの回帰係数も有意であり,出生率に影響を及ぼしていると考えることができます.</p>
<div class="note">
<p>あまり良くない回帰分析の方法として,有意な回帰係数のみを分析対象として,有意でない回帰係数を無視して分析している場合がしばしばあります.
基本的には, 式を構成するすべての回帰係数が有意である場合にはじめてその式は利用できます.</p>
<p>方針等は指導教員によって異なるのでそれぞれに従っていただくとして,<strong>この講義では</strong>基本的に<strong>一つでも有意でない式がある場合には,その回帰式は利用できない</strong>とみなしてください.</p>
</div>
<h4 data-number="1.2.5" id="式全体の評価指標r2f"><span class="header-section-number">1.2.5</span> 式全体の評価指標(<span class="math inline">R^2</span>,F)</h4>
<p>回帰係数のP値,区間推定値は<strong>回帰係数一つ一つ</strong>に関する検定の結果でした. 個別の係数が問題ないとしても,切片と傾きを合わせた<strong>式全体の評価</strong>はどうなのでしょうか. その判断に利用するのが,
<span class="math inline">R^2</span> と <strong>有意F</strong>です.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">R-squared:                       0.282</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">Adj. R-squared:                  0.243</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">F-statistic:                     7.085</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">Prob (F-statistic):             0.0159</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<div class="note">
<ul>
<li><h3 id="調整済決定係数adj.-r-squared"><strong>調整済決定係数(Adj. R-squared)</strong></h3></li>
</ul>
<p><strong>決定係数</strong> (<span class="math inline">R^2</span>) は,<strong>モデルがどの程度当てはまっているかの基準</strong>です. 決定係数は説明変数の数が多いほど1に近づく特徴があるので,説明変数が多い場合には説明変数の数を補正した <strong>自由度調整済み決定係数</strong> (𝐴𝑑𝑗.<span class="math inline">𝑅^2</span>)を用います.</p>
<p>基本的に <span class="math inline">0 \leq Adj R^2 \leq 1</span> の値をとり,目安として <span class="math inline">0.5 \leq Adj 𝑅^2</span> であればある程度予測できていると考えられます.</p>
<p>どんな散布図になっても回帰式自体は作成可能ですが,以下の左右どちらの予測値の方が信頼できそうでしょうか.</p>
<figure>
<img src="../images/regression14.png" alt="R2" />
<figcaption aria-hidden="true">R2</figcaption>
</figure>
<p>直感的には左の方が<strong>回帰直線が実際の値にフィットしており</strong>信頼できそうな気がしますね. <span class="math inline">R^2</span> はその感覚を数値化したものになります.</p>
<figure>
<img src="../images/regression15.png" alt="R2" />
<figcaption aria-hidden="true">R2</figcaption>
</figure>
<p><span class="math inline">R^2</span> は,式から作られた直線と,実際のデータの点の距離の和を変更したものです.
<span class="math inline">R^2</span> が1に近いほど, 式が点によく当てはまっていることを表します.</p>
<p>数値の解釈にも様々ありますが,この講義では</p>
<ul>
<li><p><strong>0.5以上</strong>で予測に利用できる.</p></li>
<li><p><strong>0.8以上</strong>でかなり正確に予測ができる という解釈を採用します.</p></li>
</ul>
</div>
<p>今回のモデルを見てみると,<code>Adj. R-squared:0.243</code>であり,予測精度が高くないことが分かります.</p>
<div class="note">
<ul>
<li><h3 id="有意f-prob-f-statistic"><strong>有意F (Prob (F-statistic))</strong></h3></li>
</ul>
<p>有意Fは求めた標本回帰式でどの程度データの散らばりを説明できるかを検定した結果です.
どのような意味であるか見ていきましょう.</p>
<p>求めた回帰式と,データそれぞれの散らばりは,<strong>全変動</strong>,<strong>回帰変動</strong>,<strong>残渣変動</strong>によって表現可能です.</p>
<p><img src="../images/ch11-prob-f.png" /></p>
<ul>
<li>全変動:データと平均値の差の合計(の二乗和)</li>
</ul>
<p>データの散らばり具合</p>
<p><span class="math display">
\sum_{i=1}^n (y_i-y)^2
</span></p>
<ul>
<li>回帰変動:予測値とデータの平均値の差(の二乗和)</li>
</ul>
<p>データに対する回帰式の予測値の散らばり具合
<span class="math display">
\sum_{i=1}^n (\hat{y}_i-\bar{y})^2
</span></p>
<ul>
<li>残差変動:予測値とデータの差(の二乗和)</li>
</ul>
<p>回帰式とデータのズレの散らばり具合</p>
<p><span class="math display">
\sum_{i=1}^n (y_i-\hat{y})^2
</span></p>
<p>このとき</p>
<p><code>全変動 = 回帰変動+残差変動</code> すなわち,
<span class="math display">
\sum_{i=1}^n (y_i-y)^2 = \sum_{i=1}^n (\hat{y}_i-\bar{y})^2 + \sum_{i=1}^n (y_i-\hat{y})^2
</span>
がなりたちます.</p>
<p>これは言い換えると,</p>
<p><code>データの散らばり=回帰式で説明できる散らばり+回帰式で説明できない散らばり</code></p>
<p>を表しています.</p>
<p>回帰変動の平均と,残差変動の平均の比率を考えると,kを説明変数の数として,</p>
<p><span class="math display">
\begin{align*}
&amp;\frac{回帰変動の平均}{残差変動の平均}
&amp;=\frac{\sum_{i=1}^n (\hat{y}_i-\bar{y})^2 /𝑘}{\sum_{i=1}^n (y_i-\hat{y})^2/(n−k−1)}
\end{align*}
</span></p>
<p>すなわち</p>
<p><span class="math display">
\frac{回帰式で説明できる散らばり}{回帰式で説明できない散らばり}= 回帰式が説明できている割合
</span></p>
<p>が成り立ちます.</p>
<p><img src="../images/ch11-prob-f2.png" /></p>
<p>また,この説明の割合はF分布に従うことが知られており,</p>
<p><span class="math display">
F = \frac{\sum_{i=1}^n (\hat{y}_i-\bar{y})^2 /𝑘}{\sum_{i=1}^n (y_i-\hat{y})^2/(n−k−1)} \sim F(k,n-k-1)
</span></p>
<p><span class="math inline">H_0:F=1</span>(回帰式が説明できる散らばりが説明できないものと等しい)</p>
<p><span class="math inline">H_1:F&gt;1</span> (説明できる量の方が大きい)</p>
<p>として検定した結果のP値が有意Fです.</p>
<p>したがって,有意水準5%のとき,
<code>有意F &lt; 0.05</code> であれば,回帰式全体はデータを説明しているとみなすことができます.</p>
</div>
<p>今回は<code>Prob (F-statistic):0.0159</code>であり,有意に説明できていると言えます.</p>
<div class="note">
<p>したがって今回の結果をまとめると,</p>
<ul>
<li><p><span class="math inline">y=1.03+0.01x</span></p>
<ul>
<li><p>男性の仕事時間に対する家事育児の割合が1%が増えると,出生率が0.01増える</p></li>
<li><p>切片,傾き,式全体は有意(回帰式でデータを説明できる)</p></li>
</ul></li>
<li><p>予測精度は低い(予測には使えない)</p></li>
</ul>
<p>という結果が得られます.</p>
<p>内閣府の分析では,回帰式と<span class="math inline">R^2</span>のみが記載されており,検定結果は載っていませんでしたが,概ね正しい推論と言えます.
ただし,<span class="math inline">Adj. R^2</span> が低いためこの結果をもって,日本の男性の家事育児参加時間をXに増やせば出生率がYになるというような<strong>予測</strong>はできません.</p>
</div>
<h4 data-number="1.2.6" id="結果の可視化"><span class="header-section-number">1.2.6</span> 結果の可視化</h4>
<p>最後に,このモデルを可視化してみましょう. まずは,内閣府の資料と同じ用に散布図に回帰直線を可視化してみます.
<code>OLS().fit()</code>で得られた予測モデルは,<code>.params[]</code>で値を得ることができます.回帰式をxの値と回帰係数から計算し,<code>plt.plot()</code>で直線を引いています.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰直線のためのx軸データとy軸データ</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>x_vals <span class="op">=</span> np.linspace(df_f[<span class="st">'r'</span>].<span class="bu">min</span>(), df_f[<span class="st">'r'</span>].<span class="bu">max</span>(), <span class="dv">100</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x_vals)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>y_vals <span class="op">=</span> result.params[<span class="st">'const'</span>] <span class="op">+</span> result.params[<span class="st">'r'</span>] <span class="op">*</span> x_vals</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 描画</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 散布図</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>plt.scatter(df_f[<span class="st">'r'</span>], df_f[<span class="st">'Fertility'</span>], color<span class="op">=</span><span class="st">'blue'</span>, label<span class="op">=</span><span class="st">'Data Points'</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ラベル付け</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>texts <span class="op">=</span> [plt.text(df_f.at[c, <span class="st">'r'</span>], df_f.at[c, <span class="st">'Fertility'</span>], c) <span class="cf">for</span> c <span class="kw">in</span> df_f.index]</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>adjust_text(texts, arrowprops<span class="op">=</span><span class="bu">dict</span>(arrowstyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'gray'</span>, lw<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰直線</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>plt.plot(x_vals, y_vals, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="st">'Regression Line'</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 軸・タイトル・その他</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>plt.xlim <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>plt.ylim <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Unpaid and Care Work'</span>)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Fertility'</span>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Fertility vs Unpaid and Care Work with Regression Line'</span>)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="../images/ch11_oecd_scatter_with_line.png" /></p>
<p>このようなグラフによって実測値に対する回帰直線の当てはまりを確認することもできますが,もう少しわかりやすい手法として,縦軸に実測値 <span class="math inline">Y</span> ,横軸に予測値 <span class="math inline">\hat{\beta}_0 + \sum \hat{\beta}_i X_i</span> をプロットした散布図もよく用いられます.</p>
<p>先ほどとは異なり, <code>.predict()</code>メソッドで元データから計算された予測値を求めています.ここにxの等差級数を渡すことで先程のように回帰直線の値を得ることも可能です.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> result.predict(X)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(y, pred, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolors<span class="op">=</span><span class="st">&quot;k&quot;</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Predicted&quot;</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Actual&quot;</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Actual vs. Predicted&quot;</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>plt.plot([y.<span class="bu">min</span>(), y.<span class="bu">max</span>()], [y.<span class="bu">min</span>(), y.<span class="bu">max</span>()], color<span class="op">=</span><span class="st">&quot;red&quot;</span>, linestyle<span class="op">=</span><span class="st">&quot;--&quot;</span>)  <span class="co"># 完全一致のライン</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="../images/ch11_oecd_pred_actual.png" /></p>
<p>実測値と予測値が一致していれば,この散布図はグラフの45度線(赤い点線)上に一直線になります.
<span class="math inline">R^2</span>の結果通り,あまり予測精度が高くないことがわかります.</p>
<p>実測値と予測値の<code>カーネル密度プロット(KDE; Karnel Densiti Estimation Plot)</code>を重ねたグラフもベイズモデルなどでよく利用される手法です.
実測値の分布と予測値の分布を見比べることで,値全体でどの部分が過大/過少に推測されているかモデルの想定する分布がデータの分布と近いかが視覚化されます.</p>
<p><code>kde</code>の描画には<code>seaborn</code>ライブラリが必要になるので<code>pip install</code>しておきましょう.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>,<span class="dv">8</span>))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(pred, label <span class="op">=</span> <span class="st">'Predicted'</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(y, label <span class="op">=</span> <span class="st">'Actual'</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Actual/Predicted'</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Fertility'</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Density'</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code></pre></div>
<p><img src="../images/ch11_oecd_density.png" /></p>
<p>実測値と予測値で大きく分布が異なることがわかり,やはりあまり良いモデルとはいえなさそうです.</p>
<div class="note">
<ul>
<li>演習問題</li>
</ul>
<p>内閣府の計算で何故か除外されていたMexicoのデータを加えて回帰分析を行い,その結果を解釈してください.</p>
</div>
<h3 data-number="1.3" id="重回帰分析"><span class="header-section-number">1.3</span> 重回帰分析</h3>
<p><span class="math display">
Y = \beta_0 + \beta_1 x_1 + \dots + \beta_n x_n
</span></p>
<p>のように複数の説明変数,回帰係数を利用して目的変数を説明する回帰分析を重回帰分析といいます.
基本的には,単回帰と同じように分析することが可能ですが,いくつかの注意点があります.</p>
<div class="note">
<ul>
<li><h3 id="注意点1-モデル選択">注意点1 : モデル選択</h3></li>
</ul>
<p>前節で扱った単回帰分析では,そもそもデータに説明変数が一つしかなかったためにどの変数を利用するかという選択が必要ありませんでした. しかし,多数の説明変数の存在を前提とする重回帰分析では,<strong>全ての変数をモデルに採用するのではなく</strong>,説明力の高い変数の組み合わせを選択する必要があります.</p>
<p>今回は線形重回帰分析のみを扱いますが,様々なモデルを比較して最適なモデルを選択することを<strong>モデル選択</strong>といいます.
モデル選択においては<strong>多重共線性</strong>などいくつかの判断基準に基づいて変数の選択を行います.</p>
<div class="warn">
<p>今回はモデル明らかに利用できない変数を除外するという処理のみを行いますが,より多くの変数を扱う場合には,<strong>ステップワイズ法</strong>などの手法を用いて機械的に最適な組み合わせを選択する場合があります. そのような手法に関しては次章において扱います.</p>
</div>
<ul>
<li><h3 id="注意点2-データの正規化">注意点2: データの正規化</h3></li>
</ul>
<p>重回帰分析では回帰係数毎に目的変数に対する説明変数の影響力が比較されます.
その場合,同一の基準で比較できるようにデータを正規化する必要があります</p>
</div>
<p>これらの注意点に関して,以下実例を通して概要を説明します.
手順が多く複雑ですが｢回帰分析ができる｣とはこの一連の手順を全て理解して,実行できることを意味しています.
作業を再現しつつ,どのような処理を何故行っているのかを把握するようにしましょう.</p>
<h4 data-number="1.3.1" id="データ準備"><span class="header-section-number">1.3.1</span> データ準備</h4>
<p>事例として<strong>架空の大学生のGPAに関するデータ</strong>を利用します.<a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/multiple_regression.csv">こちら</a>からダウンロードして利用して下さい.</p>
<p>各変数とデータの形式は以下のとおりです.</p>
<div class="note">
<ul>
<li>目的変数: <code>GPA</code> (0-5) 量的変数</li>
<li>説明変数:
<ul>
<li><code>Scholarship</code> (TRUE/FALSE) 質的変数;奨学生か否か</li>
<li><code>Study_Hours</code> 量的変数; 1週間の平均勉強時間</li>
<li><code>Sports_hours</code> 量的変数; 1週間の平均運動時間</li>
<li><code>Part_time_Work</code> 量的変数; 1週間の平均バイト時間</li>
</ul></li>
</ul>
<table>
<thead>
<tr class="header">
<th>GPA</th>
<th>Scholarship</th>
<th>Study_Hours</th>
<th>Sports_hours</th>
<th>Part_time_Work</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3.527536588</td>
<td>TRUE</td>
<td>12.95386632</td>
<td>5.454919869</td>
<td>10.64263873</td>
</tr>
<tr class="even">
<td>2.40855012</td>
<td>FALSE</td>
<td>10.68547312</td>
<td>7.614285509</td>
<td>13.35924324</td>
</tr>
<tr class="odd">
<td>2.529088645</td>
<td>TRUE</td>
<td>9.53740687</td>
<td>1.785033531</td>
<td>15.28753044</td>
</tr>
<tr class="even">
<td>2.001397426</td>
<td>TRUE</td>
<td>8.795585218</td>
<td>5.369267717</td>
<td>16.45415926</td>
</tr>
<tr class="odd">
<td>0.965380522</td>
<td>TRUE</td>
<td>4.085912039</td>
<td>5.519765588</td>
<td>15.14785996</td>
</tr>
<tr class="even">
<td>1.34390841</td>
<td>FALSE</td>
<td>7.120623166</td>
<td>6.563645744</td>
<td>15.05862363</td>
</tr>
<tr class="odd">
<td>1.789371684</td>
<td>TRUE</td>
<td>8.157444916</td>
<td>2.526098578</td>
<td>14.15564243</td>
</tr>
<tr class="even">
<td>3.719258275</td>
<td>TRUE</td>
<td>14.2284889</td>
<td>2.359086774</td>
<td>10.15624819</td>
</tr>
<tr class="odd">
<td>2.557462565</td>
<td>TRUE</td>
<td>11.37447316</td>
<td>6.043883131</td>
<td>16.70622459</td>
</tr>
<tr class="even">
<td>0</td>
<td>FALSE</td>
<td>2.947839379</td>
<td>5.593969346</td>
<td>19.04125979</td>
</tr>
<tr class="odd">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
</div>
<p>こちらのデータを利用して,GPAに影響する時間の使い方に関して分析します.</p>
<h4 data-number="1.3.2" id="可視化散布図行列"><span class="header-section-number">1.3.2</span> 可視化(散布図行列)</h4>
<p>まずは散布図行列で組み合わせごとの特徴を把握します.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> japanize_matplotlib</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'multiple_regression.csv'</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 散布図行列の作成</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>pd.plotting.scatter_matrix(df[[<span class="st">'GPA'</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>                              ,<span class="st">'Study_Hours'</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>                              ,<span class="st">'Sports_hours'</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>                              ,<span class="st">'Part_time_Work'</span>]], range_padding<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>散布図行列において各交点には,異なる変数の場合は散布図,同じ変数の場合はヒストグラムが表示されています.
Scholorshipは質的変数なので除外しています.</p>
<p><img src="../images/ch11-multi-regression1.png" /></p>
<p>散布図行列を確認する場合は,散布図とヒストグラムそれぞれを確認する必要があります.それぞれの見方は可視化の章で説明したとおりです.</p>
<div class="note">
<p>散布図を見る際には,まず<strong>目的変数-説明変数の関係</strong>に注目します.
GPAに対して<code>Study_Hours</code>,<code>Part_time_Work</code>は相関がありそうに見えます.</p>
<p>続いて,<strong>説明変数同士の関係</strong>にも注意が必要です.これは後に扱う<strong>多重共線性</strong>を考慮するためにも重要です.
説明変数同士も<code>Study_Hours</code>と,<code>Part_time_Work</code>には相関がありそうです.</p>
<p>次に,ヒストグラムを見ると<code>Study_Hours</code>,<code>Sports_Hours</code>,<code>Part_time_Work</code>はいずれも単峰で左右対称な分布で,外れ値もありません
しかし,<code>GPA</code>は多峰な分布になっているので,層別の必要性があります.</p>
</div>
<h4 data-number="1.3.3" id="可視化ヒートマップ"><span class="header-section-number">1.3.3</span> 可視化(ヒートマップ)</h4>
<p>散布図では相関の有無は明確にならないので量的変数ごとに相関係数のヒートマップを作成し,より詳細に見てみます.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ヒートマップで確認</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>sns.heatmap(df[[<span class="st">'GPA'</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>               ,<span class="st">'Study_Hours'</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>               ,<span class="st">'Sports_hours'</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>               ,<span class="st">'Part_time_Work'</span>]].corr()</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>            ,vmax<span class="op">=</span><span class="dv">1</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>            ,vmin<span class="op">=-</span><span class="dv">1</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>            ,annot<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="../images/ch11-multi-regression3.png" /></p>
<p>注目する点は,基本的に散布図と同様です.</p>
<div class="note">
<ul>
<li><h3 id="目的変数-説明変数">目的変数-説明変数</h3>
<ul>
<li><code>GPA-Study_Hours</code>にかなり強い正の相関</li>
<li><code>GPA-Part_time_Work</code>に強い負の相関</li>
</ul></li>
</ul>
<p>目的変数-説明変数に相関がある場合には,回帰分析において有意になる可能性が高く,説明変数として採用する可能性が高いです.</p>
<ul>
<li><h3 id="説明変数-説明変数">説明変数-説明変数</h3>
<ul>
<li>Study_Hours-Part_time_Workにも強い負の相関</li>
</ul>
バイト時間が長いと勉強時間が少なくなるという関係.</li>
</ul>
<p>説明変数同士に相関が見られる場合は,多重共線性を避けるために,片方(基本的には目的変数と相関係数が低い方)の変数を除外する必要があります</p>
</div>
<h4 data-number="1.3.4" id="多重共線性完全な多重共線性"><span class="header-section-number">1.3.4</span> 多重共線性(完全な多重共線性)</h4>
<p><strong>多重共線性</strong>とは,説明変数間に強い相関関係があることで回帰係数の推定精度が落ちることを意味します.
多重共線性が見られる場合に推定された回帰係数は数値に根拠がないため利用できません.強い相関が見られる説明変数は,目的変数に対する相関係数が高い方を残して,片方を除外する必要があります.</p>
<p>説明変数<span class="math inline">x_1,x_2,...,x_n</span>において,特定の変数<span class="math inline">x_i</span>が他の変数によって</p>
<p><span class="math display"> x_i = \sum_{i \neq j} \alpha_j x_j </span></p>
<p>として,少なくとも1つが0でない定数<span class="math inline">\alpha_j</span>によって表すことができる場合に,｢説明変数に完全な多重共線性が成り立っている｣ といいます.</p>
<p>このとき,最小二乗法では,<span class="math inline">Y = \beta_0 + \beta_1 x_1 + \dots + \beta_n x_n</span>を解くことができなくなるため,解が得られなくなります.</p>
<p>完全な多重共線性は基本的に，特定の説明変数を変形して別の説明変数を追加した場合に生じるので，特定の変数を変形した変数はいれるべきではありません．</p>
<div class="note">
<p>例: <span class="math inline">x_1=\alpha_2 x_2</span>であるとすると,
<span class="math display"> y=\beta_0+(\beta_1+\alpha_2 \beta_2)x_2 + \beta_3 x_3 + \dots \beta_n x_n </span></p>
<p>推定値が <span class="math inline">\hat{\beta}_12 = \hat{\beta}_1 + \alpha_2 \hat{\beta}_2</span> であるとすると,<span class="math inline">\hat{\beta}_12</span> となる<span class="math inline">\hat{\beta}_1</span> と <span class="math inline">\hat{\beta}_2</span> の組み合わせは無数にあるため,具体的な値を特定できません.</p>
</div>
<h4 data-number="1.3.5" id="多重共線性弱い多重共線性"><span class="header-section-number">1.3.5</span> 多重共線性(弱い多重共線性)</h4>
<p><span class="math display">x_i \approx \sum_{i \neq j}\alpha_j x_j</span></p>
<p>で成り立つ <strong>(完全ではない/弱い) 多重共線性</strong>という概念もあります.
これは,説明変数間に完全相関以外の相関が成り立つ場合の多重共線性です.</p>
<p>変数間に相関がある場合</p>
<pre><code>-   サンプルサイズによって推定値が大きく変わる
-   標本によって推定値が大きく変わる</code></pre>
<p>など,推定値が不安定になります.</p>
<p>多重共線性を避けるために,変数間の相関が強い場合には片方を除外する必要があります.
どちらの変数を残すかに関する基準には数理的なものもありますが,</p>
<ul>
<li><p>検証したい仮説と関連の強いもの</p></li>
<li><p>目的変数に対する相関係数がより高い変数</p></li>
</ul>
<p>を残すようにしましょう.</p>
<div class="note">
<p>今回は,<code>Part_time_Work</code> を説明変数から除外します.</p>
</div>
<h4 data-number="1.3.6" id="可視化層別とペアプロット"><span class="header-section-number">1.3.6</span> 可視化(層別とペアプロット)</h4>
<p>散布図/ヒートマップを参考に多重共線性に関する示唆を得ることができました.
続いて,ヒストグラムについてもう少し深堀りしてみましょう.ヒストグラムが多峰になっていたので,試しに唯一の質的変数である,<code>Scholarship</code>でデータを層別した散布図行列を作成してみます.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>sns.pairplot(df[[<span class="st">'GPA'</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                ,<span class="st">'Study_Hours'</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                ,<span class="st">'Sports_hours'</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                ,<span class="st">'Part_time_Work'</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                ,<span class="st">'Scholarship'</span>]]</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                , diag_kind<span class="op">=</span><span class="st">&quot;hist&quot;</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                , hue<span class="op">=</span><span class="st">&quot;Scholarship&quot;</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>                , palette<span class="op">=</span><span class="st">&quot;Set2&quot;</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>                , diag_kws<span class="op">=</span><span class="bu">dict</span>(bins<span class="op">=</span><span class="dv">8</span>))</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">&quot;Scatterplot Matrix with Scholarship&quot;</span>, y<span class="op">=</span><span class="fl">1.02</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="../images/ch11-multi-regression2.png" /></p>
<p>奨学金をもらっている(True)の分布と,もらっていない(False)分布で<code>GPA</code>が異なることが分かります.
つまり,奨学生とそれ以外の影響を分析に追加するべきであることが分かります.
それ以外の変数はそれほど違いがありません.
奨学金あり/なしいずれも単峰ではありませんが,今回はこれ以上分割する情報がないのでこちらで分析を進めていきます</p>
<h4 data-number="1.3.7" id="可視化層別とジョイントプロット"><span class="header-section-number">1.3.7</span> 可視化(層別とジョイントプロット)</h4>
<p><code>GPA</code>に対して,<code>Study_Hours</code>の影響が最も強そうなので,この2変数に注目してもう少し詳細に見てみましょう.
この2変数のジョイントプロットを作成してみます.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#joinplotで男女別に密度プロットを表示</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> sns.jointplot(data <span class="op">=</span> df</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                   ,x <span class="op">=</span><span class="st">&quot;Study_Hours&quot;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                   ,y <span class="op">=</span><span class="st">&quot;GPA&quot;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                   ,hue<span class="op">=</span><span class="st">'Scholarship'</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                   ,joint_kws <span class="op">=</span> <span class="bu">dict</span>(alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="../images/ch11-multi-regression4.png" /></p>
<p>基本的には勉強時間が上がるほど,GPAが高くなるという傾向が見られます.
また,奨学生の方が非奨学生よりも全体的に<code>GPA</code>が高いことが散布図,カーネル密度プロットの双方から分かります.</p>
<p>しかし,<code>Scholarships</code>は質的変数であり,そのままではこの影響を回帰分析に組み込むことができません.どのようにしたら良いのでしょうか?</p>
<h4 data-number="1.3.8" id="ダミー変数化数量化1類"><span class="header-section-number">1.3.8</span> ダミー変数化(数量化1類)</h4>
<p>説明変数に質的データを含める重回帰分析を<strong>数量化1類(Quantification Method Type I)</strong>といいます.</p>
<p>基本的に回帰分析における質的データは<code>0/1</code>からなる擬似的な量的変数である<strong>ダミー変数</strong>に変換して処理しますがこのような数への変換を総じて<strong>数量化</strong>といいます.</p>
<div class="warn">
<p>数量化にはこの他にも,目的変数と説明変数がともに質的データの場合の<strong>数量化2類(Quantification Method Type Ⅱ)</strong>, 説明変数に量的データが混ざっている場合の<strong>拡張型数量化2類</strong>などがあり,数量化3,4,5,6類なども存在します.</p>
<p>数量化2類に関してはロジスティック回帰,数量化3類に関しては主成分分析が同様の目的で利用されるため,これらに関しては本資料では扱いません.</p>
</div>
<p>例えば,以下のような身長と体重,性別,国籍からなるデータがあった場合,新たに性別,国籍の種別の列を設けて当てはまる行に1,当てはまらない行に0を入力する変換を行います.</p>
<ul>
<li>変換前のデータ</li>
</ul>
<table>
<thead>
<tr class="header">
<th>id</th>
<th>体重</th>
<th>身長</th>
<th>性別</th>
<th>国籍</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>65</td>
<td>170</td>
<td>男</td>
<td>日本</td>
</tr>
<tr class="even">
<td>2</td>
<td>58</td>
<td>174</td>
<td>女</td>
<td>米国</td>
</tr>
<tr class="odd">
<td>3</td>
<td>78</td>
<td>189</td>
<td>男</td>
<td>オランダ</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<ul>
<li>ダミー変数に変換したデータ</li>
</ul>
<table>
<thead>
<tr class="header">
<th>id</th>
<th>体重</th>
<th>身長</th>
<th>性別 男</th>
<th>日本</th>
<th>米国</th>
<th>オランダ</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>65</td>
<td>170</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>2</td>
<td>58</td>
<td>174</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td>3</td>
<td>78</td>
<td>189</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p>それでは,<code>Scholarships</code>をダミー変数化してみましょう.pandasでは<code>get_dummies</code>関数で簡単に実装できます.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># カテゴリカルデータのダミー変数化</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># get_dummies関数を使う(dtype='it'で0/1の数値に変換)</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.get_dummies(df,columns<span class="op">=</span>[<span class="st">'Scholarship'</span>],dtype<span class="op">=</span><span class="st">'int'</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Unnamed: 0       GPA  Study_Hours  Sports_hours  Part_time_Work  Scholarship_False  Scholarship_True</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">0            0  3.527537    12.953866      5.454920       10.642639                  0                 1</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">1            1  2.408550    10.685473      7.614286       13.359243                  1                 0</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co">2            2  2.529089     9.537407      1.785034       15.287530                  0                 1</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">3            3  2.001397     8.795585      5.369268       16.454159                  0                 1</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co">4            4  0.965381     4.085912      5.519766       15.147860                  0                 1</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co">..         ...       ...          ...           ...             ...                ...               ...</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co">95          95  4.000000    16.199738      6.267838        9.986043                  1                 0</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co">96          96  1.782450     6.866987      0.949715       14.228814                  1                 0</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co">97          97  1.350890     8.711754      5.372909       14.130176                  1                 0</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co">98          98  2.515160    13.254069      3.676427       12.873422                  1                 0</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="co">99          99  1.269809     5.076543      6.704867       15.826625                  0                 1</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<h4 data-number="1.3.9" id="正規化標準化"><span class="header-section-number">1.3.9</span> 正規化・標準化</h4>
<p>重回帰分析では, 単回帰分析と異なり複数の変数の影響を比較します.その際に例えば, 値1の単位がmm, 値2の単位がm, 値3の単位が%などことなると正確に比較できません.
そこで, データの単位などを揃える操作として正規化か標準化を行う必要があります.</p>
<div class="note">
<ul>
<li>正規化</li>
</ul>
<p>最大値を1, 最小値を0にそろえること.</p>
<p><span class="math display">x{\prime}_i = \frac{x_i - \min(X)}{\max(X) - \min(X)}</span></p>
<ul>
<li>標準化</li>
</ul>
<p>標準得点を求めて, 平均0分散1に揃える.</p>
<p><span class="math display">z_i = \frac{x_i - \bar{x}}{\sigma}</span></p>
</div>
<p>正規化/標準化された値によって求められた回帰係数は目的変数に対するそれぞれの説明変数の影響力を表します.
ただし, 単位が元のデータとは異なるので注意が必要です.</p>
<p>基本的には標準化が推奨されますが明確な使い分けはなく,正規化のほうが直感的に影響力が理解されやすいため簡便な分析では利用される場合があります.</p>
<div class="warn">
<p>標準化は元のデータが正規分布であることを前提に実施されます.
分布が明らかに異なる場合は正規化が採用される場合もありますが,重回帰分析自体がそのような仮定のもとで実施されているため,今回の分析では暗黙に正規分布を仮定しています.</p>
</div>
<p>以下の分析では標準化を実施してみます. 標準化は,自分で標準偏差などを求めて計算することも可能ですが<code>sklearn.preprocessing</code> の<code>StandardScaler</code>を利用すると簡単に実装できます.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#標準化</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">'Scholarship_True'</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>   ,<span class="st">'Study_Hours'</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>   ,<span class="st">'Part_time_Work'</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>   ,<span class="st">'Sports_hours'</span>]] <span class="op">=</span> scaler.fit_transform(df[[<span class="st">'Scholarship_True'</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>                                               ,<span class="st">'Study_Hours'</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>                                               ,<span class="st">'Part_time_Work'</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>                                               ,<span class="st">'Sports_hours'</span>]])</span></code></pre></div>
<p>なお正規化も同様に<code>MinMaxScaler</code>を利用することができます.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#正規化</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MinMaxScaler</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 正規化（0〜1に変換）</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> MinMaxScaler()</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">'Scholarship_True'</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Study_Hours'</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Part_time_Work'</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Sports_hours'</span>]] <span class="op">=</span> scaler.fit_transform(df[[<span class="st">'Scholarship_True'</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>                                               ,<span class="st">'Study_Hours'</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>                                               ,<span class="st">'Part_time_Work'</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>                                               ,<span class="st">'Sports_hours'</span>]])</span></code></pre></div>
<h4 data-number="1.3.10" id="モデル選択"><span class="header-section-number">1.3.10</span> モデル選択</h4>
<p>まずは, <code>Part_time_Work</code>を除外し,<code>Scholarship</code>のダミー変数<code>Scholarship_True</code>を含める<strong>標準化された</strong>説明変数で重回帰分析を実施してみます.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 説明変数(X)と目的変数(y)に分割</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df[[<span class="st">'Scholarship_True'</span>, <span class="st">'Study_Hours'</span>,<span class="st">'Sports_hours'</span>]]</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">'GPA'</span>]</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 切片(定数項)を追加</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰モデルを作成・フィット</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果を表示</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result.summary())</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co">                            OLS Regression Results</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="co">==============================================================================</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co">Dep. Variable:                    GPA   R-squared:                       0.944</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="co">Model:                            OLS   Adj. R-squared:                  0.943</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="co">Method:                 Least Squares   F-statistic:                     543.5</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="co">Date:                Fri, 24 Oct 2025   Prob (F-statistic):           4.46e-60</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="co">Time:                        12:48:46   Log-Likelihood:                -7.4041</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="co">No. Observations:                 100   AIC:                             22.81</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="co">Df Residuals:                      96   BIC:                             33.23</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="co">Df Model:                           3</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="co">Covariance Type:            nonrobust</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="co">====================================================================================</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="co">                       coef    std err          t      P&gt;|t|      [0.025      0.975]</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a><span class="co">------------------------------------------------------------------------------------</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="co">const                1.8366      0.027     69.060      0.000       1.784       1.889</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="co">Scholarship_True     0.2556      0.027      9.574      0.000       0.203       0.309</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="co">Study_Hours          1.0213      0.027     38.262      0.000       0.968       1.074</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a><span class="co">Sports_hours         0.0152      0.027      0.570      0.570      -0.038       0.068</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a><span class="co">==============================================================================</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a><span class="co">Omnibus:                       22.718   Durbin-Watson:                   2.026</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a><span class="co">Prob(Omnibus):                  0.000   Jarque-Bera (JB):               62.615</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a><span class="co">Skew:                           0.732   Prob(JB):                     2.53e-14</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a><span class="co">Kurtosis:                       6.590   Cond. No.                         1.09</span></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a><span class="co">==============================================================================</span></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>注目すべきポイントは基本的に単回帰分析と同様です.</p>
<div class="note">
<ul>
<li><p>自由度調整済み決定係数(0.943); 予測精度非常に高い</p></li>
<li><p>F値(4.46e-60); 説明力あり</p></li>
<li><p>回帰係数; 勉強時間が一番影響力が強い</p></li>
</ul>
<p>ただし,標準化されているため｢<code>Study_Hours</code>が1時間伸びると<code>GPA</code>が1.02増える｣といった解釈はできないことに注意してください.</p>
<ul>
<li><p>P値; Sports_Hours以外有意</p></li>
<li><p>区間推定値; Sports_Hours以外有意</p></li>
</ul>
</div>
<p>F値や <span class="math inline">R^2</span> が良く概ね良い結果が出たように思えますが,この結果をもってなにか結論を導くことは<strong>できません.</strong></p>
<div class="note">
<ul>
<li>できない理由</li>
</ul>
<p><strong>Sport_Hoursの回帰係数が有意ではない</strong></p>
<p>一部の社会科学では,有意ではない変数を含めて,有意である変数のみで結果を解釈するという方法論がしばしば用いられますが,モデル全体では有意ではない変数によってその他の変数の結果も影響を受けるため,この講義では有意ではない変数はモデルから除外することを推奨します.</p>
<p>その他,変数ごとのP値を比較して信頼度として解釈するようなことも行われがちですが,この講義ではそのような手法は行いません.</p>
</div>
<p>多重共線性とP値を考慮して, <code>Part_time_Work</code>を説明変数から除外したモデルでの分析を実施してみます.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sports_hours を除外し説明変数(X)と目的変数(y)に分割</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df[[<span class="st">'Scholarship_True'</span>, <span class="st">'Study_Hours'</span>]]</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">'GPA'</span>]</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 切片(定数項)を追加</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 回帰モデルを作成・フィット</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果を表示</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result.summary())</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="co">                            OLS Regression Results</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co">==============================================================================</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="co">Dep. Variable:                    GPA   R-squared:                       0.944</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co">Model:                            OLS   Adj. R-squared:                  0.943</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="co">Method:                 Least Squares   F-statistic:                     820.8</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="co">Date:                Fri, 24 Oct 2025   Prob (F-statistic):           1.62e-61</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="co">Time:                        12:48:49   Log-Likelihood:                -7.5729</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="co">No. Observations:                 100   AIC:                             21.15</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="co">Df Residuals:                      97   BIC:                             28.96</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a><span class="co">Df Model:                           2</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a><span class="co">Covariance Type:            nonrobust</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a><span class="co">====================================================================================</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a><span class="co">                       coef    std err          t      P&gt;|t|      [0.025      0.975]</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a><span class="co">------------------------------------------------------------------------------------</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a><span class="co">const                1.8366      0.027     69.301      0.000       1.784       1.889</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a><span class="co">Scholarship_True     0.2557      0.027      9.613      0.000       0.203       0.308</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a><span class="co">Study_Hours          1.0213      0.027     38.398      0.000       0.969       1.074</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a><span class="co">==============================================================================</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a><span class="co">Omnibus:                       23.472   Durbin-Watson:                   2.005</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a><span class="co">Prob(Omnibus):                  0.000   Jarque-Bera (JB):               63.596</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a><span class="co">Skew:                           0.769   Prob(JB):                     1.55e-14</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a><span class="co">Kurtosis:                       6.591   Cond. No.                         1.09</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a><span class="co">==============================================================================</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<div class="note">
<ul>
<li><p>自由度調整済み決定係数(0.943); (変化無し)予測精度非常に高い</p></li>
<li><p>F値(1.62e-61); (改善) 説明力あり</p></li>
<li><p>回帰係数; 勉強時間が一番影響力が強い</p></li>
<li><p>P値; 全て有意</p></li>
<li><p>区間推定値; 全て有意</p></li>
</ul>
</div>
<p><code>Sports_hours</code>を除外したことで全ての変数が有意となり,F値等も問題がないため選択した説明変数によって,目的変数が説明するモデルが作成できたことになります.</p>
<div class="note">
<p>今回は有意ではないものを除外することで,信頼のおける回帰式を推論することができました.</p>
<p>この結果から,</p>
<ul>
<li><p>奨学生の方がGPAが良いこと</p></li>
<li><p>勉強時間が多いほどGPAが高いこと</p></li>
<li><p>勉強時間の方が奨学生であることよりもGPAには効果があること</p></li>
<li><p>｢奨学生であるか｣｢勉強時間｣からGPAが予測できること</p></li>
</ul>
<p>などが示されました.</p>
<p>なお,今回の結果から</p>
<ul>
<li><p>バイト時間が多いほどGPAが少ない</p></li>
<li><p>バイト時間や運動時間ではGPAを説明できない</p></li>
</ul>
<p>などの仮説がたてられますが,それが検証されたわけではないことに注意が必要です.
(仮説検定は,棄却されて初めて具体的な主張が可能です.)</p>
</div>
<h4 data-number="1.3.11" id="aicについて"><span class="header-section-number">1.3.11</span> AICについて</h4>
<p>今回は,有意ではない,かつ多重共線性のある説明変数を除外することで適当なモデルを選択することができました.</p>
<p>しかし,全ての変数が有意なモデル同士はどのように比較するのでしょうか.
例えば, <span class="math inline">Adj.R^2</span> や 𝑃𝑟𝑜𝑏(𝐹−𝑠𝑡𝑎𝑡𝑖𝑠𝑡𝑖𝑐)を比較してみると</p>
<ul>
<li><p>Sports_Hours あり <span class="math inline">Adj.R^2</span> : 0.943, 𝑃𝑟𝑜𝑏(𝐹−𝑠𝑡𝑎𝑡𝑖𝑠𝑡𝑖𝑐):4.46e-60</p></li>
<li><p>Sports_Hours なし <span class="math inline">Adj.R^2</span> : 0.943, 𝑃𝑟𝑜𝑏(𝐹−𝑠𝑡𝑎𝑡𝑖𝑠𝑡𝑖𝑐):1.62e-61</p></li>
</ul>
<p>とそれほどの差はありません.</p>
<p>モデルの比較を行う際には基本的にこれらの値を利用するのではなく, <strong>AIC (赤池情報量基準、Akaike‘s Information Criterion)</strong>や <strong>BIC(ベイズ情報量規準, Bayesian information criterion)</strong>を利用するのが一般的です.</p>
<p>詳細は次の章などで扱いますが,いずれも｢モデルの良さ｣を表す基準であり,値が小さいほど良いモデルとなります.
Sports_Hours あり/なしを比較すると,AIC(22.81→21.15),BIC(33.23→28.96)共にSports_Hoursを除外したモデルのほうが値が小さいことが分かります.</p>
<h4 data-number="1.3.12" id="結果の可視化-1"><span class="header-section-number">1.3.12</span> 結果の可視化</h4>
<p>回帰分析の結果を画像でも確認してみます.
最も単純な回帰の結果を表すグラフは,縦軸に実測値Y,横軸に予測値をプロットした散布図です.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(y, pred, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolors<span class="op">=</span><span class="st">&quot;k&quot;</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Predicted&quot;</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Actual&quot;</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Actual vs. Predicted&quot;</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>plt.plot([y.<span class="bu">min</span>(), y.<span class="bu">max</span>()], [y.<span class="bu">min</span>(), y.<span class="bu">max</span>()], color<span class="op">=</span><span class="st">&quot;red&quot;</span>, linestyle<span class="op">=</span><span class="st">&quot;--&quot;</span>)  <span class="co"># 完全一致のライン</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>実測値と予測値が一致していれば,この散布図はグラフの45度線(赤い点線)上に一直線になります.
殆どの点が45度線付近に集まっているからかなり正確に予測ができていることが分かります.</p>
<p><img src="../images/ch11-multi-regression5.png" /></p>
<p>実測値と予測値の<strong>カーネル密度プロット (Karnel Densiti Estimation Plot)</strong>を重ねたグラフもベイズモデルなどでよく利用される手法です.
ここでは<code>seaborn</code>の<code>kdeplot</code>を利用してカーネル密度プロットを行ってみます.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#予測結果の作成</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> result.predict(X)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>,<span class="dv">8</span>))</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(pred, label <span class="op">=</span> <span class="st">'Predicted'</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(y, label <span class="op">=</span> <span class="st">'Actual'</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Actual/Predicted'</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'GPA'</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Density'</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="../images/ch11-multi-regression6.png" /></p>
<p>実測値の分布と予測値の分布を見比べることで,値全体でどの部分が過大/過少に推測されているかモデルの想定する分布がデータの分布と近いかがが視覚化されます.</p>
<p>基本的には実測値の分布を正しく予測できていることが分かります.</p>
<p>その他によく用いられるグラフに<strong>Partial Regression Plot</strong>や<strong>Added-Variable Plot</strong>と呼ばれるグラフがあります..</p>
<ul>
<li><p>縦軸に <span class="math inline">X_i</span> 以外の変数で <span class="math inline">Y</span> を回帰した際の残差(他の変数の影響を取り除いたYの変動)</p></li>
<li><p>横軸に <span class="math inline">X_i</span> 以外の変数で<span class="math inline">X_i</span> を回帰した際の残差(他の変数の影響を取り除いた<span class="math inline">X_i</span> の変動)</p></li>
</ul>
<p>がプロットされています.</p>
<p><code>statsmodels</code>では,そのための<code>plot_partregress_grid</code>というメソッドが準備されています.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.regressionplots <span class="im">import</span> plot_partregress_grid</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>,<span class="dv">8</span>))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>plot_partregress_grid(result, fig<span class="op">=</span>fig)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="../images/ch11-multi-regression7.png" /></p>
<p>このグラフでは他の変数の影響を取り除いた上でのYと<span class="math inline">X_i</span>の関係を可視化する手法であり,回帰直線の傾きが大きいほど他の変数の影響を取り除いた上での<span class="math inline">X_i</span>のYへの影響力が強いことが分かります.</p>


<!-- 前後の章へのナビゲーション -->
<div class="chapter-navigation">
    <nav>
        
            <a class="nav-link prev" href="slds10.html">← Previous Chapter</a>
        
        
            <a class="nav-link next" href="slds12.html">Next Chapter →</a>
        
    </nav>
</div>

    <div style="clear: both"></div>

    <div id="footer">
        Site proudly generated by
        <a href="http://jaspervdj.be/hakyll">Hakyll</a>.
    </div>
</div>


    <!-- GUID -->
    <div style="display: none">ce0f13b2-4a83-4c1c-b2b9-b6d18f4ee6d2</div>




    <!-- JavaScript TOC generator (only runs on lecture pages) -->
    <script>
    document.addEventListener("DOMContentLoaded", function() {
      var tocContainer = document.getElementById('lecture-toc');
      if (!tocContainer) return;

      // メインコンテンツから h2, h3, h4 を抽出
      var content = document.querySelector('article') || document.getElementById('content') || document.body;
      var headings = content.querySelectorAll('h2, h3, h4');
      if (headings.length === 0) return;

      // 目次用のUL要素を作成
      var tocList = document.createElement('ul');

      // 章番号カウンタ (h2, h3, h4に対応して配列を用意)
      var chapterNumbers = [0, 0, 0];

      headings.forEach(function(heading) {
        if (heading.closest('li')) return;

        var level;
        switch (heading.tagName.toLowerCase()) {
          case 'h2': level = 0; break;
          case 'h3': level = 1; break;
          case 'h4': level = 2; break;
          default: return;
        }

        chapterNumbers[level]++;
        for (var i = level + 1; i < chapterNumbers.length; i++) {
          chapterNumbers[i] = 0;
        }


        var li = document.createElement('li');
        li.classList.add('toc-level-' + (level + 1));

        var anchor = document.createElement('a');
        anchor.href = '#' + heading.id;
        anchor.textContent =  heading.textContent;

        li.appendChild(anchor);
        tocList.appendChild(li);
      });

      tocContainer.appendChild(tocList);
    });
    </script>
     <script>
  document.addEventListener("DOMContentLoaded", function() {
    // すべての <pre><code> 要素を走査
    const codeBlocks = document.querySelectorAll('pre code');
    codeBlocks.forEach(function(codeBlock) {
      // 親<pre>要素を取得
      const pre = codeBlock.parentNode;

      // <pre> を相対配置にし、子要素を絶対配置できるようにする
      pre.style.position = 'relative';

      // コピーボタンを作成
      const copyButton = document.createElement('button');
      copyButton.textContent = 'Copy';
      // ボタンのデザインはCSSで指定するのが望ましいが、簡易的にスタイルを直接指定する例:
      copyButton.style.position = 'absolute';
      copyButton.style.top = '8px';
      copyButton.style.right = '8px';
      copyButton.style.backgroundColor = '#add8e6'; // 水色
      copyButton.style.color = '#fff';             // 白文字
      copyButton.style.border = 'none';
      copyButton.style.padding = '6px 10px';
      copyButton.style.borderRadius = '4px';
      copyButton.style.cursor = 'pointer';

      // クリックされたらクリップボードにコピー
      copyButton.addEventListener('click', function() {
        const codeText = codeBlock.innerText;
        navigator.clipboard.writeText(codeText).then(function() {
          copyButton.textContent = 'Copied!';
          setTimeout(function() {
            copyButton.textContent = 'Copy';
          }, 2000);
        }, function(err) {
          console.error('Failed to copy: ', err);
        });
      });

      // ボタンを <pre> の子要素として挿入
      pre.appendChild(copyButton);
    });
  });
  </script>
  <script>
    function toggleMenu() {
      var nav = document.getElementById('navigation');
      nav.classList.toggle('open');
    }
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      var mathElements = document.querySelectorAll('.math');
      for (var i = 0; i < mathElements.length; i++) {
        var texText = mathElements[i].firstChild
        if (mathElements[i].tagName == "SPAN") {
            katex.render( texText.data
                        , mathElements[i]
                        , { displayMode: mathElements[i].classList.contains("display")
                          , throwOnError: true
                         }
                        );
          }
      }
    });
  </script>

  </body>
</html>