<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>yakagika - 特別講義DS Ch8 データの可視化</title>

    <!-- Stylesheets. -->
    <link rel="stylesheet" type="text/css" href="../style.css?v=0">

    <!-- RSS. -->
    <link rel="alternate" type="application/rss+xml" title="yakagika" href="https://yakagika.github.io/rss.xml">

    <!-- Metadata. -->

    <meta name="keywords" content="yakagika Haskell ExchangeAlgebra">
    <meta name="description" content="Personal home page and blog of yakagika.">

    
    <!-- KaTeXのスタイルシートとJavaScriptのリンクを動的に挿入 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" integrity="sha384-wcIxkf4k558AjM3Yz3BBFQUbk/zgIYC2R0QpeeYb+TwlBVMrlgLqwRjRtGZiK7ww" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js" integrity="sha384-hIoBPJpTUs74ddyc4bFZSM1TVlQDA60VBbJS0oA934VSz82sBx1X7kSx2ATBDIyd" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
    <style>
      .katex-display {
        display: block;
        margin: 1em 0;
        text-align: center;
      }
      .katex .frac {
        vertical-align: baseline;
        -webkit-vertical-align: baseline;
      }
      .katex .sqrt {
        vertical-align: baseline;
        -webkit-vertical-align: baseline;
      }
      .katex .strut {
        height: 1em;
        -webkit-height: 1em;
      }
      .katex .base {
        font-family: 'KaTeX_Main', 'Arial', sans-serif;
      }
      @media screen and (-webkit-min-device-pixel-ratio:0) {
        .katex {
          line-height: normal !important;
        }
      }
      @media not all and (min-resolution: .001dpcm) {
        @supports (-webkit-appearance:none) {
          .katex {
            line-height: normal !important;
          }
        }
      }
    </style>
    

    
      <meta property="og:description" content="資料" />
    
  </head>

  <body>

    <!-- ハンバーガーメニューのボタン（小画面時に表示） -->
    <div class="hamburger" onclick="toggleMenu()">☰</div>

    <!-- ナビゲーションに drawer-menu クラスを付与 -->
    <div id="navigation" class="drawer-menu">
      <h1>Contents</h1>
      <a href="../">Home</a>
      <a href="../posts.html">Blog</a>
      <a href="../lectures.html">Lecture</a>
      <a href="../research.html">Research</a>
      <a href="../contact.html">Contact</a>
      <!-- <a href="/cv.html">CV</a> -->

      <h1>Links</h1>
      <a href="http://github.com/yakagika" target="_blank" rel="noopener">GitHub</a>
      <a href="https://researchmap.jp/k-akagi" target="_blank" rel="noopener">researchmap</a>

      
      <div id="lecture-toc">
        <h1>Table of Contents</h1>
        <!-- The TOC will be generated here by JavaScript -->
      </div>
      
    </div>

    <div id="content">
    <h1>特別講義DS Ch8 データの可視化</h1>
<div class="soft">
    資料<br />
    Published on 2024-03-29 under the tag <a title="All pages tagged 'datascience'." href="../tags/datascience.html">datascience</a>, <a title="All pages tagged 'statistics'." href="../tags/statistics.html">statistics</a>, <a title="All pages tagged 'python'." href="../tags/python.html">python</a>
</div>

<!-- 前後の章へのナビゲーション -->
<div class="chapter-navigation">
    <nav>
        
            <a class="nav-link prev" href="slds7.html">← Previous Chapter</a>
        
        
            <a class="nav-link next" href="slds9.html">Next Chapter →</a>
        
    </nav>
</div>

<br>

<h2 id="データの可視化">データの可視化</h2>
<p>ここまでで,プログラミングを利用してデータを読み込み,編集ができるようになりました. これから,データを分析する手法を学習しましょう. データ分析の第一歩は,データの<strong>可視化</strong>です.</p>
<p>統計データはテーブル形式のまま,眺めても理解できません. データを可視化することで,データの特徴や意味を理解する助けになります. ここでは,データを可視化するいくつかの方法を学びましょう.</p>
<div class="note">
<ul>
<li><h3 id="ライブラリのインストール">ライブラリのインストール</h3></li>
</ul>
<p>Pythonにおけるグラフ作成の,代表的なライブラリには,<a href="https://matplotlib.org"><code>matplotlib</code></a>や<a href="https://seaborn.pydata.org"><code>seaborn</code></a>があります.
それぞれ, <code>pip install</code>しておきましょう.</p>
<p><code>matplotlib</code>,<code>seaborn</code>はそれぞれ以下のようにインポートするのが一般的です.</p>
<ul>
<li><p><code>import matplotlib.pyplot as plt</code></p></li>
<li><p><code>import searborn as sns</code></p></li>
</ul>
</div>
<div class="warn">
<ul>
<li><h3 id="matplotlibにおける日本語表示"><code>matplotlib</code>における日本語表示</h3>
<code>matplotlib</code>は日本語などのマルチバイト文字に対応しておらず,日本語を使用すると日本語部分が日本語部分が, □(通称豆腐)に変わります.</li>
</ul>
<p>例: ｢Hello こんにちは｣ → ｢Hello □ □ □ □ □ ｣</p>
<p><code>matplotlib</code>で日本語を利用する方法として一番簡単なものに, <code>japanize-matplotlib</code>の利用があります.
<code>pip install</code> したあとに, <code>import japanize_matplotlib</code> をしましょう(<code>pip</code> では <code>'-'</code>(ハイフン)ですが,<code>import</code>文では,<code>'_'</code>(アンダーバー)なので注意してください.)</p>
</div>
<div class="warn">
<ul>
<li>Python 3.12 における<code>japanize_matplotlib</code></li>
</ul>
<p>Python3.12では,<code>japanize_matplotlib</code>を読み込もうとすると,<code>ModuleNotFoundError: No module named 'distutils'</code> と表示されます.</p>
<p>これは,<code>japanize_matplotlib</code>内で利用されている<code>distutils</code>というモジュールが廃止されたことによります. こちらのエラーは, <code>distutils</code>の代替である<code>setuptools</code>を <code>pip install</code>することで消えます.</p>
<p>参考: <a href="https://qiita.com/pitao/items/1740a62ddee797aed807">【inshellisense】ModuleNotFoundError: No module named ’distutils’の対処法</a></p>
</div>
<p>本章におけるコードは以下, 先頭に以下のような記述があることが前提となります.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> japanize_matplotlib</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code></pre></div>
<h3 id="基礎的なグラフ棒グラフ円グラフ折れ線グラフ">基礎的なグラフ(棒グラフ,円グラフ,折れ線グラフ)</h3>
<p><code>matplotlib</code>を利用して,グラフを作成する大まかな手順は以下のようになります.</p>
<div class="note">
<ol type="1">
<li><p>データを準備する.
BOMなしのCSVを作りましょう</p></li>
<li><p><code>pandas</code>でプログラムでCSVを読み込みましょう</p></li>
<li><p>グラフにしたい部分を抽出します.</p>
<p>グラフを作るために何が必要かはグラフの種類によります.</p></li>
<li><p><code>matplotlib</code>のメソッドを利用してグラフを生成します.</p>
<p>基本的なメソッドは以下のとおりです.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">グラフの種類</th>
<th style="text-align: center;">メソッド</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">棒グラフ</td>
<td style="text-align: center;"><code>plt.bar(x軸のリスト,y軸のリスト)</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;">円グラフ</td>
<td style="text-align: center;"><code>plt.pie(カテゴリー別のデータのリスト,label=ラベル)</code></td>
</tr>
<tr class="even">
<td style="text-align: center;">折れ線グラフ</td>
<td style="text-align: center;"><code>plt.plot(x軸のリスト,y軸のリスト)</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;">散布図</td>
<td style="text-align: center;"><code>plt.scatter(x軸のリスト,y軸のリスト)</code></td>
</tr>
</tbody>
</table>
<p>これら以外の,グラフに関しては個別に扱います.</p></li>
<li><p>グラフの見た目を整えます.</p>
<p>ある程度自動で設定されますが,色,メモリ,形,軸などを個別に設定できます.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">グラフの要素</th>
<th style="text-align: center;">メソッド</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">タイトル</td>
<td style="text-align: center;"><code>plt.title('タイトル')</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;">判例</td>
<td style="text-align: center;"><code>plt.legend()</code></td>
</tr>
<tr class="even">
<td style="text-align: center;">y軸</td>
<td style="text-align: center;"><code>plt.yticks(軸の目盛のリスト)</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;">x軸</td>
<td style="text-align: center;"><code>plt.xticks(軸の目盛のリスト)</code></td>
</tr>
<tr class="even">
<td style="text-align: center;">y軸ラベル</td>
<td style="text-align: center;"><code>plt.ylabel('ラベル')</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;">x軸ラベル</td>
<td style="text-align: center;"><code>plt.xlabel('ラベル')</code></td>
</tr>
<tr class="even">
<td style="text-align: center;">補助線の追加</td>
<td style="text-align: center;"><code>plt.minorticks_on()</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;"><code>plt.grid(which='both')</code></td>
</tr>
<tr class="even">
<td style="text-align: center;">表示領域</td>
<td style="text-align: center;"><code>plt.ylim(min,max)</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;"><code>plt.xlim(min,max)</code></td>
</tr>
</tbody>
</table></li>
<li><p><code>plt.show()</code>でグラフを出力.</p></li>
</ol>
<p>ポップアップウィンドウでグラフが表示されます.</p>
<ol start="8" type="1">
<li>グラフの保存</li>
</ol>
<p>ポップアップウィンドウの保存ボタンを押すことで画像に名前をつけて保存することが可能です.</p>
<figure>
<img src="../images/graph_size_setting.png" alt="画像の表示" />
<figcaption aria-hidden="true">画像の表示</figcaption>
</figure>
</div>
<p>例えば,以下のコードで次のグラフが表示されます.
<code>np.arange(0,100,1)</code>は,<code>0</code>から<code>100</code>までの数値を<code>1</code>ずつ増える<code>numpy</code>の配列を生成しています.
<code>[x for x in range(0,101,1)]</code> でも同様の結果となります.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>plt.plot(np.arange(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">1</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>        ,np.arange(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">1</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        ,color<span class="op">=</span><span class="st">'red'</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        ,label<span class="op">=</span><span class="st">'sample'</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'title'</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="dv">0</span>,<span class="dv">100</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="dv">0</span>,<span class="dv">100</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>plt.xticks(np.arange(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">10</span>))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>plt.yticks(np.arange(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">10</span>))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>plt.minorticks_on()</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>plt.grid(which<span class="op">=</span><span class="st">'both'</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'x_label'</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'y_label'</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="../images/python_graph_elem.png" alt="グラフの要素" />
<figcaption aria-hidden="true">グラフの要素</figcaption>
</figure>
<div class="warn">
<p>画像は<code>plt.show()</code>で表示されるポップアップウィンドウを立ち上げなくても,<code>plt.savefig('figure.png')</code>と記述することで保存することができます.</p>
<p>ただし,<code>plt.show()</code>をして自分でポップアップウィンドウを閉じないと,<code>plt.</code>による設定がメモリに保存されたままになります.</p>
<p><code>plt.show()</code>を実行しない場合は必ず最後に<code>plt.close()</code>を追加してメモリを開放しましょう.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>plt.plot(np.arange(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">1</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>        ,np.arange(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">1</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        ,color<span class="op">=</span><span class="st">'red'</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        ,label<span class="op">=</span><span class="st">'sample'</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'figure.png'</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code></pre></div>
</div>
<h4 id="棒グラフの作成">棒グラフの作成</h4>
<p><a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/bar_pie.csv">こちら</a>からデータをダウンロードし,棒グラフを作成してみましょう.</p>
<p>まずはデータを確認します.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import 部分は省略されています</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dataフォルダにあるbar_pie.csvというファイルを読み込みます.</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;data/bar_pie.csv&quot;</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 読み込んだファイルの中身を見てみます.</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">    cat dog bird</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">0    10  12   20</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>プログラムは読み込むデータと,作りたいグラフの形によって変化します.
どのようなデータが必要かを意識して,データを抽出しましょう.</p>
<div class="note">
<p>棒グラフの作成に必要なデータは,</p>
<ul>
<li><code>棒毎のラベル</code></li>
</ul>
<p>それぞれの棒の名前です.文字列で指定します.
今回は<code>'cat'</code>,<code>'dog'</code>,<code>'bird'</code>とします.</p>
<ul>
<li><code>棒毎のx軸の位置</code></li>
</ul>
<p>棒グラフの位置は,<code>0</code>から始まる整数の列として指定します.
今回は,<code>0</code>,<code>1</code>,<code>2</code>を指定します.</p>
<ul>
<li><code>棒毎の高さ</code>になります.</li>
</ul>
<p>高さに<code>10</code>,<code>12</code>,<code>20</code>を指定します.</p>
</div>
<div class="sourceCode" id="cb5"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 棒グラフのラベルを抽出します</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># df.columns でDataFrameからHeaderを抽出し,</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># list()関数でDataFrameからlist型に変換しています</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> <span class="bu">list</span>(df.columns)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 棒グラフのx軸のどこに置くのかを指定しています.</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># np.arange(x) は [0,1,..,x]というarrayを作ります.</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>x_position <span class="op">=</span> np.arange(<span class="bu">len</span>(labels))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">#棒グラフの高さを抽出します</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># メソッド icloc[x]はDataFrameのx行目を抽出します.</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> <span class="bu">list</span>(df.iloc[<span class="dv">0</span>])</span></code></pre></div>
<p>抽出した情報を元に,棒グラフを作成します.
<code>plt.bar(X軸のリスト,Y軸のリスト)</code>の形で,データを指定します.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 棒グラフを作成します.</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># x 軸 にx_position</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># それぞれの棒グラフの高さにvaluesを与えています.</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># その他にも沢山の引数があります.</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>plt.bar(x<span class="op">=</span>x_position, height<span class="op">=</span>values)</span></code></pre></div>
<p>このままだと,X軸のラベルに何も記述されないので,
<code>plt.xticks(ラベルの位置のリスト,ラベルのリスト)</code>で,ラベルを指定します.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ラベルの位置を指定します.</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>plt.xticks(ticks<span class="op">=</span>x_position,labels<span class="op">=</span>labels)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Y軸ラベルを指定します</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;number&quot;</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># タイトルを指名します</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;kind&quot;</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># グラフの表示</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="../images/bar_graph.png" alt="棒グラフの表示" />
<figcaption aria-hidden="true">棒グラフの表示</figcaption>
</figure>
<p>表示されたグラフは, 保存ボタンで画像として保存できます.</p>
<p>グラフ作成の基本は,これで終わりです.あとは,それぞれのグラフ毎に<code>plt.bar()</code>の部分を使い分け,グラフのデザインを変更することで,様々なグラフが作成できます.</p>
<p>グラフのデザインに関する要素は,無数にあるためこの講義ですべてを扱うことはできませんが,いくつかの要素を実際に変更してみましょう.</p>
<h4 id="色の変更">色の変更</h4>
<p>matplotlibではグラフの各部に以下の色を指定できます.
これ以外の指定の仕方もあります.色の変え方は,それぞれのグラフで異なります.</p>
<figure>
<img src="../images/graph_color.png" alt="グラフの色" />
<figcaption aria-hidden="true">グラフの色</figcaption>
</figure>
<p>棒グラフは<code>plt.bar(color=棒毎の色のリスト)</code>の形で棒ごとに色を指定することができます.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 棒グラフの色を指定します.</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1つ目 red</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2つ目 blue</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 3つ目 yellow</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>color_list <span class="op">=</span> [<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;yellow&quot;</span>]</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 引数に色の指定をします</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>plt.bar(color<span class="op">=</span>color_list, x<span class="op">=</span>x_position, height<span class="op">=</span>values)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">#ラベルの位置を指定します.</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>plt.xticks(ticks<span class="op">=</span>x_position,labels<span class="op">=</span>labels)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># yラベルを指定します</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;number&quot;</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># タイトルを指名します</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;kind&quot;</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co"># グラフの表示</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="../images/bar_graph_color.png" alt="棒グラフの色の変更" />
<figcaption aria-hidden="true">棒グラフの色の変更</figcaption>
</figure>
<h4 id="スタイルの変更">スタイルの変更</h4>
<p>毎回細かなデザインを自分で調整すると手間なので,デフォルトで準備されているスタイルを利用すると楽です.</p>
<p>matplotlibではいくつかのデフォルトのスタイルが準備されています. 使用可能なスタイルは,plt.style.available で確認できます.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Python</span> 3.12.3 <span class="er">(</span><span class="ex">main,</span> Jun  3 2024, 08:31:31<span class="kw">)</span> <span class="ex">[Clang</span> 15.0.0 <span class="er">(</span><span class="ex">clang-1500.3.9.4</span><span class="kw">)</span><span class="ex">]</span> on darwin</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Type</span> <span class="st">&quot;help&quot;</span>, <span class="st">&quot;copyright&quot;</span>, <span class="st">&quot;credits&quot;</span> or <span class="st">&quot;license&quot;</span> for more information.</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> import <span class="ex">matplotlib.pyplot</span> as plt</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> plt.style.available</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="ex">[</span><span class="st">'Solarize_Light2'</span><span class="ex">,</span> <span class="st">'_classic_test_patch'</span>, <span class="st">'_mpl-gallery'</span>, <span class="st">'_mpl-gallery-nogrid'</span>, <span class="st">'bmh'</span>, <span class="st">'classic'</span>, <span class="st">'dark_background'</span>, <span class="st">'fast'</span>, <span class="st">'fivethirtyeight'</span>, <span class="st">'ggplot'</span>, <span class="st">'grayscale'</span>, <span class="st">'seaborn-v0_8'</span>, <span class="st">'seaborn-v0_8-bright'</span>, <span class="st">'seaborn-v0_8-colorblind'</span>, <span class="st">'seaborn-v0_8-dark'</span>, <span class="st">'seaborn-v0_8-dark-palette'</span>, <span class="st">'seaborn-v0_8-darkgrid'</span>, <span class="st">'seaborn-v0_8-deep'</span>, <span class="st">'seaborn-v0_8-muted'</span>, <span class="st">'seaborn-v0_8-notebook'</span>, <span class="st">'seaborn-v0_8-paper'</span>, <span class="st">'seaborn-v0_8-pastel'</span>, <span class="st">'seaborn-v0_8-poster'</span>, <span class="st">'seaborn-v0_8-talk'</span>, <span class="st">'seaborn-v0_8-ticks'</span>, <span class="st">'seaborn-v0_8-white'</span>, <span class="st">'seaborn-v0_8-whitegrid'</span>, <span class="st">'tableau-colorblind10'</span>]</span></code></pre></div>
<p>それぞれのスタイルのイメージは<a href="https://matplotlib.org/stable/gallery/style_sheets/style_sheets_reference.html">こちら</a>で確認できます.</p>
<p>スタイルは<code>plt.style.use('スタイル名')</code>で指定し,以降のコード全てに適用されます.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># スタイル 'ggplot' を使ってみます</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">'ggplot'</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 引数に色の指定をします</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>plt.bar(x<span class="op">=</span>x_position, height<span class="op">=</span>values)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#ラベルの位置を指定します.</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>plt.xticks(ticks<span class="op">=</span>x_position,labels<span class="op">=</span>labels)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># yラベルを指定します</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;number&quot;</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># タイトルを指名します</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;kind&quot;</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># グラフの表示</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="../images/bar_graph_style.png" alt="スタイルの適用" />
<figcaption aria-hidden="true">スタイルの適用</figcaption>
</figure>
<h4 id="要素の追加">要素の追加</h4>
<p>グラフに新しい要素を付け加えるのも簡単です.</p>
<p><code>plt.show()</code>までの間に,グラフを宣言することで,複数のグラフを重ねることが可能です.
ここでは, 異なる色の棒グラフを追加しています.</p>
<p>また, <code>plt.legend()</code>によって凡例を追加しています.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># スタイル seaborn を使ってみます</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">'seaborn'</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 棒グラフを2つ並べます</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>plt.bar(color<span class="op">=</span><span class="st">'red'</span>, x<span class="op">=</span>x_position, width<span class="op">=</span><span class="fl">0.3</span>,height<span class="op">=</span>values)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>plt.bar(color<span class="op">=</span><span class="st">'blue'</span>,x<span class="op">=</span>x_position<span class="op">+</span><span class="fl">0.3</span>, width<span class="op">=</span><span class="fl">0.3</span>,height<span class="op">=</span>[<span class="dv">11</span>,<span class="dv">15</span>,<span class="dv">14</span>])</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#凡例を追加します</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># loc で位置を指定します</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 上下 upper center lower</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 左右 left center right</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">'2020'</span>,<span class="st">'2000'</span>], loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">#ラベルの位置を指定します.</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>plt.xticks(ticks<span class="op">=</span>x_position<span class="op">+</span><span class="fl">0.15</span>,labels<span class="op">=</span>labels)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co"># yラベルを指定します</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;number&quot;</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co"># タイトルを指名します</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;kind&quot;</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co"># グラフの表示</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="../images/bar_graph_style2.png" alt="凡例の追加" />
<figcaption aria-hidden="true">凡例の追加</figcaption>
</figure>
<p>デザインのすべてのパターンをここで扱うことは出来ないので,
やりたいことに応じて,
<a href="https://matplotlib.org/stable/users/index">matplotlubの公式ドキュメント</a>を確認しましょう.</p>
<h3 id="円グラフ">円グラフ</h3>
<p>先ほどと同じデータ<code>bar_pie.csv</code>を利用して円グラフを作成してみます.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">header1 header2 header3 ...</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">value1  value2  value3  ...</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">の形のcsvから棒グラフを作成する</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># dataフォルダにあるbar_pie.csvというファイルを読み込みます.</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;data/bar_pie.csv&quot;</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 読み込んだファイルの中身を見てみます.</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 棒グラフのラベルを抽出します</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># df.columns でDataFrameからHeaderを抽出し,</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># list()関数でDataFrameからlist型に変換しています</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> <span class="bu">list</span>(df.columns)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co"># メソッド icloc[x]はDataFrameのx行目を抽出します.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> <span class="bu">list</span>(df.iloc[<span class="dv">0</span>])</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 円グラフの作成</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>plt.pie(values, labels<span class="op">=</span>labels, autopct<span class="op">=</span><span class="st">'</span><span class="sc">%1.1f%%</span><span class="st">'</span>)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="co"># タイトルを指名します</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;kind&quot;</span>)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="co"># グラフの表示</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>円グラフは, <code>plt.pie()</code>にそれぞれの領域の割合と,ラベルを与えることで,作成できます.
グラフに数字を表示するには,<code>autopct=</code>に<code>フォーマット文字列</code>で表示内容を指定します.
上記の例では<code>'%1.1f%%'</code>と書くことで,小数点1桁まで数値を表示しています.</p>
<figure>
<img src="../images/pie_graph1.png" alt="円グラフ" />
<figcaption aria-hidden="true">円グラフ</figcaption>
</figure>
<div class="note">
<ul>
<li>演習</li>
</ul>
<p><a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/pie_chart_practice.csv">円グラフデータ</a>,<a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/line_chart_practice.csv">折れ線グラフデータ2</a>,<a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/bar_chart_practice.csv">棒グラフデータ3</a>を利用し,それぞれのグラフを作成してください.
表示が必要だと思われるデザインを設定してください.</p>
</div>
<h3 id="for文を利用したグラフ">for文を利用したグラフ</h3>
<p>これまでのように単純な一つのグラフを作成するだけであれば,恐らくExcelなどのほうが手軽ですが,多数のグラフを作成したり, 複数のデータを組み合わせた複雑なグラフを作成する場合にはプログラミングの方が便利になります.</p>
<p>例えば<a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/temperature_10location.csv">こちら</a>のデータを利用して棒グラフを作成することを考えてみましょう.このデータは10箇所の気温が記録された時系列データです.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>          <span class="ex">Date</span>  Location_1  Location_2  ...  Location_8  Location_9  Location_10</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>   2023-01-01   18.211700   21.553371  ...   18.665620   29.108637    21.634069</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   2023-01-02   15.108630   16.172744  ...   20.135756    9.212193    24.209877</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>   2023-01-03   14.938279   24.593193  ...   16.778431   22.291269    19.815977</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>   2023-01-04   20.640249   18.862405  ...   13.282269   16.040627    15.993132</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>   2023-01-05   14.218562   16.281882  ...   15.729466   24.951213    18.053277</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="ex">..</span>         ...         ...         ...  ...         ...         ...          ...</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="ex">95</span>  2023-04-06   21.312739   19.613363  ...   16.497553   20.446656    13.644605</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="ex">96</span>  2023-04-07   26.388210   31.533854  ...   18.999736   15.603714    19.215097</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="ex">97</span>  2023-04-08   16.914329   20.479892  ...   21.698464   17.705697    16.867517</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="ex">98</span>  2023-04-09   14.316258   17.841650  ...   31.885071   20.816917    16.895196</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="ex">99</span>  2023-04-10   23.595042   19.896247  ...   17.534881   15.180066    15.104460</span></code></pre></div>
<p>このデータの<code>Location_1</code>から<code>Location_10</code>までの折れ線グラフを一つのグラフに表示することを考えてみます.</p>
<p><code>matplotlib</code>では, <code>plt.show()</code>までに要素を重ねることで複数のグラフを重ねることができます.</p>
<p>例えば,10本の折れ線グラフを表示する場合,一つ一つ手書きすると以下のようになります.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'data/temperature_10location.csv'</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#'Date'列を日付型に変更しています.</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Date'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'Date'</span>])</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">#一つ一つ手書きする方法</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>plt.plot(df[<span class="st">'Date'</span>],df[<span class="st">'Location_1'</span>],label<span class="op">=</span><span class="st">'Location_1'</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>plt.plot(df[<span class="st">'Date'</span>],df[<span class="st">'Location_2'</span>],label<span class="op">=</span><span class="st">'Location_2'</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>plt.plot(df[<span class="st">'Date'</span>],df[<span class="st">'Location_3'</span>],label<span class="op">=</span><span class="st">'Location_3'</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>plt.plot(df[<span class="st">'Date'</span>],df[<span class="st">'Location_4'</span>],label<span class="op">=</span><span class="st">'Location_4'</span>)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>plt.plot(df[<span class="st">'Date'</span>],df[<span class="st">'Location_5'</span>],label<span class="op">=</span><span class="st">'Location_5'</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>plt.plot(df[<span class="st">'Date'</span>],df[<span class="st">'Location_6'</span>],label<span class="op">=</span><span class="st">'Location_6'</span>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>plt.plot(df[<span class="st">'Date'</span>],df[<span class="st">'Location_7'</span>],label<span class="op">=</span><span class="st">'Location_7'</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>plt.plot(df[<span class="st">'Date'</span>],df[<span class="st">'Location_8'</span>],label<span class="op">=</span><span class="st">'Location_8'</span>)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>plt.plot(df[<span class="st">'Date'</span>],df[<span class="st">'Location_9'</span>],label<span class="op">=</span><span class="st">'Location_9'</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>plt.plot(df[<span class="st">'Date'</span>],df[<span class="st">'Location_10'</span>],label<span class="op">=</span><span class="st">'Location_10'</span>)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">15</span>) <span class="co">#x軸を15度傾かせています</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="../images/temperature_10location.png" alt="10本の折れ線グラフ" />
<figcaption aria-hidden="true">10本の折れ線グラフ</figcaption>
</figure>
<p>10本程度であれば,まだ書けなくもありませんが,それでも手間がかかります.こういった繰り返しの作業は<code>for文</code>を利用しましょう.</p>
<p><code>for文</code>を利用した場合には以下のようになります.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> df.columns[<span class="dv">1</span>:]:</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    plt.plot(df[<span class="st">'Date'</span>],df[x],label<span class="op">=</span>x)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>グラフの内容は同じですが,こちらのほうが労力が少なく,コードもスッキリしており,何か修正を加える場合でも修正箇所が少なくて済みます.
繰り返し作業は積極的に<code>for文</code>や<code>while文</code>を利用するようにしましょう.</p>
<h3 id="グラフの分割">グラフの分割</h3>
<p>先程は一つのグラフ内に複数の折れ線グラフを表示しましたが,個別に表示する場合にはどのようになるでしょうか.
一つの方法として,以下の用に複数のグラフを個別に作成することも可能です.
(先に保存先のディレクトリ <code>result/multi_plot</code> を作成しておきましょう.)</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> df.columns[<span class="dv">1</span>:]:</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    plt.plot(df[<span class="st">'Date'</span>],df[x])</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    plt.title(x)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="st">'result/multi_plot/'</span> <span class="op">+</span> x <span class="op">+</span> <span class="st">'.png'</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    plt.close()</span></code></pre></div>
<figure>
<img src="../images/temperature_10location2.png" alt="保存された10個のグラフ" />
<figcaption aria-hidden="true">保存された10個のグラフ</figcaption>
</figure>
<p>しかし,レポートなどに10枚の画像を貼り付けるのは手間がかかりますし,余白など無駄も多いです.</p>
<ul>
<li>subplots()</li>
</ul>
<p><code>matplotlib</code>には1枚の画像を分割して複数のグラフを載せるためのメソッド<code>.subplots()</code>があるので,関連するグラフや比較のためのグラフなどはできるだけ1枚の画像に集約しましょう.</p>
<p><code>.subplots()</code>は1枚の画像を<code>n行</code>,<code>n列</code>に分割し,それぞれの領域にグラフを描画します.</p>
<p>各領域は <code>axes</code>などと呼ばれ,画像全体を<code>figure</code>などと呼びます.
利用するためには,まず <code>fig, axes = plt.subplot()</code>の形で宣言します. 引数として,行数は<code>nrows=</code>,列数は<code>ncols=</code>にそれぞれ<code>int</code>で指定します.</p>
<figure>
<img src="../images/figure_axes.png" alt="FigureとAxes" />
<figcaption aria-hidden="true">FigureとAxes</figcaption>
</figure>
<div class="sourceCode" id="cb17"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplot(nrows<span class="op">=</span> <span class="dv">5</span> <span class="co">#行数の指定</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                       ,ncols<span class="op">=</span> <span class="dv">2</span> <span class="co">#列数の指定</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                        )</span></code></pre></div>
<p>宣言のあと,各領域のグラフを <code>axes[行,列]</code>の形で指定していきます.行や列は<code>0</code>から始まるので注意してください.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].plot(df[<span class="st">'Date'</span>],df[<span class="st">'Location_1'</span>],label<span class="op">=</span><span class="st">'Location_1'</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].plot(df[<span class="st">'Date'</span>],df[<span class="st">'Location_2'</span>],label<span class="op">=</span><span class="st">'Location_2'</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].plot(df[<span class="st">'Date'</span>],df[<span class="st">'Location_3'</span>],label<span class="op">=</span><span class="st">'Location_3'</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].plot(df[<span class="st">'Date'</span>],df[<span class="st">'Location_4'</span>],label<span class="op">=</span><span class="st">'Location_4'</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>,<span class="dv">0</span>].plot(df[<span class="st">'Date'</span>],df[<span class="st">'Location_5'</span>],label<span class="op">=</span><span class="st">'Location_5'</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>,<span class="dv">1</span>].plot(df[<span class="st">'Date'</span>],df[<span class="st">'Location_6'</span>],label<span class="op">=</span><span class="st">'Location_6'</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">3</span>,<span class="dv">0</span>].plot(df[<span class="st">'Date'</span>],df[<span class="st">'Location_7'</span>],label<span class="op">=</span><span class="st">'Location_7'</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">3</span>,<span class="dv">1</span>].plot(df[<span class="st">'Date'</span>],df[<span class="st">'Location_8'</span>],label<span class="op">=</span><span class="st">'Location_8'</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">4</span>,<span class="dv">0</span>].plot(df[<span class="st">'Date'</span>],df[<span class="st">'Location_9'</span>],label<span class="op">=</span><span class="st">'Location_9'</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">4</span>,<span class="dv">1</span>].plot(df[<span class="st">'Date'</span>],df[<span class="st">'Location_10'</span>],label<span class="op">=</span><span class="st">'Location_10'</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>以下のようなグラフが作成されます. しかし, 少し見にくいですね.</p>
<figure>
<img src="../images/subplot1.png" alt="subplots" />
<figcaption aria-hidden="true">subplots</figcaption>
</figure>
<p><code>.subplots(sharex=True)</code>とすると,x軸を共有することができます.今回のグラフはx軸がすべて同じなので,共有してみましょう.
また,それぞれのグラフにタイトルを付けてみます.
更に,一つ一つ手で入力するのは手間なので<code>for文</code>を利用してみましょう.</p>
<p>タイトルを付けるには今までの<code>plt.title()</code>ではなく<code>axes[r,c].set_title()</code>になります. <code>axes</code>毎の要素に関しては<a href="https://matplotlib.org/stable/users/explain/axes/axes_intro.html">公式サイト</a>を参考にしてください.</p>
<figure>
<img src="https://matplotlib.org/stable/_images/anatomy.png" alt="axesの要素(https://matplotlib.orgより)" />
<figcaption aria-hidden="true">axesの要素(https://matplotlib.orgより)</figcaption>
</figure>
<div class="sourceCode" id="cb19"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span> <span class="dv">5</span> <span class="co">#行数の指定</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                        ,ncols<span class="op">=</span> <span class="dv">2</span> <span class="co">#列数の指定</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                        ,sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>):</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        col <span class="op">=</span> df.columns[<span class="dv">1</span>:]</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        axes[i,j].plot(df[<span class="st">'Date'</span>],df[col[count]])</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        axes[i,j].set_title(col[count])</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        axes[i,j].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>        count <span class="op">+=</span><span class="dv">1</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="../images/subplot2.png" alt="subplots" />
<figcaption aria-hidden="true">subplots</figcaption>
</figure>
<p>グラフ全体の要素は<code>fig.</code>の形で指定します.
タイトルを付ける場合は<code>fig.suptitle('title')</code>となります.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span> <span class="dv">5</span> <span class="co">#行数の指定</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                        ,ncols<span class="op">=</span> <span class="dv">2</span> <span class="co">#列数の指定</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                        ,sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>):</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        col <span class="op">=</span> df.columns[<span class="dv">1</span>:]</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>        axes[i,j].plot(df[<span class="st">'Date'</span>],df[col[count]])</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>        axes[i,j].set_title(col[count])</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        axes[i,j].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>        count <span class="op">+=</span><span class="dv">1</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">'subplots title'</span>)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="../images/subplot3.png" alt="subplots" />
<figcaption aria-hidden="true">subplots</figcaption>
</figure>
<div class="note">
<ul>
<li>flatten()</li>
</ul>
<p><code>for文</code>を二重ループで記述するのは大変なので,しばしば<code>axes.flatten()</code>を利用して,連番に変換すると便利です.</p>
<figure>
<img src="../images/figure_axes_flatten.png" alt="flatten" />
<figcaption aria-hidden="true">flatten</figcaption>
</figure>
<div class="sourceCode" id="cb21"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span> <span class="dv">5</span> <span class="co">#行数の指定</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                        ,ncols<span class="op">=</span> <span class="dv">2</span> <span class="co">#列数の指定</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                        ,sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">#連番に変換</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> axes.flatten()</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    col <span class="op">=</span> df.columns[<span class="dv">1</span>:][i] <span class="co">#countをiで共通化</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    axes[i].plot(df[<span class="st">'Date'</span>],df[col])</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    axes[i].set_title(col)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    axes[i].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">'subplots title'</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
</div>
<h3 id="度数分布表とヒストグラム">度数分布表とヒストグラム</h3>
<p>データを手に入れたら最初にデータを可視化してデータの特徴を掴む必要があります. データの特徴として重要なものに,データの<strong>分布</strong>があります.</p>
<div class="warn">
<ul>
<li><h3 id="分布の意味">分布の意味</h3></li>
</ul>
<p><strong>分布</strong>という語の詳細な意味に関しては,後ほど検定や回帰の章でも簡単に扱いますが,統計学入門において数理的に詳しく扱っています.</p>
<p>統計学入門を履修していない人はここでは,単に<strong>データの散らばり具合</strong>という意味として捉えておきましょう.</p>
</div>
<p>分布を可視化する手法として代表的なものに,<strong>度数分布表</strong>と,<strong>ヒストグラム</strong>があります. 1次元のデータの可視化において,度数分布表とヒストグラムは,<strong>データ分析のファーストステップ</strong>とも称される,重要な手法です. データを手に入れたらまずは度数分布表と,ヒストグラムを作成してみましょう.</p>
<h4 id="度数分布表">度数分布表</h4>
<div class="note">
<p><strong>度数分布表</strong>とは,データの数を区切られた範囲ごとに数え上げた表のことです. 質的データの場合は,データのカテゴリー毎に,量的データの場合は分析者が定めた区間毎にデータがいくつかるのかを数え上げます.</p>
<p>普通ヒストグラムというと,量的データを対象としたものをいいますが,ここではわかりやすさのために,質的データから見ていきましょう.</p>
<p>以下の表は,何かしらの商品の美味しさに関するアンケート結果です. 商品を食べて,｢とても美味しい｣と回答した人の人数が9人,｢不味い｣と回答した人の人数が5人であることなどがわかります.</p>
<p>このように<strong>データのカテゴリー別にその値が生じたケースの数</strong>を<strong>度数</strong>といい,<strong>度数を数え上げ表に整理したもの</strong>を<strong>度数分布表</strong>といいます.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">アンケート区分</th>
<th style="text-align: center;">度数</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">とても美味しい</td>
<td style="text-align: center;">9</td>
</tr>
<tr class="even">
<td style="text-align: center;">どちらかといえば美味しい</td>
<td style="text-align: center;">11</td>
</tr>
<tr class="odd">
<td style="text-align: center;">普通</td>
<td style="text-align: center;">34</td>
</tr>
<tr class="even">
<td style="text-align: center;">どちらかといえば不味い</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="odd">
<td style="text-align: center;">不味い</td>
<td style="text-align: center;">5</td>
</tr>
</tbody>
</table>
<p>度数の亜種には,以下のようなものがあり,それぞれによってデータの分布が把握できます.</p>
<ul>
<li><p>累積度数:</p>
<p>順序尺度データの度数を少ない方から足し上げた値</p></li>
<li><p>相対度数(構成比率):</p>
<p>度数の総和を100%としたときの構成比率</p></li>
<li><p>累積相対度数(累積比率):</p>
<p>相対度数を上から足し上げた値</p></li>
</ul>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">アンケート区分</th>
<th style="text-align: center;">度数</th>
<th style="text-align: center;">累積度数</th>
<th style="text-align: center;">相対度数</th>
<th style="text-align: center;">累積相対度数</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">とても美味しい</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">14%</td>
<td style="text-align: center;">14%</td>
</tr>
<tr class="even">
<td style="text-align: center;">どちらかといえば美味しい</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">17%</td>
<td style="text-align: center;">31%</td>
</tr>
<tr class="odd">
<td style="text-align: center;">普通</td>
<td style="text-align: center;">34</td>
<td style="text-align: center;">54</td>
<td style="text-align: center;">53%</td>
<td style="text-align: center;">84%</td>
</tr>
<tr class="even">
<td style="text-align: center;">どちらかといえば不味い</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">59</td>
<td style="text-align: center;">8%</td>
<td style="text-align: center;">92%</td>
</tr>
<tr class="odd">
<td style="text-align: center;">不味い</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">64</td>
<td style="text-align: center;">8%</td>
<td style="text-align: center;">100%</td>
</tr>
<tr class="even">
<td style="text-align: center;">計</td>
<td style="text-align: center;">64</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">100%</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p>度数分布表を作成することで,データがどの分類に偏っているのかなど,データの分布の傾向がつかめます. 度数分布表を見る場合には,相対度数や累積度数から<strong>データが一番多いカテゴリー</strong>,<strong>度数データの過半数が属するカテゴリー</strong>,<strong>データのほとんど(90%程度)が属するカテゴリー</strong>などに注目してみましょう.
上のデータでは,最も回答が多いのは｢普通｣であること, ｢とても美味しい｣｢どちらかといえば美味しい｣の回答が,31%であるのに対して,｢どちらかといえば不味い｣｢不味い｣の回答が18%であり,全体的にこの商品の味は高評価側に集中していることなどがわかります.</p>
</div>
<p>Pythonで度数分布表を作成するにはどのようにしたら良いのでしょうか. 質的データの場合は,ただそれぞれの値を数えればいいので,<code>for文</code>などを利用することも可能ですが,<code>pandas</code>の<code>value_counts()</code>メソッドを利用することで簡単に作成できます.</p>
<p><a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/diff_class.csv">こちら</a>のとある授業の難易度に関する質的データをダウンロードして度数分布表を作成してみましょう.</p>
<p>データは以下のように,｢難しすぎてついていけない｣,｢難しいが許容できる｣,｢ちょうどよい｣,｢簡単だが許容できる｣｢簡単すぎて退屈｣の5段階のカテゴリーが記述されています.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>         <span class="ex">Diff</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>   難しいが許容できる</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   簡単すぎて退屈</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>   難しいが許容できる</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>   簡単だが許容できる</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>      ちょうどよい</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="ex">..</span>        ...</span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> japanize_matplotlib</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> module.sturges <span class="im">as</span> st</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co">#データの読み込み</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'Data/diff.csv'</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co">#ヒストグラムを作りたいデータの列名を指定</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>target_column <span class="op">=</span> <span class="st">'Diff'</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co">#度数</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>freq <span class="op">=</span> df[target_column].value_counts(sort<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co">#順番の入れ替え</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>freq <span class="op">=</span> freq.reindex([<span class="st">'難しすぎてついていけない'</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>                    ,<span class="st">'難しいが許容できる'</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>                    ,<span class="st">'ちょうどよい'</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>                    ,<span class="st">'簡単だが許容できる'</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>                    ,<span class="st">'簡単すぎて退屈'</span>],axis<span class="op">=</span><span class="st">'index'</span>)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'度数'</span>,freq)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>rel_freq <span class="op">=</span> freq <span class="op">/</span> df[target_column].count()  <span class="co"># 相対度数</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>cum_freq <span class="op">=</span> freq.cumsum()  <span class="co"># 累積度数</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>rel_cum_freq <span class="op">=</span> rel_freq.cumsum()  <span class="co"># 相対累積度数</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>dist <span class="op">=</span> pd.DataFrame(</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>    {   <span class="st">&quot;Value&quot;</span>: freq.index,        <span class="co">#階級値</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Freq&quot;</span>: freq,               <span class="co">#度数</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Rel&quot;</span>: rel_freq,            <span class="co">#相対度数</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Cum&quot;</span>: cum_freq,            <span class="co">#累積度数</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;RelCum&quot;</span>: rel_cum_freq,     <span class="co">#相対累積度数</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>freq.index</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dist)</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>dist.to_csv(<span class="st">'frequency_table.csv'</span>,)</span></code></pre></div>
<p>保存されたcsv(<code>frequency_table.csv</code>)を確認してみると,度数分布表が作成されていることが確認できます.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Value</th>
<th style="text-align: center;">Freq</th>
<th style="text-align: center;">Rel</th>
<th style="text-align: center;">Cum</th>
<th style="text-align: center;">RelCum</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">難しすぎてついていけない</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.02247191</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.02247191</td>
</tr>
<tr class="even">
<td style="text-align: center;">難しいが許容できる</td>
<td style="text-align: center;">44</td>
<td style="text-align: center;">0.494382022</td>
<td style="text-align: center;">46</td>
<td style="text-align: center;">0.516853933</td>
</tr>
<tr class="odd">
<td style="text-align: center;">ちょうどよい</td>
<td style="text-align: center;">38</td>
<td style="text-align: center;">0.426966292</td>
<td style="text-align: center;">84</td>
<td style="text-align: center;">0.943820225</td>
</tr>
<tr class="even">
<td style="text-align: center;">簡単だが許容できる</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">0.04494382</td>
<td style="text-align: center;">88</td>
<td style="text-align: center;">0.988764045</td>
</tr>
<tr class="odd">
<td style="text-align: center;">簡単すぎて退屈</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.011235955</td>
<td style="text-align: center;">89</td>
<td style="text-align: center;">1</td>
</tr>
</tbody>
</table>
<p>質的データはあらかじめデータのカテゴリーが定められているのでその数を数えるだけで,度数分布表が作成できました.
それでは,カテゴリーが存在しない量的データではどのようにして度数分布表を作成するのでしょうか.</p>
<div class="note">
<ul>
<li><strong>量的データと度数分布表</strong></li>
</ul>
<p>量的データには当てはまるデータを数えるためのカテゴリーが存在しません. 年収のデータを考えた場合,年収1万円ごとに表を作ると1から数億まで,非常に細かくなります.
そこで,量的データで度数分布表を作成するには,100万円ごと,300万円ごとなどデータをいくつかの区間に分けて,区間別の度数を数える必要があります. ここで, 作られた区間を<strong>階級</strong>,階級の幅を<strong>階級幅</strong>,階級を代表する値を<strong>階級値</strong>といいます. 階級値は大抵の場合,区間の中間の値が用いられます(100万円~200万円の区間だとすると,150万円など).</p>
<p>以下の度数分布表は,ある情報クラスの成績(0-100点)を10点毎に区分したものです. それぞれの点数に当てはまる人数を数えて度数とします.</p>
<figure>
<img src="../images/histogram1.png" alt="度数分布表の例" />
<figcaption aria-hidden="true">度数分布表の例</figcaption>
</figure>
<p>量的データの階級数や階級幅は,100万円ごとなどある程度人間の判断によって作成しても構いませんが,数理的に決定する方法もあります.</p>
<p>階級幅は階級数が決まることで自動的に決まるため,階級数を決める一般的な目安として,<strong>スタージェスの公式</strong>が利用されます.</p>
<p>観測数を<span class="math inline"><em>n</em></span>,階級数を<span class="math inline"><em>k</em></span>とすると.</p>
<p><span class="math display">$$ k = 1 + log_2 n = \frac{log_{10} n}{log_{10} 2}$$</span></p>
<p>程度の<span class="math inline"><em>k</em></span>が望ましいとされています.</p>
<p>計算結果はおおよそ以下のようになります.</p>
<figure>
<img src="../images/sturges_number.png" alt="スタージェス数" />
<figcaption aria-hidden="true">スタージェス数</figcaption>
</figure>
</div>
<p>Pythonではスタージェス数は対数計算をするためのモジュール<code>math</code>を利用して以下のように求めることができます.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2進対数を返す math.log2() 関数などを利用するために必要なモジュール</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 関数名を sturgesNumber として引数をnとします</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sturgesNumber(n):</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 公式の通り k = 1 + log2 n</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 階級数は整数が良いので,math.floor()で小数点以下を切り捨てます</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (math.floor (<span class="dv">1</span> <span class="op">+</span> math.log2(n)))</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sturges(<span class="dv">2048</span>)) <span class="co">#&gt;&gt;&gt; 12</span></span></code></pre></div>
<p>階級数が決まることで階級幅が
<span class="math display">$$\frac{(データの最大値 - データの最小値)}{階級数}$$</span></p>
<p>として決まります.</p>
<p>それでは,<a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/histogram_quantitative.csv">こちら</a>のデータを利用して,度数分布表を作成してみます. 量的データの度数分布表を作成するには,<code>value-counts()</code>の引数<code>bins=</code>に各階級の終点を表すリストを指定します.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ヒストグラムを作りたいデータの列名を指定</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>target_column <span class="op">=</span> <span class="st">'Values'</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 関数名を sturgesNumber として引数をnとします</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sturgesNumber(n):</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 公式の通り k = 1 + log2 n</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 階級数は整数が良いので,math.floor()で小数点以下を切り捨てます</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (math.floor (<span class="dv">1</span> <span class="op">+</span> math.log2(n)))</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co"># dataフォルダにあるhistogram_quantitative.csvというファイルを読み込みます.</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;data/histogram_quantitative.csv&quot;</span>)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 読み込んだファイルの中身を見てみます.</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co">#階級数を決定</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>stnum <span class="op">=</span> sturgesNumber(<span class="bu">len</span>(df[target_column]))</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'sturges number:'</span>,stnum)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co">#階級幅を決定</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>space <span class="op">=</span> <span class="bu">int</span>((df[target_column].<span class="bu">max</span>() <span class="op">-</span> df[target_column].<span class="bu">min</span>()) <span class="op">/</span> stnum)</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'space:'</span>,space)</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="co">#階級幅の終端を指定</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> np.arange(start <span class="op">=</span> <span class="bu">int</span>(df[target_column].<span class="bu">min</span>()) <span class="op">-</span> <span class="dv">1</span> <span class="co">#最小値</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>                ,stop  <span class="op">=</span> <span class="bu">int</span>(df[target_column].<span class="bu">max</span>()) <span class="op">+</span> <span class="dv">1</span> <span class="co">#最大値</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>                ,step  <span class="op">=</span> space <span class="co">#階級幅</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'bins:'</span>,bins)</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a><span class="co">#度数</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>freq <span class="op">=</span> df[target_column].value_counts(bins <span class="op">=</span>bins, sort<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'度数'</span>,freq)</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>rel_freq <span class="op">=</span> freq <span class="op">/</span> df[target_column].count()  <span class="co"># 相対度数</span></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>cum_freq <span class="op">=</span> freq.cumsum()  <span class="co"># 累積度数</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>rel_cum_freq <span class="op">=</span> rel_freq.cumsum()  <span class="co"># 相対累積度数</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>dist <span class="op">=</span> pd.DataFrame(</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>    {   <span class="st">&quot;Value&quot;</span>: freq.index,        <span class="co">#階級値</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Freq&quot;</span>: freq,               <span class="co">#度数</span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Rel&quot;</span>: rel_freq,            <span class="co">#相対度数</span></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Cum&quot;</span>: cum_freq,            <span class="co">#累積度数</span></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;RelCum&quot;</span>: rel_cum_freq,     <span class="co">#相対累積度数</span></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>freq.index</span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dist)</span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>dist.to_csv(<span class="st">'frequency_table_qualitative.csv'</span></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>           ,encoding<span class="op">=</span><span class="st">'utf-8-sig'</span></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>           ,index<span class="op">=</span><span class="va">False</span>)</span></code></pre></div>
<p>結果作成された,<code>frequency_table_qualitative.csv</code>を開いてみると,以下のような度数分布表が作成されたことが確認できます.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Value</th>
<th style="text-align: center;">Freq</th>
<th style="text-align: center;">Rel</th>
<th style="text-align: center;">Cum</th>
<th style="text-align: center;">RelCum</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">(8.999, 18.0]</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.01</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.01</td>
</tr>
<tr class="even">
<td style="text-align: center;">(18.0, 27.0]</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">0.05</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">0.06</td>
</tr>
<tr class="odd">
<td style="text-align: center;">(27.0, 36.0]</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;">0.11</td>
<td style="text-align: center;">17</td>
<td style="text-align: center;">0.17</td>
</tr>
<tr class="even">
<td style="text-align: center;">(36.0, 45.0]</td>
<td style="text-align: center;">21</td>
<td style="text-align: center;">0.21</td>
<td style="text-align: center;">38</td>
<td style="text-align: center;">0.38</td>
</tr>
<tr class="odd">
<td style="text-align: center;">(45.0, 54.0]</td>
<td style="text-align: center;">27</td>
<td style="text-align: center;">0.27</td>
<td style="text-align: center;">65</td>
<td style="text-align: center;">0.65</td>
</tr>
<tr class="even">
<td style="text-align: center;">(54.0, 63.0]</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">0.2</td>
<td style="text-align: center;">85</td>
<td style="text-align: center;">0.85</td>
</tr>
<tr class="odd">
<td style="text-align: center;">(63.0, 72.0]</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">0.09</td>
<td style="text-align: center;">94</td>
<td style="text-align: center;">0.94</td>
</tr>
</tbody>
</table>
<h4 id="度数分布表の可視化ヒストグラム">度数分布表の可視化:<strong>ヒストグラム</strong></h4>
<p>ここまでで,データの分布,偏りを把握する手段としての度数分布表を学びました. 度数分布表を眺めることである程度データの形は分かりますが,よりわかりやすく可視化する方法として<strong>ヒストグラム</strong>があります.</p>
<p><strong>ヒストグラム(Histogram)/柱状図</strong>とは,量的データの度数分布を棒グラフで表現したものです.ただし,通常の棒グラフと異なり値が連続しているので,棒と棒の間にスペースを置きません. 統計における最も基本的なグラフです.</p>
<p>ヒストグラムはいくつかの代表的なパターンがあり,それぞれ注意するべきポイントがありますので,順に見ていきましょう.</p>
<div class="note">
<ul>
<li><h3 id="単峰型unimodalで左右対称">単峰型(unimodal)で左右対称</h3></li>
</ul>
<p>ヒストグラムの盛り上がっている部分を<strong>峰</strong>といいます. 峰の数が一つのヒストグラムを<strong>単峰(unimodal)</strong>なヒストグラムといいます.</p>
<p>ヒストグラムの基本となる形は,単峰で左右対称な分布です. この分布は,<strong>データが同質な集団から発生していること</strong>を表しています.</p>
<pre><code>- 例:同じ人種の,同じ年代の,男性の集団の身長

- 例:同じ種類,同じ時期,同じ地域のうさぎの集団のサイズ</code></pre>
<p>峰からの左右のデータのばらつきは集団の個体差を表しています. 異なる,質を持つ集団が混じっている場合は峰が複数になることが多いです.</p>
<figure>
<img src="../images/histogram_unimodal.png" alt="単峰で左右対称なヒストグラム" />
<figcaption aria-hidden="true">単峰で左右対称なヒストグラム</figcaption>
</figure>
<ul>
<li><h3 id="多峰型bimodalなヒストグラム">多峰型(bimodal)なヒストグラム</h3></li>
</ul>
<p>峰が2つ以上あるヒストグラムを<strong>多峰(bimodal)</strong>なヒストグラムといいます.
異質な集団が混ざっているデータでは,ヒストグラムが多峰になることがあります.</p>
<pre><code>- 例:男女の混ざった集団の身長や体重
男性の峰と女性の峰が現れます.

- 例:小学生と中学生に同じテストを受けた点数
小学生の点数の峰と,中学生の点数の峰が現れます.</code></pre>
<p>ヒストグラムを作成し,多峰性が現れたらデータを集団別・要因別に分割して分析するのが良いとされています.データを特定の属性で分割することを<strong>層別</strong>といいます.</p>
<figure>
<img src="../images/histogram_bimodal.png" alt="多峰なヒスグラム" />
<figcaption aria-hidden="true">多峰なヒスグラム</figcaption>
</figure>
<ul>
<li><h3 id="左右非対称なヒストグラム">左右非対称なヒストグラム</h3></li>
</ul>
<p>ヒストグラムは峰を中心として左右対称な場合もありますが,どちらかの方向に歪んでいるものも良く見られます.</p>
<pre><code>- 例:社会人の年収,企業の売上など</code></pre>
<p>ヒストグラムの細くなっている部分をヒストグラムの<strong>尾</strong>といいます.</p>
<pre><code>- **尾が**左に伸びている場合に **左に歪んだ分布**

- **尾が**右に伸びている場合に **右に歪んだ分布**</code></pre>
<p>といいます.</p>
<figure>
<img src="../images/histogram_right_left.png" alt="左右に歪んだヒストグラム" />
<figcaption aria-hidden="true">左右に歪んだヒストグラム</figcaption>
</figure>
<p>左右に歪んだ分布では,後に扱う<strong>中心を表す代表値</strong>(平均値や中央値)が適切に集団を代表しない場合があるので,代表値の使い分けが必要になります.</p>
<p>また, 後に扱う<strong>検定</strong>手法のうち,<strong>正規分布</strong>を仮定する検定が利用できないなど,手法の選択において,分布の歪みは重要なポイントです.</p>
<ul>
<li><h3 id="外れ値outlierのあるヒストグラム"><strong>外れ値(Outlier)</strong>のあるヒストグラム</h3></li>
</ul>
<p>大多数のデータとは離れた位置にある少数のデータを<strong>外れ値(Outlier)</strong>といいます.</p>
<p>外れ値は,データ分析において非常に重要な意味を持ち,外れ値が現れた場合にはその原因を探ることが必要となります.
外れ値が発生する原因としては以下のようなものがあり,いずれも注目する必要があります.</p>
<pre><code>- データの取得におけるミス
    単純な入力ミスや計算ミスなど
    発見した場合は修正,除外する必要がある.

- 異質な存在の発見
    新種や新しい現象の発見などにつながる可能性があります.</code></pre>
<p>また,代表値の計算においては歪みが生じる可能性があるので,外れ値を除外する必要があります.</p>
<figure>
<img src="../images/histogram_outlier.png" alt="外れ値のあるヒストグラム" />
<figcaption aria-hidden="true">外れ値のあるヒストグラム</figcaption>
</figure>
</div>
<p>それでは,Pythonでヒストグラムを作成してみましょう. 度数分布表を作成している場合は,棒グラフを作成し,棒の幅を<code>0</code>にすることで,ヒストグラムが作成できます.</p>
<p><code>plt.bar()</code>では,引数<code>width=1</code>を与えることで,棒の太さを<code>1</code>(棒の間を0)にすることができます.</p>
<p>まずは,以前扱った<a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/diff_class.csv">質的データ</a>の例におけるヒストグラムを作成してみましょう.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#データの読み込み</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'Data/diff_class.csv'</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co">#ヒストグラムを作りたいデータの列名を指定</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>target_column <span class="op">=</span> <span class="st">'Diff'</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co">#度数</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>freq <span class="op">=</span> df[target_column].value_counts(sort<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co">#順番の入れ替え</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>freq <span class="op">=</span> freq.reindex([<span class="st">'難しすぎてついていけない'</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>                    ,<span class="st">'難しいが許容できる'</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>                    ,<span class="st">'ちょうどよい'</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>                    ,<span class="st">'簡単だが許容できる'</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>                    ,<span class="st">'簡単すぎて退屈'</span>],axis<span class="op">=</span><span class="st">'index'</span>)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'度数'</span>,freq)</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>rel_freq <span class="op">=</span> freq <span class="op">/</span> df[target_column].count()  <span class="co"># 相対度数</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>cum_freq <span class="op">=</span> freq.cumsum()  <span class="co"># 累積度数</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>rel_cum_freq <span class="op">=</span> rel_freq.cumsum()  <span class="co"># 相対累積度数</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>dist <span class="op">=</span> pd.DataFrame(</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    {   <span class="st">&quot;Value&quot;</span>: freq.index,        <span class="co">#階級値</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Freq&quot;</span>: freq,               <span class="co">#度数</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Rel&quot;</span>: rel_freq,            <span class="co">#相対度数</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Cum&quot;</span>: cum_freq,            <span class="co">#累積度数</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;RelCum&quot;</span>: rel_cum_freq,     <span class="co">#相対累積度数</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>freq.index</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dist)</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>dist.to_csv(<span class="st">'frequency_table.csv'</span>,encoding<span class="op">=</span><span class="st">'utf-8-sig'</span>,index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a><span class="co"># ヒストグラム</span></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>plt.bar(x<span class="op">=</span>dist[<span class="st">'Value'</span>], height<span class="op">=</span>dist[<span class="st">&quot;Freq&quot;</span>],width<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>plt.xticks(np.arange(<span class="bu">len</span>(dist)),<span class="bu">list</span>(dist.index),rotation<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>以下のように,単峰で右に歪んだグラフが作成されるはずです.</p>
<figure>
<img src="../images/histogram_qualitative.png" alt="質的データのヒストグラム" />
<figcaption aria-hidden="true">質的データのヒストグラム</figcaption>
</figure>
<p>同様に<a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/histogram_quantitative.csv">量的データ</a>についても作成してみます.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ヒストグラムを作りたいデータの列名を指定</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>target_column <span class="op">=</span> <span class="st">'Values'</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 関数名を sturgesNumber として引数をnとします</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sturgesNumber(n):</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 公式の通り k = 1 + log2 n</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 階級数は整数が良いので,math.floor()で小数点以下を切り捨てます</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (math.floor (<span class="dv">1</span> <span class="op">+</span> math.log2(n)))</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co"># dataフォルダにあるhistogram_quantitative.csvというファイルを読み込みます.</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;data/histogram_quantitative.csv&quot;</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 読み込んだファイルの中身を見てみます.</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="co">#階級数を決定</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>stnum <span class="op">=</span> sturgesNumber(<span class="bu">len</span>(df[target_column]))</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'sturges number:'</span>,stnum)</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="co">#階級幅を決定</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>space <span class="op">=</span> <span class="bu">int</span>((df[target_column].<span class="bu">max</span>() <span class="op">-</span> df[target_column].<span class="bu">min</span>()) <span class="op">/</span> stnum)</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'space:'</span>,space)</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="co">#階級幅の終端を指定</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> np.arange(start <span class="op">=</span> <span class="bu">int</span>(df[target_column].<span class="bu">min</span>()) <span class="op">-</span> <span class="dv">1</span> <span class="co">#最小値</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>                ,stop  <span class="op">=</span> <span class="bu">int</span>(df[target_column].<span class="bu">max</span>()) <span class="op">+</span> <span class="dv">1</span> <span class="co">#最大値</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>                ,step  <span class="op">=</span> space <span class="co">#階級幅</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'bins:'</span>,bins)</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a><span class="co">階級が整数では大きすぎる場合は,</span></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a><span class="co">np.arrange()では上手く出来ません.</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a><span class="co">while文などで,以下のように自作しましょう.</span></span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a><span class="co">space = (data.max() - data.min()) / step</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a><span class="co">current = data.min() -1</span></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a><span class="co">bins = [current]</span></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a><span class="co">while current &lt;= data.max() +1:</span></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a><span class="co">    current += space</span></span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a><span class="co">    bins.append(current)</span></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a><span class="co">#度数</span></span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>freq <span class="op">=</span> df[target_column].value_counts(bins <span class="op">=</span>bins, sort<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'度数'</span>,freq)</span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a>rel_freq <span class="op">=</span> freq <span class="op">/</span> df[target_column].count()  <span class="co"># 相対度数</span></span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a>cum_freq <span class="op">=</span> freq.cumsum()  <span class="co"># 累積度数</span></span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a>rel_cum_freq <span class="op">=</span> rel_freq.cumsum()  <span class="co"># 相対累積度数</span></span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a>dist <span class="op">=</span> pd.DataFrame(</span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a>    {   <span class="st">&quot;Value&quot;</span>: freq.index,        <span class="co">#階級値</span></span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Freq&quot;</span>: freq,               <span class="co">#度数</span></span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Rel&quot;</span>: rel_freq,            <span class="co">#相対度数</span></span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Cum&quot;</span>: cum_freq,            <span class="co">#累積度数</span></span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;RelCum&quot;</span>: rel_cum_freq,     <span class="co">#相対累積度数</span></span>
<span id="cb32-59"><a href="#cb32-59" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb32-60"><a href="#cb32-60" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>freq.index</span>
<span id="cb32-61"><a href="#cb32-61" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-62"><a href="#cb32-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-63"><a href="#cb32-63" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dist)</span>
<span id="cb32-64"><a href="#cb32-64" aria-hidden="true" tabindex="-1"></a>dist.to_csv(<span class="st">'frequency_table_qualitative.csv'</span></span>
<span id="cb32-65"><a href="#cb32-65" aria-hidden="true" tabindex="-1"></a>           ,encoding<span class="op">=</span><span class="st">'utf-8-sig'</span>,index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb32-66"><a href="#cb32-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-67"><a href="#cb32-67" aria-hidden="true" tabindex="-1"></a><span class="co"># ヒストグラム</span></span>
<span id="cb32-68"><a href="#cb32-68" aria-hidden="true" tabindex="-1"></a><span class="co">## dist['Value']は文字列でないので,</span></span>
<span id="cb32-69"><a href="#cb32-69" aria-hidden="true" tabindex="-1"></a><span class="co">## .astype(str) で文字列に変換しています.</span></span>
<span id="cb32-70"><a href="#cb32-70" aria-hidden="true" tabindex="-1"></a>plt.bar(x<span class="op">=</span>dist[<span class="st">'Value'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb32-71"><a href="#cb32-71" aria-hidden="true" tabindex="-1"></a>       ,height<span class="op">=</span>dist[<span class="st">&quot;Freq&quot;</span>],width<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb32-72"><a href="#cb32-72" aria-hidden="true" tabindex="-1"></a>plt.xticks(np.arange(<span class="bu">len</span>(dist)),<span class="bu">list</span>(dist.index),rotation<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb32-73"><a href="#cb32-73" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>以下のように単峰で左に歪んだヒストグラムが作成されます.</p>
<figure>
<img src="../images/histogram_quantitative.png" alt="量的データのヒストグラム" />
<figcaption aria-hidden="true">量的データのヒストグラム</figcaption>
</figure>
<p>一方で,量的データに関しては,度数分布表を作成せずとも<code>matplotlib</code>の<code>plt.hist()</code>を利用して直接作成することも可能です.</p>
<p><code>plt.hist()</code>では<code>bins=</code>に階級数を指定することで,その階級数で自然に分割したヒストグラムを作成してくれます.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ヒストグラムの作成</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>label  <span class="op">=</span> df.columns[<span class="dv">0</span>]</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> df[label]</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>plt.hist(values, bins<span class="op">=</span>stnum)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="../images/histogram_quantitative2.png" alt="量的データのヒストグラム" />
<figcaption aria-hidden="true">量的データのヒストグラム</figcaption>
</figure>
<p>階級幅の設定によって,見た目が変わることが分かります. 作成手法や階級の設定は目的に応じて,使い分けるようにしましょう.</p>
<div class="note">
<ul>
<li>演習</li>
</ul>
<p><a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/qualitative_histogram_practice.csv">データ1</a>,<a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/quantitative_histogram_practice.csv">データ2</a>の度数分布表とヒストグラムを作成し,pptなどでグラフとその解釈をまとめてください.</p>
</div>
<h3 id="箱ひげ図">箱ひげ図</h3>
<p>データの観測対象が複数のグループに層別可能な場合には, それぞれのヒストグラムを作成して比較することなどが必要です. グループの数が多い場合には, 何個もヒストグラムを作成することになりますし,比較には剥いていない場合があります.
そのような複数のグループの分布を比較する際に良く用いられるグラフが,箱ひげ図です.</p>
<p><a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/boxplot_data_300.csv">こちら</a>のデータは, 複数の種類の馬鈴薯のサイズがまとまっています.</p>
<p>試しに,ヒストグラム馬鈴薯の種類毎のヒストグラムを作成してみます.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'data/boxplot_data_300.csv'</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co">#馬鈴薯の種類を抜き出す</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>types <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(df[<span class="st">'Type'</span>]))</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(types)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">#馬鈴薯の種類別にヒストグラムを作成してみる</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(ncols<span class="op">=</span><span class="dv">2</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>                      ,nrows<span class="op">=</span><span class="bu">int</span>(<span class="bu">len</span>(types) <span class="op">/</span> <span class="dv">2</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>                      ,sharex <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> ax.flatten()</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">'Potato Weight'</span>)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(types)):</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> types[i]</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    df_temp <span class="op">=</span> df[df[<span class="st">'Type'</span>] <span class="op">==</span> t]</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>    axes[i].hist(df_temp[<span class="st">'Weight'</span>])</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    axes[i].set_title(t)</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="../images/box_plot1.png" alt="馬鈴薯の重さのヒストグラム" />
<figcaption aria-hidden="true">馬鈴薯の重さのヒストグラム</figcaption>
</figure>
<p>これでも比較はできますが1枚の画像にまとめる手段として,箱ひげ図が利用できます.
箱ひげ図は<code>plt.boxplot(データのリスト,labels=ラベルのリスト)</code>で生成できます.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> [df[df[<span class="st">'Type'</span>]<span class="op">==</span>x][<span class="st">'Weight'</span>] <span class="cf">for</span> x <span class="kw">in</span> types]</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co">#内包表記を利用しない場合は</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">data = []</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">for x in types:</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">    data.append(df[df['Type']==x]['Weight'])</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>plt.boxplot(data,labels<span class="op">=</span>types)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="../images/box_plot2.png" alt="馬鈴薯の重さの箱ひげ図" />
<figcaption aria-hidden="true">馬鈴薯の重さの箱ひげ図</figcaption>
</figure>
<p>箱ひげ図は,線がそれぞれ四分位数を表しており,それぞれ上から<strong>最大値</strong>,<strong>75%点</strong>,<strong>中央値</strong>,<strong>25%点</strong>,<strong>最小値</strong>となります.また,外れ値は丸で表されます.</p>
<p>ヒストグラムと比較して情報量は減りますが, 一覧性と比較においては優れています.それぞれ一長一短なので,用途に応じて使い分けるようにしましょう.</p>
<h3 id="発展密度プロット">発展:密度プロット</h3>
<p>データの分布を表現する手法としてヒストグラムは非常に便利ですが,階級数や階級幅を自分で定める必要があり,その設定によって見た目が変わってしまいます. また, データ数が少ないときには正確なデータの分布をつかめないという問題点もあります.</p>
<p>そこで, データを階級で区分せずに,度数ではなく確率分布を直接推定する手法に<strong>カーネル密度推定(Karnel Density Estimation)</strong>があります.</p>
<h3 id="発展sinaplot">発展:sinaplot</h3>
<h3 id="発展バイオリンプロット">発展:バイオリンプロット</h3>
<h3 id="散布図">散布図</h3>
<p>これまではデータの各観測項目を独立に可視化してきました. 複数の観測項目の関係性を可視化する代表的な手法に散布図があります.</p>
<p><a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/scatter.csv">こちら</a>のデータはGoogle Trendにおける同時期の<code>AI</code>というワードのの検索量と,<code>Python</code>というワードの検索量を表しています.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>     <span class="ex">AI</span>  Python</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    34      27</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>    40      26</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>    59      28</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    46      29</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>    36      29</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="ex">..</span>   ..     ...</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="ex">255</span>  58      83</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="ex">256</span>  69      87</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="ex">257</span>  59      82</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="ex">258</span>  62      84</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="ex">259</span>  59      87</span></code></pre></div>
<p>この2つの検索量がどのような関係にあるのかを散布図を用いて確認してみましょう.
散布図は<code>plt.scatter(x軸の値のリスト,y軸の値のリスト)</code>の形で作成できます.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'data/scatter.csv'</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co">#散布図のx軸を指定</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>x_column <span class="op">=</span> <span class="st">'AI'</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co">#散布図のy軸を指定</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>y_column <span class="op">=</span> <span class="st">'Python'</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>x_value <span class="op">=</span> df[x_column]</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>y_value <span class="op">=</span> df[y_column]</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>plt.scatter(x_value, y_value)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(y_column)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(x_column)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="../images/scatter.png" alt="散布図" />
<figcaption aria-hidden="true">散布図</figcaption>
</figure>
<p>散布図を見ると,<code>AI</code>に関する検索量が増えるにつれて,<code>Python</code>の検索量が増えるという関係が見えてきます.</p>
<p>この関係の度合いを数値化する<strong>相関係数</strong>や,関係の仕方を説明する<strong>回帰分析</strong>に関しては後ほど扱います.</p>
<h4 id="観測項目が複数ある場合の散布図">観測項目が複数ある場合の散布図</h4>
<p>データが3つある場合には,以下のように3Dで表現することも可能ですがこの講義では,3次元のグラフに関しては深く扱いません.興味のある方は調べてみましょう.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.random.rand(<span class="dv">100</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.random.rand(<span class="dv">100</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> np.random.rand(<span class="dv">100</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure()</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fig.add_subplot(projection<span class="op">=</span><span class="st">'3d'</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>ax.scatter(x, y, z, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code></pre></div>
<figure>
<img src="../images/3dscatter.png" alt="3次元の散布図" />
<figcaption aria-hidden="true">3次元の散布図</figcaption>
</figure>
<p>観測項目が4つ以上ある場合に散布図のように関係を表す手法としては,複数の観測項目の値を合成して3次元以下にする<strong>次元削減</strong>が良く利用されます. <strong>次元削減</strong>に関しては後ほど扱うとして,ここではいくつかの観測項目を<strong>色</strong>や<strong>大きさ</strong>などの要素の変換して関係を見る方法を紹介します.</p>
<p><code>plt.scatter()</code>では<code>s=</code>に数値を与えることでサイズ,<code>c=</code>に数値を与えることで色を指定できます.
また,色と数値の関係は<code>plt.colorbar()</code>で表示可能です.</p>
<p>複数の点が重なると見にくくなるために <code>alpha=</code>に<code>0-1</code>の間の数値を指定して透明度を指定することができます.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.random.rand(<span class="dv">100</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.random.rand(<span class="dv">100</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> np.random.rand(<span class="dv">100</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co">#色とサイズをzで指定する</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co">#そのままだとサイズが小さすぎるので,100倍している</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,y,alpha<span class="op">=</span><span class="fl">0.5</span>,s<span class="op">=</span>z<span class="op">*</span><span class="dv">100</span>,c<span class="op">=</span>z)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>plt.colorbar() <span class="co">#カラーバーの表示</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="../images/scatter_color_size.png" alt="色とサイズによる表現" />
<figcaption aria-hidden="true">色とサイズによる表現</figcaption>
</figure>
<h4 id="クラスタリングにおける散布図">クラスタリングにおける散布図</h4>
<p>散布図は複数の観測項目間の関係性を可視化するための手法ですが,データから特定の観測対象の集まり(<strong>クラスター</strong>)を発見する<strong>クラスタリング</strong>とも深い関わりがあります.
クラスタリングの手法は後ほど扱いますが,ここでは可視化手法としての散布図とクラスタ表現の関係に関して確認してみましょう.</p>
<p><a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/scatter_class.csv">こちら</a>のデータはクラスタリングによって得られたクラスタ毎のラベルがなされています.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>           <span class="ex">x</span>          y  Cluster</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>  <span class="at">-8.149818</span>  <span class="at">-9.152380</span>        2</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   5.860155   0.126873        1</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>  <span class="at">-3.213409</span>   9.828126        0</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>   6.744070  <span class="at">-0.129607</span>        1</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>  <span class="at">-6.342946</span>  <span class="at">-6.038933</span>        2</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="ex">..</span>       ...        ...      ...</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="ex">95</span> <span class="at">-3.524581</span>   9.931801        0</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="ex">96</span> <span class="at">-0.962698</span>  10.411206        0</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="ex">97</span>  4.397950   2.579246        1</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="ex">98</span> <span class="at">-5.255050</span>  <span class="at">-5.299407</span>        2</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="ex">99</span> <span class="at">-3.768024</span>   8.550468        0</span></code></pre></div>
<p>クラスタを表現は<code>.scatter(color=)</code>で色を指定することが一般的です.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#散布図をクラスタごとに色を変えて表示</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    df_temp<span class="op">=</span> df[df[<span class="st">'Cluster'</span>] <span class="op">==</span> i]</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    plt.scatter(df_temp[<span class="st">'x'</span>]</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>               ,df_temp[<span class="st">'y'</span>]</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>               ,c<span class="op">=</span>color_list[i]</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>               ,label<span class="op">=</span><span class="st">'Cluster:'</span> <span class="op">+</span> <span class="bu">str</span>(i))</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="../images/scatter_class.png" alt="クラスタリング" />
<figcaption aria-hidden="true">クラスタリング</figcaption>
</figure>
<h3 id="同時度数分布表">同時度数分布表</h3>
<p>2つの観測項目の関係を調べる手法として散布図を学びましたが,散布図は量的データにしか使えません. 質的変数同士の関係性を調べるにはどのようにしたらいいのでしょうか.</p>
<p>質的変数同士の関係性を調べる手法として代表的なものに<strong>同時度数分布表(クロス表)</strong>があります.
例えば<a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/cross_table_data.csv">こちら</a>のデータはある講義の成績情報ですが,観測項目として成績以外に1時限から5時限までの時限が記録されています. 時限が早い講義と遅い講義で成績が変わるのかという関係性を調べてみます.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>     <span class="ex">Period</span> Grade</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>         2     B</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>         5     A</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>         4     A</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>         3     C</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         1     C</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="ex">..</span>      ...   ...</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="ex">195</span>       2     C</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="ex">196</span>       4     C</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="ex">197</span>       5     C</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="ex">198</span>       5     F</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="ex">199</span>       4     C</span></code></pre></div>
<p>試しに,散布図で<code>Period</code>と<code>Grade</code>の関係を表してみましょう.
成績をそのままでは,散布図の軸上に配置できないので数値に変換します.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'data/cross_table_data.csv'</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co">#あえて散布図を作ってみる</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>grade_num_map <span class="op">=</span> {<span class="st">'S'</span>:<span class="dv">1</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>                ,<span class="st">'A'</span>:<span class="dv">2</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>                ,<span class="st">'B'</span>:<span class="dv">3</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>                ,<span class="st">'C'</span>:<span class="dv">4</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>                ,<span class="st">'F'</span>:<span class="dv">5</span>}</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Grade_num'</span>] <span class="op">=</span> df[<span class="st">'Grade'</span>].<span class="bu">map</span>(<span class="kw">lambda</span> x: grade_num_map[x])</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>plt.scatter(df[<span class="st">'Period'</span>],df[<span class="st">'Grade'</span>])</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Period'</span>)</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Grade'</span>)</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="../images/cross_table1.png" alt="質的データの散布図" />
<figcaption aria-hidden="true">質的データの散布図</figcaption>
</figure>
<p>質的データを数値に変換したとしても,離散値となるため,散布図はこのように基本的にはすべての交点に点があるだけのなんの情報も得られないグラフとなります.</p>
<p>散布図としてプロットすると, 点がありうる場所が少なすぎるため情報がとれません. 元々知りたいことは,講義の時限と成績にどのような関係があるのかということでした.
そこで, 講義の時間ごとの成績の偏りが分かるように可視化することを考えてみます.</p>
<p>講義の時限ごとの成績の分布がわかり,それぞれに違いがあれば時限によって成績に偏りが出ていると言えそうです.
そこで,以下のように講義の時限毎の成績の度数分布表を作ってみましょう.</p>
<figure>
<img src="../images/cross_table2.png" alt="同時度数分布表" />
<figcaption aria-hidden="true">同時度数分布表</figcaption>
</figure>
<p>この度数分布表では,時限毎にその成績を取った学生の度数が数えられています(<span class="math inline"><em>n</em><sub>11</sub></span>は1時限にSを取った学生の度数,<span class="math inline"><em>n</em><sub><em>i</em><em>j</em></sub></span>は<code>j時限</code>に上から<code>i番目</code>の成績をとった学生の度数.)</p>
<p>このような2観測項目の度数分布表を<strong>同時度数分布表</strong>あるいは,<strong>クロス表(cross table)</strong>といいます.</p>
<p>それでは,Pythonで同時度数分布表を作成してみましょう.
<code>pandas</code> では,<code>.crosstab(行,列)</code>メソッドを利用することで,クロス表が作成できます.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#クロス表の作成</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>cross <span class="op">=</span> pd.crosstab(df[<span class="st">'Grade'</span>],df[<span class="st">'Period'</span>])</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co">#表示順の設定</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>cross <span class="op">=</span> cross.reindex([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>],axis<span class="op">=</span><span class="st">'columns'</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>cross <span class="op">=</span> cross.reindex([<span class="st">'S'</span>,<span class="st">'A'</span>,<span class="st">'B'</span>,<span class="st">'C'</span>,<span class="st">'F'</span>],axis<span class="op">=</span><span class="st">'index'</span>)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cross)</span></code></pre></div>
<div class="sourceCode" id="cb45"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Period</span>   1   2   3   4   5</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Grade</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="ex">S</span>        9  10  12   4   2</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="ex">A</span>        7  14   7   5   4</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="ex">B</span>        9  10   7  11   7</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="ex">C</span>       14   6   3  15  18</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="ex">F</span>        7   4   3   1  11</span></code></pre></div>
<p>このようにしてみることで,それぞれの時限毎にそれぞれの成績がどのような分布なのかが分かります.
しかし,各時限の人数が同じとは限らないため,各列の値をその列の和で割って,列相対度数に変更してみましょう.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#列相対度数に変更する</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> cross.columns:</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    cross[c] <span class="op">=</span> cross[c] <span class="op">/</span> cross[c].<span class="bu">sum</span>()</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cross)</span></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Period</span>         1         2        3         4         5</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Grade</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="ex">S</span>       0.195652  0.227273  0.37500  0.111111  0.047619</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="ex">A</span>       0.152174  0.318182  0.21875  0.138889  0.095238</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="ex">B</span>       0.195652  0.227273  0.21875  0.305556  0.166667</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="ex">C</span>       0.304348  0.136364  0.09375  0.416667  0.428571</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="ex">F</span>       0.152174  0.090909  0.09375  0.027778  0.261905</span></code></pre></div>
<p>このようにすると,時限毎にどの程度の割合がSやAなどの良い成績をとっているのかが分かります.
通常度数分布表を作成したあとには,<strong>χ二乗検定</strong>や,<strong>標準化残渣</strong>を利用した<strong>残渣分析</strong>によって,<strong>偏り</strong>が統計的に存在するかを判定します. しかし,それらは後の検定の章に譲るとして,次の節では更に,これを一目で判断しやすいように可視化することを考えてみます.</p>
<h3 id="ヒートマップ">ヒートマップ</h3>
<p>一つ前の節では,同時度数分布表を利用して2つの質的変数からなる観測項目の関係性を見てみました. しかし, 同時度数分布表のままでは,可視化とは言えません. 同時度数分布表のような表形式の数値を可視化する方法として,ヒートマップがあります.</p>
<p>ヒートマップとは,表形式の数値を各セルの色によって表現する可視化手法です.</p>
<p>先ほど作成した,列相対度数をヒートマップを利用して可視化してみましょう.</p>
<p>ヒートマップは<code>seaborn</code>の<code>.heatmap()</code>を利用することで簡単に作成できます.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>sns.heatmap( cross  <span class="co">#ヒートマップを作成したいテーブル</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>           , cmap<span class="op">=</span>plt.get_cmap(<span class="st">'Reds'</span>) <span class="co">#カラーマップ(省略可)</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>           , linewidths<span class="op">=</span><span class="fl">.5</span> <span class="co">#線の太さを指定することでセルを囲う線を表示</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>           , annot<span class="op">=</span><span class="va">True</span>  <span class="co">#セルに数値を表示</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="../images/heatmap.png" alt="ヒートマップ" />
<figcaption aria-hidden="true">ヒートマップ</figcaption>
</figure>
<p>このヒートマップでは,数値が大きいほど,色が濃くなっており2,3時限においてB以上の成績を取る学生の割合が大きいこと,4,5時限においてCやFなどの成績を取る人の割合が大きいことが視覚的に分かります.</p>
<p>ヒートマップは複数の数値間の相関係数や距離を可視化する際にも良く用いられるので,覚えておきましょう.</p>
<div class="note">
<ul>
<li>演習</li>
</ul>
<ol type="1">
<li><p>GoogleTrendで4つのワードに関して同じ期間の推移を調べ以下の2通りの方法でCSVを作成してください.</p>
<ul>
<li><p>1つのグラフに表示
for文を利用して1つのグラフに4つの折れ線グラフを色を変えて表示する.
凡例も表示する.</p></li>
<li><p>グラフの分割
グラフを分割して,それぞれのワードに関して4象限の折れ線グラフを作成する.</p></li>
</ul></li>
<li><p><a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/beetle_datal.csv">こちら</a>のカブトムシの種類別の体長と体重のデータを利用して散布図を作成してください.カブトムシの種類別に散布図の色や点の図形を変更してください.</p></li>
<li><p><a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/forest_beetle_data.csv">こちら</a>の森の地点別に採取できたカブトムシの種類を記録したデータを可視化しどの森でどのカブトムシが取れやすいのかを分析してください.</p></li>
</ol>
</div>

<!-- 前後の章へのナビゲーション -->
<div class="chapter-navigation">
    <nav>
        
            <a class="nav-link prev" href="slds7.html">← Previous Chapter</a>
        
        
            <a class="nav-link next" href="slds9.html">Next Chapter →</a>
        
    </nav>
</div>

    <div style="clear: both"></div>

    <div id="footer">
        Site proudly generated by
        <a href="http://jaspervdj.be/hakyll">Hakyll</a>.
    </div>
</div>


    <!-- GUID -->
    <div style="display: none">ce0f13b2-4a83-4c1c-b2b9-b6d18f4ee6d2</div>

    
    <!-- KaTeX JavaScript and auto-render extension -->
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "\[", right: "\]", display: true},
            {left: "$", right: "$", display: false}
          ]
        });
      });
    </script>
    

    <!-- JavaScript TOC generator (only runs on lecture pages) -->
    <script>
    document.addEventListener("DOMContentLoaded", function() {
      var tocContainer = document.getElementById('lecture-toc');
      if (!tocContainer) return;

      // メインコンテンツから h2, h3, h4 を抽出
      var content = document.querySelector('article') || document.getElementById('content') || document.body;
      var headings = content.querySelectorAll('h2, h3, h4');
      if (headings.length === 0) return;

      // 目次用のUL要素を作成
      var tocList = document.createElement('ul');

      // 章番号カウンタ (h2, h3, h4に対応して配列を用意)
      var chapterNumbers = [0, 0, 0];

      headings.forEach(function(heading) {
        if (heading.closest('li')) return;

        var level;
        switch (heading.tagName.toLowerCase()) {
          case 'h2': level = 0; break;
          case 'h3': level = 1; break;
          case 'h4': level = 2; break;
          default: return;
        }

        chapterNumbers[level]++;
        for (var i = level + 1; i < chapterNumbers.length; i++) {
          chapterNumbers[i] = 0;
        }

        var chapterNumberStr = chapterNumbers.slice(0, level + 1).join('.');
        if (!heading.id) {
          heading.id = heading.textContent.trim().replace(/\s+/g, '-').toLowerCase();
        }

        var li = document.createElement('li');
        li.classList.add('toc-level-' + (level + 1));

        var anchor = document.createElement('a');
        anchor.href = '#' + heading.id;
        anchor.textContent = chapterNumberStr + ' ' + heading.textContent;

        li.appendChild(anchor);
        tocList.appendChild(li);
      });

      tocContainer.appendChild(tocList);
    });
    </script>
     <script>
  document.addEventListener("DOMContentLoaded", function() {
    // すべての <pre><code> 要素を走査
    const codeBlocks = document.querySelectorAll('pre code');
    codeBlocks.forEach(function(codeBlock) {
      // 親<pre>要素を取得
      const pre = codeBlock.parentNode;

      // <pre> を相対配置にし、子要素を絶対配置できるようにする
      pre.style.position = 'relative';

      // コピーボタンを作成
      const copyButton = document.createElement('button');
      copyButton.textContent = 'Copy';
      // ボタンのデザインはCSSで指定するのが望ましいが、簡易的にスタイルを直接指定する例:
      copyButton.style.position = 'absolute';
      copyButton.style.top = '8px';
      copyButton.style.right = '8px';
      copyButton.style.backgroundColor = '#add8e6'; // 水色
      copyButton.style.color = '#fff';             // 白文字
      copyButton.style.border = 'none';
      copyButton.style.padding = '6px 10px';
      copyButton.style.borderRadius = '4px';
      copyButton.style.cursor = 'pointer';

      // クリックされたらクリップボードにコピー
      copyButton.addEventListener('click', function() {
        const codeText = codeBlock.innerText;
        navigator.clipboard.writeText(codeText).then(function() {
          copyButton.textContent = 'Copied!';
          setTimeout(function() {
            copyButton.textContent = 'Copy';
          }, 2000);
        }, function(err) {
          console.error('Failed to copy: ', err);
        });
      });

      // ボタンを <pre> の子要素として挿入
      pre.appendChild(copyButton);
    });
  });
  </script>
  <script>
    function toggleMenu() {
      var nav = document.getElementById('navigation');
      nav.classList.toggle('open');
    }
  </script>
  </body>
</html>