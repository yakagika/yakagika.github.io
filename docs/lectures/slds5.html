<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>yakagika - 特別講義DS Ch5 データの取得と編集</title>

    <!-- Stylesheets. -->
    <link rel="stylesheet" type="text/css" href="../style.css?v=0">

    <!-- RSS. -->
    <link rel="alternate" type="application/rss+xml" title="yakagika" href="https://yakagika.github.io/rss.xml">

    <!-- Metadata. -->

    <meta name="keywords" content="yakagika Haskell ExchangeAlgebra">
    <meta name="description" content="Personal home page and blog of yakagika.">

    
    <!-- KaTeXのスタイルシートとJavaScriptのリンクを動的に挿入 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" integrity="sha384-wcIxkf4k558AjM3Yz3BBFQUbk/zgIYC2R0QpeeYb+TwlBVMrlgLqwRjRtGZiK7ww" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js" integrity="sha384-hIoBPJpTUs74ddyc4bFZSM1TVlQDA60VBbJS0oA934VSz82sBx1X7kSx2ATBDIyd" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
    <style>
      .katex-display {
        display: block;
        margin: 1em 0;
        text-align: center;
      }
      .katex .frac {
        vertical-align: baseline;
        -webkit-vertical-align: baseline;
      }
      .katex .sqrt {
        vertical-align: baseline;
        -webkit-vertical-align: baseline;
      }
      .katex .strut {
        height: 1em;
        -webkit-height: 1em;
      }
      .katex .base {
        font-family: 'KaTeX_Main', 'Arial', sans-serif;
      }
      @media screen and (-webkit-min-device-pixel-ratio:0) {
        .katex {
          line-height: normal !important;
        }
      }
      @media not all and (min-resolution: .001dpcm) {
        @supports (-webkit-appearance:none) {
          .katex {
            line-height: normal !important;
          }
        }
      }
    </style>
    

    
      <meta property="og:description" content="資料" />
    
  </head>

  <body>

    <!-- ハンバーガーメニューのボタン（小画面時に表示） -->
    <div class="hamburger" onclick="toggleMenu()">☰</div>

    <!-- ナビゲーションに drawer-menu クラスを付与 -->
    <div id="navigation" class="drawer-menu">
      <h1>Contents</h1>
      <a href="../">Home</a>
      <a href="../posts.html">Blog</a>
      <a href="../lectures.html">Lecture</a>
      <a href="../research.html">Research</a>
      <a href="../contact.html">Contact</a>
      <!-- <a href="/cv.html">CV</a> -->

      <h1>Links</h1>
      <a href="http://github.com/yakagika" target="_blank" rel="noopener">GitHub</a>
      <a href="https://researchmap.jp/k-akagi" target="_blank" rel="noopener">researchmap</a>

      
      <div id="lecture-toc">
        <h1>Table of Contents</h1>
        <!-- The TOC will be generated here by JavaScript -->
      </div>
      
    </div>

    <div id="content">
    <h1>特別講義DS Ch5 データの取得と編集</h1>
<div class="soft">
    資料<br />
    Published on 2024-03-29 under the tag <a title="All pages tagged 'datascience'." href="../tags/datascience.html">datascience</a>, <a title="All pages tagged 'statistics'." href="../tags/statistics.html">statistics</a>, <a title="All pages tagged 'python'." href="../tags/python.html">python</a>
</div>

<!-- 前後の章へのナビゲーション -->
<div class="chapter-navigation">
    <nav>
        
            <a class="nav-link prev" href="slds4.html">← Previous Chapter</a>
        
        
            <a class="nav-link next" href="slds6.html">Next Chapter →</a>
        
    </nav>
</div>

<br>

<h2 id="データの取得と編集">データの取得と編集</h2>
<p>これからデータをプログラム上で扱うにあたって,まずはデータについて考えてみましょう.</p>
<p>データは,基本的に誰かが収集・作成したものです. 自然科学においては,<strong>実験</strong>によってデータを収集し,人文・社会科学では,<strong>調査</strong>によってデータが集められます. データの作成はそれ自体でそれぞれ,<strong>実験計画法</strong>,<strong>社会調査法</strong>といった学問分野になっています.</p>
<p>データサイエンスは,データを利用して行う学問でセウが,データを収集・作成するのは専門知識,技能,時間,お金などが必要であり,データの作成自体が大きな仕事です.</p>
<p>データを自分で集めるには大変な手間がかかるので, 研究機関や,行政,大学,調査会社など他者が集めて公開しているデータを利用するのも一つの手段です. この講義では, 基本的に公開されているデータを利用して, 学習,研究を行います.</p>
<p>実験や調査によって集められたデータを<strong>原データ</strong>といい,調査によって集められた個別の調査票などを<strong>個票</strong>といいます.</p>
<p>原データに統計処理を加えてまとめたものを,<strong>統計資料</strong>あるいは<strong>調査結果</strong>などと呼びます.もともと<strong>統計(statistics)</strong>という言葉は,(国家の状況に関して)
集められた原データを編集してわかりやすく加工することを意味していました. データサイエンスではしばしば原データが利用されますが,公開されているデータはこれらの統計資料である場合が多く,原データを利用するのは困難な場合が多いです.</p>
<p>統計資料に更に加工を加えたものを,<strong>二次統計</strong>や<strong>加工統計</strong>と呼びます.</p>
<p>例えば, 国税調査によって個票が収集され,統計処理を加えた統計資料が公開され, それを更に複数の統計と併せて加工することで,国民経済計算などの加工統計が作成されます.</p>
<figure>
<img src="../images/statistical-data-flow.png" alt="データの作られ方" />
<figcaption aria-hidden="true">データの作られ方</figcaption>
</figure>
<h3 id="データの尺度">データの尺度</h3>
<p>データには様々な種類があり,種類ごとに利用可能な統計やデータサイエンスの手法が異なります.したがって,今後データを分析するにあたって,大まかなデータの区分を知っておく必要があります.</p>
<p>データの区分として,一番大きいものに <strong>量的データ(quantitative data)</strong>,<strong>質的データ(qualitative data)</strong>があります. 質的データはカテゴリーデータなどとも呼ばれます.</p>
<div class="warn">
<p>このどちらにも当てはまらないような,画像,音声,文字データなどの<strong>非構造データ</strong>もありますが,それらはそれぞれ個別の対処手法があります.</p>
<p>この講義では後半で文字データを扱う自然言語処理について扱いますが,しばらくはこれらに関しては無視して,量的データと質的データを扱います.</p>
</div>
<div class="note">
<h4 id="量的データ">量的データ</h4>
<ul>
<li><p>数量的なデータであり,データを数直線上の位置で表現できます.</p>
<ul>
<li>年齢(5歳,10歳,100歳)</li>
<li>身長(150cm,170cm,200cm)</li>
<li>年収(200万円,500万円,1億円)</li>
</ul>
<p>など基本的には,何かしらの<strong>単位</strong>で計量されます.</p></li>
</ul>
<h4 id="質的データ">質的データ</h4>
<ul>
<li><p>あらかじめ定められたカテゴリーのいずれかに属する値を持つデータです.</p>
<ul>
<li>性別(F or M)</li>
<li>犬の種類(ゴールデンレトリバー, 柴犬, プードル,など)</li>
<li>天気(晴れ,雨,曇など)</li>
<li>満足度(とても満足, まぁ満足, どちらでもない,など)</li>
</ul></li>
</ul>
</div>
<p>質的データと量的データは更に細かい区分として<strong>尺度(scale)</strong>に分解されます.
それぞれは,｢比較が可能か｣,｢和差積商｣の計算が可能かどうかという観点で定義されます.</p>
<div class="note">
<h4 id="名義尺度nominal-scale">名義尺度(nominal scale)</h4>
<ul>
<li><p>質的データの中で区分にしか意味がなく順序が定義されていないもの.</p>
<ul>
<li>例:氏名,性別,種類,など</li>
</ul></li>
<li><p>和差積商のどれも定義されない.</p>
<ul>
<li>例:青木 + 赤木 = 紫木 のような計算はできない.</li>
<li>青木は赤木よりも良い,大きい,などの比較もできない</li>
</ul></li>
</ul>
<h4 id="順序尺度ordinal-scale">順序尺度(ordinal scale)</h4>
<ul>
<li><p>質的データの中で順序が定義されているもの.</p>
<ul>
<li>例: 満足度,成績区分(S,A,B,…)など</li>
</ul></li>
<li><p>和差積商のどれも定義されないが比較が可能</p>
<ul>
<li>例: ｢満足｣は｢不満足｣よりも満足度が高いが,</li>
<li>普通 + 普通 = 満足 のような計算はできない.</li>
</ul></li>
</ul>
<h4 id="間隔尺度interval-scale">間隔尺度(interval scale)</h4>
<ul>
<li><p>量的データの中で,間隔は定義されているが,比率が定義されていないもの.</p>
<ul>
<li>例: 時刻,日付,IQ,気温,西暦,etc</li>
</ul></li>
<li><p>足し算引き算はできるが,掛け算割り算ができない.</p>
<ul>
<li>1月1日 + 364日 = 12月31日 ですが,</li>
<li>1月1日 * 2 = 2月2日 のような計算は定義されていません.</li>
</ul></li>
</ul>
<h4 id="比率尺度ratio-scale">比率尺度(ratio scale)</h4>
<ul>
<li><p>量的データの中で,比率が定義されているもの.</p>
<ul>
<li>例: 長さ,速度,重さ,面積など</li>
</ul></li>
<li><p>和差積商すべて計算できます.</p>
<ul>
<li>10Kg + 10Kg = 20Kg</li>
<li>10Kg * 2 = 20Kg</li>
</ul></li>
</ul>
</div>
<p>これらの区分は今後データの処理手法を選択する際に使用するので,
データがでてきたら尺度は何かを判断するようにしましょう.</p>
<div class="note">
<p><strong>演習問題</strong></p>
<p>以下のデータの尺度を判断し,なぜそのように判断できるかを説明してください.</p>
<ol type="1">
<li><p>ペットの種類 (イヌ,ネコ,鳥,魚,爬虫類,その他から選択)</p></li>
<li><p>偏差値</p></li>
<li><p>電話番号</p></li>
<li><p>一週間に読んだ本のページ数</p></li>
</ol>
</div>
<h3 id="データの種類">データの種類</h3>
<p>これまでは一つの種類の値の区分に関して,説明してきましたが,データは複数の値の組み合わせで表現され,<strong>観測対象(ケース)</strong>別の<strong>観測項目(変数)</strong>の<strong>テーブルデータ</strong>として表現される場合が多いです.</p>
<figure>
<img src="../images/case-and-variable.png" alt="観測対象と観測項目" />
<figcaption aria-hidden="true">観測対象と観測項目</figcaption>
</figure>
<p>データの観測項目の数のことを<strong>次元</strong>と呼び, 1観測項目のデータを<strong>1次元データ</strong>,2観測項目以上のデータを<strong>多次元データ</strong>と呼びます.</p>
<figure>
<img src="../images/data-dimention.png" alt="データの次元" />
<figcaption aria-hidden="true">データの次元</figcaption>
</figure>
<p>また,観測項目や観測対象の組み合わせによって,特別に呼称され,それぞれ独自の分析手法が存在するデータもあります(時系列データと時系列解析,パネルデータと,パネルデータ分析など)</p>
<p><img src="../images/data-types.png" /></p>
<p>上の時系列データは,特定の時間単位で集計,区分されたデータを指しますが,データの発生時刻が記録されたデータを<strong>点過程データ</strong>と呼びます. 点過程データを日毎,月ごとなどで集計することで時系列データが作成されます.</p>
<h3 id="データの取得と編集-1">データの取得と編集</h3>
<p>先に述べたように,データは自分で集めることもできますが,手間,時間,お金がかかるため,目的に応じて他人の集めたデータを利用することも一般的です.</p>
<p>現在では,無料で利用可能なデータも多数あり,この講義ではそれらのデータを利用します.</p>
<div class="warn">
<p>後ほど自分で選んだ研究テーマによっては自分でデータを収集することも可能です.
過去のこの講義でも, HPの視線移動データ,アンケートデータ,ヒットチャートの音楽の特徴量を表すデータ
などを自分で作った事例もあります.</p>
<p>それらに関しては,個々の研究計画に応じて必要であれば補足的に講義内で扱います.</p>
</div>
<p>無料で誰でも利用可能なデータの代表として,<strong>公的統計</strong>があります. 公的統計は,国や地方自治体の作成する統計情報であり,政策立案と評価のための基礎資料として利用されており, 作成過程なども含めて一般に公開されているものが多数あります. プライバシーや個人情報保護の観点から個票は公開されていない場合が大半ですが,研究目的であれば申請して利用することも可能です.しかし,通常データが手元に来るまでに1年程度時間を要するのでこの講義では扱いません.</p>
<p>日本の統計情報を活用するには,“日本の統計が閲覧できる政府統計ポータルサイト”<a href="https://www.e-stat.go.jp"><code>e-stat</code></a>があります. e-statでは日本の各種公的統計の情報を統計別,分野別,地域別,時系列などで取得することができます.</p>
<p><img src="../images/e-stat-screenshot1.png" alt="e-stat screenshot1" />
<img src="../images/e-stat-screenshot2.png" alt="e-stat screenshot2" /></p>
<p>日本以外のデータに関しては,各国の統計サイトに直接アクセスするか,あるいは国連による各種子交際期間の統計の横断検索サイト<a href="https://data.un.org"><code>UNData</code></a>などを利用することで取得可能です.</p>
<figure>
<img src="../images/UNData-screenshot.png" alt="UNData" />
<figcaption aria-hidden="true">UNData</figcaption>
</figure>
<p>各国の公的統計は通常数量的なデータを扱っていますが,大学の講義や研究などで欲利用される質的データとして,<a href="https://www.worldvaluessurvey.org/wvs.jsp"><code>World Value Survey</code></a>があります. 世界各国の価値観に関する調査のパネルデータを提供しており, ｢人生において大切にするもの｣｢男女平等意識｣ などの調査結果が利用できます.</p>
<p>その他にも各種研究機関や企業が提供するデータも利用可能です.</p>
<p>統計ではありませんが, <a href="https://disclosure2.edinet-fsa.go.jp/WEEK0010.aspx"><code>EDINET</code></a>のWEB APIを利用して有価証券報告書のデータを取得する,Wikipediaのテキストデータを自然言語処理してデータを作成するなどもこの講義における過去の研究事例があります.</p>
<p>これらに関しては後ほど, Webページから自動でデータを取得する<code>Webスクレイピング</code>やTwitterなどのSNSの提供する<code>API</code>を利用してデータを取得する方法も扱います.</p>
<p>Webから取得可能な情報以外にも, 特定の組織に直接交渉してデータを活用することも可能です. この講義では千葉商科大学の授業データや,電力消費データを提供してもらい分析した事例もあります.</p>
<h3 id="e-statを使ってみよう">e-statを使ってみよう</h3>
<p>e-statを利用して,pandasで読み込める形式のCSVを作成しましょう. 練習用なので,何を持ってきてもいいのですがここでは,｢産業別の給与｣に関するデータを取得します. 就職活動中の学生も多いかと思います. 産業別の給与はどのように異なるのでしょうか.</p>
<p>まずは使いたいデータを探します. 方法はいくつもありますが,ここでは<code>分野</code>から探してみましょう. <code>分野→労働・賃金→民間給与実態調査</code>の順にクリックしてください.</p>
<p><img src="../images/e-stat-salary1.png" /></p>
<p><code>データベース</code>形式か,<code>ファイル</code>形式か選択することができます. データベース形式は必要なデータをブラウザ上で選択,編集してデータを取得することができます. ファイル形式は,ExcelやPDFファイルをダウンロードできます. どちらでも問題ありませんが,ここではただのExcelファイルと,pandasで読み込めるデータの違いを確認するために,<code>ファイル</code>をクリックしましょう.</p>
<p><img src="../images/e-stat-salary2.png" /></p>
<p>官庁の作成する統計は,<code>民間給与実態調査</code>などの調査名,統計名の下位分類として,年次推計,延長推計などの提供分類,その下に対象年次,更にその下に表レベルの分類があります. これはそれぞれの統計にある程度詳しくないと意味がわからないかと思いますが,今は練習ですので気にせず,<code>結果表</code>の<code>年次推計</code>の<code>2018年度</code>の<code>第1表</code> の<code>Excel</code>をクリックしましょう.</p>
<p><img src="../images/e-stat-salary3.png" /></p>
<p>これで,民間給与実態統計調査結果表年次推計2018年度第1表 給与所得者数・給与額・税額 全国計表 がダウンロードできましたので,開いてみましょう.</p>
<p><img src="../images/e-stat-salary4.png" /></p>
<p>省庁から取得したExcel表は,このような形態になっていることが多いですが,このデータはそのままではpandasなどで読み込める形になっていません. もちろん,データベース機能で編集したデータや2018年ではなくもっと新しいデータの場合には,ある程度利用できる形態になっていますが,このようなデータは未だに多数存在します.</p>
<p>ではこのデータは一体,何が駄目なのでしょうか. プログラムで利用できるデータを作成するにあたって,e-statのデータは良い<strong>悪い見本</strong>なので,e-stat全般の問題点に関して少し見ていきましょう.</p>
<p>先ほどダウンロードしたような形式のデータを俗に<strong>ネ申Excel</strong>といいます(以降<strong>神Excel</strong>と記載).</p>
<p>神Excelとは,紙で印刷した際の見栄えを重視した,データとしての利用性のまったくないExcelシートです(参考:<a href="https://okumuralab.org/~okumura/SSS2013.pdf">｢ネ申Excel｣問題</a>).</p>
<p>例えば, 見栄えを重視するために<strong>セルを結合する</strong>,<strong>画像を挿入する</strong>,<strong>スペースなどで幅を揃える</strong>,<strong>1セルに1文字を入力する(Excel方眼紙)</strong>などが神Excelの特徴となります.</p>
<p>先程の民間給与実態統計調査を見てみるとこれらの特徴が見事に当てはまります.</p>
<figure>
<img src="../images/kami-excel.png" alt="神Excel" />
<figcaption aria-hidden="true">神Excel</figcaption>
</figure>
<p>人間は,文字の間に空白が挟まっていてもつながった単語として認識できますが,コンピュータにはできません.また,セルが結合されている場合に表として解釈することもできません,画像も処理できません.このようなExcel表はデータとしては利用できないので,データとして形式を揃えるだけで大変な手間がかかります(このあと実際にやります).</p>
<p>逆に, プログラムで利用可能なデータを<strong>機械判読可能</strong>なデータといいます.
機械判読可能な分析しやすいExcelデータをまとめる基本チェック表として,以下のものが有名です(<a href="https://www.tandfonline.com/doi/full/10.1080/00031305.2017.1375989">Data Organization in Spredsheets</a>).</p>
<div class="note">
<ul>
<li><p>一貫性を保つ</p>
<ul>
<li>名前の一貫性</li>
<li>記述方法の一貫性</li>
</ul></li>
<li><p>名前の付け方</p>
<ul>
<li>スペースを使わない</li>
<li>意味が分かる名前をつける</li>
<li>日付の書き方をYYYY-MM-DDに</li>
</ul></li>
<li><p>空のセルを作らない</p></li>
<li><p>セルに一つしかものを入れない</p></li>
<li><p>長方形にする</p></li>
<li><p>データと計算を分離する</p></li>
<li><p>フォントの色やハイライトをデータとして使用しない</p></li>
<li><p>データ検証機能を使う</p></li>
<li><p>CSVファイルに保存する</p></li>
</ul>
</div>
<p>データをプログラムで処理するのが一般的な現代において,自分で使うためのみならず,データの価値を保つためにも機械判読可能な形式でデータを作成するように心がけましょう.Excelを使っていると,せっかくある機能を使いたくなりますができるだけデータとしての利用可能性を高める意識が必要です.</p>
<div class="warn">
<p>ちなみにe-statの問題点は,神Excelにとどまりません.</p>
<p>一番恐ろしいのは一部のデータにおいて,<strong>データベース機能に登録されている元データが神Excel</strong>のままになっていることです.</p>
<p>Excel表上でスペースが混じっているセルの値などがデータベース機能で編集してもそのまま出てくる場合があります.</p>
<p>その他にも,</p>
<ul>
<li>同じ統計でも作成年毎に表記が異なる</li>
<li>データの構造が統計名-提供分類-年次-表の形式になっているため,APIなどでデータを一意に絞り込めない.</li>
<li>公表が遅い</li>
<li>APIにおける一部文字化けやJSONの構造が崩れている</li>
</ul>
<p>など沢山の問題があります. 徐々に改善されているようですので,今後に期待したいところですね.</p>
</div>
<h3 id="機械判読可能データの作成">機械判読可能データの作成</h3>
<p>では,e-statからダウンロードしたデータを編集して, <strong>機械判読可能なBOM付きUTF-8のCSV</strong>に変換してみましょう. ここでは, Execelを用いて行います.</p>
<p>今回ダウンロードしたデータの中で扱いたいのは,<strong>業種別の給料</strong>です.
それ以外の邪魔な情報は削除しましょう(コピーして別のシートに貼り付けた方が早いです).
新しいファイルを作成し,一行目にHeaderとして,<code>industry</code>, <code>salary</code> と記入しましょう.
日本語でも大丈夫ですが英語の方が安心です.
しかし,業種名を他のファイルにそのまま貼り付けようとすると,セルが結合されているためうまくいきません.このままでは,プログラムで上手く処理できないので編集します.</p>
<p>ダウンロードしたファイルの業種の部分をコピーしたら,新しいファイルのindustry の下のセルを右クリックして｢値だけ貼り付け｣をしましょう.
一部の行の中に句読点が入っていますがこれもエラーのもととなるので,編集します.</p>
<figure>
<img src="../images/e-stat-salary5.png" alt="ヘッダーの作成" />
<figcaption aria-hidden="true">ヘッダーの作成</figcaption>
</figure>
<figure>
<img src="../images/e-stat-salary6.png" alt="データのコピー" />
<figcaption aria-hidden="true">データのコピー</figcaption>
</figure>
<p>プログラムは基本的に英語の利用を想定されているのでデータも英語の方が安定します.
日本語でも問題ない場合が大半なので,日本語のままでも良いですが,プログラム記述中に日本語と英語が混ざるとエラーの原因となりやすいので,文章自体に意味があるテキストデータなどを除いて可能な限り英語に変換しておくことをおすすめします.
自分で適切な英語に変換できない場合はExcelでは翻訳したいセルを右クリックして<code>翻訳</code>を選ぶと翻訳してくれます. Excelでは現状自分でコピーアンドペーストしなければなりません.
Google Sheetなど使うと一発で全て変換する関数 GoogleTranslate などがあります.</p>
<figure>
<img src="../images/e-stat-salary7.png" alt="翻訳されたデータ" />
<figcaption aria-hidden="true">翻訳されたデータ</figcaption>
</figure>
<figure>
<img src="../images/e-stat-salary8.png" alt="Excelの翻訳機能" />
<figcaption aria-hidden="true">Excelの翻訳機能</figcaption>
</figure>
<p>CSVでデータを詠み込む場合, 空白,コンマ,Tabなどはエラーになりやすいので,可能な限り消しましょう.
特に今回の業種データは｢電気･ガス･熱供給・水道業｣ などなぜか中点を利用しているものもあれば,句点で区切られているものもあり,意味が分かりません.
長過ぎるのも問題が起きやすいので,頭文字のみにするなどわかりやすい形に変更しましょう(電気･ガス･熱供給・水道業 → インフラ, 卸売,小売業 → 商業 など)</p>
<p>再度に作成されたデータをCSVとして保存して終了です.保存する際のデータ型式にCSV UTF-8があるのでそれを選択し, ｢<code>salary.csv</code>｣という名前で作業ディレクトリのDataフォルダに保存します.</p>
<figure>
<img src="../images/e-stat-salary9.png" alt="データの保存" />
<figcaption aria-hidden="true">データの保存</figcaption>
</figure>
<h3 id="pandasによるデータ処理">pandasによるデータ処理</h3>
<p>ここから,先ほど作成したデータを利用してpandasの基本的な機能について確認していきます.
<strong>いくつもの処理を一気に扱いますが,すべて暗記する必要はありません. ただし,それぞれの処理の存在を覚えるようにしましょう. 可能な処理やその名前を覚えておけば,この資料に戻る,あるいは検索して調べることで自分で利用できます.</strong>
取り敢えず,講義内ではそれぞれの処理が何をやっているのかの概要を掴み,体験してみましょう.</p>
<h4 id="ファイルの読み込み">ファイルの読み込み</h4>
<p>先程作成したデータを作業ディレクトリのdataフォルダに保存して,Pythonで読み込んでみます.
以下,<code>salary.py</code>というファイルを作成してプログラムを追記していきます.</p>
<div class="warn">
<p>スクリプトのファイル名は,中身がなにか後で見ても分かるような英数字であれば何でも構いません.
ただし, <code>pandas</code>,<code>numpy</code>,<code>matplotlib</code>などの今後利用するライブラリと同名のスクリプトを作成すると,
正常にライブラリを利用できなくなるので注意しましょう.</p>
</div>
<p>以下の用に <code>import pandas as pd</code> でpandasをimportしたあとに, <code>pd.read_csv('ファイルパス')</code>でファイルが読み込めます. また,同じ行で読み込んだファイルを<code>df</code>という変数に代入しています.
最後の行で読み込んだファイルを表示しています.</p>
<p>最初のうちは自分で作成するプログラムにも以下の例の用に,それぞれの行で何をしているのかコメントを書くようにしましょう.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pandas を import し, pdと呼ぶという意味</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># pandas はデータの読み込みなどに利用します</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># データの読み込み</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># CSVファイルを読み込んでデータフレーム(後述)に格納</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># pd.関数名 でpandasの関数が利用できる</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataフォルダを作成し,そこにデータを入れておきましょう</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># data/salary_data.csv は  data フォルダの salary.csv という意味</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'data/salary.csv'</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<p>正しくプログラムをデータが作成できていれば,プログラムを実行することで以下のようにデータの中身が標準出力に表示されるはずです. プログラムを記述する際には,このようにところどころで,<code>print()</code>を利用して,自分のイメージしたとおりにデータが編集されているか確認する癖をつけるようにしましょう.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 salary.py</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>         <span class="ex">industry</span>  salary</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction    4503</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing    4756</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale    3186</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    Accomodation    1949</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance    5711</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate    3786</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport    3909</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy    8199</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>            Info    5337</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu    3913</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med    4144</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other    4239</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice    3086</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC    2190</span></code></pre></div>
<div class="note">
<p>pandasでは主に<code>DataFrame</code>というデータ型を利用してデータを扱います.
<code>DataFrame</code>オブジェクトには様々な機能が実装されており,様々な形に変形することができますが,基本的には以下の3属性から成っています.</p>
<ul>
<li><p>values : データ部分 n × m の行列</p></li>
<li><p>columns: 列名, header情報</p></li>
<li><p>index: 行名</p></li>
</ul>
<figure>
<img src="../images/data-frame-image.png" alt="DataFrameのイメージ" />
<figcaption aria-hidden="true">DataFrameのイメージ</figcaption>
</figure>
</div>
<p>クラスの属性には<code>オブジェクト名.属性名</code>でアクセスできます. 以下のコードを追加して実行し,それぞれどのように表示されるか確認してみましょう.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dfのvalues属性を表示したい場合</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.values)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#dfのcolumns属性を表示したい場合</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.columns)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#dfのindex属性を表示したい場合</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.index)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">[[</span><span class="st">'Construction'</span> 4503]</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">'Manufacturing'</span> 4756]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">'Wholesale'</span> 3186]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">'Accomodation'</span> 1949]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">'Finance'</span> 5711]</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">'Real Estate'</span> 3786]</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">'Transport'</span> 3909]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">'Energy'</span> 8199]</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">'Info'</span> 5337]</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">'Edu'</span> 3913]</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">'Med'</span> 4144]</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">'Other'</span> 4239]</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">'Suervice'</span> 3086]</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">'AFFC'</span> 2190]]</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Index</span><span class="er">(</span><span class="ex">[</span><span class="st">'industry'</span><span class="ex">,</span> <span class="st">'salary'</span>], dtype=<span class="st">'object'</span><span class="kw">)</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="ex">RangeIndex</span><span class="er">(</span><span class="va">start</span><span class="op">=</span>0, <span class="va">stop</span><span class="op">=</span>14, <span class="va">step</span><span class="op">=</span>1<span class="kw">)</span></span></code></pre></div>
<h3 id="データの確認">データの確認</h3>
<p>DataFrameを読み込んだらまずは,その全体像と特徴を確認しましょう.
確認すべき項目として,columnsやindexの他に以下のようなものがあります.</p>
<div class="note">
<ul>
<li>データの中身</li>
</ul>
<p>データが長い場合は標準出力には省略して表示されます.
意図的に,先頭n行を取得したい場合には<code>df.head(n)</code>を利用します.
後ろからn行を取得したい場合には<code>df.tail(n)</code>を利用します.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'head --- </span><span class="ch">\n</span><span class="st">'</span>,df.head(<span class="dv">5</span>))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'tail --- </span><span class="ch">\n</span><span class="st">'</span>,df.tail(<span class="dv">5</span>))</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span> <span class="at">---</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>         <span class="ex">industry</span>  salary</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>   Construction    4503</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>  Manufacturing    4756</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>      Wholesale    3186</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>   Accomodation    1949</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>        Finance    5711</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span> <span class="at">---</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>     <span class="ex">industry</span>  salary</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>        Edu    3913</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>       Med    4144</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>     Other    4239</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>  Suervice    3086</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>      AFFC    2190</span></code></pre></div>
</div>
<div class="note">
<ul>
<li><p>データの形</p>
<ul>
<li><p><code>df.shape</code> でデータの行数,列数を取得できます.</p></li>
<li><p><code>len(df)</code> でデータの長さ(行数)を確認できます.</p></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#形の確認</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.shape)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(df))</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">14,</span> 2<span class="kw">)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">14</span></span></code></pre></div>
</div>
<div class="note">
<ul>
<li>記述統計量</li>
</ul>
<p><code>df.describe()</code>を利用することで <code>データ数(count)</code>,<code>平均(mean)</code>, <code>母標準偏差(std)</code>,<code>最大値(max)</code>,<code>最小値(min)</code>, <code>四分位数(25%,50%,75%)</code>などの特徴量が把握できます.
<code>df[列名].max()</code>で最大値,<code>df[列名].mean()</code>で列の平均,<code>df[列名].median()</code>で中央値など個別に把握することも可能です.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#特徴量の把握</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.describe())</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'最大値:'</span>,df[<span class="st">'Salaray'</span>].<span class="bu">max</span>())</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'平均値:'</span>,df[<span class="st">'Salaray'</span>].mean())</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'中央値:'</span>,df[<span class="st">'Salary'</span>].median())</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>            <span class="ex">salary</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">count</span>    14.000000</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="ex">mean</span>   4207.714286</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="ex">std</span>    1561.247008</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="ex">min</span>    1949.000000</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="ex">25%</span>    3336.000000</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="ex">50%</span>    4028.500000</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="ex">75%</span>    4692.750000</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="ex">max</span>    8199.000000</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="ex">最大値:8199.000000</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="ex">平均値:4207.714286</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="ex">中央値:4028.500000</span></span></code></pre></div>
</div>
<h3 id="行名列名の変更">行名,列名の変更</h3>
<p>columnsとindexは任意の値を設定できます(ただし重複はなし).
リストでそれぞれの属性を更新することで新しい列名,行名を指定できます.</p>
<ul>
<li>列名の変更</li>
</ul>
<p><code>df.columns = [新しい列名のリスト]</code></p>
<ul>
<li>行名の変更</li>
</ul>
<p><code>df.index = [新しい行名のリスト]</code></p>
<p>試しに列名を<code>['Ind','Sal']</code>に,行名を<code>a~n</code>のアルファベットに変更してみましょう.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">#列名の変更</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>df.columns <span class="op">=</span> [<span class="st">'Ind'</span>,<span class="st">'Sal'</span>]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">#行名の変更</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>df.index <span class="op">=</span> [<span class="st">'a'</span>,<span class="st">'b'</span>,<span class="st">'c'</span>,<span class="st">'d'</span>,<span class="st">'e'</span>,<span class="st">'f'</span>,<span class="st">'g'</span>,<span class="st">'h'</span>,<span class="st">'i'</span>,<span class="st">'j'</span>,<span class="st">'k'</span>,<span class="st">'l'</span>,<span class="st">'m'</span>,<span class="st">'n'</span>]</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<p>指定した通りに列名や行名が変更されていれば成功です.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>             <span class="ex">Ind</span>   Sal</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">a</span>   Construction  4503</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span>  Manufacturing  4756</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span>      Wholesale  3186</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="ex">d</span>   Accomodation  1949</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="ex">e</span>        Finance  5711</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="ex">f</span>    Real Estate  3786</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="ex">g</span>      Transport  3909</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="ex">h</span>         Energy  8199</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="ex">i</span>           Info  5337</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="ex">j</span>            Edu  3913</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="ex">k</span>            Med  4144</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="ex">l</span>          Other  4239</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="ex">m</span>       Suervice  3086</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="ex">n</span>           AFFC  2190</span></code></pre></div>
<p>ただし,indexは0から始まる連番を利用するのが一般的なので,むやみに文字などにしないほうが良いです. indexに0から始まる連番を振り直すには,<code>.reset_index()</code>メソッドを利用するのが一般的です.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#元の連番に戻す</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">## ()の中に inplace = True と書くことでdfのindexが変更される</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">## inplace=Trueを書かないと変更されません.</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">## drop = True と書くことで,変更前に使用していたindexが消去されます.</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">## drop = False の場合先ほどのアルファベットが列として残ります.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>df.reset_index(inplace<span class="op">=</span><span class="va">True</span>,drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<p>実行結果</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>             <span class="ex">Ind</span>   Sal</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction  4503</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing  4756</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale  3186</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    Accomodation  1949</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance  5711</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate  3786</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport  3909</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy  8199</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>            Info  5337</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu  3913</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med  4144</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other  4239</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice  3086</span></code></pre></div>
<h3 id="値の抽出">値の抽出</h3>
<p>valuesにアクセスする方法は多数存在し,用途によって使い分けます.</p>
<p>列の指定は,<code>df['列名']</code>あるいは<code>df.列名</code>のように記述することで指定するのが最も単純な方法です.
<code>df</code>の<code>'Ind'</code>列を抽出したい場合には<code>df['Ind']</code>あるいは<code>df.Ind</code>と書きます.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#列の指定(Ind列)</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'Ind'</span>])</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#列の指定(Sal列)</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.Sal)</span></code></pre></div>
<p>実行結果</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>      Construction</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>     Manufacturing</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>         Wholesale</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>      Accomodation</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>           Finance</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>       Real Estate</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>         Transport</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>            Energy</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>              Info</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>               Edu</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>              Med</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>            Other</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>         Suervice</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>             AFFC</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Name:</span> Ind, dtype: object</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>     4503</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>     4756</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>     3186</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>     1949</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>     5711</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     3786</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>     3909</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>     8199</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>     5337</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>     3913</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>    4144</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>    4239</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>    3086</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>    2190</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="ex">Name:</span> Sal, dtype: int64</span></code></pre></div>
<p><code>X列の,Y行</code>のように<code>範囲選択</code>したい場合には<code>df.loc[行番号,列名]</code>と書きます.
また,行名,列名それぞれにスライスを利用することでの,<code>X~Y列のV~W行</code>のような指定ができます.
スライスで表せない行名や列名を指定する場合には,それぞれに抜き出したい列や行のリストを渡します.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#範囲指定(3行目,'Sal'列)</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.loc[<span class="dv">3</span>,<span class="st">'Sal'</span>])</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">#スライスを利用した範囲指定</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.loc[<span class="dv">3</span>:<span class="dv">5</span>,<span class="st">'Ind'</span>:<span class="st">'Sal'</span>])</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">#リストを利用した範囲指定</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.loc[[<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">7</span>],[<span class="st">'Ind'</span>,<span class="st">'Sal'</span>]])</span></code></pre></div>
<p>実行結果</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1949</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>            <span class="ex">Ind</span>   Sal</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>  Accomodation  1949</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>       Finance  5711</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>   Real Estate  3786</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>         <span class="ex">Ind</span>   Sal</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>  Wholesale  3186</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>    Finance  5711</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>     Energy  8199</span></code></pre></div>
<p>特定の一つのセルにアクセスする場合には<code>loc</code>を利用することもできますが,<code>df.at[行名,列名]</code>を使うほうが高速です.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#atによる単独のセルの指定</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.at[<span class="dv">3</span>,<span class="st">'Sal'</span>])</span></code></pre></div>
<p>実行結果</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1949</span></span></code></pre></div>
<p>行名や列名ではなく,行番号,列番号による指定も可能です. 行番号,列番号は行名や列名とは無関係に,0から始まる連番として指定されています.
範囲選択は<code>df.iloc[行番号,列番号]</code>,単独の値は<code>df.iat[行番号,列番号]</code>で行うことができます.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#行番号,列番号による範囲指定</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.iloc[<span class="dv">3</span>:<span class="dv">5</span>,<span class="dv">0</span>:])</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">#行番号,列番号による単独のセルの指定</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.iat[<span class="dv">3</span>,<span class="dv">1</span>])</span></code></pre></div>
<p>実行結果</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>         <span class="ex">Ind</span>   Sal</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>  Wholesale  3186</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>    Finance  5711</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>     Energy  8199</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="ex">1949</span></span></code></pre></div>
<div class="note">
<ul>
<li>演習問題</li>
</ul>
<p>以下の画像における範囲①~③を一度に抽出してください.
単独の値を抜き出す際には<code>.at</code>,<code>.iat</code>メソッドを利用しましょう.</p>
<figure>
<img src="../images/pandas-select-practice.png" alt="値の抽出" />
<figcaption aria-hidden="true">値の抽出</figcaption>
</figure>
</div>
<h3 id="条件による抽出">条件による抽出</h3>
<p>Excelにおけるフィルター機能のように,pandasでも条件による値の抽出が可能です.
pandsでは,DataFrameオブジェクトに,真偽値のリストを渡すと,<code>True</code>の行のみを抜き出すことができます.</p>
<p>以下のコードでは,<code>False</code>と<code>True</code>を交互に繰り返し,奇数行のみを抜き出しています.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#真偽値のリストによる抜き出し</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>bools <span class="op">=</span> [<span class="va">False</span>,<span class="va">True</span>] <span class="op">*</span> <span class="dv">7</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(bools)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[bools])</span></code></pre></div>
<p>実行結果</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">[False,</span> True, False, True, False, True, False, True, False, True, False, True, False, True]</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>              <span class="ex">Ind</span>   Sal</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing  4756</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    Accomodation  1949</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate  3786</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy  8199</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu  3913</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other  4239</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC  2190</span></code></pre></div>
<p>DataFrameオブジェクトに対して,真偽値計算をすると,各行に対する真偽値計算の結果が帰ってきます.
以下のコードでは,Salaryが3000以上の行のみ<code>True</code>の値が帰ってきているのが確認できます.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#DataFrameオブジェクトに対する論理演算</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'Sal'</span>])</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'Sal'</span>] <span class="op">&gt;=</span> <span class="dv">3000</span>)</span></code></pre></div>
<p>実行結果</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>     4503</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>     4756</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>     3186</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>     1949</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>     5711</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     3786</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>     3909</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>     8199</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>     5337</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>     3913</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>    4144</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>    4239</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>    3086</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>    2190</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Name:</span> Sal, dtype: int64</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>      True</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>      True</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>      True</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>     False</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>      True</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>      True</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>      True</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>      True</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>      True</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>      True</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>     True</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>     True</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>     True</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>    False</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a><span class="ex">Name:</span> Sal, dtype: bool</span></code></pre></div>
<p>この<strong>①BoolのリストをDataFrameに渡すとTrueの行が返ってくる</strong>,<strong>②DataFrameに論理演算を行うとBoolのリストが返ってくる</strong>という機能の2つを組み合わせて,条件抽出を行うことができます.
例えば,<code>Sal列</code>から3000以上の行のみを抜き出すには以下のように書きます.</p>
<p>1行のプログラムですが,いくつかの機能を組み合わせているので,どの部分で何が起きているのかを分解して理解するようにしましょう.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#DataFrameオブジェクトに対する条件抽出</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[df[<span class="st">'Sal'</span>] <span class="op">&gt;=</span> <span class="dv">3000</span>][<span class="st">'Sal'</span>])</span></code></pre></div>
<p>実行結果</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Name:</span> Sal, dtype: bool</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>     4503</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>     4756</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>     3186</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>     5711</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     3786</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>     3909</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>     8199</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>     5337</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>     3913</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>    4144</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>    4239</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>    3086</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="ex">Name:</span> Sal, dtype: int64</span></code></pre></div>
<div class="note">
<ul>
<li>演習</li>
</ul>
<p>Salary.csvから以下の条件に従った抽出を行ってください.</p>
<ol type="1">
<li><p><code>Sal列</code>が偶数の<code>Sal列</code>の行</p></li>
<li><p><code>Sal列</code>が奇数の<code>Ind列</code>の行</p></li>
<li><p><code>Ind列</code>が<code>Info</code>,<code>Edu</code>のいずれかで,<code>Sal列</code>が<code>4000以上</code>の<code>Sal列</code></p></li>
</ol>
</div>
<h3 id="値の変更">値の変更</h3>
<p>DataFrameでは選択したセルなどに<code>=</code>を利用して代入することで,値の更新が可能です.
以下のコードで,どの部分が変更されているか,コードと結果の対応関係を見てみましょう.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>df.at[<span class="dv">1</span>,<span class="st">'Sal'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<p>実行結果</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>              <span class="ex">Ind</span>   Sal</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction  4503</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing  4756</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale  3186</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    Accomodation  1949</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance  5711</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate  3786</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport  3909</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy  8199</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>            Info  5337</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu  3913</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med  4144</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other  4239</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice  3086</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC  2190</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>              <span class="ex">Ind</span>   Sal</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction  4503</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing     0</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale  3186</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    Accomodation  1949</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance  5711</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate  3786</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport  3909</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy  8199</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>            Info  5337</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu  3913</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med  4144</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other  4239</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice  3086</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC  2190</span></code></pre></div>
<p>範囲の変更は,同じ形のリストを渡すことで可能です.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#範囲の変更</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="dv">3</span>:<span class="dv">5</span>,<span class="st">'Sal'</span>] <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>              <span class="ex">Ind</span>   Sal</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction  4503</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing     0</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale  3186</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    Accomodation     1</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance     2</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate     3</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport  3909</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy  8199</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>            Info  5337</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu  3913</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med  4144</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other  4239</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice  3086</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC  2190</span></code></pre></div>
<p>リストではなく,単一の値を渡すと一括で変更されます.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#一括変更</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="dv">3</span>:<span class="dv">5</span>,<span class="st">'Sal'</span>] <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>              <span class="ex">Ind</span>   Sal</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction  4503</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing     0</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale  3186</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    Accomodation     4</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance     4</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate     4</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport  3909</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy  8199</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>            Info  5337</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu  3913</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med  4144</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other  4239</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice  3086</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC  2190</span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode py"><code class="sourceCode python"></code></pre></div>
<div class="warn">
<ul>
<li>配列のコピーと変更</li>
</ul>
<p>リストの節でも説明しましたが,pandasのDataFrameは,別の変数に代入して,そのDataFrameの値を変更すると<strong>元のDataFrameの値も変更されます.</strong></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>df2[<span class="st">'Sal'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'df --- </span><span class="ch">\n</span><span class="st">'</span>,df)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'df2 --- </span><span class="ch">\n</span><span class="st">'</span>, df2)</span></code></pre></div>
<p><code>df</code>を<code>df2</code>に代入して,<code>df2</code>の値を変更すると,元の<code>df</code>の値も変更されていることが確認できます.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">df</span> <span class="at">---</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>               <span class="ex">Ind</span>  Sal</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction    0</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing    0</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale    0</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    Accomodation    0</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance    0</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate    0</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport    0</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy    0</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>            Info    0</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu    0</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med    0</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other    0</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice    0</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC    0</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="ex">df2</span> <span class="at">---</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>               <span class="ex">Ind</span>  Sal</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction    0</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing    0</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale    0</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    Accomodation    0</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance    0</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate    0</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport    0</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy    0</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>            Info    0</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu    0</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med    0</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other    0</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice    0</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC    0</span></code></pre></div>
<p>これは割り当てられるメモリの大きなDataFrameを効率的に利用するための仕様ですが,仕様を理解していないと思わぬ結果となるので注意してください.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'id df:'</span>,<span class="bu">id</span>(df))</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'id df2:'</span>,<span class="bu">id</span>(df2))</span></code></pre></div>
<p>実行結果</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">id</span> df: 5013939024</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">id</span> df2: 5013939024</span></code></pre></div>
<p>大きなデータを扱う際に,部分的に抜き出したデータに編集を加えて,元のデータを変更したくない場合があります.そのような場合には,<code>.copy()</code>メソッドを利用します.<code>.copy()</code>メソッドを利用することで,元のデータとは異なるメモリが割り当てられます.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#元のDataFrameを保つコピー</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co">## 一度変更を元に戻す</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'data/salary.csv'</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>df.columns <span class="op">=</span> [<span class="st">'Ind'</span>,<span class="st">'Sal'</span>]</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df.copy()</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>df2[<span class="st">'Sal'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'df --- </span><span class="ch">\n</span><span class="st">'</span>,df)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'df2 --- </span><span class="ch">\n</span><span class="st">'</span>, df2)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'id df:'</span>,<span class="bu">id</span>(df))</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'id df2:'</span>,<span class="bu">id</span>(df2))</span></code></pre></div>
<p>実行結果</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">df</span> <span class="at">---</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>               <span class="ex">Ind</span>   Sal</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction  4503</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing  4756</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale  3186</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    Accomodation  1949</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance  5711</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate  3786</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport  3909</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy  8199</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>            Info  5337</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu  3913</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med  4144</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other  4239</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice  3086</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC  2190</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="ex">df2</span> <span class="at">---</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>               <span class="ex">Ind</span>  Sal</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction    0</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing    0</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale    0</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    Accomodation    0</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance    0</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate    0</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport    0</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy    0</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>            Info    0</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu    0</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med    0</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other    0</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice    0</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC    0</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a><span class="fu">id</span> df: 5013945696</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a><span class="fu">id</span> df2: 4559223920</span></code></pre></div>
</div>
<div class="note">
<ul>
<li>演習</li>
</ul>
<p>作成したsaraly.csvを読み込み,以下の処理を順に行ってください.</p>
<ol type="1">
<li><p>columnsを日本語(産業,給与)に変更してください.</p></li>
<li><p>サービス業だと思われる行のみを抽出して,<code>.copy()</code>してください.</p></li>
<li><p>コピーされたDataFrameに0から始まるインデックスを振り直してください.</p></li>
<li><p>元のDataFrameとコピーされたデータフレームの中身とidを確認してください.</p></li>
</ol>
</div>
<h3 id="データ型の確認と変更">データ型の確認と変更</h3>
<p>pandasでデータを読み込むと列ごとに自動でデータ型が推論,設定されます. pandasのDataFrameにおけるデータ型(<code>dtype</code>)はこれまでに見てきたpythonの標準的なデータ型(<code>type</code>)とは異なるものですが,同じ名前でも変更が可能です. ただし,<code>str</code>型だけ扱いが特殊なので注意が必要です.</p>
<p>pandasの列ごとのデータ型を確認するには,<code>.dtypes</code>を利用します.
<code>type</code>の<code>int</code>に対応する<code>dtype</code>は<code>int64</code>,<code>float</code>は<code>float64</code>と表示されます. <code>str</code>型は,<code>object</code>型になりますがそれぞれの要素は<code>str</code>型です.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'DataFrameのデータ型:</span><span class="ch">\n</span><span class="st">'</span>,df.dtypes)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Sal列のデータ型:'</span>,df[<span class="st">'Sal'</span>].dtypes)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Ind列のデータ型:'</span>,df[<span class="st">'Ind'</span>].dtypes)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Ind列の要素のデータ型:'</span>,<span class="bu">type</span>(df.at[<span class="dv">0</span>,<span class="st">'Ind'</span>]))</span></code></pre></div>
<div class="sourceCode" id="cb43"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="ex">DataFrameのデータ型:</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a> <span class="ex">Ind</span>    object</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Sal</span>     int64</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="ex">dtype:</span> object</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Sal列のデータ型:</span> int64</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Ind列のデータ型:</span> object</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Ind列の要素のデータ型:</span> <span class="op">&lt;</span>class <span class="st">'str'</span><span class="op">&gt;</span></span></code></pre></div>
<p><code>.astype()</code>メソッドでデータ型を変更することができます. 元の列に代入する形で変更しましょう.
今回は,<code>Sal</code>列を<code>int型</code>から<code>float型</code>に変更します.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#データ型の変更</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Sal'</span>] <span class="op">=</span> df[<span class="st">'Sal'</span>].astype(<span class="bu">float</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Sal列のデータ型:'</span>,df[<span class="st">'Sal'</span>].dtypes)</span></code></pre></div>
<div class="sourceCode" id="cb45"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Sal列のデータ型:float64</span></span></code></pre></div>
<p>データを読み込む際に,<code>dtyp=列名とデータ型の辞書</code>を記述することで,データ型を指定することも可能です.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#読み込み時のデータ型の指定</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'data/salary.csv'</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>                ,dtype <span class="op">=</span> {<span class="st">'Industry'</span>:<span class="bu">str</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>                         ,<span class="st">'Salary'</span>:<span class="bu">float</span>})</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>df.columns <span class="op">=</span> [<span class="st">'Ind'</span>,<span class="st">'Sal'</span>]</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.dtypes)</span></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Ind</span>     object</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Sal</span>    float64</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="ex">dtype:</span> object</span></code></pre></div>
<h3 id="dataframeの作成">DataFrameの作成</h3>
<p>これまでは,<code>salary.csv</code>を読み込んでDataFrameとして編集してきましたが,プログラム内で新たなDataFrameを作成することも可能です.</p>
<p>新たなDataFrameを作成するためには,<code>pd.DataFrame()メソッド</code>を利用します.丸括弧内には, <code>data</code>, <code>index</code>, <code>columns</code>を設定する必要があります. ただし, <code>index</code>と<code>columns</code>は省略可能です.
<code>data</code>には,必要な<code>行×列の多次元リスト</code>, <code>index</code>と<code>columns</code>には1次元のリストを渡します.</p>
<p>以下の表のようなDataFrameを作成するコードは次のようになります.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#DataFrameのvalues部分をリストで作成する</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co">## 行のリストになっていることに注意</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co">#DataFrameのvalues部分をリストで作成する</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 行のリストになっていることに注意</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> [[<span class="st">'dog'</span>,<span class="fl">5.0</span>,<span class="fl">60.0</span>]</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>         ,[<span class="st">'cat'</span>,<span class="fl">3.0</span>,<span class="fl">30.0</span>]</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>         ,[<span class="st">'fish'</span>,<span class="fl">0.15</span>,<span class="fl">0.5</span>]]</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co">#DataFrameの作成</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>values</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>                 ,columns<span class="op">=</span>[<span class="st">'animal_kind'</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>                          ,<span class="st">'weight'</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>                          ,<span class="st">'size'</span>])</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>  <span class="ex">animal_kind</span>  weight  size</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>         dog    5.00  60.0</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>         cat    3.00  30.0</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>        fish    0.15   0.5</span></code></pre></div>
<div class="warn">
<p>行のリストよりも列のリストを渡すほうがデータ型が統一されており簡単です.
そのような場合には,数値計算用ライブラリ<code>numpy</code>の<code>.T</code>を利用して,転置行列を渡します.
Shell上で<code>pip install numpy</code>を実行して, <code>numpy</code>をinstallしたのち,<code>import numpy as np</code>と記述して
<code>numpy</code>をプログラムで利用しましょう.</p>
<p><code>numpy</code>では,ndarray配列というデータ型を利用します.そのため,<code>np.array()</code>メソッドで一度<code>ndarray</code>に変換し,
<code>.T</code>によって転置した配列を<code>.tolist()</code>メソッドでリストに戻しています.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">#転置行列によるデータの作成</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>animal_kinds <span class="op">=</span> [<span class="st">'dog'</span>,<span class="st">'cat'</span>,<span class="st">'fish'</span>]</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>weights  <span class="op">=</span> [<span class="fl">5.0</span>,<span class="fl">6.0</span>,<span class="fl">0.15</span>]</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>sizes    <span class="op">=</span> [<span class="fl">60.0</span>,<span class="fl">30.0</span>,<span class="fl">0.5</span>]</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> np.array([animal_kinds</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>                 ,weights</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>                 ,sizes]).T.tolist()</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>values</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>                 ,columns<span class="op">=</span>[<span class="st">'animal_kind'</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>                          ,<span class="st">'weight'</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>                          ,<span class="st">'size'</span>])</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'weight'</span>] <span class="op">=</span> df[<span class="st">'weight'</span>].astype(<span class="bu">float</span>)</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'size'</span>]   <span class="op">=</span> df[<span class="st">'size'</span>].astype(<span class="bu">float</span>)</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<p>実行結果</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>  <span class="ex">animal_kind</span> weight  size</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>         dog    5.0  60.0</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>         cat    6.0  30.0</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>        fish   0.15   0.5</span></code></pre></div>
</div>
<p>また,列名を<code>key</code>その列のリストを<code>value</code>とした辞書型によって<code>DataFrame</code>を作成することも可能です.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'animal_kind'</span>:[<span class="st">'dog'</span>,<span class="st">'cat'</span>,<span class="st">'fisg'</span>]</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>                  ,<span class="st">'weight'</span>:[<span class="fl">5.0</span>,<span class="fl">6.0</span>,<span class="fl">0.15</span>]</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                  ,<span class="st">'size'</span>:[<span class="fl">60.0</span>,<span class="fl">30.0</span>,<span class="fl">0.5</span>]})</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<p>実行結果</p>
<pre><code>  animal_kind weight  size
0         dog    5.0  60.0
1         cat    6.0  30.0
2        fish   0.15   0.5</code></pre>
<div class="note">
<ul>
<li>演習</li>
</ul>
<p>以下の<code>data</code>をもつDataFrameを作成し,<code>age</code>列を<code>float64</code>に変更しましょう.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">name</th>
<th style="text-align: center;">age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Taro</td>
<td style="text-align: center;">20</td>
</tr>
<tr class="even">
<td style="text-align: center;">Jiro</td>
<td style="text-align: center;">30</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Hanako</td>
<td style="text-align: center;">40</td>
</tr>
</tbody>
</table>
</div>
<h3 id="データの追加と削除">データの追加と削除</h3>
<p>列や行の追加には<code>.assine()</code>や<code>.insert()</code>,<code>.append()</code>などが利用可能ですがここでは分かりやすく代入を利用する方法を紹介します.</p>
<p><code>df[新規列名]=新しい列</code>,のようにDataFrameに新しい列を代入することで列の追加が可能です.行の追加は<code>df.loc[追加したいindex] = 新しい行</code>で行えます.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">#データの追加</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co">#列の追加</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'追加前:</span><span class="ch">\n</span><span class="st">'</span>,df)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'name'</span>] <span class="op">=</span> [<span class="st">'pochi'</span>,<span class="st">'tama'</span>,<span class="st">'kintaro'</span>]</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'列の追加:</span><span class="ch">\n</span><span class="st">'</span>,df)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="dv">4</span>] <span class="op">=</span> [<span class="st">'bird'</span>,<span class="fl">1.0</span>,<span class="dv">3</span>,<span class="st">'piyo'</span>]</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'行の追加:</span><span class="ch">\n</span><span class="st">'</span>,df)</span></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="ex">追加前:</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>   <span class="ex">animal_kind</span> weight  size</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>         dog    5.0  60.0</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>         cat    6.0  30.0</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>        fish   0.15   0.5</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="ex">列の追加:</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>   <span class="ex">animal_kind</span> weight  size     name</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>         dog    5.0  60.0    pochi</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>         cat    6.0  30.0     tama</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>        fish   0.15   0.5  kintaro</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="ex">行の追加:</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>   <span class="ex">animal_kind</span> weight  size     name</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>         dog    5.0  60.0    pochi</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>         cat    6.0  30.0     tama</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>        fish   0.15   0.5  kintaro</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>        bird    1.0     3     piyo</span></code></pre></div>
<p>特定の列の値を利用して計算された新たな列を作成することも可能です.ここでは,<code>size</code>あたりの<code>weight</code>を計算してみます. 列を用いた計算では各行の値が計算されます.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#列を利用した計算</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'density'</span>] <span class="op">=</span> df[<span class="st">'weight'</span>] <span class="op">/</span> df[<span class="st">'size'</span>]</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<div class="sourceCode" id="cb57"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>  <span class="ex">animal_kind</span>  weight  size     name   density</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>         dog    5.00  60.0    pochi  0.083333</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>         cat    6.00  30.0     tama  0.200000</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>        fish    0.15   0.5  kintaro  0.300000</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>        bird    1.00   3.0     piyo  0.333333</span></code></pre></div>
<p>列や行を削除するには<code>.drop(行名 or 列名, axis= 0/1 )</code>を利用します.行を削除する場合は<code>axis=0</code>,列を削除する場合には<code>axis=1</code>と書きます. <code>axis='column'</code>,<code>axis='index'</code>でも行と列を選択することができます.
<code>inplace = True</code> を設定すると元のDataFrameが変更されますが,設定しないと新しいDataFrameが返され,元のDataFrameは変更されません.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">#列の削除</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>df.drop(<span class="st">'name'</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>       ,axis<span class="op">=</span><span class="st">'columns'</span> <span class="co"># or axis = 1</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>       ,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="co">#行の削除</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>df.drop(<span class="dv">4</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>       ,axis<span class="op">=</span><span class="st">'index'</span> <span class="co"># or axis = 0</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>       ,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<div class="sourceCode" id="cb59"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a> <span class="ex">animal_kind</span>  weight  size   density</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>         dog    5.00  60.0  0.083333</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>         cat    6.00  30.0  0.200000</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>        fish    0.15   0.5  0.300000</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>        bird    1.00   3.0  0.333333</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="ex">animal_kind</span>  weight  size   density</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>         dog    5.00  60.0  0.083333</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>         cat    6.00  30.0  0.200000</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>        fish    0.15   0.5  0.300000</span></code></pre></div>
<p>行名や列名にリストを指定すると,複数行/列が削除されます.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">#複数行の削除</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.drop([<span class="st">'weight'</span>,<span class="st">'size'</span>,<span class="st">'density'</span>],axis<span class="op">=</span><span class="dv">1</span>))</span></code></pre></div>
<div class="sourceCode" id="cb61"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>  <span class="ex">animal_kind</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>         dog</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>         cat</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>        fish</span></code></pre></div>
<h3 id="欠損値の処理">欠損値の処理</h3>
<p>例えば特定の日だけ値を入力し忘れている出勤簿や授業をサボった学生の成績など,現実のデータには抜けや欠損が付き物です. 抜けや欠損の無いデータを<strong>完備データ</strong>といい,欠損している部分を<strong>欠損値</strong>といいます.</p>
<p>pandasでは,csvの空白, 作成時の未定義部分 などが欠損値<code>NaN</code>(Not a Number) として表現されます.</p>
<p>例えば,DataFrame作成時にvaluesのサイズが合わない場合にはデータのない部分が<code>NaN</code>となります.
また,以下のように空白のあるCSVを読み込んだ場合には空白のセルが<code>NaN</code>となります.</p>
<figure>
<img src="../images/salary_nan.png" alt="salary_nan.cav" />
<figcaption aria-hidden="true">salary_nan.cav</figcaption>
</figure>
<div class="sourceCode" id="cb62"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co">#DataFrameの作成</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data <span class="op">=</span> [[<span class="st">'dog'</span>,<span class="dv">5</span>,<span class="dv">60</span>]</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>                         ,[<span class="st">'cat'</span>,<span class="dv">30</span>]</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>                         ,[<span class="st">'fish'</span>,<span class="fl">0.15</span>]]</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>                  ,columns<span class="op">=</span>[<span class="st">'animal_kind'</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>                          ,<span class="st">'weight'</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>                          ,<span class="st">'size'</span>])</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="co">#かけたデータの読み込み</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'data/salary_nan.csv'</span>)</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'-----</span><span class="ch">\n</span><span class="st">'</span>,df)</span></code></pre></div>
<div class="sourceCode" id="cb63"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>  <span class="ex">animal_kind</span>  weight  size</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>         dog    5.00  60.0</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>         cat   30.00   NaN</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>        fish    0.15   NaN</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="ex">-----</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>          <span class="ex">Industry</span>  Salary</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction  4503.0</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing  4756.0</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale  3186.0</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>   Accommodation     NaN</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance  5711.0</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate  3786.0</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport  3909.0</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy  8199.0</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>            Info     NaN</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu  3913.0</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med  4144.0</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other     NaN</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice  3086.0</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC  2190.0</span></code></pre></div>
<p><code>NaN</code>はすべての値に対して,<code>==</code>で<code>True</code>,<code>!=</code>で<code>False</code>を返すため,欠損値か否かの判定には,<code>==</code>や<code>!=</code>を使うことはできません. なお,<code>float('NaN')</code>で<code>float</code>型の<code>NaN</code>を生成できます.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'data/salary_nan.csv'</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.at[<span class="dv">8</span>,<span class="st">'Salary'</span>])</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'NaN == 1:'</span>,df.at[<span class="dv">8</span>,<span class="st">'Salary'</span>] <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'NaN == NaN:'</span>,df.at[<span class="dv">8</span>,<span class="st">'Salary'</span>] <span class="op">==</span> <span class="bu">float</span>(<span class="st">'NaN'</span>))</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'NaN != 1:'</span>,df.at[<span class="dv">8</span>,<span class="st">'Salary'</span>] <span class="op">!=</span> <span class="dv">1</span>)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'NaN != NaN:'</span>,df.at[<span class="dv">8</span>,<span class="st">'Salary'</span>] <span class="op">==</span> <span class="bu">float</span>(<span class="st">'NaN'</span>))</span></code></pre></div>
<div class="sourceCode" id="cb65"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nan</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="ex">NaN</span> == 1: False</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="ex">NaN</span> == NaN: False</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="ex">NaN</span> != 1: True</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="ex">NaN</span> != NaN: False</span></code></pre></div>
<p>欠損値の判定には<code>isna()</code>メソッドを利用します.DataFrameに利用することで<code>NaN</code>のあるセルにはTrue,<code>NaN</code>以外のセルに<code>False</code>を返します.また,<code>pd.isna(値)</code>の形で,値の判定も可能です.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'data/salary_nan.csv'</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.isna())</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.isna(df.at[<span class="dv">8</span>,<span class="st">'Salary'</span>]))</span></code></pre></div>
<div class="sourceCode" id="cb67"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Industry</span>  Salary</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>      False   False</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>      False   False</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>      False   False</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>      False    True</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>      False   False</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>      False   False</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>      False   False</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>      False   False</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>      False    True</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>      False   False</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>     False   False</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>     False    True</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>     False   False</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>     False   False</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a><span class="ex">True</span></span></code></pre></div>
<p>欠損のあるデータを分析する際には,欠損値をどのように処理するかを決める必要があります.
欠損値の処理の方法には<strong>除外</strong>, <strong>置換</strong>, <strong>補定(ほてい)</strong>,<strong>補完</strong>などいくつかの方法があり,pandasにおいても
<code>dropna()</code>,<code>fillna()</code>などのメソッドが提供されています.</p>
<p>元も単純な欠損値の処理方法は,欠損値のある行や列を除外してしまうことです. pandasにおいて欠損値の除外行うメソッドは<code>dropna()</code>です.</p>
<p><code>df.dropna(subset=除外したい列名のリスト,how=‘any’,inplace=True)</code>と記述することで
指定された列においてNaNの含まれる行の削除ができます.
<code>subset</code>を指定しないと,すべての列が対象となります.
<code>how ='any'</code>と指定すると, subsetに含まれる列のどれか, <code>how='all'</code>にすると, subsetに含まれる列の全てがNaNの場合にその行が削除されます.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#欠損値の削除</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.dropna(subset<span class="op">=</span>[<span class="st">'Salary'</span>],how<span class="op">=</span><span class="st">'any'</span>))</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'---</span><span class="ch">\n</span><span class="st">'</span>,df)</span></code></pre></div>
<div class="sourceCode" id="cb69"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>         <span class="ex">Industry</span>  Salary</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction  4503.0</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing  4756.0</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale  3186.0</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance  5711.0</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate  3786.0</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport  3909.0</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy  8199.0</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu  3913.0</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med  4144.0</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice  3086.0</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC  2190.0</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>         <span class="ex">Industry</span>  Salary</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction  4503.0</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing  4756.0</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale  3186.0</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>   Accommodation     NaN</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance  5711.0</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate  3786.0</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport  3909.0</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy  8199.0</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>            Info     NaN</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu  3913.0</span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med  4144.0</span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other     NaN</span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice  3086.0</span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC  2190.0</span></code></pre></div>
<p>inplace = True と設定するともとのDataFrameが変更されますが Falseに設定すると, もとのDataFrameには反映されません.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>df.dropna(subset<span class="op">=</span>[<span class="st">'Salary'</span>]</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>         ,how<span class="op">=</span><span class="st">'any'</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>         ,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<div class="sourceCode" id="cb71"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>         <span class="ex">Industry</span>  Salary</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction  4503.0</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing  4756.0</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale  3186.0</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance  5711.0</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate  3786.0</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport  3909.0</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy  8199.0</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu  3913.0</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med  4144.0</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice  3086.0</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC  2190.0</span></code></pre></div>
<h3 id="データの保存">データの保存</h3>
<p>pandasで作成, 加工したDataFrameオブジェクトは, csv等の形式でファイルに書き出すことができます.
DataFrameオブジェクト<code>df</code>をcsvファイルとして書き出すには<code>df.to_csv('ファイルパス')</code> と記述します. <code>encoding=</code>を追加して記述することでエンコードを指定することも可能です.
BOM付きのUTF-8の場合は<code>encoding='utf-8-sig'</code>と記述します.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> [[<span class="st">'dog'</span>,<span class="fl">5.0</span>,<span class="fl">60.0</span>]</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>         ,[<span class="st">'cat'</span>,<span class="fl">3.0</span>,<span class="fl">30.0</span>]</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>         ,[<span class="st">'fish'</span>,<span class="fl">0.15</span>,<span class="fl">0.5</span>]]</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co">#DataFrameの作成</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>values</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>                 ,columns<span class="op">=</span>[<span class="st">'animal_kind'</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>                          ,<span class="st">'weight'</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>                          ,<span class="st">'size'</span>])</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="co">#csvとして保存</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'data/animal.csv'</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>         ,encoding<span class="op">=</span><span class="st">'utf-8-sig'</span>)</span></code></pre></div>
<div class="warn">
<p>pandasで可能なデータの処理のうち,今回紹介したのは基本となるほんの一部です.ライブラリの活用方法や機能は日々増えており, 全部を扱うことはできません.必要に応じて自分で利用方法を調べて学習しましょう.</p>
</div>
<h3 id="データの取得と編集全体の演習">データの取得と編集全体の演習</h3>
<div class="note">
<p>演習問題</p>
<hr />
<ol type="1">
<li>データの作成と編集</li>
</ol>
<p>以下の条件に従うDataFrameを作成してください.</p>
<ul>
<li><p>columnsが’<code>1</code>‘,<code>'2'</code>,<code>'3'</code>,<code>'4'</code>,’<code>5</code>’</p></li>
<li><p>indexが<code>0~19</code></p></li>
<li><p>‘<code>1</code>’列の値はindexの1倍,<code>'2'</code>列の値はindexの2倍,<code>'3'</code>列の値はindexの3倍,<code>'4'</code>列の値はindexの4倍,’<code>5</code>’列の値はindexの5倍の値が入る.</p></li>
</ul>
<p>作成したDataFrameに以下の操作を加えてください.</p>
<ul>
<li><p><code>'3'</code>列を2倍した<code>'6'</code>という列を追加してください.</p></li>
<li><p><code>index</code>が<code>20</code>となる行を追加してください</p></li>
<li><p><code>'mean'</code>という各行の平均値からなる列を追加してください</p></li>
<li><p><code>index</code>が偶数の列のみを残して,すべての列を<code>int</code>型に変更した後<code>BOM付きのUTF-8</code>の<code>csv</code>で保存してください.</p></li>
</ul>
<ol start="2" type="1">
<li>外部データの読み込みと編集</li>
</ol>
<p>以下のURLから近世経済データのEXCELファイルをダウンロードし, 米相場の列に欠損値がないように変更し,データの基本的な構造を確認したのち米相場の平均値を求めてください.</p>
<p><a href="https://www.rieb.kobe-u.ac.jp/project/kinsei-db/database_excel.html">https://www.rieb.kobe-u.ac.jp/project/kinsei-db/database_excel.html</a></p>
</div>

<!-- 前後の章へのナビゲーション -->
<div class="chapter-navigation">
    <nav>
        
            <a class="nav-link prev" href="slds4.html">← Previous Chapter</a>
        
        
            <a class="nav-link next" href="slds6.html">Next Chapter →</a>
        
    </nav>
</div>

    <div style="clear: both"></div>

    <div id="footer">
        Site proudly generated by
        <a href="http://jaspervdj.be/hakyll">Hakyll</a>.
    </div>
</div>


    <!-- GUID -->
    <div style="display: none">ce0f13b2-4a83-4c1c-b2b9-b6d18f4ee6d2</div>

    
    <!-- KaTeX JavaScript and auto-render extension -->
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "\[", right: "\]", display: true},
            {left: "$", right: "$", display: false}
          ]
        });
      });
    </script>
    

    <!-- JavaScript TOC generator (only runs on lecture pages) -->
    <script>
    document.addEventListener("DOMContentLoaded", function() {
      var tocContainer = document.getElementById('lecture-toc');
      if (!tocContainer) return;

      // メインコンテンツから h2, h3, h4 を抽出
      var content = document.querySelector('article') || document.getElementById('content') || document.body;
      var headings = content.querySelectorAll('h2, h3, h4');
      if (headings.length === 0) return;

      // 目次用のUL要素を作成
      var tocList = document.createElement('ul');

      // 章番号カウンタ (h2, h3, h4に対応して配列を用意)
      var chapterNumbers = [0, 0, 0];

      headings.forEach(function(heading) {
        if (heading.closest('li')) return;

        var level;
        switch (heading.tagName.toLowerCase()) {
          case 'h2': level = 0; break;
          case 'h3': level = 1; break;
          case 'h4': level = 2; break;
          default: return;
        }

        chapterNumbers[level]++;
        for (var i = level + 1; i < chapterNumbers.length; i++) {
          chapterNumbers[i] = 0;
        }

        var chapterNumberStr = chapterNumbers.slice(0, level + 1).join('.');
        if (!heading.id) {
          heading.id = heading.textContent.trim().replace(/\s+/g, '-').toLowerCase();
        }

        var li = document.createElement('li');
        li.classList.add('toc-level-' + (level + 1));

        var anchor = document.createElement('a');
        anchor.href = '#' + heading.id;
        anchor.textContent = chapterNumberStr + ' ' + heading.textContent;

        li.appendChild(anchor);
        tocList.appendChild(li);
      });

      tocContainer.appendChild(tocList);
    });
    </script>
     <script>
  document.addEventListener("DOMContentLoaded", function() {
    // すべての <pre><code> 要素を走査
    const codeBlocks = document.querySelectorAll('pre code');
    codeBlocks.forEach(function(codeBlock) {
      // 親<pre>要素を取得
      const pre = codeBlock.parentNode;

      // <pre> を相対配置にし、子要素を絶対配置できるようにする
      pre.style.position = 'relative';

      // コピーボタンを作成
      const copyButton = document.createElement('button');
      copyButton.textContent = 'Copy';
      // ボタンのデザインはCSSで指定するのが望ましいが、簡易的にスタイルを直接指定する例:
      copyButton.style.position = 'absolute';
      copyButton.style.top = '8px';
      copyButton.style.right = '8px';
      copyButton.style.backgroundColor = '#add8e6'; // 水色
      copyButton.style.color = '#fff';             // 白文字
      copyButton.style.border = 'none';
      copyButton.style.padding = '6px 10px';
      copyButton.style.borderRadius = '4px';
      copyButton.style.cursor = 'pointer';

      // クリックされたらクリップボードにコピー
      copyButton.addEventListener('click', function() {
        const codeText = codeBlock.innerText;
        navigator.clipboard.writeText(codeText).then(function() {
          copyButton.textContent = 'Copied!';
          setTimeout(function() {
            copyButton.textContent = 'Copy';
          }, 2000);
        }, function(err) {
          console.error('Failed to copy: ', err);
        });
      });

      // ボタンを <pre> の子要素として挿入
      pre.appendChild(copyButton);
    });
  });
  </script>
  <script>
    function toggleMenu() {
      var nav = document.getElementById('navigation');
      nav.classList.toggle('open');
    }
  </script>
  </body>
</html>