<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>yakagika - 特別講義DS Ch9 データの数値化</title>

    <!-- Stylesheets. -->
    <link rel="stylesheet" type="text/css" href="../style.css?v=0">

    <!-- RSS. -->
    <link rel="alternate" type="application/rss+xml" title="yakagika" href="https://yakagika.github.io/rss.xml">

    <!-- Metadata. -->

    <meta name="keywords" content="yakagika Haskell ExchangeAlgebra">
    <meta name="description" content="Personal home page and blog of yakagika.">

    
    <!-- KaTeXのスタイルシートとJavaScriptのリンクを動的に挿入 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" integrity="sha384-wcIxkf4k558AjM3Yz3BBFQUbk/zgIYC2R0QpeeYb+TwlBVMrlgLqwRjRtGZiK7ww" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js" integrity="sha384-hIoBPJpTUs74ddyc4bFZSM1TVlQDA60VBbJS0oA934VSz82sBx1X7kSx2ATBDIyd" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
    <style>
      .katex-display {
        display: block;
        margin: 1em 0;
        text-align: center;
      }
      .katex .frac {
        vertical-align: baseline;
        -webkit-vertical-align: baseline;
      }
      .katex .sqrt {
        vertical-align: baseline;
        -webkit-vertical-align: baseline;
      }
      .katex .strut {
        height: 1em;
        -webkit-height: 1em;
      }
      .katex .base {
        font-family: 'KaTeX_Main', 'Arial', sans-serif;
      }
      @media screen and (-webkit-min-device-pixel-ratio:0) {
        .katex {
          line-height: normal !important;
        }
      }
      @media not all and (min-resolution: .001dpcm) {
        @supports (-webkit-appearance:none) {
          .katex {
            line-height: normal !important;
          }
        }
      }
    </style>
    

    
      <meta property="og:description" content="資料" />
    
  </head>

  <body>

    <!-- ハンバーガーメニューのボタン（小画面時に表示） -->
    <div class="hamburger" onclick="toggleMenu()">☰</div>

    <!-- ナビゲーションに drawer-menu クラスを付与 -->
    <div id="navigation" class="drawer-menu">
      <h1>Contents</h1>
      <a href="../">Home</a>
      <a href="../posts.html">Blog</a>
      <a href="../lectures.html">Lecture</a>
      <a href="../research.html">Research</a>
      <a href="../contact.html">Contact</a>
      <!-- <a href="/cv.html">CV</a> -->

      <h1>Links</h1>
      <a href="http://github.com/yakagika" target="_blank" rel="noopener">GitHub</a>
      <a href="https://researchmap.jp/k-akagi" target="_blank" rel="noopener">researchmap</a>

      
      <div id="lecture-toc">
        <h1>Table of Contents</h1>
        <!-- The TOC will be generated here by JavaScript -->
      </div>
      
    </div>

    <div id="content">
    <h1>特別講義DS Ch9 データの数値化</h1>
<div class="soft">
    資料<br />
    Published on 2024-03-29 under the tag <a title="All pages tagged 'datascience'." href="../tags/datascience.html">datascience</a>, <a title="All pages tagged 'statistics'." href="../tags/statistics.html">statistics</a>, <a title="All pages tagged 'python'." href="../tags/python.html">python</a>
</div>

<!-- 前後の章へのナビゲーション -->
<div class="chapter-navigation">
    <nav>
        
            <a class="nav-link prev" href="slds8.html">← Previous Chapter</a>
        
        
            <a class="nav-link next" href="slds10.html">Next Chapter →</a>
        
    </nav>
</div>

<br>

<h2 id="データの数値化">データの数値化</h2>
<p>データを可視化することで,データの大まかな傾向はつかめます. しかし,グラフではデータの特徴を大まかにしか捉えることが出来ません.
実際に,データの特徴に関して言及するためにはそれを数値にする必要があります.</p>
<p>例えば,以下のヒストグラム(<a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/histogram_A_B_data.csv">データ</a>)を見てみましょう.</p>
<figure>
<img src="../images/histogram_compare.png" alt="ヒストグラムの比較" />
<figcaption aria-hidden="true">ヒストグラムの比較</figcaption>
</figure>
<p>ヒストグラムAと比較して,Bはデータの<strong>中心が右</strong>にあり,データの<strong>散らばりが大きい</strong>ように見えます. しかし,それらが具体的にどの程度右にあり,どの程度散らばりが大きいのでしょうか.
このように,グラフによる比較では,抽象的な印象しか語ることができないため,データの中心や,散らばりを数値で表すことが必要です.</p>
<p>数値化の対象となる量は,データの種類や分析の目的によって様々ですが,大まかに以下のような分類が可能です.</p>
<div class="note">
<ul>
<li><h3 id="データの数値化-1">データの数値化</h3></li>
</ul>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">データの数</th>
<th style="text-align: center;">データの種類</th>
<th style="text-align: center;">求める数値</th>
<th style="text-align: center;">目的</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">量的変数</td>
<td style="text-align: center;">基本統計量</td>
<td style="text-align: center;">データの特徴を知る</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">量的変数</td>
<td style="text-align: center;">ピアソンの積率相関係数</td>
<td style="text-align: center;">データの関係を知る</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2</td>
<td style="text-align: center;">質的変数</td>
<td style="text-align: center;">ピアソンのΧ二乗統計量 <br> スピアマンの順位相関係数</td>
<td style="text-align: center;">データの関係を知る</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">混在</td>
<td style="text-align: center;">寄与率,相関比</td>
<td style="text-align: center;">データの関係を知る</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3以上</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">次元削減,多変量解析など多数</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
</div>
<h3 id="基本統計量">基本統計量</h3>
<p>量的データを客観的に評価するために,分布の特徴を数値で表したものを<strong>基本統計量(代表値)</strong>といいます.</p>
<div class="note">
<ul>
<li>基本統計量</li>
</ul>
<table>
<colgroup>
<col style="width: 55%" />
<col style="width: 44%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">名称</th>
<th style="text-align: left;">概要</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">平均 (Mean)</td>
<td style="text-align: left;">データの平均値.量的データの分布の中心傾向を示す</td>
</tr>
<tr class="even">
<td style="text-align: center;">中央値 (Median)</td>
<td style="text-align: left;">データの順位における中央.量的データの分布の中心傾向を示す</td>
</tr>
<tr class="odd">
<td style="text-align: center;">最頻値 (Mode)</td>
<td style="text-align: left;">最も度数の多い値.量的データの分布の中心傾向を示す</td>
</tr>
<tr class="even">
<td style="text-align: center;">標準偏差 (Standard Deviation)</td>
<td style="text-align: left;">データのばらつき具合を示す.</td>
</tr>
<tr class="odd">
<td style="text-align: center;">分散 (Variance)</td>
<td style="text-align: left;">データのばらつき具合を示す.</td>
</tr>
<tr class="even">
<td style="text-align: center;">尖度 (Kurtosis)</td>
<td style="text-align: left;">外れ値の度合い</td>
</tr>
<tr class="odd">
<td style="text-align: center;">歪度 (Skewness)</td>
<td style="text-align: left;">分布の歪み</td>
</tr>
</tbody>
</table>
</div>
<p>Pythonでは, pandasのDataFrameに対して, <code>.describe()</code>メソッドを適用すると, データ数(<code>count</code>),平均値(<code>mean</code>),中央値(<code>50%</code>),四分位数(<code>24%,75%</code>),標準偏差(<code>std</code>),最大値(<code>max</code>),最小値(<code>min</code>)などが求まります.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'data/histogram_A_B_data.csv'</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.describe())</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">python quantify.py</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">       Histogram_A  Histogram_B</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">count  1000.000000  1000.000000</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">mean     60.289981    50.708362</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">std      14.688239     9.974544</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">min      11.380990    20.596114</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">25%      50.286145    43.937583</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">50%      60.379509    50.630771</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">75%      69.719158    57.288822</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">max     117.790972    81.931076</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>それぞれの統計量の意味を順番に見ていきましょう.</p>
<h3 id="中心を表す基本統計量">中心を表す基本統計量</h3>
<p>ヒストグラムにおける峰のある位置,分布の中心がどこにあるかを表す統計量には,<strong>平均値</strong>,<strong>中央値</strong>,<strong>最頻値</strong>などがあります. この3つは,いずれも分布の中心を表す統計量ですが,分布の歪みによって意味が異なり,使い分けが必要となります.</p>
<ul>
<li><h3 id="算術平均-mean"><strong>算術平均 (mean)</strong></h3>
分布の中心を表す統計量としてもっとも一般的なものに,平均値があります. しかし, 一言に平均といっても,いくつかの種類があるので注意しましょう. 分布の中心を表す場合に用いられる平均は基本的に算術平均ですが, ここでは異なる定義の平均として, <strong>幾何平均</strong>と<strong>調和平均</strong>も紹介します.</li>
</ul>
<p>一般に「平均」といった時にイメージされる,すべてのデータの和をデータの個数で割った値を<strong>算術平均</strong>といいます.</p>
<p>算術平均は対象とするデータを足し合わせることによって基準となる値が算出される場合に使用します.</p>
<div class="note">
<p>n個の観測値 $ x_1, x_2, …, x_n $ の時,平均値 $ {x} $ は</p>
<p><span class="math display">$$ \bar{x} = \frac{1}{n} (x_1 + ... + x_n) = \frac{1}{n} \sum_{i=1}^{n} x_i $$</span></p>
</div>
<p>例： 165,171,189の算術平均は</p>
<p><span class="math display">$$ \bar{x} = \frac{1}{3} (165 + 171 + 189) = 175 $$</span></p>
<p>となります.</p>
<p><code>pandas</code>で平均を求めるには, <code>.mean()</code>を利用します.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'x'</span>:[<span class="dv">165</span>,<span class="dv">171</span>,<span class="dv">189</span>]})</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'x'</span>].mean()) <span class="co">#&gt;&gt;&gt;175</span></span></code></pre></div>
<ul>
<li><h3 id="幾何平均geometric-mean"><strong>幾何平均(geometric mean)</strong></h3></li>
</ul>
<p>すべてのデータを乗じて,データの数で根を取った値を<strong>幾何平均</strong>といいます. 増加率,減少率など対象とするデータを相互に乗じることによって基準となる値が算出される場合に使用します.</p>
<div class="note">
<p><span class="math inline"><em>n</em></span>個の観測値 <span class="math inline"><em>x</em><sub>1</sub>, <em>x</em><sub>2</sub>, ..., <em>x</em><sub><em>n</em></sub></span> の時,幾何平均 <span class="math inline"><em>x</em><sub><em>G</em></sub></span> は
<span class="math display">$$ x_G = \sqrt[n]{x_1 \cdot x_2 \cdot ... \cdot x_n} = (\prod_{i}^{n} x_i)^{\frac{1}{n}} $$</span></p>
</div>
<p>例：各年の売上と,その増加率が以下のように表されるとき,平均何%売上が伸びているかを考える.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">年度</th>
<th style="text-align: center;">売上</th>
<th style="text-align: center;">増加率</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">300</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">350</td>
<td style="text-align: center;">117%</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">600</td>
<td style="text-align: center;">171%</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">1000</td>
<td style="text-align: center;">167%</td>
</tr>
</tbody>
</table>
<p>このとき算術平均を用いると,
<span class="math display">$$ 算術平均 = \frac{1.17 + 1.71 + 1.67}{3} \approx 1.52 $$</span> となり,</p>
<p><span class="math display">300 ⋅ 1.52<sup>3</sup> ≈ 1045</span></p>
<p>平均的な伸び率を3回乗じても4年目の売上の値になりません. これは,毎年度の値に増加率を<strong>掛ける</strong>ことで次の年度の値が求まるのに対して,算術平均は毎年度足す操作をしたばあいの平均値を求めているからです.</p>
<p>そこで,幾何平均を求めてみると.</p>
<p><span class="math display">$$ 幾何平均 = \sqrt[3]{1.17 \cdot 1.71 \cdot 1.67} \approx 1.49, \\
300 \cdot 1.49^3 \approx 1000 $$</span>
となり, 正確に4年目の値が計算できていることが分かります.</p>
<ul>
<li><h3 id="調和平均harmonic-mean"><strong>調和平均(harmonic mean)</strong></h3>
先程の幾何平均が掛け算の平均値だったのに対して,割り算の平均値を<strong>調和平均</strong>といい,速度などの定義に割り算が含まれている計算で用います.</li>
</ul>
<p>調和平均は対象とするデータに別の値を除して足し合わせることによって基準となる値が算出される場合に使用します.</p>
<div class="note">
<p><span class="math inline"><em>n</em></span>個の観測値 <span class="math inline"><em>x</em><sub>1</sub>, <em>x</em><sub>2</sub>, ..., <em>x</em><sub><em>n</em></sub></span> の時,調和平均 <span class="math inline"><em>x</em><sub><em>H</em></sub></span> は
<span class="math display">$$ \frac{1}{x_H} = \frac{1}{n} \left( \frac{1}{x_1} + ... + \frac{1}{x_n} \right) \\
 \iff \\
 x_H = \frac{n}{\frac{1}{x_1} + ... + \frac{1}{x_n}}  = \frac{n}{\sum_{i=1}^{n} \frac{1}{x_i}}$$</span></p>
</div>
<p>例：平均速度</p>
<p>100kmの道のりを行きは車 (60km/h),帰りは自転車 (30km/h) で移動した場合,算術平均は 45km/hとなります. しかし,</p>
<p>かかった時間は <span class="math inline">$\frac{距離}{速度}$</span>で求まるので,
車は <span class="math inline">$\frac{100}{60}$</span>, 自転車 は <span class="math inline">$\frac{100}{30}$</span> となり,速度は <span class="math inline">$\frac{距離}{時間}$</span> で求まるので</p>
<p>平均速度は,
<span class="math display">$$ \frac{200}{\frac{200}{60} + \frac{200}{30}} = \frac{2}{\frac{1}{30} + \frac{1}{60}} = 40 $$</span></p>
<p>となります. 算術平均では正確に計算できていないことが分かります.</p>
<p>この <span class="math display">$$\frac{200}{\frac{200}{60} + \frac{200}{30}} $$</span>
が調和平均です.</p>
<ul>
<li><h3 id="中央値median"><strong>中央値(median)</strong></h3></li>
</ul>
<p>中心を表す統計量として,データを昇順に並び替えて,そのちょうど真ん中の数を表す<strong>中央値</strong>も良く利用されます.</p>
<div class="note">
<p><span class="math inline"><em>n</em></span>個の観測値を大きさの順に並べ替えて <span class="math inline"><em>x</em><sub>1</sub>, <em>x</em><sub>2</sub>, ..., <em>x</em><sub><em>n</em></sub></span> とした時,
中央値 <span class="math inline"><em>x̃</em></span> は</p>
<p><span class="math display">$$ \tilde{x} =
\begin{cases}
x_{\frac{n+1}{2}}, ~~&amp; if ~~ n \mod 2 \neq 0 \\
\frac{x_{ \frac{n}{2}} + x_{\frac{n}{2} + 1 }}{2}, ~~ &amp; if~~ n \mod 2 = 0
\end{cases}
$$</span></p>
</div>
<p>例：観測値が <span class="math inline">3, 4, 7, 9, 11, 12, 15</span> の時 中央値は
<span class="math display">$$ \tilde{x} = x_{\frac{n+1}{2}} = x_{\frac{8}{2}} = x_4 = 9 $$</span></p>
<p>となります.</p>
<p>また,観測値が <span class="math inline">4, 5, 6, 10, 14, 17</span> のように偶数個の場合は
<span class="math display">$$ \tilde{x} = \frac{x_{ \frac{n}{2}} + x_{\frac{n}{2} + 1 }}{2} = \frac{6 + 10}{2} = 8 $$</span></p>
<p>となります.</p>
<p><code>pandas</code>では,中央値は<code>.median()</code>で求めることができます.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'x'</span>:[<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">9</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">15</span>]})</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'x'</span>].median()) <span class="co">#9.0</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'x'</span>:[<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">10</span>,<span class="dv">14</span>,<span class="dv">17</span>]})</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'x'</span>].median()) <span class="co">#8.0</span></span></code></pre></div>
<ul>
<li><h3 id="四分位数-quartiles">四分位数 (quartiles)</h3></li>
</ul>
<p><strong>中央値:</strong> データを小さい順に並べた時に観測数が50%となる点</p>
<p><strong>四分位数:</strong>
データを小さい順に並べた時に,観測数が25%, 50%, 75%となる点.
第一四分位数 (25%),第二四分位数 (50%),第三四分位数 (75%)</p>
<p><strong>四分位範囲:</strong>
四分位範囲 = 第一四分位数から第三四分位数の範囲</p>
<figure>
<img src="../images/quartiles.png" alt="四分位数" />
<figcaption aria-hidden="true">四分位数</figcaption>
</figure>
<p><code>pandas</code>で四分位数を用いるには, <code>.quantile(q=%点の数値,interpolation='nearest')</code>で求めることができます.
<code>interpolation</code> (補間) は,値がインデックス<code>i</code>と<code>j</code>の間にある場合に補間する方法を指定する引数で以下のような設定が可能です.</p>
<p><code>.quantile()</code>では, データの最大インデックス掛ける<code>q</code>で必要な値を求めます. なので例えば<code>xs=[2,5,8,9,11,13,15,16,19,22,24]</code>の25%点は,<code>10*0.25=2.5</code>となり<code>xs[2.5]</code>となるような点を求めます.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">引数</th>
<th style="text-align: left;">効果</th>
<th style="text-align: left;">25%点の場合の計算</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>'linear'</code></td>
<td style="text-align: left;">線形補間</td>
<td style="text-align: left;"><code>xs[2] + (xs[2] - xs[3]) * 0.5 = 8.5</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>'lower'</code></td>
<td style="text-align: left;">小さい方</td>
<td style="text-align: left;"><code>xs[2] = 8</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>'higher'</code></td>
<td style="text-align: left;">大きい方</td>
<td style="text-align: left;"><code>xs[3] = 9</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>'midpoint'</code></td>
<td style="text-align: left;">中間</td>
<td style="text-align: left;"><code>(xs[2] + xs[3])/2 = 8.5</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>'nearest'</code></td>
<td style="text-align: left;">近い方</td>
<td style="text-align: left;"><code>xs[2] = 8</code></td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb4"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> [<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">11</span>,<span class="dv">13</span>,<span class="dv">15</span>,<span class="dv">16</span>,<span class="dv">19</span>,<span class="dv">22</span>,<span class="dv">24</span>]</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'x'</span>:xs})</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'25%点:'</span>,df[<span class="st">'x'</span>].quantile(q<span class="op">=</span><span class="fl">0.25</span>, interpolation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'25%点:'</span>,df[<span class="st">'x'</span>].quantile(q<span class="op">=</span><span class="fl">0.25</span>, interpolation<span class="op">=</span><span class="st">'nearest'</span>))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'50%点:'</span>,df[<span class="st">'x'</span>].quantile(q<span class="op">=</span><span class="fl">0.5</span>, interpolation<span class="op">=</span><span class="st">'nearest'</span>))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'75%点:'</span>,df[<span class="st">'x'</span>].quantile(q<span class="op">=</span><span class="fl">0.75</span>, interpolation<span class="op">=</span><span class="st">'nearest'</span>))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">25%点: 8.5</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">25%点: 8</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">50%点: 13</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">75%点: 19</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<ul>
<li><h3 id="最頻値-mode">最頻値 (mode)</h3></li>
</ul>
<p>中心を表す統計量の最後は,最も頻繁にあらわれる値,すなわち度数分布表において最も度数の高い階級を表す<strong>最頻値</strong>です.</p>
<div class="note">
<p>最頻値はデータの種類に応じて,意味が異なるので注意が必要です.
(※ 質的データの平均値などは定義できません)</p>
<ul>
<li><p>質的データの場合</p>
<ul>
<li>最大度数のカテゴリー</li>
</ul></li>
<li><p>量的データの場合</p>
<ul>
<li><p>最大度数の階級 = 最頻階級 (modal class)</p></li>
<li><p>長さや気温など同じ間隔で値が存在するもの</p></li>
</ul></li>
</ul>
</div>
<p><code>pandas</code>で最頻値を求める方法は色々ありますが, 単純に同じデータが最も多い値を探す場合には<code>.mode()</code>が利用できます. <code>.mode()</code>は最頻値が複数ある場合に対応するために<code>DataSeries</code>Objectを返すので,<code>[0]</code>で最初の値を取っています.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'x'</span>:[<span class="st">'A'</span>,<span class="st">'A'</span>,<span class="st">'B'</span>,<span class="st">'C'</span>]})</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'x'</span>].mode()[<span class="dv">0</span>]) <span class="co"># A</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'x'</span>:[<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">3</span>]})</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'x'</span>].mode()[<span class="dv">0</span>]) <span class="co"># 3</span></span></code></pre></div>
<p>しかし,この方法では連続値の数値などにおける定義での最頻値は求められません. 特定の区間の最頻値を求めたい場合は<code>value_count()</code>などを利用して求めましょう.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ランダムな1から100までのデータの生成</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">0</span>)  <span class="co"># 再現性のためにシードを設定</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'x'</span>:np.random.randint(<span class="dv">0</span>, <span class="dv">101</span>, size<span class="op">=</span><span class="dv">1000</span>)})</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#10区切りで度数を求める</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> [<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">70</span>,<span class="dv">80</span>,<span class="dv">90</span>,<span class="dv">100</span>]</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>freq <span class="op">=</span> df[<span class="st">'x'</span>].value_counts(bins <span class="op">=</span>bins, sort<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(freq)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">#最大の度数のindexを取得</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(freq.idxmax())</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">      x</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">0    44</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">1    47</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">2    64</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">3    67</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co">4    67</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co">..   ..</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co">995  79</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co">996  41</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="co">997  17</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co">998  80</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co">999  43</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co">[1000 rows x 1 columns]</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="co">(-0.001, 10.0]    121</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="co">(10.0, 20.0]       87</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="co">(20.0, 30.0]       96</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="co">(30.0, 40.0]      107</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="co">(40.0, 50.0]       94</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="co">(50.0, 60.0]       92</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="co">(60.0, 70.0]       97</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="co">(70.0, 80.0]      103</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="co">(80.0, 90.0]      103</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="co">(90.0, 100.0]     100</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="co">Name: count, dtype: int64</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="co">(-0.001, 10.0]</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<div class="note">
<ul>
<li><h3 id="中心を表す代表値の使い分け">中心を表す代表値の使い分け</h3></li>
</ul>
<p>中心を表す基本統計量である,<strong>算術平均</strong>,<strong>中央値</strong>,<strong>最頻値</strong>は,ヒストグラムが<strong>単峰で左右対称</strong>である場合一致します. したがってヒストグラムを作成して単峰で左右対称である場合には,どの値を利用しても大きな違いは生まれません.</p>
<p>一方で,分布が歪んでいる場合には,それぞれの統計量の値が変わります. 中心を表す統計量として,何も考えずに算術平均を利用する人がいますが,分布が歪んでいる場合には目的に応じて最頻値や中央値の方が適当である場合があります.</p>
<figure>
<img src="../images/mean_median_mode.png" alt="分布の歪みと中心" />
<figcaption aria-hidden="true">分布の歪みと中心</figcaption>
</figure>
<p>例えば,以下の図は,日本人の平均所得を表したヒストグラムです.</p>
<figure>
<img src="../images/mean_median_mode2.png" alt="https://www.mhlw.go.jp/toukei/saikin/hw/k-tyosa/k-tyosa09/2-2.html" />
<figcaption aria-hidden="true"><a href="https://www.mhlw.go.jp/toukei/saikin/hw/k-tyosa/k-tyosa09/2-2.html">https://www.mhlw.go.jp/toukei/saikin/hw/k-tyosa/k-tyosa09/2-2.html</a></figcaption>
</figure>
<p>この図では,分布が大きく右に歪んでいるため平均値,中央値,最頻値の値が異なっています.それぞれの値が何を意味するのかを考えてみましょう.</p>
<ul>
<li>平均値: 547万円
<ul>
<li>全員の所得を足して一人あたりで割る(仮に全員平等にもらえるならこの金額)</li>
</ul></li>
<li>中央値: 427万円
<ul>
<li>下から所得の低い順に並んだときに真ん中の人(これ以上なら真ん中より上の所得)</li>
</ul></li>
<li>最頻値: 250万円
<ul>
<li>一番多い(街で適当に声をかけるとコレくらいである可能性が高い)</li>
</ul></li>
</ul>
<p>このようなときに, 世間一般の人の感覚を表す値として平均値を利用することは適当ではないでしょう. 平均値は,分布が歪んでいる場合には少数のデータに大きく引っ張られるため全体の傾向を表せない場合があります.</p>
<p>例えば,年収300万円の人が100人いる村に年収50億円の野球選手が引っ越してくると,平均年収は5000万円,中央値,最頻値は300万円になります.</p>
<p>統計量はそれぞれの意味を把握したうえで, 目的に応じて使い分けるようにしましょう.</p>
</div>
<h3 id="データの広がりを表す統計量">データの広がりを表す統計量</h3>
<p>分布の中心がどこかという点の他に,データがどのように広がっているかもデータの特徴を記述するうえでは重要です.</p>
<figure>
<img src="../images/histogram_compare.png" alt="ヒストグラムの比較" />
<figcaption aria-hidden="true">ヒストグラムの比較</figcaption>
</figure>
<p>データの広がり具合を<strong>散布度</strong>といいますが,散布度を表す統計量として代表的なものに<strong>分散</strong>と<strong>標準偏差</strong>があります.</p>
<p>データの散らばり具合を数値化するために,どのように考えるかを順におって見ましょう.
データがどの程度散らばっているかを考える際の基準の一つが算術平均 <span class="math inline"><em>x̄</em></span> です.
各データ <span class="math inline"><em>x</em><sub><em>i</em></sub></span> が,データの算術平均からどの程度離れているのかを考えてみましょう.</p>
<figure>
<img src="../images/deviation.png" alt="偏差" />
<figcaption aria-hidden="true">偏差</figcaption>
</figure>
<div class="note">
<ul>
<li><strong>偏差(deviation)</strong></li>
</ul>
<p><span class="math display">観測値<em>x</em><sub><em>i</em></sub>と平均<em>x̄</em>の差 = <em>x</em><sub><em>i</em></sub> − <em>x̄</em></span></p>
</div>
<p>この偏差がデータ全体でどのくらい大きいのかを考えるために<strong>偏差の平均</strong>を取ります.
ただし,平均からの差は,すべて足し合わせると0になるため,絶対値を取ります.これを<strong>平均偏差</strong>と呼びます.</p>
<div class="note">
<ul>
<li><strong>平均偏差(mean deviation)</strong></li>
</ul>
<p>各観測値が平均からどれだけ離れているかの絶対値平均</p>
<p><span class="math display">$$ d = \frac{1}{n} \sum_{i=1}^{n} |x_i - \bar{x}| $$</span></p>
</div>
<p>絶対値の計算は面倒なので,値が大きくはなるけれど2乗してみることにします. これが<strong>分散</strong>です.</p>
<div class="note">
<ul>
<li><strong>分散(variance)</strong></li>
</ul>
<p>各観測値の偏差の2乗の平均</p>
<p><span class="math display">$$ S^2 = \frac{1}{n} \sum_{i=1}^{n} (x_i - \bar{x})^2 $$</span></p>
</div>
<p>2乗すると値が大きくなるので,単位をもとのデータに合わせるために分散の平方根をとります(例えば, <span class="math inline"><em>x</em><sub><em>i</em></sub></span> の単位がKgのとき, <span class="math inline"><em>S</em><sup>2</sup></span> の単位は <span class="math inline"><em>K</em><em>g</em><sup>2</sup></span> となってしまう).これを標準偏差といいます.</p>
<div class="note">
<ul>
<li><strong>標準偏差(standard deviation)</strong></li>
</ul>
<p><span class="math display">$$ S = \sqrt{S^2} $$</span></p>
</div>
<p>例えば, データが<code>[9,6,12,18,10]</code>の場合を考えてみましょう. 何を計算しているのか,イメージしながら順番に計算していきましょう.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> [<span class="dv">9</span>,<span class="dv">6</span>,<span class="dv">12</span>,<span class="dv">18</span>,<span class="dv">10</span>]</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'data'</span>:data})</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">  data</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">0     9</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">1     6</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">2    12</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">3    18</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">4    10</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>まずは平均からの差(偏差)を求めてみます.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#平均</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>barx <span class="op">=</span> df[<span class="st">'data'</span>].mean()</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(barx) <span class="co">#11.0</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 偏差</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'dev'</span>] <span class="op">=</span> df[<span class="st">'data'</span>] <span class="op">-</span> barx</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">   data  dev</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">0     9 -2.0</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">1     6 -5.0</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co">2    12  1.0</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">3    18  7.0</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co">4    10 -1.0</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>次に偏差の2乗とその平均(分散)を求めます.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#偏差の2乗</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'dev2'</span>] <span class="op">=</span> df[<span class="st">'dev'</span>] <span class="op">*</span> df[<span class="st">'dev'</span>]</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">   data  dev  dev2</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">0     9 -2.0   4.0</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">1     6 -5.0  25.0</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">2    12  1.0   1.0</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">3    18  7.0  49.0</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">4    10 -1.0   1.0</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">#偏差の2乗の平均(分散)</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'dev2'</span>].mean()) <span class="co">#16.0</span></span></code></pre></div>
<p>最後に分散の累乗根をとって,標準偏差を求めます.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#偏差の2乗の平均の累乗根(標準偏差)</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.sqrt(df[<span class="st">'dev2'</span>].mean())) <span class="co">#4.0</span></span></code></pre></div>
<p>計算から,このデータの分散は<code>16</code>,標準偏差は<code>4</code>であることが分かりました.</p>
<p><code>pandas</code>では,分散は<code>.var(ddof=0)</code>,標準偏差は<code>.std(ddof=0)</code>で求めることができます.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'分散:'</span>,df[<span class="st">'data'</span>].var(ddof<span class="op">=</span><span class="dv">0</span>)) <span class="co">#16.0</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'標準偏差:'</span>,df[<span class="st">'data'</span>].std(ddof<span class="op">=</span><span class="dv">0</span>)) <span class="co">#4.0</span></span></code></pre></div>
<div class="warn">
<ul>
<li>不偏分散,不偏標準偏差</li>
</ul>
<p><code>.var()</code>と<code>.std()</code>における引数<code>ddof=0</code>とはなんでしょうか.これは,分散を求める際の分母の値から引く数を表しています(引いた後の値を自由度といいます).</p>
<p>デフォルトの値は,<code>ddof=1</code>となっており,</p>
<p><span class="math display">$$\frac{1}{n-1} \sum_{i=1}^{n} (x_i - \bar{x})^2$$</span> を求めています.</p>
<p>このような分母が <span class="math inline"><em>n</em> − 1</span>となっている分散を<strong>不偏分散</strong>といいます. 一方で,これまで計算してきた値を<strong>標本分散</strong>といいます.</p>
<p>不偏分散の意味に関しては, 統計学入門で学習していただくとして,ここでは一言に分散や標準偏差といっても,
細かくは<strong>標本分散</strong>,<strong>不偏分散</strong>,<strong>母分散</strong>などの異なる概念があることに注意しましょう.
特にプログラムにおいて, 分散や標準偏差を求める際には,それがなんの値なのかに注意が必要です.
ネット上の記事などにおいても混同していることが多いので, 実際に自分で計算して確かめることをおすすめします.</p>
<p>例えば,<code>pandas</code>における<code>describe()</code>で表示される<code>std</code>は不偏標準偏差であり,<code>std(ddof=0)</code>の値とは異なります.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'data'</span>].describe())</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">count     5.000000</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">mean     11.000000</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">std       4.472136</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">min       6.000000</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">25%       9.000000</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">50%      10.000000</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">75%      12.000000</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">max      18.000000</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co">Name: data, dtype: float64</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
</div>
<div class="note">
<ul>
<li><p>演習</p></li>
<li><p>算術平均,幾何平均, 調和平均,標本標準偏差を計算する関数をそれぞれ作成してください.</p></li>
<li><p><a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/histogram_A_B_data.csv">こちら</a>のデータの列ごとの算術平均,中央値,最頻値,標本分散,標本標準偏差を求めよ</p></li>
</ul>
</div>
<h3 id="相関">相関</h3>
<p>基本統計量は,一つの観測項目に対する数値化の手法でしたが,可視化における散布図のように,2つの観測項目間の関係を数値で表すことが可能です.</p>
<p>散布図の節で扱った<a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/scatter.csv">事例</a>についてもう一度考えてみましょう.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>     <span class="ex">AI</span>  Python</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    34      27</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>    40      26</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>    59      28</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    46      29</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>    36      29</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="ex">..</span>   ..     ...</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="ex">255</span>  58      83</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="ex">256</span>  69      87</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="ex">257</span>  59      82</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="ex">258</span>  62      84</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="ex">259</span>  59      87</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'data/scatter.csv'</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#散布図のx軸を指定</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>x_column <span class="op">=</span> <span class="st">'AI'</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#散布図のy軸を指定</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>y_column <span class="op">=</span> <span class="st">'Python'</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>x_value <span class="op">=</span> df[x_column]</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>y_value <span class="op">=</span> df[y_column]</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>plt.scatter(x_value, y_value)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(y_column)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(x_column)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="../images/scatter.png" alt="散布図" />
<figcaption aria-hidden="true">散布図</figcaption>
</figure>
<p>Google Trendの <code>AI</code>と<code>Python</code>の検索数から散布図を作成すると, AIの検索数が増えるにつれて<code>Python</code>の検索数が増えていることが分かります.</p>
<div class="note">
<ul>
<li><h3 id="相関関係">相関関係</h3></li>
</ul>
<p>このような関係を<strong>相関関係(correlation)</strong>といい,2つの変数の間に直線関係に近い傾向が見られるときに｢<strong>相関関係がある</strong>｣といいます.</p>
<p>直線的であるほど<strong>強い相関</strong>,逆を<strong>弱い相関</strong>といいます.</p>
<p>また,</p>
<ul>
<li>一方が増加したとき,他方が増加する関係を <strong>正の相関関係</strong></li>
<li>一方が増加したとき,他方が減少する関係を <strong>負の相関関係</strong></li>
</ul>
<p>といいます.</p>
<p>このような相関関係があるかないかは,散布図を見ただけである程度判断が可能ですが, 相関が<strong>ある/ない</strong>,<strong>強い/弱い</strong>というのは抽象的な表現なので, 厳密に判断する場合にはそれらを数値として表す必要があります.</p>
<figure>
<img src="../images/corre1.png" alt="相関関係" />
<figcaption aria-hidden="true">相関関係</figcaption>
</figure>
<p>相関関係を数値化したものを<strong>相関係数(correlation coefficient)</strong>といい,データの尺度に応じて,以下のような種類が存在します.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">尺度</th>
<th style="text-align: center;">係数</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">量的変数 <span class="math inline">×</span> 量的変数</td>
<td style="text-align: center;">ピアソンの積率相関係数</td>
</tr>
<tr class="even">
<td style="text-align: center;">順位尺度 <span class="math inline">×</span> 順位尺度</td>
<td style="text-align: center;">スピアマンの順位相関係数</td>
</tr>
<tr class="odd">
<td style="text-align: center;">名義尺度 <span class="math inline">×</span> 質的変数</td>
<td style="text-align: center;">ピアソンの <span class="math inline">$\Chi^2$</span> 統計量</td>
</tr>
</tbody>
</table>
</div>
<h4 id="ピアソンの積率相関係数">ピアソンの積率相関係数</h4>
<p>2つの量的変数に利用される相関係数を<strong>ピアソンの積率相関係数(product moment correlation coefficient)</strong>といいます.</p>
<p>データが <span class="math inline">(<em>x</em><sub>1</sub>,<em>y</em><sub>1</sub>), (<em>x</em><sub>2</sub>,<em>y</em><sub>2</sub>), ..., (<em>x</em><sub><em>n</em></sub>,<em>y</em><sub><em>n</em></sub>)</span> の時,</p>
<p><span class="math display">$$
\begin{align*}
r_{xy} &amp;= \frac{\sum (x_i - \bar{x})(y_i - \bar{y}) / n}{\sqrt{\sum (x_i - \bar{x})^2 / n} \sqrt{\sum (y_i - \bar{y})^2 / n}} \\
&amp; = \frac{\sum (x_i - \bar{x})(y_i - \bar{y})}{\sqrt{\sum (x_i - \bar{x})^2} \sqrt{\sum (y_i - \bar{y})^2}} \\
&amp;= \frac{s_{xy}}{s_x s_y}
\end{align*}
$$</span></p>
<p>なお,
<span class="math display">$$
\quad s_{xy} = \frac{1}{n} \sum (x_i - \bar{x})(y_i - \bar{y})
$$</span>
を <span class="math inline"><em>x</em></span> と <span class="math inline"><em>y</em></span> の共分散といい,相関係数は <span class="math inline">$\frac{xとyの共分散}{xの標準偏差 \times yの標準偏差}$</span>の形で表されます.</p>
<p><img src="../images/corre2.png" alt="ピアソンの積率相関係数のイメージ" />
<img src="../images/corre3.png" alt="ピアソンの積率相関係数のイメージ" />
<img src="../images/corre4.png" alt="ピアソンの積率相関係数のイメージ" /></p>
<p><span class="math inline"><em>x</em><sub><em>i</em></sub>, <em>y</em><sub><em>i</em></sub></span> を標準化し <span class="math inline">$z_i = \frac{x_i - \bar{x}}{s_x}, w_i = \frac{y_i - \bar{y}}{s_y}$</span> とすると,</p>
<p><span class="math display">$$
\begin{align*}
r_{zw} &amp;= \frac{1}{n} \sum z_i w_i \\
&amp;= \frac{1}{n S_z S_w} \sum (x_i - \bar{x})(y_i - \bar{y}) \\
&amp;= \frac{1}{n} \sum \left( \frac{x_i - \bar{x}}{S_x} \right) \left( \frac{y_i - \bar{y}}{S_y} \right) \\
&amp;= \frac{\sum (x_i - \bar{x})(y_i - \bar{y})}{n S_x S_y} \\
&amp;= r_{xy}
\end{align*}
$$</span></p>
<p>このとき,証明の為に <span class="math inline">$\frac{1}{n} \sum (z_i \pm w_i)^2$</span> を考える.</p>
<p><span class="math display">$$
\begin{align*}
\frac{1}{n} \sum (z_i \pm w_i)^2 &amp;\geq 0 \\
\frac{1}{n} \sum (z_i^2 \pm 2z_i w_i + w_i^2) &amp;\geq 0 \\
\frac{1}{n} \sum z_i^2 \pm \frac{2}{n} \sum z_i w_i + \frac{1}{n} \sum w_i^2 &amp;\geq 0 \\
\frac{1}{n S_x^2} \sum (x_i - \bar{x})^2 \pm \frac{2}{n} \sum z_i w_i + \frac{1}{n S_y^2} \sum (y_i - \bar{y})^2 &amp;\geq 0  \\
\frac{S_x^2}{S_x^2} + \frac{2}{n} \sum z_i w_i + \frac{S_y^2}{S_y^2}  &amp;\geq 0 \\
1 \pm \frac{2}{n} \sum z_i w_i + 1 &amp;\geq 0 \\
2 (1 \pm r_{xy}) &amp;\geq 0 \\
-1 \leq r_{xy} \leq 1
\end{align*}
$$</span></p>
<p>このように相関係数は常に <span class="math inline"> − 1 ≤ <em>r</em><sub><em>x</em><em>y</em></sub> ≤ 1</span> を取ります.</p>
<p>また, <span class="math inline"><em>c</em></span>を<span class="math inline"><em>c</em> &gt; 0</span>の定数として$すべての点で <span class="math inline"><em>x</em><sub><em>i</em></sub> = <em>c</em><em>y</em><sub><em>i</em></sub></span> が成り立つとき, <span class="math inline">$\bar{x} = c \bar{y_i}$</span> が成り立ち,</p>
<p><span class="math display">$$
\begin{align*}
S_y &amp;= \sqrt{\frac{1}{n} \sum (y_i - \bar{y})^2} \\
    &amp;= \sqrt{\frac{1}{n} \sum (c x_i  - c \bar{y})^2} \\
    &amp;= \sqrt{\frac{c^2}{n} \sum (x_i - \bar{x})}
\end{align*}
$$</span></p>
<p>となります.
したがって,</p>
<p><span class="math display">$$
\begin{align*}
r &amp;= \frac{\frac{1}{n} \sum (x_i - \bar{x})(y_i - \bar{y})}{S_x \times S_y} \\
  &amp;= \frac{\frac{c}{n} \sum (x_i - \bar{x})(x_i - \bar{x})}{S_x \times S_x} \\
  &amp;= \frac{c S_x^2}{c S_x^2} = 1
\end{align*}
$$</span></p>
<p>となり,<code>1</code>となります. また, <span class="math inline"><em>c</em> &lt; 0</span> の場合は, <span class="math inline"><em>S</em><sub><em>x</em></sub> × <em>S</em><sub><em>y</em></sub> =  − <em>c</em><em>S</em><sub><em>x</em></sub><sup>2</sup></span>となるので,<code>-1</code>になります.</p>
<p>このように<span class="math inline"><em>x</em><sub><em>i</em></sub></span>と<span class="math inline"><em>y</em><sub><em>i</em></sub></span>が同じ比率で増減するとき,</p>
<ul>
<li><span class="math inline"><em>r</em><sub><em>x</em><em>y</em></sub> = 1</span> となり,正の完全相関</li>
<li><span class="math inline"><em>r</em><sub><em>x</em><em>y</em></sub> =  − 1</span> となり,負の完全相関</li>
</ul>
<p>といいます.</p>
<p>なお, 相関が「ある/ない」の目安は以下のようになっています.</p>
<table>
<thead>
<tr class="header">
<th>相関係数</th>
<th>関連性の程度</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0.0～0.4 ,0.0～-0.4</td>
<td>ほとんど相関がない</td>
</tr>
<tr class="even">
<td>0.4～0.7 ,-0.4～-0.7</td>
<td>弱い相関がある</td>
</tr>
<tr class="odd">
<td>0.7～0.9 ,-0.7～-0.9</td>
<td>強い相関がある</td>
</tr>
<tr class="even">
<td>0.9～1.0 ,-0.9～-1.0</td>
<td>きわめて強い相関がある</td>
</tr>
</tbody>
</table>
<p>Pythonで積率相関係数を求めるには <code>numpy</code>の<code>np.corrcoef(xのデータ,yのデータ)</code>あるいは,<code>scipy.stats.pearsonr(xのデータ,yのデータ)</code>を利用します. <code>scipy</code>がインストールされていない人は <code>pip install scipy</code>をしておきましょう.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas               <span class="im">as</span> pd</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot    <span class="im">as</span> plt</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> japanize_matplotlib</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> st</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">#データの読み込み</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#データの位置を指定しよう</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'Data/scatter.csv'</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">#散布図のx軸を指定</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>x_column <span class="op">=</span> <span class="st">'AI'</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">#散布図のy軸を指定</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>y_column <span class="op">=</span> <span class="st">'Python'</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>x_value <span class="op">=</span> df[x_column]</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>y_value <span class="op">=</span> df[y_column]</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>plt.scatter(x_value, y_value)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>plt.ylabel(y_column)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>plt.xlabel(x_column)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="co"># numpyで相関係数を求める</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 返り値が [[xとxの相関係数=1, xとyの相関係数]</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="co"># ,[yとxの相関係数, yとyの相関係数=1]]</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="co"># となっている</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.corrcoef(df[x_column],df[y_column]))</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="co">[[1.         0.83281294]</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="co"> [0.83281294 1.        ]]</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.corrcoef(df[x_column],df[y_column])[<span class="dv">0</span>][<span class="dv">1</span>])</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a><span class="co"># 0.83281294</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a><span class="co">#scipy.stats.pearsonr でも計算可能</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a><span class="co"># 返り値が (相関係数, p値)の形に成っている</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="co"># p値に関しては, 検定の章で扱います.</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>r, p <span class="op">=</span> st.pearsonr(df[x_column],df[y_column])</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r) <span class="co">#0.8328129378961621</span></span></code></pre></div>
<h4 id="スピアマンの順位相関係数">スピアマンの順位相関係数</h4>
<p>積率相関係数は量的変数にしか利用できませんが,質的変数のうち順序尺度データに関しては,<strong>スピアマンの順位相関係数(rank correlation coefficient)</strong>が利用できます.</p>
<p>スピアマンの順位相関係数は, 順序尺度データを順位に変換して,順位の間の相関係数を求めたものになります.</p>
<figure>
<img src="../images/corre5.png" alt="ピアソンの積率相関係数のイメージ" />
<figcaption aria-hidden="true">ピアソンの積率相関係数のイメージ</figcaption>
</figure>
<p>データを小さい順に並べ替えた順位 <span class="math inline"><em>x</em><sub><em>i</em></sub>, ..., <em>x</em><sub><em>n</em></sub></span> がある時,</p>
<p><span class="math display">$$
r_{xy} = \frac{\frac{1}{n} \sum (x_i - \bar{x})(y_i - \bar{y})}{\sqrt{\frac{1}{n} \sum (x_i - \bar{x})^2} \sqrt{\frac{1}{n} \sum (y_i - \bar{y})^2}}
$$</span>
がどの様になるかを考える.</p>
<p>順位相関係数は,</p>
<p><span class="math display">$$
\sum x_i = \sum y_i = \frac{n(n+1)}{2}
$$</span></p>
<p><span class="math display">$$
\sum x_i^2 = \sum y_i^2 = \frac{1}{6} n(n+1)(2n+1)
$$</span></p>
<p><span class="math display">$$
\bar{x} = \bar{y} = \frac{\sum x_i}{n} = \frac{n(n+1)}{2n} = \frac{n+1}{2}
$$</span></p>
<p>なので, 分子に関して,</p>
<p><span class="math display">$$
\begin{align*}
&amp; \frac{1}{n}\sum(x_i - \bar{x})(y_i - \bar{y}) \\
&amp;= \frac{1}{n}\sum \{x_iy_i - x_i \bar{y} - \bar{x}y_i + \bar{x}\bar{y}\} \\
&amp;= \frac{1}{n}\sum x_i y_i - \frac{1}{n}\sum x_i\bar{y} - \frac{1}{n}\sum \bar{x}y_i + \frac{1}{n}\sum  \bar{x}\bar{y} \\
&amp;= \frac{1}{n}\sum x_i y_i - \frac{\bar{y}}{n}\sum x_i - \frac{\bar{x}}{n}\sum y_i + \bar{x}\bar{y} \\
&amp;= \frac{1}{n}\sum x_i y_i - \bar{x}\bar{y} \\
&amp;= \frac{1}{2n}\sum \{x_i^2 + y_i^2 - (x_i - y_i)^2\} - \bar{x}\bar{y} \\
\end{align*}
$$</span></p>
<p><span class="math display">$$
\begin{align*}
\because (x_i - y_i)^2 = x_i^2 -2x_i y_i + y_i^2  \\
x_i y_i = \frac{1}{2} \{ x_i^2 + y_i^2 - (x_i - y_i)^2 \}
\end{align*}
$$</span></p>
<p><span class="math display">$$
\begin{align*}
&amp; \frac{1}{2n}\sum \{x_i^2 + y_i^2 - (x_i - y_i)^2\} - \bar{x}\bar{y} \\
&amp;= \frac{1}{2n}\sum x_i^2 + \frac{1}{2n}\sum y_i^2 - \frac{1}{2n}\sum (x_i - y_i)^2 - \bar{x}\bar{y} \\
&amp; = \frac{1}{6} (n+1)(2n+1) - \frac{(n+1)^2}{4} - \frac{1}{2n}\sum (x_i - y_i)^2 \\
&amp; = \frac{1}{12}(n+1)(n-1) - \frac{1}{2n}\sum (x_i - y_i)^2
\end{align*}
$$</span></p>
<p>また, 分母に関して,
<span class="math display">$$
\begin{align*}
&amp; \frac{1}{n}\sum (x_i - \bar{x})^2 \\
&amp;= \frac{1}{n}\sum x_i^2 - n \bar{x}^2 \\
&amp;= \frac{1}{n} \{ \sum x_i^2 -2n \bar{x}^2 + \bar{x}^2 \} \\
&amp;= \frac{1}{n} \{\sum x_i^2 - n\bar{x}^2\} \\
&amp;= \frac{1}{6}(n+1)(2n+1) - \frac{1}{4}(n+1)^2 \\
&amp;= \frac{1}{12}(n+1)(n-1)
\end{align*}
$$</span></p>
<p>なので</p>
<p><span class="math display">$$
r_{xy} = \frac{\frac{1}{n} \sum (x_i - \bar{x})(y_i - \bar{y})}{\sqrt{\frac{1}{n} \sum (x_i - \bar{x})^2} \sqrt{\frac{1}{n} \sum (y_i - \bar{y})^2}}
$$</span></p>
<p>に代入して,
<span class="math display">$$
\begin{align*}
r_{xy} = \frac{\frac{1}{n} \sum (x_i - \bar{x})(y_i - \bar{y})}{\sqrt{\frac{1}{n} \sum (x_i - \bar{x})^2} \sqrt{\frac{1}{n} \sum (y_i - \bar{y})^2}} &amp;= \frac{\frac{1}{12}(n+1)(n-1) - \frac{1}{2} \sum (x_i - y_i)^2}{\frac{1}{12}(n+1)(n-1)}\\
&amp;=  1 - \frac{6}{n^3 - n} \sum (x_i - y_i)^2
\end{align*}
$$</span></p>
<p>となる.</p>
<p>スピアマンの順位相関係数は,Pythonでは, <code>scipy.stats.spearmanr(xのデータ,yのデータ)</code>で求めることができます.</p>
<p><a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/spearman.csv">こちら</a>のデータは,国別(A~J)のサッカー(FIFA)と野球(WBSC)のランキングのダミーデータです.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>    <span class="ex">rank</span> FIFA WBSC</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>     1    A    A</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>     2    B    E</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>     3    C    G</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>     4    D    I</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>     5    E    D</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     6    F    C</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>     7    G    B</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>     8    H    F</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>     9    I    H</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>    10    J    J</span></code></pre></div>
<p>こちらの順位の相関係数を求めてみましょう.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'Data/spearman.csv'</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># sciypyで相関係数を求める</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>correlation, pvalue <span class="op">=</span> st.spearmanr(df[<span class="st">&quot;FIFA&quot;</span>], df[<span class="st">&quot;WBSC&quot;</span>])</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;相関係数:&quot;</span>,correlation) <span class="co">#0.4545</span></span></code></pre></div>
<p><code>0.45</code>なので弱い正の相関があることが分かります.</p>
<h4 id="相関係数のヒートマップ">相関係数のヒートマップ</h4>
<p>相関係数はデータの関係を探るために非常に便利な数値であり, 複数の観測項目からなるデータを扱う場合には,最初に相関係数をとってそれぞれにどのような関係があるのかを確認するようにしましょう.</p>
<p><a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/coeff_multi.csv">こちら</a>のデータは,e-statから取得した,県別の身長,体重,食費,睡眠の平均時間,スポーツの平均時間に関するデータです.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> coeff.py</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="ex">pref</span>  height  weight   food  sleep  sports</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    北海道   170.4    63.7  65739    477      15</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>    青森県   169.8    62.8  64889    490      13</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>    岩手県   170.6    63.7  70156    489      13</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    宮城県   169.8    63.4  73337    482      15</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>    秋田県   170.6    66.1  74560    493      14</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>    山形県   170.9    63.9  76000    497      12</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>    福島県   170.2    63.9  71074    480      13</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>    茨城県   169.7    62.4  74341    467      17</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>    栃木県   169.8    63.3  74387    472      16</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>    群馬県   170.5    62.7  71701    475      15</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>   埼玉県   170.4    61.1  76663    463      15</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>   千葉県   170.3    62.4  77639    458      15</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>   東京都   170.5    61.3  83506    461      16</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>  神奈川県   170.9    62.5  77510    456      17</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="ex">14</span>   新潟県   170.9    62.0  75937    479      13</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="ex">15</span>   富山県   170.8    63.5  73589    471      15</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="ex">16</span>   石川県   170.8    62.9  76256    470      16</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="ex">17</span>   福井県   170.4    62.5  79478    476      14</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="ex">18</span>   山梨県   170.1    61.7  71294    481      16</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="ex">19</span>   長野県   169.5    61.0  72228    474      17</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="ex">20</span>   岐阜県   169.9    60.6  69527    469      13</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="ex">21</span>   静岡県   170.1    61.9  75833    474      19</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="ex">22</span>   愛知県   169.6    60.9  74694    463      14</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="ex">23</span>   三重県   170.4    62.1  75721    473      16</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="ex">24</span>   滋賀県   170.6    62.9  77978    470      18</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="ex">25</span>   京都府   170.5    62.0  76904    464      16</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="ex">26</span>   大阪府   170.2    62.2  74015    469      18</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="ex">27</span>   兵庫県   169.6    60.6  72847    466      15</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a><span class="ex">28</span>   奈良県   169.9    61.8  74888    461      18</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a><span class="ex">29</span>  和歌山県   170.0    62.6  69858    479      15</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a><span class="ex">30</span>   鳥取県   170.4    62.7  73321    475      14</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a><span class="ex">31</span>   島根県   169.7    60.7  72160    483      16</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="ex">32</span>   岡山県   169.6    61.7  69060    475      17</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="ex">33</span>   広島県   168.8    60.8  69061    473      15</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="ex">34</span>   山口県   169.2    60.2  69882    472      17</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="ex">35</span>   徳島県   169.9    64.4  67102    472      18</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="ex">36</span>   香川県   169.9    62.7  68400    469      18</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a><span class="ex">37</span>   愛媛県   168.8    61.8  67274    474      16</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a><span class="ex">38</span>   高知県   169.1    61.8  70188    484      16</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a><span class="ex">39</span>   福岡県   169.7    60.9  70135    471      14</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a><span class="ex">40</span>   佐賀県   169.2    62.2  68749    473      16</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a><span class="ex">41</span>   長崎県   170.1    63.3  66641    473      18</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a><span class="ex">42</span>   熊本県   169.5    61.8  66184    482      20</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a><span class="ex">43</span>   大分県   169.3    62.5  69255    479      18</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a><span class="ex">44</span>   宮崎県   168.7    61.8  65165    477      19</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a><span class="ex">45</span>  鹿児島県   169.7    61.4  65377    479      18</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a><span class="ex">46</span>   沖縄県   168.7    60.6  56298    482      20</span></code></pre></div>
<p>データの取得過程に興味がある人は,以下の手順を自分で行い,データを作ってみましょう.</p>
<details>
<summary>
e-statのデータ表示機能を使ってデータを自分で作る (開く/閉じる)
</summary>
<div class="note">
<p>e-statで県別の身長,体重,睡眠時間等のデータを集めます.
地域別のデータは｢地域｣から選択できます.</p>
<figure>
<img src="../images/coeff_multi1.png" alt="e-stat 地域" />
<figcaption aria-hidden="true">e-stat 地域</figcaption>
</figure>
<p>｢都道府県データ｣を選択し,｢データ表示｣をクリックします.</p>
<figure>
<img src="../images/coeff_multi2.png" alt="e-stat 地域" />
<figcaption aria-hidden="true">e-stat 地域</figcaption>
</figure>
<p>データを集める,地域,表示項目,表示方法の順に選択します.
今回はすべての県を利用するので,｢全て選択｣をクリックしたあと｢確定｣をクリックします.</p>
<figure>
<img src="../images/coeff_multi3.png" alt="e-stat 地域" />
<figcaption aria-hidden="true">e-stat 地域</figcaption>
</figure>
<p>次に項目をきめます.
分野をクリックして｢I健康･医療｣を選ぶと,項目候補に健康・医療に関わる項目が表示されます.
そこから,</p>
<pre><code>- I411301_身長（高校2年）（男）【ｃｍ】
- I412301_体重（高校2年）（男）【ｋｇ】</code></pre>
<p>を順番に選んで,｢項目を選択｣をクリックします.</p>
<figure>
<img src="../images/coeff_multi4.png" alt="e-stat 地域" />
<figcaption aria-hidden="true">e-stat 地域</figcaption>
</figure>
<p>同様に
｢L 家計｣から</p>
<pre><code>- L421101_食料費（二人以上の世帯のうち勤労者世帯）（全国消費実態調査結果）【円】</code></pre>
<p>｢M 生活時間｣から</p>
<pre><code>- M1101_睡眠の平均時間（10歳以上）（男）【分】
- M360100_スポーツの平均時間（15歳以上）（男）【分】</code></pre>
<p>を順番に選んで,｢項目を選択｣をクリックします.</p>
<figure>
<img src="../images/coeff_multi5.png" alt="e-stat 地域" />
<figcaption aria-hidden="true">e-stat 地域</figcaption>
</figure>
<p>最後にどのデータを表示するかレイアウトを決めます.</p>
<pre><code>- 調査年を列に配置
- 表示年度を2000から2010まで
- 設定して表示を更新</code></pre>
<figure>
<img src="../images/coeff_multi6.png" alt="e-stat 地域" />
<figcaption aria-hidden="true">e-stat 地域</figcaption>
</figure>
<p>データをダウンロードします.</p>
<figure>
<img src="../images/coeff_multi7.png" alt="e-stat 地域" />
<figcaption aria-hidden="true">e-stat 地域</figcaption>
</figure>
<p>ダウンロードしたデータを読み込めるcsvに編集します.</p>
<pre><code>- 2006年以外の列を削除
- 数値として新しいシートにコピー
- ヘッダー名をつける
    - 県名 pref (prefectureの略)
    - 身長 height
    - 体重 weight
    - 食費 food
    - 睡眠 sleep
    - スポーツ sports
- utf-8のcsvで保存
- ファイル名: coeff_multi.csv
- 作業ディレクトリのDataフォルダに保存</code></pre>
<figure>
<img src="../images/coeff_multi8.png" alt="e-stat 地域" />
<figcaption aria-hidden="true">e-stat 地域</figcaption>
</figure>
</div>
</details>
<p>データのどの観測項目間に関連があるのかを確かめるために,作成したデータのすべての組み合わせの相関係数を見てみましょう. 今までのように一つ一つ散布図を作成して,相関係数を求めていると,<span class="math inline">観測項目数 × 観測項目数</span> のグラフを作成することになります.
そこで, 与えられた観測項目すべての組み合わせで図示する<strong>ペアプロット</strong>と<strong>ヒートマップ</strong>を活用してみます.</p>
<p><code>DataFrame</code>に含まれるデータのペアプロットには, <code>pandas</code>の<code>.plotting</code>メソッドを利用します. <code>pd.plotting.scatter_matrix(ペアプロットを求めるDataFrame)</code>で,散布図のペアプロットが作成できます.</p>
<p>また, 各項目の相関係数も<code>pandas</code>の<code>.corr()</code>メソッドで取得することが出来ます.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CSVファイルを読み込んでデータフレームに格納</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataフォルダを作成し,そこにデータを入れておきましょう</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'Data/coeff.csv'</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># データの表示</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co">#分析するデータの選択</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> [<span class="st">'height'</span>, <span class="st">'weight'</span>, <span class="st">'food'</span>, <span class="st">'sports'</span>, <span class="st">'sleep'</span>]</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df[labels]</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="co">#散布図行列を作成してみる</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>pd.plotting.scatter_matrix(X, range_padding<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co">#相関係数の組み合わせを確認</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X.corr())</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="co">#ヒートマップで確認</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="co">#ヒートマップで確認</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>sns.heatmap(X.corr()</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>           ,vmax<span class="op">=</span><span class="dv">1</span>     <span class="co">#ヒートマップの最大値</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>           ,vmin<span class="op">=-</span><span class="dv">1</span>    <span class="co">#最小値</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>           ,center <span class="op">=</span><span class="dv">0</span>  <span class="co">#中心</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>           ,annot<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="../images/pair_plot.png" alt="散布図のペアプロット" />
各項目の組み合わせごとに,散布図が作成されています. 自交点にはヒストグラムが作成されます.</p>
<figure>
<img src="../images/coeff_multi9.png" alt="相関係数のヒートマップ" />
<figcaption aria-hidden="true">相関係数のヒートマップ</figcaption>
</figure>
<p>食費と体重,体重と身長などに正の相関があることが分かります.
このように複数の観測項目から関係があるデータを探したい場合には,ペアプロットや,相関係数のヒートマップを作成することで,関係性がわかりやすくなります.</p>
<h4 id="chi2統計量"><span class="math inline">$\Chi^2$</span>統計量</h4>
<p>量的データには積率相関係数, 順位尺度データに対しては,順位相関係数を求めることで2つのデータの関連性を確かめることができました. では,名義尺度データの場合はどのようにすれば良いのでしょうか.</p>
<p>名義尺度を含めた質的変数の関係性を可視化するには,同時度数分布表が利用できました. 数値化においても,同時度数分布表を用いることができます.</p>
<figure>
<img src="../images/cross_table2.png" alt="同時度数分布表" />
<figcaption aria-hidden="true">同時度数分布表</figcaption>
</figure>
<p>質的変数間の関連度合いは,同時度数分布表の数値を利用した <strong>ピアソンの<span class="math inline">$\Chi^2$</span>統計量(かいじじょうとうけいりょう)</strong>で表すことができます. 可視化の節では, 同時度数分布表から列相対度数を求めましたが,ここでは相対度数ではなく,度数なので注意してください.</p>
<p><span class="math display">$$
\Chi_o^2 = \sum_{i=0}^{r} \sum_{j=0}^{c} \frac{(n_{ij} - E_ij)^2}{E_{ij}} (r:行数,c:列数)
$$</span></p>
<p>このとき,<span class="math inline"><em>E</em><sub><em>i</em><em>j</em></sub></span>を期待度数といい, <span class="math inline">$\frac{行の合計 \times 列の合計}{総数}$</span></p>
<p><span class="math display">$$
E_{ij} = \frac{\sum_{i}^r n_{ij} \times \sum_{j}^c n_{ij}}{\sum_{i}^{r}\sum_{j}^c n_{ij}}
$$</span></p>
<p>で求められます.</p>
<p>この<span class="math inline">$\Chi_o^2$</span>が大きいほど,2つの変数の間の関連が強いと言え,この値を利用して行と列のデータが独立であるかを検定する <strong><span class="math inline">$\Chi^2$</span>検定(独立性の検定)</strong> を行うことができます. ** <span class="math inline">$\Chi^2$</span> 検定** に関しては後ほど扱うとして,ここではこの値を利用して2つのデータの関連の度合いを判断する方法に関して見ていきましょう.</p>
<p><span class="math inline">$\Chi_o^2$</span>の値は, 同時度数分布表の行数や列数に依存して値が変わるため,相関係数のように,｢特定の値から関連があるといえる｣といった利用方には適しません.</p>
<p>そこで, 異なるデータを比較するためには, <span class="math inline">0 ≤ <em>V</em> ≤ 1</span>の値を取る,<strong>クラメールの連関係数V</strong>に変換します.</p>
<p><span class="math display">$$
V = \sqrt{\frac{\Chi_o^2}{n \times min(r - 1,c - 1)}}
$$</span></p>
<p>クラメールの連関係数は,相関係数よりも高い値が出にくいので,以下のような基準で判断します.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">V</th>
<th style="text-align: left;">判断</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0 ~ 0.1</td>
<td style="text-align: left;">関連なし</td>
</tr>
<tr class="even">
<td style="text-align: left;">0.1 ~ 0.25</td>
<td style="text-align: left;">弱い関連がある</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0.25 ~ 0.5</td>
<td style="text-align: left;">関連がある</td>
</tr>
<tr class="even">
<td style="text-align: left;">0.5 ~ 1.0</td>
<td style="text-align: left;">強い関連がある</td>
</tr>
</tbody>
</table>
<p><span class="math inline">$\Chi_o^2$</span>は <code>scipy.stats</code>の<code>chi2_contingency(度数分布表,correction=False)</code>で求めることが出来ます.
返り値が, <span class="math inline">$\Chi_o^2$</span>,p値,自由度,期待度数の4つあるので,注意しましょう.</p>
<p>同時度数分布表の節で扱った時限と成績の関係を記録した<a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/cross_table_data.csv">データ</a>を利用して,クラメールの連関係数Vを求めてみましょう.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>     <span class="ex">Period</span> Grade</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>         2     B</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>         5     A</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>         4     A</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>         3     C</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         1     C</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="ex">..</span>      ...   ...</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="ex">195</span>       2     C</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="ex">196</span>       4     C</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="ex">197</span>       5     C</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="ex">198</span>       5     F</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="ex">199</span>       4     C</span></code></pre></div>
<figure>
<img src="../images/heatmap.png" alt="ヒートマップ" />
<figcaption aria-hidden="true">ヒートマップ</figcaption>
</figure>
<div class="sourceCode" id="cb26"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> st</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'data/cross_table_data.csv'</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co">#クロス表の作成</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>cross <span class="op">=</span> pd.crosstab(df[<span class="st">'Grade'</span>],df[<span class="st">'Period'</span>])</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="co">#表示順の設定</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>cross <span class="op">=</span> cross.reindex([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>],axis<span class="op">=</span><span class="st">'columns'</span>)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>cross <span class="op">=</span> cross.reindex([<span class="st">'S'</span>,<span class="st">'A'</span>,<span class="st">'B'</span>,<span class="st">'C'</span>,<span class="st">'F'</span>],axis<span class="op">=</span><span class="st">'index'</span>)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cross)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="co">#列相対度数に変更する</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> cross.columns:</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    cross[c] <span class="op">=</span> cross[c] <span class="op">/</span> cross[c].<span class="bu">sum</span>()</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cross)</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>sns.heatmap( cross  <span class="co">#ヒートマップを作成したいテーブル</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>           , cmap<span class="op">=</span>plt.get_cmap(<span class="st">'Reds'</span>) <span class="co">#カラーマップ(省略可)</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>           , linewidths<span class="op">=</span><span class="fl">.5</span> <span class="co">#線の太さを指定することでセルを囲う線を表示</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>           , annot<span class="op">=</span><span class="va">True</span>  <span class="co">#セルに数値を表示</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a><span class="co">#χ二乗統計量を求める</span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>x2, p, dof, e <span class="op">=</span> st.chi2_contingency(cross,correction<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x2) <span class="co">#1.1342960955202308</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a><span class="co">#クラメールの連関係数Vを求める</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>v <span class="op">=</span> np.sqrt(x2<span class="op">/</span>(cross.<span class="bu">sum</span>().<span class="bu">sum</span>() <span class="op">*</span> <span class="bu">min</span>(cross.shape[<span class="dv">0</span>]<span class="op">-</span><span class="dv">1</span>,cross.shape[<span class="dv">1</span>] <span class="op">-</span><span class="dv">1</span>)))</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(v) <span class="co">#0.2381487030743849</span></span></code></pre></div>
<p>クラメールの連関係数Vの値は,0.28となり,弱い関連があることが分かりました.</p>
<h4 id="因果関係と相関">因果関係と相関</h4>
<p>相関関係は, 2つの観測項目間の関係を表していますが, 観測項目Aの変化によって,観測項目Bの変化が起きているという<strong>因果関係(causality)</strong>を示しているものではありません.</p>
<p>論理学における因果関係は, <strong>AならばB <span class="math inline">(<em>A</em>⇒<em>B</em>)</span></strong> という関係として示されます.</p>
<pre><code>- 例: 人間ならば死ぬ</code></pre>
<p>このとき,Aを<strong>十分条件</strong>, Bを<strong>必要条件</strong> といいます.</p>
<p>しかし,統計学における因果関係は,このような関係では表せません.
例えば, <strong>喫煙をすると肺がんになる</strong>という関係は, 喫煙をしても肺がんにならない場合があるので,倫理学における因果関係ではありません. 統計学における因果関係は, <strong>Aが,Bの一部を説明するための,あるいはBが起きる確率を高めるための十分条件となっている</strong>ことを表します.</p>
<p>したがって,統計学における因果関係は, ** AによってBの一部が説明できる** あるいは, ** AによってBが起きる確率が高まる** という形で示され,これを<strong>統計的因果関係</strong>といいます.</p>
<div class="note">
<p>統計的因果関係が認められる条件は,簡単には以下のように示されます.</p>
<ol type="1">
<li><p>AとBの間に明瞭な関係が認められる</p></li>
<li><p>Aが時間的に,あるいは意味的にBより選考している</p></li>
<li><p>AとBの共通要因となりうる要因を統制して(影響を取り除いて)も,両者に関係が見出される.</p></li>
</ol>
</div>
<p>これらの因果関係を示すには, 特に3.に関して, A以外の条件を揃えてBの発生確率を確かめる<strong>対照実験</strong>などの手法によって明らかにされますが,本資料では実験に関しては扱いません. AによってBを説明する,という関係に関しては,後の回帰の章で少し扱います.</p>
<p>このように, 相関関係と因果関係は異なる概念として理解する必要があります.</p>
<p>例えば, 因果関係があっても相関関係がない有名な例として, <strong>チーズの消費量と,ベッドシーツに絡まって死ぬ人の数</strong>や,<strong>プールで溺れた人の数と,ニコラス･ケイジの映画出演数</strong>などがあります(こちらのサイト(<a href="https://www.tylervigen.com/spurious-correlations">https://www.tylervigen.com/spurious-correlations</a>)にこういった例が沢山まとめられているので興味のある人は見てみましょう.)</p>
<figure>
<img src="../images/cheese_cinsumption.png" alt="spurious correlations" />
<figcaption aria-hidden="true"><a href="https://www.tylervigen.com/spurious-correlations">spurious correlations</a></figcaption>
</figure>
<figure>
<img src="../images/nicolas_cage.png" alt="spurious correlations" />
<figcaption aria-hidden="true"><a href="https://www.tylervigen.com/spurious-correlations">spurious correlations</a></figcaption>
</figure>
<p>このように,全く因果関係のないものでも現れる相関関係を<strong>偽相関(Spurious Correlation)</strong>といいます.</p>
<p>また,反対に$ y = (x-8)^2 $ という関係においては, yの値は完全にxによって決まるため,xとyの間に因果関係は認められますが,相関係数は0となります.</p>
<figure>
<img src="../images/y_x_8.png" alt="因果があっても相関がない例" />
<figcaption aria-hidden="true">因果があっても相関がない例</figcaption>
</figure>
<h4 id="発展偏相関係数">発展:偏相関係数</h4>
<p>因果関係を検証する方法に関しては後の章に譲るとして, ここでは,相関における類似概念である<strong>偏相関</strong>について見てみましょう.</p>
<p><strong>偏相関係数(partial correlation coefficient)</strong> とは, 3つの変数がある場合に, <strong>1つの変数の影響を除いた</strong>残り2つの変数間の相関係数となります.</p>
<p>変数,<span class="math inline"><em>x</em>, <em>y</em>, <em>z</em></span>があるとき,<span class="math inline"><em>z</em></span>の影響を除いた, <span class="math inline"><em>x</em>, <em>y</em></span>の間の偏相関係数は以下のように求められます.</p>
<p><span class="math display">$$
r_{xy \dot z} = \frac{r_{xy} - r_{xz}r_yz}{\sqrt{1 - r_{xz}^2}\sqrt{1 - r_{yz}^2}}
$$</span></p>
<p>式を見てみると,分子では, xとyの相関係数から,zに関する相関係数を引いていることが分かります.</p>
<p>偏相関係数の具体例を見てみましょう. <a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/partial_coeff.csv">こちら</a>のデータは米国における<code>x:小麦の1日あたりの消費量</code>,<code>y:米の一日あたりの消費量</code>,<code>z:肥満度</code>を表しています.なお, いずれの列も最大を1,最小を0に変換してあります.</p>
<p>この3変数の相関係数を取ってみます.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'data/partial_coeff.csv'</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> df[<span class="st">'x'</span>]</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">'y'</span>]</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> df[<span class="st">'z'</span>]</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co">#散布図行列を作成してみる</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>pd.plotting.scatter_matrix(df, range_padding<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'partial_coeff_scatter_matrix.png'</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>plt.close()</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co">#ヒートマップで確認</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>sns.heatmap(df.corr()</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>           ,vmax<span class="op">=</span><span class="dv">1</span>     <span class="co">#ヒートマップの最大値</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>           ,vmin<span class="op">=-</span><span class="dv">1</span>    <span class="co">#最小値</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>           ,center <span class="op">=</span><span class="dv">0</span>  <span class="co">#中心</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>           ,annot<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'partial_coeff_heatmap.png'</span>)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>plt.close()</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>rxy <span class="op">=</span> np.corrcoef(x, y)[<span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>rxz <span class="op">=</span> np.corrcoef(x,z)[<span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>ryz <span class="op">=</span> np.corrcoef(y,z)[<span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'x-y:'</span>,rxy) <span class="co">#x-y: -0.6001681728315631</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'x-z:'</span>,rxz) <span class="co">#x-z: 0.8000777549807391</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'y-z:'</span>,ryz) <span class="co">#y-z: -0.4740072261555343</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'ryzx:'</span>,ryzx)</span></code></pre></div>
<figure>
<img src="../images/partial_coeff_scatter_matrix.png" alt="partial_coeff_scatter_matrix.png" />
<figcaption aria-hidden="true">partial_coeff_scatter_matrix.png</figcaption>
</figure>
<figure>
<img src="../images/partial_coeff_heatmap.png" alt="partial_coeff_heatmap.png" />
<figcaption aria-hidden="true">partial_coeff_heatmap.png</figcaption>
</figure>
<p>相関係数を見ると,</p>
<ul>
<li><p><span class="math inline"><em>r</em><sub><em>x</em><em>y</em></sub> ≈  − 0.60</span>: 小麦を食べる量が多いと米を食べる量が少ない</p></li>
<li><p><span class="math inline"><em>r</em><sub><em>x</em><em>z</em></sub> ≈ 0.80</span>:小麦を食べる量が多いほど太っている</p></li>
<li><p><span class="math inline"><em>r</em><sub><em>y</em><em>z</em></sub> ≈  − 0.47</span>:米を食べる量が多いほど痩せている</p></li>
</ul>
<p>となっています.</p>
<p>小麦を食べるほど,米を食べる量が少ないというのは米国において,米を主食とする人が少ないことから,普段小麦粉を利用した食事をしているほど,米を食べる機会が少ないということで理解ができます. また,小麦を食べる量が多いほど太っているというのも,炭水化物をたくさん食べるほど太っているということで理解できます. 一方で, 米を食べる量が多いほど痩せているという関係は, あまり自然ではありません.</p>
<p>これは, 一般的に小麦を食べる文化圏の人のほうが,アジア系よりも太っていることに影響されていそうです. yとzの散布図に,xで色をつけることで,xの影響を確認してみましょう.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(y,z,c<span class="op">=</span>x)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'米の消費量'</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'肥満度'</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="op">-</span><span class="fl">0.1</span>,<span class="fl">1.1</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="op">-</span><span class="fl">0.1</span>,<span class="fl">1.1</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>plt.colorbar()</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'ryz='</span><span class="op">+</span><span class="bu">str</span>(ryz)[:<span class="dv">5</span>])</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'partial_coeff1.png'</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code></pre></div>
<figure>
<img src="../images/partial_coeff1.png" alt="r_{yz}に対するxの影響" />
<figcaption aria-hidden="true"><span class="math inline"><em>r</em><sub><em>y</em><em>z</em></sub></span>に対するxの影響</figcaption>
</figure>
<p>左上に行くほど,xの値を表す色が明るくなっており, xの影響で<span class="math inline"><em>r</em><sub><em>y</em><em>z</em></sub></span>が負の相関となっていることが分かります.</p>
<p>それでは, 小麦の影響を除いた米の肥満への影響 <span class="math inline">$r_{yz \dor x}$</span> を計算してみましょう.</p>
<p><span class="math display">$$
\begin{align*}
r_{yz \dot x} &amp;= \frac{r_{yz} - r_{xy}r_xz}{\sqrt{1 - r_{xz}^2}\sqrt{1 - r_{xy}^2}}
&amp;\approx \frac{-0.47 + 0.8 \times 0.6}{\sqrt{1 - 0.8^2}\sqrt{1 - 0.6^2}}
&amp;\approx 0.02
\end{align*}
$$</span></p>
<p>Pythonでも計算してみます.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>ryzx <span class="op">=</span> (ryz <span class="op">-</span> (rxy <span class="op">*</span> rxz)) <span class="op">/</span> (np.sqrt(<span class="dv">1</span><span class="op">-</span>rxy<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>np.sqrt(<span class="dv">1</span><span class="op">-</span>rxz<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'ryzx:'</span>,ryzx) <span class="co">#0.012866706738387962</span></span></code></pre></div>
<p>実際にはほとんど,米の消費量と,肥満度に相関はないことが分かります.</p>
<p>最後に,xの影響を打ち消した,yとzの関係をプロットしてみましょう. これは,この後扱う回帰を利用していますので, コードは理解できなくても問題ありません.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#の影響を除いたyとzの散布図</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">#yとzのxによる回帰式をたてて,その残渣をプロットすることで,</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">#xの効果を打ち消したyとzの関係を表現</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>model_y <span class="op">=</span> LinearRegression().fit(df[[<span class="st">'x'</span>]], y)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>residual_y <span class="op">=</span> y <span class="op">-</span> model_y.predict(df[[<span class="st">'x'</span>]])</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>model_z <span class="op">=</span> LinearRegression().fit(df[[<span class="st">'x'</span>]], z)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>residual_z <span class="op">=</span> z <span class="op">-</span> model_z.predict(df[[<span class="st">'x'</span>]])</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>(<span class="op">-</span><span class="fl">0.47</span> <span class="op">+</span> <span class="fl">0.8</span> <span class="op">*</span> <span class="fl">0.6</span>) <span class="op">/</span> (np.sqrt(<span class="dv">1</span> <span class="op">-</span> <span class="fl">0.8</span><span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> np.sqrt(<span class="dv">1</span> <span class="op">-</span> <span class="fl">0.6</span><span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>plt.scatter(residual_z,residual_y,c<span class="op">=</span>x)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'米の消費量'</span>)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'肥満度'</span>)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>plt.colorbar()</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'ryz='</span><span class="op">+</span><span class="bu">str</span>(ryzx)[:<span class="dv">5</span>])</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'partial_coeff2.png'</span>)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code></pre></div>
<figure>
<img src="../images/partial_coeff2.png" alt="partial_coeff2.png" />
<figcaption aria-hidden="true">partial_coeff2.png</figcaption>
</figure>
<p>もとのyとzの散布図における,xの広がりの影響が打ち消されて,ほとんど相関がなくなっていることが分かります.</p>
<h3 id="距離と類似度">距離と類似度</h3>
<p>ユークリッド距離,コサイン距離</p>

<!-- 前後の章へのナビゲーション -->
<div class="chapter-navigation">
    <nav>
        
            <a class="nav-link prev" href="slds8.html">← Previous Chapter</a>
        
        
            <a class="nav-link next" href="slds10.html">Next Chapter →</a>
        
    </nav>
</div>

    <div style="clear: both"></div>

    <div id="footer">
        Site proudly generated by
        <a href="http://jaspervdj.be/hakyll">Hakyll</a>.
    </div>
</div>


    <!-- GUID -->
    <div style="display: none">ce0f13b2-4a83-4c1c-b2b9-b6d18f4ee6d2</div>

    
    <!-- KaTeX JavaScript and auto-render extension -->
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "\[", right: "\]", display: true},
            {left: "$", right: "$", display: false}
          ]
        });
      });
    </script>
    

    <!-- JavaScript TOC generator (only runs on lecture pages) -->
    <script>
    document.addEventListener("DOMContentLoaded", function() {
      var tocContainer = document.getElementById('lecture-toc');
      if (!tocContainer) return;

      // メインコンテンツから h2, h3, h4 を抽出
      var content = document.querySelector('article') || document.getElementById('content') || document.body;
      var headings = content.querySelectorAll('h2, h3, h4');
      if (headings.length === 0) return;

      // 目次用のUL要素を作成
      var tocList = document.createElement('ul');

      // 章番号カウンタ (h2, h3, h4に対応して配列を用意)
      var chapterNumbers = [0, 0, 0];

      headings.forEach(function(heading) {
        if (heading.closest('li')) return;

        var level;
        switch (heading.tagName.toLowerCase()) {
          case 'h2': level = 0; break;
          case 'h3': level = 1; break;
          case 'h4': level = 2; break;
          default: return;
        }

        chapterNumbers[level]++;
        for (var i = level + 1; i < chapterNumbers.length; i++) {
          chapterNumbers[i] = 0;
        }

        var chapterNumberStr = chapterNumbers.slice(0, level + 1).join('.');
        if (!heading.id) {
          heading.id = heading.textContent.trim().replace(/\s+/g, '-').toLowerCase();
        }

        var li = document.createElement('li');
        li.classList.add('toc-level-' + (level + 1));

        var anchor = document.createElement('a');
        anchor.href = '#' + heading.id;
        anchor.textContent = chapterNumberStr + ' ' + heading.textContent;

        li.appendChild(anchor);
        tocList.appendChild(li);
      });

      tocContainer.appendChild(tocList);
    });
    </script>
     <script>
  document.addEventListener("DOMContentLoaded", function() {
    // すべての <pre><code> 要素を走査
    const codeBlocks = document.querySelectorAll('pre code');
    codeBlocks.forEach(function(codeBlock) {
      // 親<pre>要素を取得
      const pre = codeBlock.parentNode;

      // <pre> を相対配置にし、子要素を絶対配置できるようにする
      pre.style.position = 'relative';

      // コピーボタンを作成
      const copyButton = document.createElement('button');
      copyButton.textContent = 'Copy';
      // ボタンのデザインはCSSで指定するのが望ましいが、簡易的にスタイルを直接指定する例:
      copyButton.style.position = 'absolute';
      copyButton.style.top = '8px';
      copyButton.style.right = '8px';
      copyButton.style.backgroundColor = '#add8e6'; // 水色
      copyButton.style.color = '#fff';             // 白文字
      copyButton.style.border = 'none';
      copyButton.style.padding = '6px 10px';
      copyButton.style.borderRadius = '4px';
      copyButton.style.cursor = 'pointer';

      // クリックされたらクリップボードにコピー
      copyButton.addEventListener('click', function() {
        const codeText = codeBlock.innerText;
        navigator.clipboard.writeText(codeText).then(function() {
          copyButton.textContent = 'Copied!';
          setTimeout(function() {
            copyButton.textContent = 'Copy';
          }, 2000);
        }, function(err) {
          console.error('Failed to copy: ', err);
        });
      });

      // ボタンを <pre> の子要素として挿入
      pre.appendChild(copyButton);
    });
  });
  </script>
  <script>
    function toggleMenu() {
      var nav = document.getElementById('navigation');
      nav.classList.toggle('open');
    }
  </script>
  </body>
</html>