<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"
    xmlns:dc="http://purl.org/dc/elements/1.1/">
    <channel>
        <title>yakagika - All posts</title>
        <link></link>
        <description><![CDATA[Personal blog of yakagika]]></description>
        <atom:link href="/rss.xml" rel="self"
                   type="application/rss+xml" />
        <lastBuildDate>Fri, 29 Mar 2024 00:00:00 UT</lastBuildDate>
        <item>
    <title>Hakyllでブログ作成</title>
    <link>/posts/2024-03-29-a-first-post.html</link>
    <description><![CDATA[<div class="toc"><div class="header">Table of Contents</div>
<ul>
<li><a href="#はじめに" id="toc-はじめに"><span class="toc-section-number">1</span> はじめに</a></li>
<li><a href="#stack" id="toc-stack"><span class="toc-section-number">2</span> stack</a></li>
<li><a href="#katex" id="toc-katex"><span class="toc-section-number">3</span> KaTeX</a></li>
<li><a href="#シンタクスハイライトの変更" id="toc-シンタクスハイライトの変更"><span class="toc-section-number">4</span> シンタクスハイライトの変更</a></li>
<li><a href="#目次の生成" id="toc-目次の生成"><span class="toc-section-number">5</span> 目次の生成</a></li>
<li><a href="#sitemapの生成" id="toc-sitemapの生成"><span class="toc-section-number">6</span> sitemapの生成</a></li>
<li><a href="#複数のタグを付ける" id="toc-複数のタグを付ける"><span class="toc-section-number">7</span> 複数のタグを付ける</a></li>
</ul>
</div>
<h1 data-number="1" id="はじめに"><span class="header-section-number">1</span> はじめに</h1>
<p>講義資料の公開,置き場やら自分のプロフィール載せるために取り敢えずブログを作った.</p>
<p>取り敢えずHaskell静的サイトでググって最初に出てきたHakyllを使うことにした.</p>
<p><a href="https://jaspervdj.be/hakyll/index.html">Haklly</a>開発者のjaspervdjの<a href="https://jaspervdj.be">ブログ</a>の<a href="https://github.com/jaspervdj/jaspervdj">ソースコード</a>をほとんどそのまま使っている
ため,今後色々変えていく予定.</p>
<p>取り敢えずの変更点として,</p>
<ul>
<li>↑はcabalで開発していたので,stackにした</li>
<li>Hakyll+KaTeXで数式を書けるようにした</li>
<li>シンタックスハイライトの追加</li>
<li>目次の追加</li>
<li>safari対応</li>
<li>細かなデザインの変更</li>
</ul>
<p>など. ソースコードは<a href="https://github.com/yakagika/yakagika.github.io">こちら</a>.
今後なにか変更を加えたら書いていく.</p>
<h1 data-number="2" id="stack"><span class="header-section-number">2</span> stack</h1>
<p>package.yamlを追加したのみ.
これで,</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">stack</span> build</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">stack</span> exec main build <span class="er">(</span><span class="ex">2回目以降はrebuild</span><span class="kw">)</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">stack</span> exec main watch</span></code></pre></div>
<p>で確認できる.
(執筆段階では,まだローカルで試しているだけ)
package.yamlは以下.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ependencies</span><span class="kw">:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> base</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> binary</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> directory</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> filepath</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> hakyll</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pandoc</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> process</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> text</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> containers</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span><span class="kw">:</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">source-dirs</span><span class="kw">:</span><span class="at"> src</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="fu">_exe-defs</span><span class="kw">:</span><span class="at"> </span><span class="ot">&amp;exe-defaults</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">dependencies</span><span class="kw">:</span><span class="at"> blog</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="fu">executables</span><span class="kw">:</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">main</span><span class="kw">:</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">&lt;&lt;</span><span class="kw">:</span><span class="at"> </span><span class="ot">*exe-defaults</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">main</span><span class="kw">:</span><span class="at">                Main.hs</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">source-dirs</span><span class="kw">:</span><span class="at">         src</span></span></code></pre></div>
<h1 data-number="3" id="katex"><span class="header-section-number">3</span> KaTeX</h1>
<p>基本的にはこちらの<a href="https://axiomatic.neophilus.net/using-katex-with-hakyll/">サイト</a>を参考にした2015年の記事で現在はHakyllを使っておらず,ソースコードが消えていたので,補うのに苦労した.
KaTeXの情報が古かったので,mathCtxを最新のKaTeXの<a href="https://github.com/KaTeX/KaTeX">テンプレ</a>にした.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ot">mathCtx ::</span> <span class="dt">Context</span> a</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>mathCtx <span class="ot">=</span> field <span class="st">&quot;katex&quot;</span> <span class="op">$</span> \item <span class="ot">-&gt;</span> <span class="kw">do</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    katex <span class="ot">&lt;-</span> getMetadataField (itemIdentifier item) <span class="st">&quot;katex&quot;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> <span class="op">$</span> <span class="kw">case</span> katex <span class="kw">of</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">Just</span> <span class="st">&quot;false&quot;</span> <span class="ot">-&gt;</span> <span class="st">&quot;&quot;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">Just</span> <span class="st">&quot;off&quot;</span> <span class="ot">-&gt;</span> <span class="st">&quot;&quot;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                    _ <span class="ot">-&gt;</span> <span class="st">&quot;&lt;link rel=\&quot;stylesheet\&quot; href=\&quot;https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css\&quot; integrity=\&quot;sha384-wcIxkf4k558AjM3Yz3BBFQUbk/zgIYC2R0QpeeYb+TwlBVMrlgLqwRjRtGZiK7ww\&quot; crossorigin=\&quot;anonymous\&quot;&gt;\n\</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="st">                             \&lt;script defer src=\&quot;https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js\&quot; integrity=\&quot;sha384-hIoBPJpTUs74ddyc4bFZSM1TVlQDA60VBbJS0oA934VSz82sBx1X7kSx2ATBDIyd\&quot; crossorigin=\&quot;anonymous\&quot;&gt;&lt;/script&gt;\n\</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="st">                             \&lt;script defer src=\&quot;https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js\&quot; integrity=\&quot;sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk\&quot; crossorigin=\&quot;anonymous\&quot; onload=\&quot;renderMathInElement(document.body);\&quot;&gt;&lt;/script&gt;&quot;</span></span></code></pre></div>
<p>これでコンテクストを作って,mappend (&lt;&gt;)でdefaultContext (template/default.html)に追加する.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>match (<span class="st">&quot;lectures/*.md&quot;</span> <span class="op">.||.</span> <span class="st">&quot;lectures/*.html&quot;</span> <span class="op">.||.</span> <span class="st">&quot;lectures/*.lhs&quot;</span>) <span class="op">$</span> <span class="kw">do</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>        route   <span class="op">$</span> setExtension <span class="st">&quot;.html&quot;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        compile <span class="op">$</span> pandocCompiler</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> saveSnapshot <span class="st">&quot;content&quot;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> <span class="fu">return</span> <span class="op">.</span> <span class="fu">fmap</span> demoteHeaders</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/lecture.html&quot;</span> (postCtx tags)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/content.html&quot;</span> (mathCtx <span class="op">&lt;&gt;</span> defaultContext )</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/default.html&quot;</span> (mathCtx <span class="op">&lt;&gt;</span> defaultContext)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> relativizeUrls</span></code></pre></div>
<p>もとのブログは,markdownのメタデータにおいて,
katex : trueとなっているものだけにKaTeXを適用するのが方針で,
以下のように書くことで実現できる.
<del>“$$”で数式が書けるようにdelimitersを設定する必要があるのだが,Hakyllの仕様で,“$”が消えるので全部二重にしたら上手く行った.</del></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 旧版 --&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;html</span> <span class="er">lang</span><span class="ot">=</span><span class="st">&quot;en&quot;</span> <span class="er">$if(dark)$class</span><span class="ot">=</span><span class="st">&quot;dark&quot;</span><span class="er">$endif$</span><span class="kw">&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;head&gt;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;meta</span> <span class="er">charset</span><span class="ot">=</span><span class="st">&quot;UTF-8&quot;</span><span class="kw">&gt;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;meta</span> <span class="er">name</span><span class="ot">=</span><span class="st">&quot;viewport&quot;</span> <span class="er">content</span><span class="ot">=</span><span class="st">&quot;width=device-width&quot;</span><span class="kw">&gt;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;title&gt;</span>yakagika - $title$<span class="kw">&lt;/title&gt;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">&lt;!-- Stylesheets. --&gt;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;link</span> <span class="er">rel</span><span class="ot">=</span><span class="st">&quot;stylesheet&quot;</span> <span class="er">type</span><span class="ot">=</span><span class="st">&quot;text/css&quot;</span> <span class="er">href</span><span class="ot">=</span><span class="st">&quot;/style.css?v=0&quot;</span><span class="kw">&gt;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">&lt;!-- RSS. --&gt;</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;link</span> <span class="er">rel</span><span class="ot">=</span><span class="st">&quot;alternate&quot;</span> <span class="er">type</span><span class="ot">=</span><span class="st">&quot;application/rss+xml&quot;</span> <span class="er">title</span><span class="ot">=</span><span class="st">&quot;yakagika&quot;</span> <span class="kw">&gt;</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">&lt;!-- href=&quot;http://jaspervdj.be/rss.xml&quot; --&gt;</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">&lt;!-- Metadata. --&gt;</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;meta</span> <span class="er">name</span><span class="ot">=</span><span class="st">&quot;keywords&quot;</span> <span class="er">content</span><span class="ot">=</span><span class="st">&quot;yakagika Haskell ExchangeAlgebra&quot;</span><span class="kw">&gt;</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;meta</span> <span class="er">name</span><span class="ot">=</span><span class="st">&quot;description&quot;</span> <span class="er">content</span><span class="ot">=</span><span class="st">&quot;Personal home page and blog of yakagika.&quot;</span><span class="kw">&gt;</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        $if(katex)$</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">&lt;!-- KaTeXのスタイルシートとJavaScriptのリンクを動的に挿入 --&gt;</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>        $katex$</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>        $endif$</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>        $if(description)$<span class="kw">&lt;meta</span> <span class="er">property</span><span class="ot">=</span><span class="st">&quot;og:description&quot;</span> <span class="er">content</span><span class="ot">=</span><span class="st">&quot;$description$&quot;</span> <span class="kw">/&gt;</span>$endif$</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/head&gt;</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;body&gt;</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;div</span> <span class="er">id</span> <span class="ot">=</span><span class="st">&quot;navigation&quot;</span><span class="kw">&gt;</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>            <span class="kw">&lt;h1&gt;</span>Contents<span class="kw">&lt;/h1&gt;</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>            <span class="kw">&lt;a</span> <span class="er">href</span><span class="ot">=</span><span class="st">&quot;/&quot;</span><span class="kw">&gt;</span>Home<span class="kw">&lt;/a&gt;</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>            <span class="kw">&lt;a</span> <span class="er">href</span><span class="ot">=</span><span class="st">&quot;/posts.html&quot;</span><span class="kw">&gt;</span>Blog<span class="kw">&lt;/a&gt;</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>            <span class="kw">&lt;a</span> <span class="er">href</span><span class="ot">=</span><span class="st">&quot;/lectures.html&quot;</span><span class="kw">&gt;</span>Lecture<span class="kw">&lt;/a&gt;</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>            <span class="kw">&lt;a</span> <span class="er">href</span><span class="ot">=</span><span class="st">&quot;/research.html&quot;</span><span class="kw">&gt;</span>Research<span class="kw">&lt;/a&gt;</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>            <span class="kw">&lt;a</span> <span class="er">href</span><span class="ot">=</span><span class="st">&quot;/contact.html&quot;</span><span class="kw">&gt;</span>Contact<span class="kw">&lt;/a&gt;</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>            <span class="co">&lt;!-- &lt;a href=&quot;/cv.html&quot;&gt;CV&lt;/a&gt; --&gt;</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>            <span class="kw">&lt;h1&gt;</span>Links<span class="kw">&lt;/h1&gt;</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>            <span class="kw">&lt;a</span> <span class="er">href</span><span class="ot">=</span><span class="st">&quot;http://github.com/yakagika&quot;</span><span class="kw">&gt;</span>GitHub<span class="kw">&lt;/a&gt;</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;/div&gt;</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>        $body$</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>        <span class="co">&lt;!-- GUID --&gt;</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;div</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;display: none&quot;</span><span class="kw">&gt;</span>ce0f13b2-4a83-4c1c-b2b9-b6d18f4ee6d2<span class="kw">&lt;/div&gt;</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>        $if(katex)$</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>        <span class="co">&lt;!-- KaTeX JavaScript and auto-render extension --&gt;</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;script&gt;</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>          <span class="bu">document</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&quot;DOMContentLoaded&quot;</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>            <span class="fu">renderMathInElement</span>(<span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">,</span> {</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>              <span class="dt">delimiters</span><span class="op">:</span> [</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>                {<span class="dt">left</span><span class="op">:</span> <span class="st">&quot;$$$$&quot;</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="st">&quot;$$$$&quot;</span><span class="op">,</span> <span class="dt">display</span><span class="op">:</span> <span class="kw">true</span>}<span class="op">,</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>                {<span class="dt">left</span><span class="op">:</span> <span class="st">&quot;$$&quot;</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="st">&quot;$$&quot;</span><span class="op">,</span> <span class="dt">display</span><span class="op">:</span> <span class="kw">false</span>} <span class="co">// インライン数式用のデリミタを追加</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>              ]</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>            })<span class="op">;</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>          })<span class="op">;</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;/script&gt;</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>        $endif$</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/body&gt;</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
<p><del>とりあえずこんな感じで出せる.</del></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode tex"><code class="sourceCode latex"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>あいうえお <span class="fu">\\</span>( f(あ) = a^2 <span class="fu">\\</span>) かきくけこ</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>あいうえお <span class="ss">$ f(あ) = a^2 $</span> かきくけこ</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="ss">$$ f(x) = </span><span class="sc">\frac</span><span class="ss">{1}{x}  $$</span></span></code></pre></div>
<p><del>あいうえお \( f(あ) = a^2 \) かきくけこ</del></p>
<p><del>あいうえお $ f(あ) = a^2 $ かきくけこ</del></p>
<p><del><span class="math display"> f(x) = \frac{1}{x}  </span></del></p>
<p>(2025/03/27修正) –</p>
<p>上の方法だと,<code>Pandoc</code>時点で数式処理されて<code>math inline</code>となった要素と<code>JavaScript</code>側で処理されて<code>latex.inlline</code>となった要素が混在して,ところどころデザインが崩れるので,Pandocの時点でKaTeXを使用するように変更した.</p>
<p>結構苦労したので追記.</p>
<p><code>writerOption</code> において <code>Pandoc.writerHTMLMathMethod  = Pandoc.KaTeX ""</code> と設定することでKaTeXで数式が処理される.
<code>$ ... $</code>で式を示したい場合は,
<code>Pandoc.writerExtensions</code>に<code>Pandoc.enableExtension Pandoc.Ext_tex_math_dollars</code>を指定する. <code>Ext_tex_math_double_backslash</code>は<code>\( .. \)</code>など.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Custom WriterOptions: disable `$...$` math, enable fenced_divs, plus TOC etc.</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ot">customWriterOptions ::</span> <span class="dt">Pandoc.WriterOptions</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>customWriterOptions <span class="ot">=</span> defaultHakyllWriterOptions</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  { Pandoc.writerHTMLMathMethod  <span class="ot">=</span> <span class="dt">Pandoc.KaTeX</span> <span class="st">&quot;&quot;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  , Pandoc.writerExtensions      <span class="ot">=</span> Pandoc.enableExtension <span class="dt">Pandoc.Ext_fenced_divs</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="op">$</span> Pandoc.enableExtension <span class="dt">Pandoc.Ext_tex_math_dollars</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="op">$</span> Pandoc.enableExtension <span class="dt">Pandoc.Ext_tex_math_double_backslash</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="op">$</span> Pandoc.enableExtension <span class="dt">Pandoc.Ext_tex_math_single_backslash</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                                 <span class="op">$</span> Pandoc.pandocExtensions</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>match (<span class="st">&quot;lectures/*.md&quot;</span> <span class="op">.||.</span> <span class="st">&quot;lectures/*.html&quot;</span> <span class="op">.||.</span> <span class="st">&quot;lectures/*.lhs&quot;</span>) <span class="op">$</span> <span class="kw">do</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        route   <span class="op">$</span> setExtension <span class="st">&quot;.html&quot;</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        compile <span class="op">$</span> pandocCompilerWith customReaderOptions customWriterOptions</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> saveSnapshot <span class="st">&quot;content&quot;</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> <span class="fu">return</span> <span class="op">.</span> <span class="fu">fmap</span> demoteHeaders</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/lecture.html&quot;</span> (postCtx tags)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/content.html&quot;</span> (mathCtx <span class="op">&lt;&gt;</span> defaultContext )</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/default.html&quot;</span> (mathCtx <span class="op">&lt;&gt;</span> defaultContext)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> relativizeUrls</span></code></pre></div>
<p>これで</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode tex"><code class="sourceCode latex"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ss">$x=1$</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="ss">$$</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="ss">x = 1</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="ss">$$</span></span></code></pre></div>
<p>と書かれているmdから</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">class</span><span class="ot">=</span><span class="st">&quot;math inline&quot;</span><span class="kw">&gt;</span> $x=1$ <span class="kw">&lt;/span&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">class</span><span class="ot">=</span><span class="st">&quot;math display&quot;</span><span class="kw">&gt;</span> $x=1$ <span class="kw">&lt;/span&gt;</span></span></code></pre></div>
<p>のような形のhtmlに変換される. これを<code>default.html</code>側でレンダリングする.レンダリングは以下でOK.
(cf.<a href="https://github.com/jaspervdj/hakyll/issues/1006#issuecomment-2369250865">https://github.com/jaspervdj/hakyll/issues/1006#issuecomment-2369250865</a>)</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;head&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>$if(katex)$</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    $katex$</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>$endif$</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/head&gt;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;body&gt;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a> <span class="kw">&lt;script&gt;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&quot;DOMContentLoaded&quot;</span><span class="op">,</span> <span class="kw">function</span> () {</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> mathElements <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelectorAll</span>(<span class="st">&#39;.math&#39;</span>)<span class="op">;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> mathElements<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> texText <span class="op">=</span> mathElements[i]<span class="op">.</span><span class="at">firstChild</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (mathElements[i]<span class="op">.</span><span class="at">tagName</span> <span class="op">==</span> <span class="st">&quot;SPAN&quot;</span>) {</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>            katex<span class="op">.</span><span class="fu">render</span>( texText<span class="op">.</span><span class="at">data</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>                        <span class="op">,</span> mathElements[i]</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>                        <span class="op">,</span> { <span class="dt">displayMode</span><span class="op">:</span> mathElements[i]<span class="op">.</span><span class="at">classList</span><span class="op">.</span><span class="fu">contains</span>(<span class="st">&quot;display&quot;</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>                          <span class="op">,</span> <span class="dt">throwOnError</span><span class="op">:</span> <span class="kw">true</span> }</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>                        )<span class="op">;</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/script&gt;</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/body&gt;</span></span></code></pre></div>
<h1 data-number="4" id="シンタクスハイライトの変更"><span class="header-section-number">4</span> シンタクスハイライトの変更</h1>
<p>シンタックスハイライトを変更した
シンタックスは,pandocCompilerのオプションとして指定できる.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Text.Pandoc.Highlighting</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ot">pandocCodeStyle ::</span> <span class="dt">Style</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>pandocCodeStyle <span class="ot">=</span> breezeDark</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="ot">customWriterOptions::</span> <span class="dt">Pandoc.WriterOptions</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>customWriterOptions <span class="ot">=</span> defaultHakyllWriterOptions { Pandoc.writerHTMLMathMethod <span class="ot">=</span> <span class="dt">Pandoc.MathJax</span> <span class="st">&quot;&quot;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                                                 , Pandoc.writerHighlightStyle <span class="ot">=</span> <span class="dt">Just</span> pandocCodeStyle}</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="ot">myPandocCompiler ::</span> <span class="dt">Compiler</span> (<span class="dt">Item</span> <span class="dt">String</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>myPandocCompiler <span class="ot">=</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    pandocCompilerWith defaultHakyllReaderOptions customWriterOptions</span></code></pre></div>
<p>このように適用することでこのブログの見た目になっている.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a> match (<span class="st">&quot;posts/*.md&quot;</span> <span class="op">.||.</span> <span class="st">&quot;posts/*.html&quot;</span> <span class="op">.||.</span> <span class="st">&quot;posts/*.lhs&quot;</span>) <span class="op">$</span> <span class="kw">do</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>        route   <span class="op">$</span> setExtension <span class="st">&quot;.html&quot;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>        compile <span class="op">$</span> myPandocCompiler</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> saveSnapshot <span class="st">&quot;content&quot;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> <span class="fu">return</span> <span class="op">.</span> <span class="fu">fmap</span> demoteHeaders</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/post.html&quot;</span> (postCtx tags)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/content.html&quot;</span> (mathCtx <span class="op">&lt;&gt;</span> defaultContext)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/default.html&quot;</span> (mathCtx <span class="op">&lt;&gt;</span> defaultContext)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> relativizeUrls</span></code></pre></div>
<h1 data-number="5" id="目次の生成"><span class="header-section-number">5</span> 目次の生成</h1>
<p><a href="https://svejcar.dev/posts/2019/11/27/table-of-contents-in-hakyll/">こちらのサイト</a>そのままで導入した.
だんだんPandocのOptionが長くなっていく…</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span>           <span class="dt">Prelude</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span>           <span class="dt">Data.Functor.Identity</span> (runIdentity)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>tocTemplate <span class="ot">=</span> <span class="fu">either</span> <span class="fu">error</span> Prelude.id <span class="op">.</span> runIdentity <span class="op">.</span> Pandoc.compileTemplate <span class="st">&quot;&quot;</span> <span class="op">$</span> T.unlines</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  [ <span class="st">&quot;&lt;div class=\&quot;toc\&quot;&gt;&lt;div class=\&quot;header\&quot;&gt;Table of Contents&lt;/div&gt;&quot;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  , <span class="st">&quot;$toc$&quot;</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  , <span class="st">&quot;&lt;/div&gt;&quot;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  , <span class="st">&quot;$body$&quot;</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="ot">customWriterOptions::</span> <span class="dt">Pandoc.WriterOptions</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>customWriterOptions <span class="ot">=</span> defaultHakyllWriterOptions</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>                        { Pandoc.writerHTMLMathMethod   <span class="ot">=</span> <span class="dt">Pandoc.MathJax</span> <span class="st">&quot;&quot;</span>       <span class="co">-- LaTeX</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>                        , Pandoc.writerNumberSections   <span class="ot">=</span> <span class="dt">True</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>                        , Pandoc.writerHighlightStyle   <span class="ot">=</span> <span class="dt">Just</span> pandocCodeStyle    <span class="co">-- Syntax</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>                        , Pandoc.writerTableOfContents  <span class="ot">=</span> <span class="dt">True</span>                    <span class="co">-- toc</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>                        , Pandoc.writerTOCDepth         <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>                        , Pandoc.writerTemplate          <span class="ot">=</span> <span class="dt">Just</span> tocTemplate</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>                        }</span></code></pre></div>
<p>として,</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>    match (<span class="st">&quot;posts/*.md&quot;</span> <span class="op">.||.</span> <span class="st">&quot;posts/*.html&quot;</span> <span class="op">.||.</span> <span class="st">&quot;posts/*.lhs&quot;</span>) <span class="op">$</span> <span class="kw">do</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>        route   <span class="op">$</span> setExtension <span class="st">&quot;.html&quot;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>        compile <span class="op">$</span> <span class="kw">do</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                underlying <span class="ot">&lt;-</span> getUnderlying</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                toc        <span class="ot">&lt;-</span> getMetadataField underlying <span class="st">&quot;tableOfContents&quot;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> writerOptions&#39; <span class="ot">=</span> <span class="fu">maybe</span> defaultHakyllWriterOptions (<span class="fu">const</span> customWriterOptions) toc</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>                pandocCompilerWith defaultHakyllReaderOptions writerOptions&#39;</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> saveSnapshot <span class="st">&quot;content&quot;</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> <span class="fu">return</span> <span class="op">.</span> <span class="fu">fmap</span> demoteHeaders</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/post.html&quot;</span> (postCtx tags)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/content.html&quot;</span> (mathCtx <span class="op">&lt;&gt;</span> defaultContext)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/default.html&quot;</span> (mathCtx <span class="op">&lt;&gt;</span> defaultContext)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> relativizeUrls</span></code></pre></div>
<h1 data-number="6" id="sitemapの生成"><span class="header-section-number">6</span> sitemapの生成</h1>
<p>postCtxを修正して, 修正時間(<code>mtime</code>),url(<code>url</code>)を追加.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ot">postCtx ::</span> <span class="dt">Tags</span> <span class="ot">-&gt;</span> <span class="dt">Context</span> <span class="dt">String</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>postCtx tags <span class="ot">=</span> <span class="fu">mconcat</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    [ modificationTimeField <span class="st">&quot;mtime&quot;</span> <span class="st">&quot;%Y-%m-%d&quot;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    , dateField <span class="st">&quot;date&quot;</span> <span class="st">&quot;%Y-%m-%d&quot;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    , tagsField <span class="st">&quot;tags&quot;</span> tags</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    , urlField <span class="st">&quot;url&quot;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    , <span class="dt">Context</span> <span class="op">$</span> \key <span class="ot">-&gt;</span> <span class="kw">case</span> key <span class="kw">of</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;title&quot;</span> <span class="ot">-&gt;</span> unContext (mapContext escapeHtml defaultContext) key</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>        _       <span class="ot">-&gt;</span> unContext <span class="fu">mempty</span> key</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    , defaultContext</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    ]</span></code></pre></div>
<p><code>templates</code>に<code>sitemap.xml</code>を追加.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;UTF-8&quot;</span><span class="fu">?&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">urlset</span><span class="ot"> xmlns=</span><span class="st">&quot;http://www.sitemaps.org/schemas/sitemap/0.9&quot;</span>&gt;</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    $for(entries)$</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">url</span>&gt;</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">loc</span>&gt;$url$&lt;/<span class="kw">loc</span>&gt;</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">lastmod</span>&gt;$mtime$&lt;/<span class="kw">lastmod</span>&gt;</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">url</span>&gt;</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    $endfor$</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">urlset</span>&gt;</span></code></pre></div>
<p><code>create</code>で<code>sitemap</code>を生成.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>    create [<span class="st">&quot;sitemap.xml&quot;</span>] <span class="op">$</span> <span class="kw">do</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>        route idRoute</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>        compile <span class="op">$</span> <span class="kw">do</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>            posts <span class="ot">&lt;-</span> loadAllSnapshots <span class="st">&quot;posts/*&quot;</span> <span class="st">&quot;content&quot;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>            lectures <span class="ot">&lt;-</span> loadAllSnapshots <span class="st">&quot;lectures/*&quot;</span> <span class="st">&quot;content&quot;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> allPosts <span class="ot">=</span> posts <span class="op">++</span> lectures</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> sitemapCtx <span class="ot">=</span> constField <span class="st">&quot;root&quot;</span> <span class="st">&quot;https://yakagika.github.io&quot;</span> <span class="op">&lt;&gt;</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>                             listField <span class="st">&quot;entries&quot;</span> (postCtx tags) (<span class="fu">return</span> allPosts)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>            makeItem <span class="st">&quot;&quot;</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/sitemap.xml&quot;</span> sitemapCtx</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;=</span> relativizeUrls</span></code></pre></div>
<p>以下のようなサイトマップが生成される.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;UTF-8&quot;</span> <span class="fu">?&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">urlset</span><span class="ot"> xmlns=</span><span class="st">&quot;http://www.sitemaps.org/schemas/sitemap/0.9&quot;</span>&gt;</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">url</span>&gt;</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">loc</span>&gt;/posts/2024-03-29-a-first-post.html&lt;/<span class="kw">loc</span>&gt;</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">lastmod</span>&gt;2024-06-12&lt;/<span class="kw">lastmod</span>&gt;</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">url</span>&gt;</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">url</span>&gt;</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">loc</span>&gt;/lectures/2024-03-29-introduction-to-algebraic-programing.html&lt;/<span class="kw">loc</span>&gt;</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">lastmod</span>&gt;2024-06-12&lt;/<span class="kw">lastmod</span>&gt;</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">url</span>&gt;</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">url</span>&gt;</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">loc</span>&gt;/lectures/2024-03-29-introduction-to-statistics.html&lt;/<span class="kw">loc</span>&gt;</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">lastmod</span>&gt;2024-06-12&lt;/<span class="kw">lastmod</span>&gt;</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">url</span>&gt;</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">url</span>&gt;</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">loc</span>&gt;/lectures/2024-03-29-special-lecture-datascience-answer.html&lt;/<span class="kw">loc</span>&gt;</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">lastmod</span>&gt;2024-06-12&lt;/<span class="kw">lastmod</span>&gt;</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">url</span>&gt;</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">url</span>&gt;</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">loc</span>&gt;/lectures/2024-03-29-special-lecture-datascience.html&lt;/<span class="kw">loc</span>&gt;</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">lastmod</span>&gt;2024-06-12&lt;/<span class="kw">lastmod</span>&gt;</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">url</span>&gt;</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">urlset</span>&gt;</span></code></pre></div>
<h1 data-number="7" id="複数のタグを付ける"><span class="header-section-number">7</span> 複数のタグを付ける</h1>
<p>lectures と post の2つからタグを生成する.</p>
<p>複数の<code>Pattern</code>から<code>Tags</code>を生成するための<code>buildTagsWithList</code>を定義して.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>buildTagsWithList :: MonadMetadata m <span class="op">=&gt;</span> [Pattern] <span class="op">-&gt;</span> (String <span class="op">-&gt;</span> Identifier) <span class="op">-&gt;</span> m Tags</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>buildTagsWithList patterns makeId <span class="op">=</span> do</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    ids <span class="op">&lt;-</span> concat <span class="op">&lt;</span>$<span class="op">&gt;</span> mapM getMatches patterns</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    tagMap <span class="op">&lt;-</span> foldM addTags M.empty ids</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    let <span class="bu">set</span><span class="st">&#39; = S.fromList ids</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="er">    return $ Tags </span>(M.toList tagMap) makeId (PatternDependency (mconcat patterns) <span class="bu">set</span><span class="st">&#39;)</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="er">  where</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">--</span> Create a tag <span class="bu">map</span> <span class="cf">for</span> one page</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    addTags tagMap <span class="bu">id</span><span class="st">&#39; = do</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="er">        tags &lt;- getTags id&#39;</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        let tagMap<span class="st">&#39; = M.fromList $ zip tags $ repeat [id&#39;</span>]</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> $ M.unionWith (<span class="op">++</span>) tagMap tagMap<span class="st">&#39;</span></span></code></pre></div>
<p>以下のように使う.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="op">--</span> Build tags</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>tags <span class="op">&lt;-</span> buildTagsWithList [<span class="st">&quot;posts/*&quot;</span>,<span class="st">&quot;lectures/*&quot;</span>] (fromCapture <span class="st">&quot;tags/*.html&quot;</span>)</span></code></pre></div>
<p><code>markdown</code>のメタデータに以下のように設定すると,ちゃんと動く.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> 特別講義(データサイエンス)</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> 資料</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="an">tags:</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">    - datascience</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">    - statistics</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">    - python</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="an">featured:</span><span class="co"> true</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="an">tableOfContents:</span><span class="co"> true</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span></code></pre></div>
<p>yakagika</p>
]]></description>
    <pubDate>Fri, 29 Mar 2024 00:00:00 UT</pubDate>
    <guid>/posts/2024-03-29-a-first-post.html</guid>
    <dc:creator>yakagika</dc:creator>
</item>

    </channel>
</rss>
