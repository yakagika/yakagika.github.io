<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"
    xmlns:dc="http://purl.org/dc/elements/1.1/">
    <channel>
        <title>yakagika - Posts tagged statistics</title>
        <link></link>
        <description><![CDATA[Personal blog of yakagika]]></description>
        <atom:link href="/tags/statistics.xml" rel="self"
                   type="application/rss+xml" />
        <lastBuildDate>Fri, 29 Mar 2024 00:00:00 UT</lastBuildDate>
        <item>
    <title>特別講義(データサイエンス)</title>
    <link>/lectures/2024-03-29-special-lecture-datascience.html</link>
    <description><![CDATA[<div class="toc"><div class="header">Table of Contents</div>
<ul>
<li><a href="#注意記法などについて" id="toc-注意記法などについて"><span class="toc-section-number">1</span> 注意,記法などについて</a>
<ul>
<li><a href="#デザインについて" id="toc-デザインについて"><span class="toc-section-number">1.1</span> デザインについて</a></li>
<li><a href="#演習回答及びデータ" id="toc-演習回答及びデータ"><span class="toc-section-number">1.2</span> 演習回答及びデータ</a></li>
<li><a href="#シンタックスとコーディングスタイル" id="toc-シンタックスとコーディングスタイル"><span class="toc-section-number">1.3</span> シンタックスとコーディングスタイル</a></li>
</ul></li>
<li><a href="#イントロダクション" id="toc-イントロダクション"><span class="toc-section-number">2</span> イントロダクション</a>
<ul>
<li><a href="#プログラミング言語の種類" id="toc-プログラミング言語の種類"><span class="toc-section-number">2.1</span> プログラミング言語の種類</a></li>
<li><a href="#授業準備" id="toc-授業準備"><span class="toc-section-number">2.2</span> 授業準備</a>
<ul>
<li><a href="#テキストエディタ" id="toc-テキストエディタ"><span class="toc-section-number">2.2.1</span> テキストエディタ</a></li>
</ul></li>
<li><a href="#imeの設定" id="toc-imeの設定"><span class="toc-section-number">2.3</span> IMEの設定</a></li>
<li><a href="#cliの基本操作" id="toc-cliの基本操作"><span class="toc-section-number">2.4</span> CLIの基本操作</a>
<ul>
<li><a href="#エンコーディング" id="toc-エンコーディング"><span class="toc-section-number">2.4.1</span> エンコーディング</a></li>
<li><a href="#日本語表示" id="toc-日本語表示"><span class="toc-section-number">2.4.2</span> 日本語表示</a></li>
<li><a href="#ディレクトリ" id="toc-ディレクトリ"><span class="toc-section-number">2.4.3</span> ディレクトリ</a></li>
</ul></li>
<li><a href="#基礎的なコマンド" id="toc-基礎的なコマンド"><span class="toc-section-number">2.5</span> 基礎的なコマンド</a></li>
<li><a href="#環境構築" id="toc-環境構築"><span class="toc-section-number">2.6</span> 環境構築</a></li>
<li><a href="#hello-world" id="toc-hello-world"><span class="toc-section-number">2.7</span> Hello World</a></li>
<li><a href="#プログラミングの勉強の仕方" id="toc-プログラミングの勉強の仕方"><span class="toc-section-number">2.8</span> プログラミングの勉強の仕方</a></li>
</ul></li>
<li><a href="#pythonことはじめ" id="toc-pythonことはじめ"><span class="toc-section-number">3</span> Pythonことはじめ</a>
<ul>
<li><a href="#replを使ってみよう" id="toc-replを使ってみよう"><span class="toc-section-number">3.1</span> REPLを使ってみよう</a></li>
<li><a href="#コメントアウト" id="toc-コメントアウト"><span class="toc-section-number">3.2</span> コメントアウト</a></li>
<li><a href="#データ型" id="toc-データ型"><span class="toc-section-number">3.3</span> データ型</a>
<ul>
<li><a href="#数値型pythonを電卓として使う" id="toc-数値型pythonを電卓として使う"><span class="toc-section-number">3.3.1</span> 数値型(Pythonを電卓として使う)</a></li>
</ul></li>
<li><a href="#変数と代入" id="toc-変数と代入"><span class="toc-section-number">3.4</span> 変数と代入</a>
<ul>
<li><a href="#代入演算子" id="toc-代入演算子"><span class="toc-section-number">3.4.1</span> 代入演算子</a></li>
</ul></li>
<li><a href="#文字列型" id="toc-文字列型"><span class="toc-section-number">3.5</span> 文字列型</a>
<ul>
<li><a href="#文字列の演算" id="toc-文字列の演算"><span class="toc-section-number">3.5.1</span> 文字列の演算</a></li>
</ul></li>
<li><a href="#リスト" id="toc-リスト"><span class="toc-section-number">3.6</span> リスト</a>
<ul>
<li><a href="#リストの演算" id="toc-リストの演算"><span class="toc-section-number">3.6.1</span> リストの演算</a></li>
</ul></li>
<li><a href="#タプル" id="toc-タプル"><span class="toc-section-number">3.7</span> タプル</a></li>
<li><a href="#辞書型" id="toc-辞書型"><span class="toc-section-number">3.8</span> 辞書型</a></li>
<li><a href="#論理演算" id="toc-論理演算"><span class="toc-section-number">3.9</span> 論理演算</a></li>
<li><a href="#復習スクリプトの実行" id="toc-復習スクリプトの実行"><span class="toc-section-number">3.10</span> (復習)スクリプトの実行</a></li>
<li><a href="#エラーへの対応法とよくある間違い" id="toc-エラーへの対応法とよくある間違い"><span class="toc-section-number">3.11</span> エラーへの対応法とよくある間違い</a>
<ul>
<li><a href="#エラーへの対応方法" id="toc-エラーへの対応方法"><span class="toc-section-number">3.11.1</span> エラーへの対応方法</a></li>
<li><a href="#エラーを体験してみよう" id="toc-エラーを体験してみよう"><span class="toc-section-number">3.11.2</span> エラーを体験してみよう</a></li>
</ul></li>
</ul></li>
<li><a href="#ライブラリの利用" id="toc-ライブラリの利用"><span class="toc-section-number">4</span> ライブラリの利用</a>
<ul>
<li><a href="#ライブラリとは" id="toc-ライブラリとは"><span class="toc-section-number">4.1</span> ライブラリとは</a></li>
<li><a href="#ライブラリを使ってみよう" id="toc-ライブラリを使ってみよう"><span class="toc-section-number">4.2</span> ライブラリを使ってみよう</a></li>
<li><a href="#なぜexcelではだめなのか" id="toc-なぜexcelではだめなのか"><span class="toc-section-number">4.3</span> なぜExcelではだめなのか</a></li>
</ul></li>
<li><a href="#データの取得と編集" id="toc-データの取得と編集"><span class="toc-section-number">5</span> データの取得と編集</a>
<ul>
<li><a href="#データの尺度" id="toc-データの尺度"><span class="toc-section-number">5.1</span> データの尺度</a></li>
<li><a href="#データの種類" id="toc-データの種類"><span class="toc-section-number">5.2</span> データの種類</a></li>
<li><a href="#データの取得と編集-1" id="toc-データの取得と編集-1"><span class="toc-section-number">5.3</span> データの取得と編集</a></li>
<li><a href="#e-statを使ってみよう" id="toc-e-statを使ってみよう"><span class="toc-section-number">5.4</span> e-statを使ってみよう</a></li>
<li><a href="#機械判読可能データの作成" id="toc-機械判読可能データの作成"><span class="toc-section-number">5.5</span> 機械判読可能データの作成</a></li>
<li><a href="#pandasによるデータ処理" id="toc-pandasによるデータ処理"><span class="toc-section-number">5.6</span> pandasによるデータ処理</a>
<ul>
<li><a href="#ファイルの読み込み" id="toc-ファイルの読み込み"><span class="toc-section-number">5.6.1</span> ファイルの読み込み</a></li>
</ul></li>
<li><a href="#データの確認" id="toc-データの確認"><span class="toc-section-number">5.7</span> データの確認</a></li>
<li><a href="#行名列名の変更" id="toc-行名列名の変更"><span class="toc-section-number">5.8</span> 行名,列名の変更</a></li>
<li><a href="#値の抽出" id="toc-値の抽出"><span class="toc-section-number">5.9</span> 値の抽出</a></li>
<li><a href="#条件による抽出" id="toc-条件による抽出"><span class="toc-section-number">5.10</span> 条件による抽出</a></li>
<li><a href="#値の変更" id="toc-値の変更"><span class="toc-section-number">5.11</span> 値の変更</a></li>
<li><a href="#データ型の確認と変更" id="toc-データ型の確認と変更"><span class="toc-section-number">5.12</span> データ型の確認と変更</a></li>
<li><a href="#dataframeの作成" id="toc-dataframeの作成"><span class="toc-section-number">5.13</span> DataFrameの作成</a></li>
<li><a href="#データの追加と削除" id="toc-データの追加と削除"><span class="toc-section-number">5.14</span> データの追加と削除</a></li>
<li><a href="#欠損値の処理" id="toc-欠損値の処理"><span class="toc-section-number">5.15</span> 欠損値の処理</a></li>
<li><a href="#データの保存" id="toc-データの保存"><span class="toc-section-number">5.16</span> データの保存</a></li>
<li><a href="#データの取得と編集全体の演習" id="toc-データの取得と編集全体の演習"><span class="toc-section-number">5.17</span> データの取得と編集全体の演習</a></li>
</ul></li>
<li><a href="#アルゴリズムとpythonの基本構文" id="toc-アルゴリズムとpythonの基本構文"><span class="toc-section-number">6</span> アルゴリズムとPythonの基本構文</a>
<ul>
<li><a href="#フローチャート" id="toc-フローチャート"><span class="toc-section-number">6.0.1</span> フローチャート</a></li>
<li><a href="#input関数" id="toc-input関数"><span class="toc-section-number">6.1</span> input関数</a></li>
<li><a href="#逐次処理インデントブロック" id="toc-逐次処理インデントブロック"><span class="toc-section-number">6.2</span> 逐次処理,インデント,ブロック</a></li>
<li><a href="#分岐" id="toc-分岐"><span class="toc-section-number">6.3</span> 分岐</a></li>
<li><a href="#反復" id="toc-反復"><span class="toc-section-number">6.4</span> 反復</a>
<ul>
<li><a href="#while文" id="toc-while文"><span class="toc-section-number">6.4.1</span> While文</a></li>
<li><a href="#for文" id="toc-for文"><span class="toc-section-number">6.4.2</span> for文</a></li>
</ul></li>
<li><a href="#関数とクラス" id="toc-関数とクラス"><span class="toc-section-number">6.5</span> 関数とクラス</a>
<ul>
<li><a href="#関数" id="toc-関数"><span class="toc-section-number">6.5.1</span> 関数</a></li>
<li><a href="#発展クラスとインスタンス" id="toc-発展クラスとインスタンス"><span class="toc-section-number">6.5.2</span> 発展:クラスとインスタンス</a></li>
</ul></li>
</ul></li>
<li><a href="#データサイエンスを始めよう-研究計画の建て方" id="toc-データサイエンスを始めよう-研究計画の建て方"><span class="toc-section-number">7</span> データサイエンスを始めよう 研究計画の建て方</a></li>
<li><a href="#モデルとデータ執筆中" id="toc-モデルとデータ執筆中"><span class="toc-section-number">8</span> モデルとデータ(執筆中)</a>
<ul>
<li><a href="#手法の決め方" id="toc-手法の決め方"><span class="toc-section-number">8.1</span> 手法の決め方</a></li>
<li><a href="#研究計画を建てよう" id="toc-研究計画を建てよう"><span class="toc-section-number">8.2</span> 研究計画を建てよう</a></li>
</ul></li>
<li><a href="#データの可視化-執筆中" id="toc-データの可視化-執筆中"><span class="toc-section-number">9</span> データの可視化 (執筆中)</a>
<ul>
<li><a href="#基礎的なグラフ棒グラフ円グラフ折れ線グラフ" id="toc-基礎的なグラフ棒グラフ円グラフ折れ線グラフ"><span class="toc-section-number">9.1</span> 基礎的なグラフ(棒グラフ,円グラフ,折れ線グラフ)</a>
<ul>
<li><a href="#棒グラフの作成" id="toc-棒グラフの作成"><span class="toc-section-number">9.1.1</span> 棒グラフの作成</a></li>
<li><a href="#色の変更" id="toc-色の変更"><span class="toc-section-number">9.1.2</span> 色の変更</a></li>
<li><a href="#スタイルの変更" id="toc-スタイルの変更"><span class="toc-section-number">9.1.3</span> スタイルの変更</a></li>
<li><a href="#要素の追加" id="toc-要素の追加"><span class="toc-section-number">9.1.4</span> 要素の追加</a></li>
</ul></li>
<li><a href="#円グラフ" id="toc-円グラフ"><span class="toc-section-number">9.2</span> 円グラフ</a></li>
<li><a href="#for文を利用したグラフ" id="toc-for文を利用したグラフ"><span class="toc-section-number">9.3</span> for文を利用したグラフ</a></li>
<li><a href="#グラフの分割" id="toc-グラフの分割"><span class="toc-section-number">9.4</span> グラフの分割</a></li>
<li><a href="#度数分布表とヒストグラム" id="toc-度数分布表とヒストグラム"><span class="toc-section-number">9.5</span> 度数分布表とヒストグラム</a>
<ul>
<li><a href="#度数分布表" id="toc-度数分布表"><span class="toc-section-number">9.5.1</span> 度数分布表</a></li>
<li><a href="#度数分布表の可視化ヒストグラム" id="toc-度数分布表の可視化ヒストグラム"><span class="toc-section-number">9.5.2</span> 度数分布表の可視化:<strong>ヒストグラム</strong></a></li>
</ul></li>
<li><a href="#箱ひげ図" id="toc-箱ひげ図"><span class="toc-section-number">9.6</span> 箱ひげ図</a></li>
<li><a href="#発展密度プロット" id="toc-発展密度プロット"><span class="toc-section-number">9.7</span> 発展:密度プロット</a></li>
<li><a href="#発展sinaplot" id="toc-発展sinaplot"><span class="toc-section-number">9.8</span> 発展:sinaplot</a></li>
<li><a href="#発展バイオリンプロット" id="toc-発展バイオリンプロット"><span class="toc-section-number">9.9</span> 発展:バイオリンプロット</a></li>
<li><a href="#散布図" id="toc-散布図"><span class="toc-section-number">9.10</span> 散布図</a>
<ul>
<li><a href="#観測項目が複数ある場合の散布図" id="toc-観測項目が複数ある場合の散布図"><span class="toc-section-number">9.10.1</span> 観測項目が複数ある場合の散布図</a></li>
<li><a href="#クラスタリングにおける散布図" id="toc-クラスタリングにおける散布図"><span class="toc-section-number">9.10.2</span> クラスタリングにおける散布図</a></li>
</ul></li>
<li><a href="#同時度数分布表" id="toc-同時度数分布表"><span class="toc-section-number">9.11</span> 同時度数分布表</a></li>
<li><a href="#ヒートマップ" id="toc-ヒートマップ"><span class="toc-section-number">9.12</span> ヒートマップ</a></li>
</ul></li>
<li><a href="#データの数値化-執筆中" id="toc-データの数値化-執筆中"><span class="toc-section-number">10</span> データの数値化 (執筆中)</a>
<ul>
<li><a href="#相関係数" id="toc-相関係数"><span class="toc-section-number">10.1</span> 相関係数</a></li>
<li><a href="#距離と類似度" id="toc-距離と類似度"><span class="toc-section-number">10.2</span> 距離と類似度</a></li>
</ul></li>
<li><a href="#検定" id="toc-検定"><span class="toc-section-number">11</span> 検定</a></li>
<li><a href="#回帰分析" id="toc-回帰分析"><span class="toc-section-number">12</span> 回帰分析</a></li>
<li><a href="#教師ありなし学習-執筆中" id="toc-教師ありなし学習-執筆中"><span class="toc-section-number">13</span> 教師あり/なし学習 (執筆中)</a>
<ul>
<li><a href="#主成分分析principle-component-analysis" id="toc-主成分分析principle-component-analysis"><span class="toc-section-number">13.0.1</span> 主成分分析(Principle component analysis)</a></li>
<li><a href="#k-means法" id="toc-k-means法"><span class="toc-section-number">13.0.2</span> k-means法</a></li>
<li><a href="#階層クラスタリング" id="toc-階層クラスタリング"><span class="toc-section-number">13.0.3</span> 階層クラスタリング</a></li>
<li><a href="#自然言語処理nplnatural-language-processing" id="toc-自然言語処理nplnatural-language-processing"><span class="toc-section-number">13.1</span> 自然言語処理(NPL,Natural Language Processing)</a></li>
</ul></li>
<li><a href="#一般化線形モデル執筆中" id="toc-一般化線形モデル執筆中"><span class="toc-section-number">14</span> 一般化線形モデル(執筆中)</a></li>
</ul>
</div>
<h1 data-number="1" id="注意記法などについて"><span class="header-section-number">1</span> 注意,記法などについて</h1>
<details>
<summary>
開く
</summary>
<p>特別講義(データサイエンス)の授業資料などを書いてく予定です.
(現在執筆中)</p>
<p>本資料は,文系学部生向けにデータサイエンスを体験することを目的にしたものです.
これまでにプログラミングや理数系科目を学習していないことを前提にしているので,
初歩の初歩から一つずつ扱う科目です.</p>
<p>こちらの資料では,授業に必要な技術的な内容に限定して掲載します.
授業概要,授業の注意点,成績等については講義中に別資料で説明します.</p>
<h2 data-number="1.1" id="デザインについて"><span class="header-section-number">1.1</span> デザインについて</h2>
<p>文章中で色の変わっているブロックはオレンジ色が注意(warn),青色が演習や強調(note)など独立した部分を表しています.
講義ではwarnに関しては,飛ばす場合があるので,興味のある人は自分で読み進めてください.</p>
<div class="warn">
<p>これは注意や発展的内容を示しています.</p>
</div>
<div class="note">
<p>これは演習や強調したい箇所に利用されています.</p>
</div>
<p>リンクは<a href="https://www.google.co.jp">Google</a>のように下線で表示されます.クリックすることでリンクに飛ぶことが可能です. 右クリックして,新しいタブで開くことを推奨しています.</p>
<h2 data-number="1.2" id="演習回答及びデータ"><span class="header-section-number">1.2</span> 演習回答及びデータ</h2>
<p>演習回答は<a href="https://yakagika.github.io/lectures/2024-03-29-special-lecture-datascience-answer.html">こちら</a></p>
<p>利用するデータは<a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/">こちら</a></p>
<h2 data-number="1.3" id="シンタックスとコーディングスタイル"><span class="header-section-number">1.3</span> シンタックスとコーディングスタイル</h2>
<p>本講義ではプログラムブロックは以下のように黒い背景でシンタックスハイライトが適用されています.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Sample&#39;</span>)</span></code></pre></div>
<p>コピー&amp;ペーストが可能なので, 自分のプログラムに利用してください.</p>
<div class="warn">
<ul>
<li>Pythonのコーディングスタイルについて</li>
</ul>
<p>Pythonの書き方は,基本的に可読性を高めるために,決まったルールで記載されます.
このルールを<strong>コーディングスタイル</strong>といいます.
Pythonにおける標準的なコーディングスタイルには<a href="https://peps.python.org/pep-0008/">PEP8(Python Enhancement Proposal)</a>などがありますが,本講義では一部従っていません.</p>
<p>特に,リストや辞書型などの改行において</p>
<ul>
<li><p>コンマを改行後の先頭に記述する</p></li>
<li><p>ブランケットの終わりを改行した最後に記述する</p></li>
</ul>
<p>といった記法を採用しています.これは,関数型言語(特にHaskell)の講義との対応関係を持たせるために筆者が好んでいるものですが,
一般的な手続き型言語のコーディングスタイルではありませんので注意してください.</p>
<p>また, リストなどを<code>xs</code>などの<code>s</code>をつけた複数形で表現する命名規則も多用していますが,
こちらも一般的なコーディングスタイルではありません.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#通常の記法</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>animals <span class="op">=</span> [<span class="st">&#39;cat&#39;</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">&#39;dog&#39;</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>           <span class="st">&#39;bird&#39;</span>]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#本資料における記法</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>animals <span class="op">=</span> [<span class="st">&#39;cat&#39;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>          ,<span class="st">&#39;dog&#39;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>          ,<span class="st">&#39;bird&#39;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>          ]</span></code></pre></div>
</div>
</details>
<h1 data-number="2" id="イントロダクション"><span class="header-section-number">2</span> イントロダクション</h1>
<details>
<summary>
開く
</summary>
<p>データサイエンスは,データを利用して現象を発見したり,予測をする科学の総称です. データの作成やデータを分析する前の処理,利用するコンピュータ関連の技術なども対象となります.</p>
<p>データサイエンスと関連の深い分野/用語として統計や機械学習,AIがありますが,それらもデータサイエンスの一部とみなすことができます.</p>
<p>統計は,データ自体の取得・作成・集計から,データの構造を分かりやすく分析・可視化する学問です.機械学習は,データから予測モデルを作り,意思決定などに応用する学問です. 統計や機械学習・AIは明確に分割することができるものではなく,かなりの部分が共通しています. 特に皆さんがこの講義の先修科目である統計学入門で学んだ,初歩的な統計は,機械学習やAI,データサイエンス全般を学ぶ上で,前提知識となります.この他,どちらかに分類できるわけではない,モデリング,AI,シミュレーション,最適化,次元削減,など様々なトピックが含まれています.</p>
<figure>
<img src="/images/data-science-and-components.png" alt="データサイエンス" />
<figcaption aria-hidden="true">データサイエンス</figcaption>
</figure>
<p>この講義では,統計学入門で学んだ,可視化,数値化,検定,回帰などの統計学の手法をPCを使って行う他,統計学入門の範囲を超えたより発展的な手法に関しても学習します.</p>
<p>しかし,このようにデータサイエンスは非常に広範な学問なので,統計学入門のように個別の手法に関して,細かく理解することはせず,それぞれの概要と利用方に関してのみを扱います.</p>
<h2 data-number="2.1" id="プログラミング言語の種類"><span class="header-section-number">2.1</span> プログラミング言語の種類</h2>
<p>データサイエンスは言葉の通り,データを扱います. 現在ではデータは基本的に,電子データとして収集,処理されるため,それらの編集,処理にはコンピュータを利用し,操作は基本的にはプログラムによってなされます. したがってプログラミングは,データサイエンスのための前提知識となります.</p>
<p>この講義では最終的には,学生それぞれに研究のためのプログラムを組んでもらいます.
データサイエンスや統計でよく使われる言語は, Python, Julia, R, SPSS, matlab などいくつかありますが, この授業では, 現在世界的に広く使われており,習得も容易なPythonを利用します.</p>
<p>プログラミング言語には沢山の種類がありますが,言語によって機能や得意なことが異なります.</p>
<figure>
<img src="/images/2024-04-08-lecture-DS-languages.png" alt="Langage icons" />
<figcaption aria-hidden="true">Langage icons</figcaption>
</figure>
<p>プログラミング言語は <strong>実行方式</strong>, <strong>書き方</strong>,<strong>検査の仕方</strong>などの特徴がそれぞれ異なり,大まかにはそれぞれ以下のような意味になります.</p>
<hr />
<p><strong>実行方式</strong></p>
<p>プログラミング言語は,人間にとって理解しやすくデータ構造やアルゴリズムを記述するための手段です.しかし,コンピュータはプログラミング言語を直接理解することはできません.そのため,書かれたプログラムはコンピュータが解釈できる形式,すなわち0と1のビット列である機械語に翻訳される必要があります.この翻訳プロセスは,プログラムの実行方式を以下の二つに分ける要因となります.</p>
<div class="note">
<ul>
<li>インタプリタ方式</li>
</ul>
<p>インタプリタ方式では,プログラムは逐次的に機械語に翻訳されながら実行されます.この方式の特徴は,コンパイルする必要がないため,翻訳と実行が同時に行われる点です.これにより,プログラムの変更がすぐに反映されるため,開発中のテストやデバッグが容易になります.しかし,実行のたびに翻訳を行う必要があるため,実行速度が遅くなることが欠点です.</p>
</div>
<div class="note">
<ul>
<li>コンパイラ方式</li>
</ul>
<p>コンパイラ方式では,プログラム全体が事前に機械語に翻訳され,その結果として得られる実行可能なプログラムが生成されます.コンパイラ方式の利点は,一度コンパイルされたプログラムは,何度も実行される際に追加の翻訳が不要であるため,実行速度が速いことです.また,コンパイル時にプログラム全体を分析できるため,エラーやバグの発見が早期に行え,より安全性が高まるという利点があります.</p>
</div>
<p>この二つの実行方式は,プログラムの性質や用途に応じて選択されます.インタプリタ方式は開発の柔軟性が求められる場合に適しており,コンパイラ方式は性能が重視される場合に好まれます.プログラマはこれらの特性を理解し,それぞれの場面で最適な選択をすることが求められます.</p>
<hr />
<p><strong>書き方</strong></p>
<p>プログラミングとは,基本的にコンピュータに対して実行してほしい命令を記述する作業です.現在主流のプログラミング言語には,大まかに<strong>手続き型言語</strong>と<strong>関数型言語</strong>の二つの記述方法が存在します.</p>
<div class="note">
<ul>
<li>手続き型言語</li>
</ul>
<p>この言語タイプでは,プログラムが｢何を,どうするか｣を順番に記述していきます. Python,Java,VBAなど多くの広く使われている言語がこの方法を採用しています. これにより,処理の流れが直観的に理解しやすくなります.</p>
</div>
<div class="note">
<ul>
<li>関数型言語</li>
</ul>
<p>関数型言語では,プログラムを実行によってユーザーが得たい結果を抽象化し,関数の組み合わせで記述します.このアプローチは,安全性の向上やデバッグのしやすさといったメリットを提供しますが. 概念の抽象化により理解が難しくなることがあります.</p>
</div>
<p>近年では,手続き型言語にも関数型の構文が取り入れられるようになり,手続き型言語内で関数型風に記述することや,その逆も可能になっています.</p>
<p>これらの違いについて更に詳しく知りたい方は,別の<a href="/lectures/2024-03-29-introduction-to-algebraic-programing.html">講義資料</a>で更に詳しく説明しています.</p>
<hr />
<p><strong>検査の仕方</strong></p>
<p>プログラミングは,データ構造とアルゴリズムを使用して命令を記述する作業です.ここではデータ型の詳細に深くは触れませんが,あらゆるプログラミング言語において,データはコンピュータのメモリ上に数値の羅列として存在します.それらの数値に意味を与えることでデータ型が形成されます.</p>
<p>プログラムは実行時に,これらのデータ型が適切に使用されているかを検査します.主な検査方法には<strong>動的型付け</strong>と<strong>静的型付け</strong>があります.動的型付けでは,プログラムの実行時にデータ型が決定され,静的型付けではコンパイル時にデータ型が固定されます.さらに,型付けには「弱い型付け」と「強い型付け」という区別も存在しますが,この講義ではその詳細には触れません.興味のある方は,このトピックについてさらに調査してみてください.</p>
<div class="note">
<ul>
<li>動的型付け
動的型付けのシステムでは,プログラマが変数の型を明示的に宣言する必要がありません.代わりに,コンピュータはプログラムの実行時に型を推論し,適切な型を自動で割り当てます.この柔軟性により,プログラマはより迅速に開発を進めることが可能になります.一方で,このシステムではコンパイル時の型チェックが行われないため,実行時に型関連のエラーが発生するリスクが高まります.そのため,安全性を確保するためには,プログラマ自身が型の整合性に注意を払い,エラー処理やテストにより問題を検出する必要があります.</li>
</ul>
</div>
<div class="note">
<ul>
<li>静的型付け</li>
</ul>
<p>静的型付けでは,プログラマが変数や関数の型をコード内で明示的に宣言し,これらはコンパイル時にチェックされます.この事前の型チェックにより,プログラムの安全性が向上し,実行時のエラーが減少します.また,コンパイラが型情報を利用して効率的なコード生成を行い,パフォーマンスが向上することがあります.静的型付けは特に,大規模プロジェクトや高い信頼性が求められる場合に適しています.</p>
</div>
<hr />
<p>プログラミング言語は,このような区分や,それ以外の様々な機能によって,用途の向き不向きが決まります(大雑把な目安です).</p>
<figure>
<img src="/images/2024-04-08-language-and-purpose.png" alt="Languages and usages" />
<figcaption aria-hidden="true">Languages and usages</figcaption>
</figure>
<p>ではこれらの特徴を踏まえて,Pythonとはどのような言語なのかを見てみましょう.</p>
<div class="note">
<p>Pythonは</p>
<pre><code>- インタプリタ型言語で
    - 機械語に翻訳しながら動く
    - 手軽に書けて手軽に試せる
    - でも少し安全性が低く,遅い

- 手続き型言語で
    - 次に何をするかを順番に書く
    - (ただし関数型っぽい書き方もできる)

- 動的型付け言語で
    - 型検査を動かしながら実施
    - 動かしてから型が違うと失敗する</code></pre>
</div>
<p>これらは,プログラミング言語の大きな分類からみたPythonですが, Python固有の特徴として以下のようなものがあります.</p>
<div class="note">
<pre><code>- とにかく読みやすく書きやすく覚えやすい
    - ABC言語という教育用言語が元になっている
        - 予約語が少ない,      → 覚えることが少ない
        - インデントでかき分け → 間違いが少ない
        - だれが書いても同じになる(と言われてはいる)

- ライブラリが豊富
    - 統計処理を全部0から自分で書くのは大変
    - 他の人が作ったものを使えるようにするのがライブラリ
    - 様々な大学や企業,研究者が膨大な量の統計処理,機械学習ライブラリを開発している

- 遅いけど,Cなどと連携しやすい.
    - プログラミング言語ごとに速度は異なる.
    - Pythonは結構遅いので大きな計算に時間がかかる.
        - とても早い言語で遅い部分を書き換えやすい
        - ライブラリは基本的に早くなっている</code></pre>
</div>
<p>Pythonが教育用に良く使われるのは, インタプリタ方式の動的型付け言語であることから手軽に書けるだけではなく,もともと言語として簡単に書けるように作られていることが大きいです.</p>
<p>また, 統計,データサイエンス分野のライブラリが充実しており, これによって誰でも簡単に複雑な統計処理やデータサイエンスの技法が利用できることで,Pythonが広く普及しています.</p>
<p>簡単 → 教育用に → 多くの人が使う → ライブラリが充実 → もっと多くの人が使う</p>
<p>という流れがPythonの最大の強みと言えるでしょう.</p>
<p>実際にPythonはユーザー数が増え続けており,プログラムの共有サイトGitHubにおける2023年のすべての言語のなかで2番目にユーザ数が多い言語となっています.
<a href="https://github.blog/2023-11-08-the-state-of-open-source-and-ai/">Top 10 Programming languages on GitHub</a></p>
<figure>
<img src="/images/top-programming-languages-2023.png" alt="Top 10 Programming languages on GitHub" />
<figcaption aria-hidden="true">Top 10 Programming languages on GitHub</figcaption>
</figure>
<h2 data-number="2.2" id="授業準備"><span class="header-section-number">2.2</span> 授業準備</h2>
<p>この講義では,プログラムを自分で作成し,様々な演習をこなしてもらいますが,その前段階として,いくつかの準備が必要となります. このあたりはこの科目の先修科目の統計学入門でも扱っていますが,履修していない人もいますので,順番にやっていきましょう. 非常に基礎的な内容なので, 問題のない人は飛ばしましょう.</p>
<h3 data-number="2.2.1" id="テキストエディタ"><span class="header-section-number">2.2.1</span> テキストエディタ</h3>
<p>テキストエディタとは,プログラムを書くためのソフトウェアです.
プログラムを書くことをコーディング(Coding)といいます.</p>
<p>テキストエディタには沢山の種類があり,それぞれ独自の機能を持っています.
Windwosに最初から入っている｢メモ帳｣もテキストエディタですが,プログラムを書くために様々な機能が追加された高機能なテキストエディタも沢山あります.</p>
<p>例えば,シンタックスハイライト機能は,以下のプログラムのように,プログラムの記述を役割や意味に応じて色付けして見やすくしてくれます.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">## シンタックスハイライト</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> greet_based_on_time():</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    now <span class="op">=</span> datetime.now()</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    current_hour <span class="op">=</span> now.hour</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="dv">5</span> <span class="op">&lt;=</span> current_hour <span class="op">&lt;</span> <span class="dv">12</span>:</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        greeting <span class="op">=</span> <span class="st">&quot;Good morning, world!&quot;</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="dv">12</span> <span class="op">&lt;=</span> current_hour <span class="op">&lt;</span> <span class="dv">18</span>:</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        greeting <span class="op">=</span> <span class="st">&quot;Good afternoon, world!&quot;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        greeting <span class="op">=</span> <span class="st">&quot;Good night, world!&quot;</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> greeting</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 関数を呼び出して結果を表示</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(greet_based_on_time())</span></code></pre></div>
<p>また,スペースをタブに変換するなどの機能も非常に便利です. 最近では生成AIを利用した自動補完機能がついたエディタなどもありますが,本講義における生成AIの利用に関しては第2回でコードを書き始めた際に説明します.</p>
<p>今までメモ帳以外のテキストエディタを利用したことが無い方には,シンプルなSublime Text 3をおすすめします(今世界的に人気があるのは VSCodeです.非常に便利ですが機能が多すぎて皆さんが混乱する可能性があるので,こちらを選びました).</p>
<p>既に何かしらのテキストエディタを利用している方は,現在使用しているエディタをそのまま利用して頂いても構いません.</p>
<p><a href="https://www.sublimetext.com/3">このURL</a>をクリックして,ページ上部にあるDownloadをクリックします. 自分のPCに合わせたインストール方法を選択しましょう.</p>
<figure>
<img src="/images/2024-04-08-lecture-DS-sublime-install.png" alt="Screenshot Sublime Text" />
<figcaption aria-hidden="true">Screenshot Sublime Text</figcaption>
</figure>
<div class="warn">
<p>SublimeTextもいろいろな機能を追加することができます.
｢SublimeText 設定｣などで調べて,好きなようにカスタマイズして構い舞いません.
カスタマイズをしなくても基本的な機能には問題ありません.</p>
</div>
<h2 data-number="2.3" id="imeの設定"><span class="header-section-number">2.3</span> IMEの設定</h2>
<p>プログラムは基本的に <strong>｢半角英数字｣</strong> で記述されます. プログラム中に全角の空白や記号が交じるとエラーの原因となる場合があります. そのため,プログラムを書く前に,そういったミスが起きないようにIMEの設定をしましょう.</p>
<p>タスクトレーからIMEの設定ができます．基本的に記号をすべて半角に設定しましょう（スペースは必ず半角にしましょう）．特に，句読点をコンマとピリオドに変更しましょう．</p>
<figure>
<img src="/images/2024-04-08-lecture-DS-IME.png" alt="IME" />
<figcaption aria-hidden="true">IME</figcaption>
</figure>
<h2 data-number="2.4" id="cliの基本操作"><span class="header-section-number">2.4</span> CLIの基本操作</h2>
<p>プログラムの開発環境にはマウスなどでクリックして操作するGUI(Graphical User Interface)をもったIDE(Integrated Development Environment)などもありますが,基本的には文字によってコンピュータに命令を送るCLI(Command Line Interface)を利用します. 映画やマンガなどで,ハッカーが黒い画面に文字を打っているあれのことです.</p>
<p>コンピュータのオペレーティングシステムとユーザー間のCLIを提供するプログラムをShellといい,Windowsでは,Command PromptやPowerShellなどがあります. MacなどのUnix系では,Bashやzshがあります. いずれも (Windows) Terminalというソフトウェアを介して利用します.</p>
<p>本講義では環境や好みによって好きな環境で開発して構いませんが,ここでは,PowerShellの利用法を解説します.</p>
<p>Windows11の検索バーで <code>Terminal</code>と検索して,出てきた <code>Terminal</code>をクリックしましょう.</p>
<figure>
<img src="/images/Terminal-launch.png" alt="Screenshot Terminal" />
<figcaption aria-hidden="true">Screenshot Terminal</figcaption>
</figure>
<p>自動的に<code>Windows PowerShell</code>が起動します. 立ち上がった,黒色の画面に文字でコマンド(命令)を入力して,コンピュータを操作します.</p>
<figure>
<img src="/images/Terminal-window.png" alt="Screenshot Terminal" />
<figcaption aria-hidden="true">Screenshot Terminal</figcaption>
</figure>
<h3 data-number="2.4.1" id="エンコーディング"><span class="header-section-number">2.4.1</span> エンコーディング</h3>
<p>実際にコマンドを入力する前に, 初心者がつまづきやすいポイントとして,Windowsのエンコーディングについて解説します.</p>
<p>PCは人間の使う文字（日本語，英語など）が理解できません.PCは機械語と呼ばれる言語で命令を受け付けます.一方で,人間は機械語を読むのが困難です.そこで,人間の使う文字と,機械語の間に変換ルールを設けて人間の文字でされた命令をPCにわかる文字に変換します.この変換ルールを文字エンコーディングと呼びます.</p>
<p>エンコーディングには複数の種類があります(日本語設定のWindowsはShift-JIS,Unix系はUnicodeが一般的です).
PythonはUTF-8という文字エンコーディングがデフォルトなので,Windowsにおいても可能な限りUTF-8を用いた方が良いです.</p>
<p>そこで,ターミナル上で利用するエンコーディングを変更します.
PowerShellを起動して, <code>chcp 65001</code> と打ち込み, PowerShell上で利用する文字エンコーディングをUTF-8に変更しましょう. <code>chcp</code>が利用する文字コードを変更するコマンド(change code page)で,その後に変更したい文字コードを入力します. <code>65001</code>は<code>UTF-8</code>のコードページ(Windows独自の文字エンコーディング)です. これはPowerShellを起動する度に行ってください．</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">chcp</span> 65001</span></code></pre></div>
<p>と入力すると,</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Active</span> code page: 65001</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">PS</span> C:<span class="dt">\U</span>sers<span class="dt">\u</span>ser<span class="op">&gt;</span></span></code></pre></div>
<p>のように表示されるはずです.</p>
<h3 data-number="2.4.2" id="日本語表示"><span class="header-section-number">2.4.2</span> 日本語表示</h3>
<p>Power Shellの設定によっては日本語が表示されず,日本語部分が <code>□</code> で置き換えられて表示されます.これは,使用しているフォントに日本語が含まれていないために発生します.</p>
<figure>
<img src="/images/powershell-tofu.png" alt="Screenshot PowerShell" />
<figcaption aria-hidden="true">Screenshot PowerShell</figcaption>
</figure>
<p>設定を変更してて日本語を表示可能にしましょう(
適当な日本語を入力してみて,問題なく表示されるようであれば,変更は必要ありません).</p>
<p>左上の<code>下向きの矢印 &gt; 既定値 &gt; 外観 &gt; フォントフェイス</code>の部分を日本語フォントに変更し<code>保存</code>をクリックすることで,日本語が表示されるようになります.</p>
<figure>
<img src="/images/Terminal-setting1.png" alt="Screenshot Terminal" />
<figcaption aria-hidden="true">Screenshot Terminal</figcaption>
</figure>
<figure>
<img src="/images/Terminal-setting2.png" alt="Screenshot Terminal" />
<figcaption aria-hidden="true">Screenshot Terminal</figcaption>
</figure>
<figure>
<img src="/images/Terminal-setting3.png" alt="Screenshot Terminal" />
<figcaption aria-hidden="true">Screenshot Terminal</figcaption>
</figure>
<p>その他色やサイズなど,好きな設定に変更できます. あとで,好みにカスタマイズしましょう.</p>
<h3 data-number="2.4.3" id="ディレクトリ"><span class="header-section-number">2.4.3</span> ディレクトリ</h3>
<p>基礎的なコマンドを学ぶ前に,ディレクトリに関して理解しておきましょう.
コンピュータの中のデータは,以下のような木構造になっています. このような木構造によるファイルの構造をディレクトリといいます.</p>
<pre><code>C: -- Users -- hoge
          |
            -- hoge2 -- Desktop
                   |
                     -- Downloads
                   |
                     -- Documents -- huga
                                |
                                  -- huga2</code></pre>
<p>CLIにおいて,ユーザはこの木構造のどこかに存在しており,この木構造を移動しながら様々な作業を行います. 現在いるディレクトリのことを <code>working directory</code>(以下wd)や<code>current directory</code>といいます.</p>
<h2 data-number="2.5" id="基礎的なコマンド"><span class="header-section-number">2.5</span> 基礎的なコマンド</h2>
<p>ここでは, この講義で必要となる最低限のコマンド,特にディレクトリの移動に関するコマンドを学習します.</p>
<p>wdは, CLIの左側に表示されていることが多いです.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">PS</span> C:/Users/hoge2<span class="op">&gt;</span></span></code></pre></div>
<p>のように表示されていれば今<code>C:</code>ドライブ下の<code>Users</code>下の<code>hoge2</code>がwdとなります.</p>
<div class="warn">
<ul>
<li><p>Windowsでは,ディレクトリを区切る文字が<code>¥</code>あるいは<code>\</code>で表示されていると思います.</p></li>
<li><p>Macでは,<code>/</code>です.</p></li>
</ul>
<p>本資料では,<code>¥</code>を表示するのが <del>ダルい</del> 技術的に難しいので<code>/</code>を利用しています. 自分の環境に併せて適宜読み替えてください.</p>
</div>
<p>CLIの左側に表示されていない場合にも<code>pwd</code>コマンド (print working directory)を入力すると,現在のディレクトリが表示されます.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">PS</span> C:/Users/hoge2<span class="op">&gt;</span> pwd</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="ex">PATH</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="ex">----</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="ex">C:/Users/hoge2</span></span></code></pre></div>
<p>wdの下に何があるかを調べるコマンドとして<code>ls</code>コマンド(list)があります.</p>
<div class="warn">
<p>以下, <code>PS C:\Users\hoge2</code>の部分は省略します.</p>
</div>
<div class="sourceCode" id="cb11"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> ls</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Desktop</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Downloads</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Documents</span></span></code></pre></div>
<p>※実際の画面では,もう少しいろいろな情報が書かれているかと思います.</p>
<p>wdから別のディレクトリに移動するコマンドとして <code>cd</code> コマンド(change directory)があります</p>
<p><code>cd [移動先]</code> と打つことで,lsコマンドで出てきた,ディレクトリに移動することができます.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> ls</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Desktop</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Downloads</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Documents</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> cd <span class="ex">Documents</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> pwd</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="ex">PS</span> C:/Users/hoge2/Documents</span></code></pre></div>
<div class="warn">
<p>移動先のディレクトリ名はすべて自分で入力する必要はありません. 最初の数文字を入力して<code>Tab</code> Keyを押すと,自動で保管してくれます.</p>
</div>
<p><code>cd ..</code> と打つと一つ前のディレクトリ,<code>cd ~</code>と打つとホームディレクトリ(基本的には最初に開いた際にいた場所)に一挙に移動することができます.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> pwd</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="ex">PS</span> C:/Users/hoge2/Documents</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> cd <span class="ex">..</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> pwd</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="ex">PS</span> C:/Users/hoge2</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> cd <span class="ex">Documents/huga</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> pwd</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="ex">PS</span> C:/Users/hoge2/huga</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> cd <span class="ex">~</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> pwd</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="ex">PS</span> C:/Users/hoge2</span></code></pre></div>
<p><code>mkdir [作りたいディレクトリ名]</code> コマンド(make directory)で,新しいディレクトリを作成できます.</p>
<p><code>rmdir [消したいディレクトリ名]</code> コマンド(remove directory)で,ディレクトリを消すことができます.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> pwd</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="ex">PS</span> C:/Users/hoge2</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> ls</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Desktop</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Downloads</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Documents</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> cd <span class="ex">Documents</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> ls</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="ex">huga</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="ex">huga2</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> mkdir <span class="ex">huga3</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> ls</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="ex">huga</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="ex">huga2</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="ex">huga3</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> rmdir <span class="ex">huga3</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> ls</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="ex">huga</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="ex">huga2</span></span></code></pre></div>
<p><code>rmdir</code> コマンドでは中身のあるディレクトリは消せません. オプションを追加することで消せますが,危険なのでここでは教えません.興味があったら自分で調べてみましょう.</p>
<div class="note">
<p><strong>練習:作業用ディレクトリを作ろう</strong></p>
<ul>
<li><p>これから,作業をするためのディレクトリをコマンドで作成しましょう.</p>
<ul>
<li>Documentsに移動</li>
<li>Programs というディレクトリを作成し移動</li>
<li>Python というディレクトリを作成し移動</li>
<li>slds というディレクトリを作成し移動
(名前は好きに設定して良いです. slds; special lecture data science)</li>
</ul></li>
</ul>
<p>これからこの講義で利用するプログラムなどはsldsに保存しましょう.</p>
</div>
<h2 data-number="2.6" id="環境構築"><span class="header-section-number">2.6</span> 環境構築</h2>
<p>自身の環境(PC)でプログラムが動くようにすることを環境構築といいます. Python自分のPCで動くように設定をしましょう.</p>
<p>Pythonの環境構築に関して説明します.Pythonを動かす方法は沢山あります.一つのソフトの中でプログラムの編集から実行まで全て完結するIDE(統合開発環境)やブラウザ上で実行する方法もありますが,ここではCLIを利用して実行する方法を準備します.Windowsを所有している学生が多いと思われるので,Windowsを前提に説明します. それ以外のOSの方は分からなければ教員に聞いて下さい.</p>
<div class="note">
<ul>
<li>pythonの環境</li>
</ul>
<p>現在のPythonの開発環境は, <a href="https://github.com/pyenv/pyenv"><code>pyenv</code></a>や<a href="https://www.docker.com"><code>Docker</code></a>を利用した仮想環境でpythonのversionやライブラリをアプリケーションごとに分ける方法が主流です.</p>
<p>ただし,本資料では複数のアプリケーションを設定すると手順が煩雑になり,環境変数の設定など作業量が多くなるため扱いません.興味がある方は,調べて自分で導入してみましょう.</p>
<p>特にMacユーザーは,以下の手順で公式サイトのインストーラーを利用した場合,新しいversionのpythonを導入する際に苦労することになるかと思います. もし,自分で環境を再構築して上手く以下なかった場合は,教員に聞いてみましょう.</p>
</div>
<p>Pythonの<a href="https://www.python.org/downloads/windows/">公式サイト</a>からPythonをダウンロードしましょう.</p>
<p>Windows → 最新の一つ前のバージョンの Windows installer (64-bit) をクリック</p>
<p>最新版を入れたいところですが,最新のVersionは色々と不具合が起きる可能性があるので,上から1つ目のVersionにしておきましょう.ここでは最新が3.12.2なので,3.11台のバージョンを入れます.(バージョンの数字は,サイトを開いた時期によって変わります.)</p>
<figure>
<img src="/images/python-download.png" alt="Download Python" />
<figcaption aria-hidden="true">Download Python</figcaption>
</figure>
<p>ダウンロードした Python-3.11.8.exeをクリックするとウィンドウが開きます. 指示に従ってインストールしましょう．</p>
<div class="warn">
<p>注意点</p>
<p>開いたWindowで</p>
<ul>
<li><p><code>Insatall launcher for all users(recommended)</code></p></li>
<li><p><code>Add Python 11.8 to PATH</code></p></li>
</ul>
<p>というチェックボックスが出てきたら,それらにチェックを入れてから次に進みましょう.</p>
<p>この画面もVersionなどによって変わるため,分からなければ教員に聞いて下さい.</p>
<figure>
<img src="/images/install-python.png" alt="Install Python" />
<figcaption aria-hidden="true">Install Python</figcaption>
</figure>
</div>
<p>インストールが終わったら <strong>新しくPowerShellを開いて</strong> <code>python --version</code> と入力しましょう.
<strong>Macの人は</strong> <code>python3 --version</code> とコマンドが変わりますので注意してください. Macの人は以降,<code>python</code> コマンドはすべて <code>python3</code> コマンドに読み替えてください.</p>
<p>install したversionのPythonが表示されれば無事インストールされています.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> python <span class="ex">--version</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Python</span> 3.11.8</span></code></pre></div>
<h2 data-number="2.7" id="hello-world"><span class="header-section-number">2.7</span> Hello World</h2>
<p>初めて作成するプログラムとして標準出力(PowerShellなどの画面)に<code>Hello World</code>と出力するだけのプログラムを作成してみます.</p>
<p><code>PowerShell</code>を開いて,自分の作業用ディレクトリに移動します.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> chcp <span class="ex">65001</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> cd <span class="ex">Documents/Programs/Python/slds</span></span></code></pre></div>
<p>テキストエディタで新しいファイルを開き,<strong>作業用ディレクトリ</strong>に<code>hello.py</code>という名前で保存しましょう.</p>
<p><code>.py</code>はPythonプログラムの拡張子です.</p>
<p>保存は,タブから<code>File &gt; save with encoding &gt; UTF-8</code>の順にクリックし<code>UTF-8</code>で保存しましょう.
それ以降は <code>Ctrl + s</code>などで上書き保存しても構いません.</p>
<p>作成したディレクトリに移動し, lsコマンドでファイルがあるか確認しましょう.
ょう.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> ls</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="ex">hello.py</span></span></code></pre></div>
<p>確認できたらhello.pyに以下の2行を書き足して上書き保存します.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -*- coding:utf-8 -*-</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(“Hello world<span class="op">!</span>”)</span></code></pre></div>
<p>保存できたら<code>python hello.py</code>コマンドでプログラムを実行します.
(Macの人は <code>python3 hello.py</code>です.)</p>
<p>標準出力に<code>Hello World!</code>と表示されれば成功です.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> python <span class="ex">hello.py</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Hello</span> World!</span></code></pre></div>
<p>ここまでで，皆さんはPCでプログラムを書く準備が整いました．
あとはプログラムの書き方を学習すれば自身の環境で開発が行なえます．</p>
<h2 data-number="2.8" id="プログラミングの勉強の仕方"><span class="header-section-number">2.8</span> プログラミングの勉強の仕方</h2>
<p>プログラミング言語は,文字通り<strong>言語</strong>です. 英語などと同じ様に,使わないと身につきません.なので,大事なことは<strong>勉強するより使う</strong>ことです.</p>
<p>英語の勉強で,一つひとつ文法を覚えることは大切かもしれませんが,実際に英文を書いたり,会話しないと使えるようにはなりません. プログラミングの学習で,学習用の資料や教科書を一つ一つ<strong>読んだり,ノートに書き写す人</strong>がたまにいますが,かなり効率が悪い方法です. 何も分からなくてもいいので,取り敢えずプログラムを書いて実行するようにしましょう. 資料に載っている例はすべて,実際に書いて実行してみましょう.</p>
<p>一番いい方法は,何も分からなくても取り敢えず,プログラムをつかってしてみたいことを実行することです.1からすべての構文などを覚えようとしないで,自分がやりたい,しなければならないことを,書き始めましょう. <strong>分からないところだけを</strong>調べれば十分です.</p>
<p>その際に,新しく知ったことは,メモなどして,あとで参照できるようにしておきましょう. その資料が後々役に立ちます.</p>
<p>プログラミングは,すべて暗記する必要はありません. 覚えていなくても,それの調べ方や載っている資料を知っていれば十分です. 何回も使う機能であれば自然に覚えます.</p>
<p><strong>ただし,</strong> Pythonは非常に多くの人が利用しているので,みなさんがこの講義で習うレベルのことは検索すれば既に,完成したプログラムを参考にすることができます. また,ChatGPTなどの生成AIを利用すれば,皆さんの書いたプログラムよりかなりできの良いものをすぐに得ることができます. それらを見て勉強することは大切ですが,ただ,只管コピペしたり,生成AIの結果を利用しているだけでは,全く身につきません. 検索して出てきたコードや,生成AIによるコードを利用しても構いませんが, それをただ貼り付けるのではなく,<strong>自分で読んで,理解する</strong>ようにしましょう.</p>
<p>知らない部分,自分では書けない部分が見つかったらそれを理解するように勉強しましょう. ChatGPTに質問しても構いません. ただ,聞いたことを説明できるようにしましょう.</p>
<p>自分で説明できないものを使えるのは<strong>せいぜい学校の課題くらいです</strong>. 仕事や研究では,中身の良く分からないコードは利用できません. 最低限自分で理解したものだけを利用してください.</p>
<p>講義では,結果があっていればよいだけではなく,<strong>なぜそのように書いたのか</strong>,<strong>どのような意味か</strong>,<strong>なぜこうなるのか</strong>などを皆さんに聞きますので,理解に務めるようにしましょう.</p>
<div class="note">
<p><strong>演習</strong></p>
<ul>
<li><u>演習1 Shellコマンドの調査</u></li>
</ul>
<p>今回ならったいくつかのコマンド以外にも便利なコマンドが沢山あります. 3つ調べて,使い方を説明してください.</p>
<ul>
<li><u>演習2 チートシートの作成</u></li>
</ul>
<p>チートシートとは「それだけを見れば必要な情報が分かるメモ書き」のことです.
プログラミングの学習では, 自分でノートを取って,それさえ見ればなんとかできる資料を作る のは非常に有用です.</p>
<p><code>.ppt</code>でも<code>.txt</code>でも形態は何でも良いので, 自分だけのチートシートを作成して, 今日覚えたこと,調べたことなどをメモしていきましょう.</p>
<p>◦ CLI, Pythonの基礎, Pandasなど学習の区切りごとにシートを分けると便利です.</p>
<p>◦ スライドサイズを事前に大きく設定しておくと便利です</p>
<p>書き方は自由ですが, <a href="https://www.google.com/search?newwindow=1&amp;client=safari&amp;sca_esv=635483f0705dd420&amp;sca_upv=1&amp;q=python+%E3%83%81%E3%83%BC%E3%83%88%E3%82%B7%E3%83%BC%E3%83%88&amp;uds=AMwkrPtd7EXxieMQKehnHvZf8S6pNpVcJzQvmfSMfustdt5GVU4paqDezVS1KwRLLfnWdTPfRKqI2vio1swnpAMe65pQfFGqsLrhLm9FBruViqbu8gs83egRP5pID9cAUWbOoFAII8Bi4Sa9pC2nZB8uNY_Im_IVhSc-ISQJazoPJyS7Y5hq8j_wtxEDwusT0kav7Mhx_On2phc8rZKZ0rWb3f5AykS1iJlyMqAYBs5Ke8QgUSIasP6AkeP9P6DIKWQaXCglNYTRDcA_cLO0qv_MU45G2ng9BfipwmjcaL4l2EsY-TdRRazsTUowT__BAUHIv2lsEG32&amp;udm=2&amp;prmd=ivsnmbtz&amp;sa=X&amp;ved=2ahUKEwiA48qB-bOFAxU3aPUHHYJmBQsQtKgLegQICRAB&amp;biw=1147&amp;bih=1269&amp;dpr=1">検索して</a>有名なチートシートを参考にしてください.</p>
<p>このチートシートは後で紹介してもらいます.</p>
<ul>
<li><u>演習3 <code>print()</code>の利用</u></li>
</ul>
<p>今回作成した<code>hello.py</code>における
<code>print()</code> という関数は()内の文字(<code>""</code>で囲われている部分)を標準出力する関数です.
<code>print()</code>の括弧内の <code>Hello World!</code> 部分を好きな文字に書き換えて実行してみましょう.</p>
</div>
<div class="warn">
<p><strong>演習について</strong></p>
<p>この資料では,所々に演習が指定されています.
演習は自分で行い, どのようにやったのかを講義中に発表,あるいは宿題として提出してもらいます.</p>
<p>家で演習を進めた場合には,講義中にそれが再現できるように,</p>
<ul>
<li>どのようにやったのか</li>
<li>なぜやったのか</li>
</ul>
<p>などを人に説明できるように<strong>必ず作成したメモ,資料</strong>などを残しておきましょう.</p>
</div>
</details>
<h1 data-number="3" id="pythonことはじめ"><span class="header-section-number">3</span> Pythonことはじめ</h1>
<details>
<summary>
開く
</summary>
<p>第2回では,Pythonの基礎の基礎を学習します.
本講義はプログラミング自体の学習を対象としているわけではないので,
講義内で必要な技能を紹介するのみに留めます.</p>
<p>基本的には,公式の<a href="https://docs.python.org/ja/3/tutorial/index.html">Pythonチュートリアル</a>の内容で必要十分ですので,そちらにそって学習を進めます.
より詳しい内容を勉強したい場合には,プログラミングの講義を履修するか,
<a href="http://cucieee.stars.ne.jp/index.html">千葉商科大学IEEESB</a>
などに参加するのが良いかと思います.</p>
<p>今回は取り敢えず,以下の作業を自分で行いながら,Pythonの体験をしてみましょう.</p>
<h2 data-number="3.1" id="replを使ってみよう"><span class="header-section-number">3.1</span> REPLを使ってみよう</h2>
<p>プログラムの対話環境全般をREPL (Read Eval Print Loop)と呼びます. 長いプログラム(スクリプト)を書かなくても対話的にプログラムを実行することができます.</p>
<p>Pythonには複数のREPLがあり,iPython, jupyternotebook, Google Colaboratoryなどがあります.ここではとりあえず,iPythonを利用します. 他のものについても,後ほど出てきます.</p>
<p>CLI(PowerShellやTerminal)を開いて,<code>python</code>(Mac の人はPython3)とだけ打ってEnter Keyを入力するとPythonのREPLが立ち上がります.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">~/Desktop</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Python</span> 3.10.11 <span class="er">(</span><span class="ex">v3.10.11:7d4cc5aa85,</span> Apr  4 2023, 19:05:19<span class="kw">)</span> <span class="ex">[Clang</span> 13.0.0 <span class="er">(</span><span class="ex">clang-1300.0.29.30</span><span class="kw">)</span><span class="ex">]</span> on darwin</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Type</span> <span class="st">&quot;help&quot;</span>, <span class="st">&quot;copyright&quot;</span>, <span class="st">&quot;credits&quot;</span> or <span class="st">&quot;license&quot;</span> for more information.</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span></span></code></pre></div>
<p>プログラムを書いてEnter Keyを押すとその行のプログラムが実行されます.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span></span></code></pre></div>
<p>終了するには,<code>exit()</code>と入力します.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">~/Desktop</span> 1m 7s</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Python</span> 3.10.11 <span class="er">(</span><span class="ex">v3.10.11:7d4cc5aa85,</span> Apr  4 2023, 19:05:19<span class="kw">)</span> <span class="ex">[Clang</span> 13.0.0 <span class="er">(</span><span class="ex">clang-1300.0.29.30</span><span class="kw">)</span><span class="ex">]</span> on darwin</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Type</span> <span class="st">&quot;help&quot;</span>, <span class="st">&quot;copyright&quot;</span>, <span class="st">&quot;credits&quot;</span> or <span class="st">&quot;license&quot;</span> for more information.</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> 1 <span class="ex">+</span> 1</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> exit<span class="kw">()</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="ex">~/Desktop</span> 1m 7s</span></code></pre></div>
<h2 data-number="3.2" id="コメントアウト"><span class="header-section-number">3.2</span> コメントアウト</h2>
<p>REPL上でもスクリプトでも,#を先頭につけると,その行はコメントとして扱われます.</p>
<p>ただのコメントであり,プログラムとしては何も実行されません.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># これはコメント何も起きない</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span></span></code></pre></div>
<h2 data-number="3.3" id="データ型"><span class="header-section-number">3.3</span> データ型</h2>
<p>第1回の検査に関する説明で軽く触れましたが, プログラミングで扱うデータはコンピュータのメモリ上に数値の羅列として存在します. それらの数値に人間が解釈可能な意味を与えたものをデータ型といいます.</p>
<p>Pythonで最初から準備されているデータ型(<strong>組み込み型</strong>)には以下のようなものがあります.
詳細はこのあと順番に見ていきますので, こんなものがあるということだけ,頭に入れておきましょう.</p>
<div class="note">
<p>Pythonのデータ型(一部)</p>
<ul>
<li><p>数値型:数値を表す</p>
<ul>
<li>整数(<code>int</code>)</li>
<li>浮動小数点数(<code>float</code>)</li>
<li>複素数(<code>complex</code>)</li>
</ul></li>
<li><p>文字列型(<code>str</code>):文字を表す</p></li>
<li><p>リスト(<code>list</code>):いくつかのデータをまとめたもの</p></li>
<li><p>タプル(<code>tuple</code>):データの組み合わせ</p></li>
<li><p>辞書型(<code>dict</code>):<code>key</code>と<code>value</code>からなる辞書を表す</p></li>
<li><p>真偽値(<code>bool</code>):正しいか正しくないかなどを表す</p></li>
</ul>
</div>
<h3 data-number="3.3.1" id="数値型pythonを電卓として使う"><span class="header-section-number">3.3.1</span> 数値型(Pythonを電卓として使う)</h3>
<p>REPLの動きに慣れるために,電卓で行うような簡単な計算をREPL上で行いましょう.
電卓で行う計算なので,ここで扱うデータ型は数値型になります.
Pythonは,における数値型には整数を表す<code>int</code>,小数を表す<code>float</code>,複素数を表す<code>complex</code>があります. 本資料では,その内<code>int</code>と<code>float</code>について扱います.</p>
<p>基本的には<code>1</code>や<code>100</code>のような整数を書けば<code>int</code>型として認識され,<code>1.0</code>や<code>100.3</code>のように小数点をつけると<code>float</code>型として認識されます.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">1</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="fl">1.0</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fl">1.0</span></span></code></pre></div>
<p>Pythonでは<code>type()</code>の丸括弧の中にデータを記述することで特定のデータのデータ型を確認することができます.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">type</span>(<span class="dv">1</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span><span class="kw">class</span> <span class="st">&#39;int&#39;</span><span class="op">&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">type</span>(<span class="fl">1.0</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span><span class="kw">class</span> <span class="st">&#39;float&#39;</span><span class="op">&gt;</span></span></code></pre></div>
<p>整数や後述の文字など変換可能なデータ型から,<code>int</code>型へ変換するには<code>int()</code>の中に,そのデータを書きます. <code>float</code>型に変換するには,<code>float()</code>を使います.<code>int</code>から<code>float</code>への変換では,小数点以下が切り捨てられます.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">int</span>(<span class="fl">4.9</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">float</span>(<span class="dv">2</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fl">2.0</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">float</span>(<span class="st">&quot;2&quot;</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="fl">2.0</span></span></code></pre></div>
<p>Pythonでは複数の数値型が混ざった計算に対応しています. 基本的に,特定の計算で複数の数値型が混じっている場合には, <code>int</code>型は<code>float</code>型に,<code>float</code>型は<code>complex</code>型に自動で拡張されるので本講義の範囲ではそれほど意識する必要はありません.</p>
<p>簡単な計算に用いる記号は以下のとおりです.</p>
<table>
<thead>
<tr class="header">
<th>計算</th>
<th>記号</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>足し算</td>
<td><code>+</code></td>
</tr>
<tr class="even">
<td>引き算</td>
<td><code>-</code></td>
</tr>
<tr class="odd">
<td>掛け算</td>
<td><code>*</code></td>
</tr>
<tr class="even">
<td>割り算</td>
<td><code>/</code></td>
</tr>
<tr class="odd">
<td>整数除算</td>
<td><code>//</code></td>
</tr>
<tr class="even">
<td>剰余(余り)</td>
<td><code>%</code></td>
</tr>
<tr class="odd">
<td>累乗</td>
<td><code>**</code></td>
</tr>
<tr class="even">
<td>絶対値</td>
<td><code>abs()</code></td>
</tr>
<tr class="odd">
<td>整数変換</td>
<td><code>int()</code></td>
</tr>
<tr class="even">
<td>小数変換</td>
<td><code>float()</code></td>
</tr>
</tbody>
</table>
<p>実際の計算は以下のようになるはずです.</p>
<p>計算は普通の電卓と同じような感覚で使えます.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># 足し算</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># 引き算</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">10</span> <span class="op">-</span> <span class="dv">5</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># 掛け算</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">2</span> <span class="op">*</span> <span class="dv">3</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># 割り算</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">100</span> <span class="op">/</span> <span class="dv">5</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="fl">20.0</span></span></code></pre></div>
<p>計算には順序があり丸括弧 <code>()</code>で囲うことで計算する順番を変えることができます.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> (<span class="dv">50</span> <span class="op">-</span> <span class="dv">5</span> <span class="op">*</span> <span class="dv">6</span>) <span class="op">/</span> <span class="dv">4</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fl">5.0</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">50</span> <span class="op">-</span> <span class="dv">5</span> <span class="op">*</span> <span class="dv">6</span> <span class="op">/</span> <span class="dv">4</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fl">42.5</span></span></code></pre></div>
<p>マイナスの数は数値の前に<code>-</code>をつけます</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">10</span> <span class="op">+</span> <span class="op">-</span><span class="dv">5</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span></span></code></pre></div>
<p>割り算の商と余りは<code>//</code>や,<code>%</code>で計算できます.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># 整数除算(余りを表示しない)</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">6</span> <span class="op">//</span> <span class="dv">4</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="fl">1.0</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># 剰余(余り)</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">17</span> <span class="op">%</span> <span class="dv">3</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">5</span> <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">2</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="dv">17</span></span></code></pre></div>
<p>同じ数字をX回掛けたものを累乗といい,<code>**</code>といいます. <code>2 ** 3 = 2 * 2 * 2</code></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># 累乗</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">2</span> <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">2</span> <span class="op">**</span> <span class="dv">3</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span></span></code></pre></div>
<p><code>abs()</code> の中に数値を入れることで絶対値が計算できます</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">abs</span>(<span class="dv">4</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">abs</span>(<span class="op">-</span><span class="dv">4</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span></span></code></pre></div>
<div class="note">
<p><strong>演習</strong></p>
<p>以下の計算をREPLを使って自分でしてみましょう.
Pythonの計算になれることが目的ですので,どのように計算したかを説明できるようにしましょう.</p>
<ul>
<li><p>飴が40個あります.7人で同じ数ずつ分けると1人分は何個で何個あまりますか?</p></li>
<li><p>底辺5cm,高さ4cmの三角形の面積はいくつですか?</p></li>
<li><p>2の8乗はいくつですか?</p></li>
<li><p>累乗と掛け算の計算順序を丸括弧を使った計算で確かめてください.</p></li>
</ul>
</div>
<h2 data-number="3.4" id="変数と代入"><span class="header-section-number">3.4</span> 変数と代入</h2>
<p>値に名前をつけることを<code>代入</code>といい,名前のついた値を<code>変数</code>といいます. <code>=</code> の左側に付けたい名前,右側に値を書きます.</p>
<p>プログラムでは,データはコンピュータの記憶領域(メモリ)に格納されています. メモリは,1バイト(8bit, 1bit は0/1の値)ごとにアドレスという連番がついています.</p>
<figure>
<img src="/images/memory-null.png" alt="memory null" />
<figcaption aria-hidden="true">memory null</figcaption>
</figure>
<div class="sourceCode" id="cb33"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> x <span class="op">=</span> <span class="dv">10</span></span></code></pre></div>
<p>変数を宣言するということは,このアドレスにデータを割り当てることを意味します.
<code>x = 10</code>という変数が4バイト利用するとしたら以下のようにアドレス 201 から204 に 10という数字(int)を割り当てるイメージです.</p>
<figure>
<img src="/images/memory-10.png" alt="memory 10" />
<figcaption aria-hidden="true">memory 10</figcaption>
</figure>
<p><code>x</code>のアドレスは<code>id(x)</code>で確認できます.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">id</span>(x)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="dv">4438639120</span></span></code></pre></div>
<p><code>y = x</code> と変数に別の名前を宣言する場合は,同じ場所が参照されます.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> y <span class="op">=</span> x</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">id</span>(x)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="dv">4438639120</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">id</span>(y)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="dv">4438639120</span></span></code></pre></div>
<figure>
<img src="/images/memory-10y.png" alt="memory 10" />
<figcaption aria-hidden="true">memory 10</figcaption>
</figure>
<p><code>x=15</code>と再度代入する(再代入)と,新しくメモリが確保されます.
その際に,<code>x</code>をコピーしていた<code>y</code>の値も変わることに注意しましょう.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> x <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">id</span>(x)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="dv">4438639280</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">id</span>(y)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="dv">4438639280</span></span></code></pre></div>
<figure>
<img src="/images/memory-15.png" alt="memory 15" />
<figcaption aria-hidden="true">memory 15</figcaption>
</figure>
<p>数値の場合には<code>y</code>に再代入しても,<code>x</code>の値は変わりません.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> x <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> y <span class="op">=</span> x</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">id</span>(x)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="dv">4438639120</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">id</span>(y)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="dv">4438639120</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> y <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> y</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="dv">15</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> x</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">id</span>(x)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="dv">4438639120</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">id</span>(y)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="dv">4438639280</span></span></code></pre></div>
<p>この挙動は,後に出てくる配列では,異なるので注意が必要です.</p>
<div class="note">
<p>変数に名前をつける際には,以下の点に注意しましょう.</p>
<ul>
<li><p>小文字で始まる英数字を使う</p></li>
<li><p>複数の単語を使うときは<code>_</code>(アンダーバー)でつなげる</p></li>
<li><p>英語で名前をつける</p>
<ul>
<li><code>nagasa</code> ではなく <code>length</code></li>
<li><code>namae</code> ではなく <code>name</code></li>
</ul></li>
<li><p>長くなっても良いので他の人が見たときに意味がわかる名前をつける</p>
<ul>
<li>三角形の高さを表したいとして
<ul>
<li><code>x</code>や<code>h</code>などの一文字よりも</li>
<li><code>height</code>のほうが良い</li>
<li>他にも高さを表す変数が登場するなら
<code>triangle_height</code>のほうがより分かりやすい</li>
</ul></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb38"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># 長方形の面積を求める</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> width <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> height <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> area <span class="op">=</span> width <span class="op">*</span> height</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> area</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="dv">900</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co">#定義されていないものはエラーがでます</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> space</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>Traceback (most recent call last):</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a> File <span class="st">&quot;&lt;stdin&gt;&quot;</span>, line <span class="dv">1</span>, <span class="kw">in</span> <span class="op">&lt;</span>module<span class="op">&gt;</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="pp">NameError</span>: name <span class="st">&#39;space&#39;</span> <span class="kw">is</span> <span class="kw">not</span> defined</span></code></pre></div>
</div>
<div class="note">
<p><strong>演習</strong></p>
<ul>
<li>変数を利用して以下の猫型ロボットのBMIを計算してください
<ul>
<li>BMI = 体重(kg)÷身長(m)の2乗</li>
<li>猫型ロボットの身長 129.3cm</li>
<li>猫型ロボットの体重 129.3kg</li>
</ul></li>
</ul>
</div>
<h3 data-number="3.4.1" id="代入演算子"><span class="header-section-number">3.4.1</span> 代入演算子</h3>
<p>代入は<code>=</code>でつなげる以外にもいくつかのパターンがあります.
まずは,普通に変数に数値を代入してみます.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> x</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> x <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> x</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span></span></code></pre></div>
<p>このように具体的な値を<code>=</code>の右側に記入するのは直感的に分かりやすいのですが,pythonのプログラムを見ていると,左右に同じ変数名が登場する場合があります.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> x <span class="op">=</span> x <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> x</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span></span></code></pre></div>
<p>これは,<strong>右側に登場する</strong><code>x</code>は過去の<code>x</code>を表しており,<strong>左側に登場する</strong><code>x</code>は,過去の<code>x</code>を利用して作られた新しい<code>x</code>であると解釈しましょう.</p>
<p>上の例では,<code>x=1</code>という過去の変数を使って, <code>x(=1) + 1</code>という新しい<code>x</code>を作っています.
これは<strong>自己代入</strong>と呼ばれ,数学や関数型言語における<strong>再帰</strong>とは異なり,手続き型言語独特の記法なので注意しましょう.</p>
<p>足し算<code>+</code>を使った自己代入は省略して, <code>x += 1</code>のように書けます. これは <code>x = x + 1</code>の省略形で<strong>複合代入演算子</strong>といいます.</p>
<p>同様に,引き算<code>-=</code>,掛け算 <code>*=</code>, 割り算 <code>/=</code>などの代入演算子も存在します.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> x <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> x <span class="op">-=</span> <span class="dv">5</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> x</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> x <span class="op">*=</span> <span class="dv">5</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> x</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="dv">25</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> x <span class="op">/=</span> <span class="dv">5</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> x</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span></span></code></pre></div>
<h2 data-number="3.5" id="文字列型"><span class="header-section-number">3.5</span> 文字列型</h2>
<p>ここまでは,数値のみを扱ってきましたが,Pythonには数値以外にもいくつものデータ型が存在します.
次に, 文字を表す<code>文字列型(str)</code>の利用法について見ていきましょう.</p>
<p>文字列型は,文字を<code>""</code>(ダブルクオーテーション),あるいは<code>''</code>(シングルクォーテーション)で囲みます.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="st">&quot;イヌ&quot;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;イヌ&#39;</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="st">&#39;ネコ&#39;</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;ネコ&#39;</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">type</span>(<span class="st">&#39;ネコ&#39;</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span><span class="kw">class</span> <span class="st">&#39;str&#39;</span><span class="op">&gt;</span></span></code></pre></div>
<p>三連引用符<code>"""</code>で囲むことで複数行書くことができます.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="st">&quot;&quot;&quot; あ</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="st">... い</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="st">... う&quot;&quot;&quot;</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;あ</span><span class="ch">\n</span><span class="co">い</span><span class="ch">\n</span><span class="co">う&#39;</span></span></code></pre></div>
<p><code>\n</code>は改行を表しています.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">print</span>(<span class="st">&#39;あ</span><span class="ch">\n</span><span class="st">い</span><span class="ch">\n</span><span class="st">う&#39;</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>あ</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>い</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>う</span></code></pre></div>
<h3 data-number="3.5.1" id="文字列の演算"><span class="header-section-number">3.5.1</span> 文字列の演算</h3>
<p>文字列は<code>+</code>で連結,<code>*</code>で反復させることができます.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> name <span class="op">=</span> <span class="st">&#39;太郎&#39;</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="st">&#39;私は&#39;</span> <span class="op">+</span> name  <span class="op">+</span> <span class="st">&#39;です!&#39;</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;私は太郎です!&#39;</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> name <span class="op">*</span> <span class="dv">3</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;太郎太郎太郎&#39;</span></span></code></pre></div>
<p>変数を文字列の中で使いたいときには,上の例のように<code>+</code>で連結することもできますが,変数が文字列型ではないときには,<code>str()</code>を利用して文字列型に変換してから,結合する必要があります.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> cat_num <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">type</span>(cat_num)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span><span class="kw">class</span> <span class="st">&#39;int&#39;</span><span class="op">&gt;</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co">#そのまま文字列と結合するとエラーが出る</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="st">&#39;私はネコを&#39;</span> <span class="op">+</span> cat_num <span class="op">+</span> <span class="st">&#39;匹飼っています.&#39;</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>Traceback (most recent call last):</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  File <span class="st">&quot;&lt;stdin&gt;&quot;</span>, line <span class="dv">1</span>, <span class="kw">in</span> <span class="op">&lt;</span>module<span class="op">&gt;</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="pp">TypeError</span>: can only concatenate <span class="bu">str</span> (<span class="kw">not</span> <span class="st">&quot;int&quot;</span>) to <span class="bu">str</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co">#str()を利用して文字列に変換する</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="st">&#39;私はネコを&#39;</span> <span class="op">+</span> <span class="bu">str</span>(cat_num) <span class="op">+</span> <span class="st">&#39;匹飼っています.&#39;</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;私はネコを10匹飼っています.&#39;</span></span></code></pre></div>
<p>また,変数の値を文字列の中で利用する場合には<code>str()</code>や<code>+</code>を利用して結合する以外にも<code>f'文字列'</code>という記法を利用することができます.文字列の前に<code>f</code>と書くと,文字列内の<code>{変数名}</code>の部分が変数の値に変更されます.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="ss">f&#39;私はネコを</span><span class="sc">{</span>cat_num<span class="sc">}</span><span class="ss">匹飼っています.&#39;</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;私はネコを10匹飼っています.&#39;</span></span></code></pre></div>
<p><code>{変数名}</code>の部分には式を入れることも可能です.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="ss">f&#39;私はネコを</span><span class="sc">{</span>cat_num<span class="op">*</span><span class="dv">10</span><span class="sc">}</span><span class="ss">匹飼っています.&#39;</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;私はネコを100匹飼っています.&#39;</span></span></code></pre></div>
<p>文字列が代入された変数の後ろに<code>[]</code>をつけて,番号を<code>[]</code>の中に入れると,指定した番号番目の文字が取得できます. このような<code>[]</code>で指定する数字を<code>index</code>といいます.</p>
<p><code>Python</code>という文字に対して,indexは以下のように振られています.
<code>-</code>をつけて後ろから数えることもできます.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">文字列</th>
<th style="text-align: center;">P</th>
<th style="text-align: center;">y</th>
<th style="text-align: center;">t</th>
<th style="text-align: center;">h</th>
<th style="text-align: center;">o</th>
<th style="text-align: center;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">前から</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="even">
<td style="text-align: center;">後ろから</td>
<td style="text-align: center;">-6</td>
<td style="text-align: center;">-5</td>
<td style="text-align: center;">-4</td>
<td style="text-align: center;">-3</td>
<td style="text-align: center;">-2</td>
<td style="text-align: center;">-1</td>
</tr>
</tbody>
</table>
<p>Pythonの文字列は,最初の文字を<code>0</code>番目と数えるので注意しましょう.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> word <span class="op">=</span> <span class="st">&#39;Python&#39;</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> word[<span class="dv">0</span>]</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;P&#39;</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> word[<span class="dv">5</span>]</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;n&#39;</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;</span> word[<span class="op">-</span><span class="dv">6</span>]</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;p&#39;</span></span></code></pre></div>
<p>インデックスの<code>[]</code>の中で,<code>[Start:End]</code>のようにはじめと終わりのインデックスを指定することで,文字列の1文字ではなく,部分的な文字列を取得することもできます. これを<strong>スライス</strong>といいます.</p>
<p>終わりは,一つ手前までになるので注意しましょう.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> word[<span class="dv">0</span>:<span class="dv">2</span>]</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;Py&#39;</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> word[<span class="dv">2</span>:<span class="dv">5</span>]</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;tho&#39;</span></span></code></pre></div>
<p>はじめか終わりのインデックスを省略すると,<strong>以降全て</strong>という意味になります.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> word[:<span class="dv">4</span>] <span class="co">#0から4まで</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;Pyth&#39;</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> word[<span class="dv">2</span>:] <span class="co">#2から最後まで</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;thon&#39;</span></span></code></pre></div>
<div class="note">
<p><strong>演習</strong></p>
<ul>
<li>演習1</li>
</ul>
<p><code>'abcdefg'</code> から <code>'cde'</code>をスライスで抜き出してください.</p>
<ul>
<li>演習2</li>
</ul>
<p><code>x = 'abcdefg'</code>と定義して, xに操作を加えて<code>'abfg'</code>を作ってください.</p>
<ul>
<li>演習3</li>
</ul>
<p><code>x = 'abcdefg'</code>と定義して, xに操作を加えて<code>'bbbeee'</code>を作ってください.</p>
</div>
<h2 data-number="3.6" id="リスト"><span class="header-section-number">3.6</span> リスト</h2>
<p>複数の値をまとめるデータ型の一種に<strong>リスト型</strong>があります. コンマで区切って角括弧の中に複数の値を書くことで,ひとまとまりのデータを作れます.
リストの中身一つ一つを<strong>要素</strong>といいます.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> squares <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">9</span>,<span class="dv">16</span>,<span class="dv">25</span>]</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> squares</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">9</span>,<span class="dv">16</span>,<span class="dv">25</span>]</span></code></pre></div>
<p>リストは文字列と同じ様に,インデックスやスライスで要素を取得できます.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> squares[<span class="dv">0</span>]</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> squares[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="dv">25</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> squares[<span class="op">-</span><span class="dv">3</span>:]</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">9</span>,<span class="dv">16</span>,<span class="dv">25</span>]</span></code></pre></div>
<h3 data-number="3.6.1" id="リストの演算"><span class="header-section-number">3.6.1</span> リストの演算</h3>
<p>リストも<code>+</code>で連結,<code>*</code>で反復させることができます.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>] <span class="op">+</span> [<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>]</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>]</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> [<span class="dv">1</span>] <span class="op">*</span> <span class="dv">3</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> [<span class="dv">1</span>,<span class="dv">2</span>] <span class="op">*</span> <span class="dv">3</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>]</span></code></pre></div>
<p>リストはインデックスやスライスで指定した要素に値を再代入して変更することができます.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> animals <span class="op">=</span> [<span class="st">&#39;cat&#39;</span>,<span class="st">&#39;dog&#39;</span>,<span class="st">&#39;bird&#39;</span>]</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> animals[<span class="dv">1</span>] <span class="op">=</span> <span class="st">&#39;mouse&#39;</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> animals</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>[<span class="st">&#39;cat&#39;</span>,<span class="st">&#39;mouse&#39;</span>,<span class="st">&#39;bird&#39;</span>]</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> animals[<span class="dv">1</span>:] <span class="op">=</span> [<span class="st">&#39;fish&#39;</span>,<span class="st">&#39;pig&#39;</span>]</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> animals</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>[<span class="st">&#39;cat&#39;</span>,<span class="st">&#39;fish&#39;</span>,<span class="st">&#39;pig&#39;</span>]</span></code></pre></div>
<div class="warn">
<p>リストは,数値などとは<strong>変数に別の名前をつけたときの挙動が異なる</strong>ので注意が必要です.</p>
<p>数値や文字列は,別の名前をつけた変数に再代入した場合もとの変数は,変更されません.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> cat <span class="op">=</span> <span class="st">&#39;cat&#39;</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> cute_cat <span class="op">=</span> cat</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> cute_cat <span class="op">=</span> <span class="st">&#39;cute_cat&#39;</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> cat</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;cat&#39;</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> cute_cat</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;cute_cat&#39;</span></span></code></pre></div>
<p><code>cute_cat</code>を変更しても<code>cat</code>は変わりません. 代入の説明箇所で見たように,数値などの変数の場合は,<code>cute_cat</code>には<code>cat</code>の値が渡されており,値が同じ場合には同じアドレスを参照するが,値が変更された場合には,
新しいメモリが確保されます.</p>
<p>しかし,リストは別名の変数を変更すると元の変数の値も変更されます.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> animals <span class="op">=</span> [<span class="st">&#39;cat&#39;</span>,<span class="st">&#39;fish&#39;</span>,<span class="st">&#39;pig&#39;</span>]</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> species <span class="op">=</span> animals</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> species[<span class="dv">0</span>] <span class="op">=</span> <span class="st">&#39;horse&#39;</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> animals</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>[<span class="st">&#39;horse&#39;</span>, <span class="st">&#39;fish&#39;</span>, <span class="st">&#39;pig&#39;</span>]</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> species</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>[<span class="st">&#39;horse&#39;</span>, <span class="st">&#39;fish&#39;</span>, <span class="st">&#39;pig&#39;</span>]</span></code></pre></div>
<p><code>animal</code>の別名<code>species</code>を変更すると<code>animal</code>も変更されています. これは,配列などは新しい名称の変数に,値ではなくアドレスを渡していることによります.どちらの変数もずっと同じアドレスを参照しつづけるため,片方が変化すると同じアドレスを参照しているもう片方の値も変わります.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">id</span>(animals)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="dv">4441753024</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">id</span>(species)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="dv">4441753024</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> species[<span class="dv">0</span>] <span class="op">=</span> <span class="st">&#39;cat&#39;</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">id</span>(species)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4441753024</span></span></code></pre></div>
<p>しかし,インデックスやスライスによる要素の変更ではなく,全体を再代入した場合には新しいアドレスが割り当てられます.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> species <span class="op">=</span> [<span class="st">&#39;a&#39;</span>,<span class="st">&#39;b&#39;</span>,<span class="st">&#39;c&#39;</span>]</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">id</span>(species)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="dv">4441834752</span></span></code></pre></div>
<p>同じ値を持つが異なる場所を参照するリストを作りたい場合には,<code>copy()</code>を利用します.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> animals <span class="op">=</span> [<span class="st">&#39;cat&#39;</span>,<span class="st">&#39;fish&#39;</span>,<span class="st">&#39;pig&#39;</span>]</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> species <span class="op">=</span> animals.copy()</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">id</span>(animals)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="dv">4441764160</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">id</span>(species)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="dv">4441798208</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> species[<span class="dv">0</span>] <span class="op">=</span> <span class="st">&#39;dog&#39;</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> animals</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>[<span class="st">&#39;cat&#39;</span>, <span class="st">&#39;fish&#39;</span>, <span class="st">&#39;pig&#39;</span>]</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> species</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>[<span class="st">&#39;dog&#39;</span>, <span class="st">&#39;fish&#39;</span>, <span class="st">&#39;pig&#39;</span>]</span></code></pre></div>
<p>このような挙動は今後出てくる<code>pandas</code>などの配列でも同様なので,注意が必要です.</p>
</div>
<p><code>append()</code>というメソッドを使って,リストの末尾に要素を追加することができます.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> animals</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>[<span class="st">&#39;cat&#39;</span>,<span class="st">&#39;fish&#39;</span>,<span class="st">&#39;pig&#39;</span>]</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> animals.append(<span class="st">&#39;dog&#39;</span>)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> animals</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>[<span class="st">&#39;cat&#39;</span>,<span class="st">&#39;fish&#39;</span>,<span class="st">&#39;pig&#39;</span>,<span class="st">&#39;dog&#39;</span>]</span></code></pre></div>
<p>リストの長さ(要素数)を知りたい場合には,<code>len()</code>関数を利用します.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> animals</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>[<span class="st">&#39;cat&#39;</span>,<span class="st">&#39;fish&#39;</span>,<span class="st">&#39;pig&#39;</span>,<span class="st">&#39;dog&#39;</span>]</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">len</span>(animals)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span></span></code></pre></div>
<div class="warn">
<p><code>メソッド</code>,<code>関数</code>という言葉が説明無しに突然でてきました.
これらの違いについて理解するには段階が必要なため,後に説明します.
ここでは,変数などの後ろに<code>変数.f()</code>の形で<code>.</code>を利用してつけるものを<code>メソッド</code>,単独で<code>f()</code>のように利用するものを<code>関数</code>ということだけ覚えておきましょう.
なお,いずれも<code>()</code>の中に値や変数を書いたり書かなかったりしますが,その意味についても後ほど扱います.</p>
</div>
<p>リストはリストも要素にすることができます. このようなリストを<strong>多重リスト</strong>と呼びます.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> x <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> y <span class="op">=</span> [<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>]</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> z <span class="op">=</span> [x,y]</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> z</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>[[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>],[<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>]]</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> z[<span class="dv">1</span>]</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>]</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> z[<span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span></span></code></pre></div>
<div class="note">
<p><strong>演習</strong></p>
<p><code>xs = [[1,2,3],[4,5,6],[7,8,9]]</code> というリストを作り,以下の操作を行ってください.</p>
<ul>
<li><p><code>xs</code>の長さを求める</p></li>
<li><p>スライスを使って以下を抽出する</p>
<ul>
<li><code>[[4,5,6],[7,8,9]]</code></li>
<li><code>[[1,2,3]]</code></li>
<li><code>[[7,8,9]]</code></li>
<li><code>[8,9]</code></li>
</ul></li>
<li><p><code>[4,5,6]</code>を<code>[-4,-5,-6]</code>に更新する</p></li>
<li><p><code>1</code> を <code>-1</code>に,<code>9</code>を<code>-9</code>にする</p></li>
<li><p><code>[7,8,-9]</code>のあとに,<code>[10,11,12]</code>を追加する</p></li>
</ul>
</div>
<h2 data-number="3.7" id="タプル"><span class="header-section-number">3.7</span> タプル</h2>
<p>Pythonにはリスト以外にも複数のデータ型の組み合わせを表すデータ型が存在します. タプルは,データの組を表すデータ型であり,<code>()</code>の中に<code>,</code>で区切ってデータを入れることでリストのようにデータを格納することができます.
タプルも複数のデータをまとめることができます.</p>
<p>しかし, リストのように扱うことは推奨されません.
(後に扱う関数などで返り値を複数返したいときなど)基本的に2,3個のデータの組を扱いたい場合に利用して,3個以上のデータを扱い場合にはリストなどを使うようにしましょう.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> name_and_age <span class="op">=</span> (<span class="st">&#39;Taro&#39;</span>,<span class="dv">10</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> name_and_age</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>(<span class="st">&#39;Taro&#39;</span>, <span class="dv">10</span>)</span></code></pre></div>
<p>タプルの値の取り出しには,同じ形のタプルに変数を格納することで値を取り出す<code>パターンマッチ</code>が良く利用されます.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> (name,age) <span class="op">=</span> name_and_age</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> name</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;Taro&#39;</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> age</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span></span></code></pre></div>
<p>インデックスによる値の取得も可能です.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> name_and_age[<span class="dv">0</span>]</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;Taro&#39;</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> name_and_age[<span class="dv">1</span>]</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span></span></code></pre></div>
<p>ただし,インデックスを利用した要素の変更はできません.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> name_and_age[<span class="dv">0</span>] <span class="op">=</span> <span class="st">&#39;Hanako&#39;</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>Traceback (most recent call last):</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  File <span class="st">&quot;&lt;stdin&gt;&quot;</span>, line <span class="dv">1</span>, <span class="kw">in</span> <span class="op">&lt;</span>module<span class="op">&gt;</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="pp">TypeError</span>: <span class="st">&#39;tuple&#39;</span> <span class="bu">object</span> does <span class="kw">not</span> support item assignment</span></code></pre></div>
<h2 data-number="3.8" id="辞書型"><span class="header-section-number">3.8</span> 辞書型</h2>
<p>名前とその意味, 商品と在庫数,日本語名と英語名など,特定のデータに対応する別のデータの組み合わせを沢山扱いたい場合には,<code>辞書型</code>(dict)が利用されます. 辞書型は<code>key</code>と<code>value</code>と呼ばれるデータの組み合わせからなります.</p>
<p>辞書型のデータは,<code>{key1:value1,key2:value2,...}</code>のように,<code>key</code>と<code>value</code>の組み合わせを<code>:</code>で表して,<code>{}</code>にコンマで区切るかたちで作成します.</p>
<p>例えば, 学生と学生の出席回数の組み合わせを表すデータは以下のように作成されます.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> attendance <span class="op">=</span> {<span class="st">&#39;Taro&#39;</span>:<span class="dv">10</span>,<span class="st">&#39;Hanako&#39;</span>:<span class="dv">12</span>,<span class="st">&#39;Kenta&#39;</span>:<span class="dv">9</span>,<span class="st">&#39;Shizuka&#39;</span>:<span class="dv">10</span>}</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> attendance</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>{<span class="st">&#39;Taro&#39;</span>: <span class="dv">10</span>, <span class="st">&#39;Hanako&#39;</span>: <span class="dv">12</span>, <span class="st">&#39;Kenta&#39;</span>: <span class="dv">9</span>, <span class="st">&#39;Shizuka&#39;</span>: <span class="dv">10</span>}</span></code></pre></div>
<p><code>dict()</code>に<code>key</code>と<code>value</code>のタプルのリストを渡すことで生成する事もできます.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> attendance <span class="op">=</span> <span class="bu">dict</span>([(<span class="st">&#39;Taro&#39;</span>,<span class="dv">10</span>),(<span class="st">&#39;Hanako&#39;</span>,<span class="dv">12</span>),(<span class="st">&#39;Kenta&#39;</span>,<span class="dv">9</span>)])</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> attendance</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>{<span class="st">&#39;Taro&#39;</span>: <span class="dv">10</span>, <span class="st">&#39;Hanako&#39;</span>: <span class="dv">12</span>, <span class="st">&#39;Kenta&#39;</span>: <span class="dv">9</span>}</span></code></pre></div>
<p>特定の<code>key</code>でそれに対応する<code>value</code>を呼び出すには,<code>key</code>をインデックスとして<code>[]</code>を利用します.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> attendance[<span class="st">&#39;Taro&#39;</span>]</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> attendance[<span class="st">&#39;Shizuka&#39;</span>]</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span></span></code></pre></div>
<p>新しい<code>key:value</code>を加える場合にも,<code>value</code>を変更する場合にも,インデックスによる代入が利用できます.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> attendance[<span class="st">&#39;Taro&#39;</span>] <span class="op">=</span> <span class="dv">11</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> attendance[<span class="st">&#39;Taro&#39;</span>]</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> attendance[<span class="st">&#39;Shinzi&#39;</span>] <span class="op">=</span> <span class="dv">12</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> attendance[<span class="st">&#39;Shinzi&#39;</span>]</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span></span></code></pre></div>
<p><code>key</code>を削除するには<code>pop(消したいkey)</code>メソッドを利用します.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> attendance.pop(<span class="st">&#39;Hanako&#39;</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> attendance</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>{<span class="st">&#39;Taro&#39;</span>: <span class="dv">11</span>, <span class="st">&#39;Kenta&#39;</span>: <span class="dv">9</span>, <span class="st">&#39;Shizuka&#39;</span>: <span class="dv">10</span>, <span class="st">&#39;Shinzi&#39;</span>: <span class="dv">12</span>}</span></code></pre></div>
<p>辞書型のデータから,<code>key</code>のみ,<code>value</code>のみを抜き出すには,<code>keys()</code>,<code>values()</code>メソッドを利用します.
リストとして取得したい場合には,<code>list()</code>関数で囲みます.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> attendance.keys()</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>dict_keys([<span class="st">&#39;Taro&#39;</span>, <span class="st">&#39;Kenta&#39;</span>, <span class="st">&#39;Shizuka&#39;</span>, <span class="st">&#39;Shinzi&#39;</span>])</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> attendance.values()</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>dict_values([<span class="dv">11</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">12</span>])</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">list</span>(attendance.values())</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">11</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">12</span>]</span></code></pre></div>
<p>これらの処理はリストを利用しても可能ですが,辞書型のほうが計算が速いため辞書型を利用するようにしましょう. プログラミングにおいては用途に応じて適切なデータ型を選択することが重要です.</p>
<div class="warn">
<p>同じような処理が可能なデータ型でも,その処理を実行するのにコンピュータが必要な計算の数や,使用するメモリの量,速度などに違いがあります.</p>
<p>この資料では扱いませんが,大規模なデータを扱う場合や,大量の計算を行うプログラムを書く際には,<code>計算量</code>を考慮して<code>アルゴリズムとデータ構造</code>を適切に設計する必要があります. 興味のある方は,調べてみましょう.</p>
</div>
<div class="note">
<p><strong>演習</strong></p>
<ul>
<li><p>5種類の果物の日本語名と英語名を変換する辞書を作成し,実際に機能する様子を紹介してください.</p></li>
<li><p>上で作成した辞書にもう一つ果物を追加してください.</p></li>
</ul>
</div>
<h2 data-number="3.9" id="論理演算"><span class="header-section-number">3.9</span> 論理演算</h2>
<p>それが正しいか間違っているか判別できる文を<strong>命題</strong>といいます. 命題の結果を表すものとして真(正しい),偽(間違っている)という値を用います. 真と偽を併せて<strong>真偽値</strong>といいます.</p>
<p>例えば,<code>1は2より大きい</code>という命題は,間違っているので<strong>偽</strong>となります. <code>人間は必ず死ぬ</code>という命題は,今のところ不老不死の人間がいないので<strong>真</strong>です.</p>
<p>プログラミングではこのような命題の判断がしばしば必要となるため,それらを扱うデータ型が提供されています.</p>
<p>真偽値を表すデータ型として<code>Bool</code>があります. <code>Bool</code>は<code>True</code>(真),<code>False</code>(偽)のいずれかです.</p>
<p>Pythonには命題の判定を行う演算子として,以下のようなものが準備されています.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">記号</th>
<th style="text-align: center;">意味</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>&gt;</code></td>
<td style="text-align: center;">より大きい</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>&gt;=</code></td>
<td style="text-align: center;">以上</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>&lt;</code></td>
<td style="text-align: center;">より小さい</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>&lt;=</code></td>
<td style="text-align: center;">以下</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>==</code></td>
<td style="text-align: center;">等しい</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>!=</code></td>
<td style="text-align: center;">等しくない</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>in</code></td>
<td style="text-align: center;">含む</td>
</tr>
</tbody>
</table>
<p>数値などの大小関係を調べるときには,比較演算子 <code>&gt;</code>,<code>&gt;=</code>.<code>&lt;</code>,<code>&lt;=</code>を利用します. 演算子の左右に数値を書くと,結果に応じて真偽値が帰ってきます.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">1</span> <span class="op">&gt;</span> <span class="dv">2</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="va">False</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">1</span> <span class="op">&lt;</span> <span class="fl">1.5</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="va">True</span></span></code></pre></div>
<p>リストや文字列に特定の要素(文字列)が含まれているかは,<code>in</code>で判定できます.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="st">&#39;ab&#39;</span> <span class="kw">in</span> <span class="st">&#39;abcd&#39;</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="va">True</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">1</span> <span class="kw">in</span> [<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>]</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="va">False</span></span></code></pre></div>
<p>値が等しいか/等しくないかを判定するには,<code>==</code>と<code>!=</code>を利用します.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="dv">4</span> <span class="op">==</span> <span class="dv">4</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="va">True</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="st">&#39;cat&#39;</span> <span class="op">!=</span> <span class="st">&#39;cat&#39;</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="va">False</span></span></code></pre></div>
<p>これ以外にもPythonにはいくつかの演算が準備されていますし,自分で作ることも可能です.</p>
<p><code>True</code> や <code>False</code>などの<code>Bool</code>値は, <code>AND</code>(かつ),<code>OR</code>(または),<code>NOT</code>という演算で計算することができます(<code>XOR</code>というのもあるが省略).
PythonではAND は <code>&amp;</code>, OR は <code>|</code>, NOT は <code>not</code> という演算子が提供されています.</p>
<p>A,Bが命題だとして,<code>A &amp; B</code>は両方<code>True</code>のときに,<code>True</code>となります. <code>A | B</code>は片方どちらかが<code>True</code>のときに<code>True</code>となります.</p>
<p>例えば,</p>
<ul>
<li><p><code>1は2より大きい かつ 2は0より大きい</code> という命題は,<code>2は0より大きい</code>は正しいですが,<code>1は2より大きい</code>が間違っているので全体として,<code>False</code>です.</p></li>
<li><p><code>ネコは哺乳類である または ネコは鳥類である</code>という命題は <code>ネコは鳥類である</code>が間違っていますが全体としては<code>True</code>です.</p></li>
</ul>
<p>演算の結果は,それぞれ以下のようになります. これを真偽値表といいます. ここでは,最低限の例だけを紹介しますが,より深く理解したい人は論理学などの講義を受講しましょう.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">命題Aの値</th>
<th style="text-align: center;">Bの値</th>
<th style="text-align: center;"><code>A &amp; B</code></th>
<th style="text-align: center;"><code>A | B</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">True</td>
<td style="text-align: center;">True</td>
<td style="text-align: center;">True</td>
<td style="text-align: center;">True</td>
</tr>
<tr class="even">
<td style="text-align: center;">False</td>
<td style="text-align: center;">True</td>
<td style="text-align: center;">False</td>
<td style="text-align: center;">True</td>
</tr>
<tr class="odd">
<td style="text-align: center;">True</td>
<td style="text-align: center;">False</td>
<td style="text-align: center;">False</td>
<td style="text-align: center;">True</td>
</tr>
<tr class="even">
<td style="text-align: center;">False</td>
<td style="text-align: center;">False</td>
<td style="text-align: center;">False</td>
<td style="text-align: center;">False</td>
</tr>
</tbody>
</table>
<p>Pythonではそれぞれの命題を丸括弧で囲んで,<code>&amp;</code>,<code>|</code>演算子で論理演算を行うことができます.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> (<span class="dv">1</span> <span class="op">&gt;</span> <span class="dv">2</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="va">False</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> (<span class="dv">2</span> <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="va">True</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> (<span class="dv">1</span> <span class="op">&gt;</span> <span class="dv">2</span>) <span class="op">&amp;</span> (<span class="dv">2</span> <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="va">False</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> (<span class="dv">1</span> <span class="op">&gt;</span> <span class="dv">2</span>) <span class="op">|</span> (<span class="dv">2</span> <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="va">True</span></span></code></pre></div>
<p><code>not</code> は命題の否定を表しており <code>True</code>が<code>False</code>,<code>False</code>が<code>True</code>になります.<code>not</code>は命題の前に書きます.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> (<span class="dv">1</span> <span class="op">&gt;</span> <span class="dv">2</span>)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="va">False</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="kw">not</span> (<span class="dv">1</span> <span class="op">&gt;</span> <span class="dv">2</span>)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="va">True</span></span></code></pre></div>
<div class="note">
<p><strong>演習</strong></p>
<p>ある値が偶数かどうかは,2で割った余りが0かどうかを判定することで判定できます.
<code>x=101</code>,<code>y=202</code>として, 以下の命題の真偽をPythonで計算してください.</p>
<ul>
<li>xが偶数</li>
<li>yが偶数</li>
<li>xが偶数かつyが偶数</li>
<li>xが偶数またはyが偶数</li>
<li>x + y が奇数</li>
</ul>
</div>
<h2 data-number="3.10" id="復習スクリプトの実行"><span class="header-section-number">3.10</span> (復習)スクリプトの実行</h2>
<p>これまでは,対話環境でプログラムを実行してきましたが,対話環境は複雑な処理には適しません.
これから,1行1行プログラムを記述して対話環境で実行するのではなく,複数行のプログラムをまとめて記述して一気に実行する方式に切り替えます. 複数行のプログラムを一つのファイルにまとめたものをスクリプトファイルと呼び, 書かれているプログラムをスクリプトといいます. 初回に行った<code>Hello World</code>はスクリプトを実行していました.</p>
<div class="note">
<p><strong>Pythonのスクリプト実行の方法</strong></p>
<ul>
<li><p>テキストファイルにプログラムを書く</p></li>
<li><p>ファイルの拡張子を<code>.py</code>にして保存する</p>
<ul>
<li>講義で作成したプログラムは,あとで自分が参考にできる最高の資料です.
<ul>
<li><p>あとで何をやっているのか自分が理解できるように
プログラムにはできるだけ沢山のコメントを付けましょう</p></li>
<li><p>ファイル名は,後からみて,中身が何であるかわかるよう<code>英数字</code>で名付けましょう</p>
<ul>
<li><code>a.py</code>や<code>file.py</code>,<code>課題.py</code>などはやめましょう</li>
</ul></li>
</ul></li>
</ul></li>
<li><p>Shell上でそのファイルが保存されている場所に移動する</p></li>
<li><p><code>python ファイル名</code> コマンドで実行する</p>
<ul>
<li>※ <code>python</code> は空白の後に続くプログラムを実行するためのコマンドです.</li>
<li>※ Macの人は <code>python3</code> を利用します.</li>
</ul></li>
</ul>
</div>
<div class="note">
<p><strong>演習</strong></p>
<p>第1回で行ったことを参考に,<code>Let's start the Python programming!!</code> と表示されるプログラムを作成しましょう. ファイル名などは適切に名付けてください.
まだ,今後沢山のスクリプトを書いていきますので,適切にフォルダなどを整理しましょう.</p>
</div>
<h2 data-number="3.11" id="エラーへの対応法とよくある間違い"><span class="header-section-number">3.11</span> エラーへの対応法とよくある間違い</h2>
<p>これまで皆さんは1行のプログラムを記述して, REPL上で実行してきました. これから何行かに渡るプログラムを記述すると, うまくできない人が出てきます. ここでは,学生のつまずきやすいポイントとその対策について,事前に学習しておきましょう.</p>
<h3 data-number="3.11.1" id="エラーへの対応方法"><span class="header-section-number">3.11.1</span> エラーへの対応方法</h3>
<p>間違った手順,プログラムの記述方法でプログラムを実行すると,エラー文がTerminalに表示されます. どれだけプログラミングが得意な人でも, 完璧な作業はできません. 必ずエラーが発生します. そのような意味でも,プログラミングをするというのは,プログラムを書いて発生したエラーに対応するということでもあります.</p>
<p>エラーへの対応は, プログラミングにある程度習熟した人でも,Webなどで調べて解決する場合が多いです.PCやプログラミングができるということは,すべての場合をすべて記憶して対応できるということではなく,<strong>問題が起きたら自分で解決できる</strong>ということを意味しています.</p>
<p>したがって, まず必要なのは問題が起きたら解決策を<strong>自分で調べること</strong>です.</p>
<p>解決方法を調べるためには,検索するためのワードとして,<strong>機能や名称を知っていること</strong>が重要です.
例として, Excelのフィルター機能の存在を知っていれば, <strong>Excel フィルター 使い方</strong>などで検索することができます.しかし,Excelも,フィルターも知らなければ,調べることすらできません.</p>
<p>すべての概念や機能を最初から完全に理解する必要はありませんが,概念の存在や名称を覚えるようにしましょう. そのためにも自分の<strong>メモやチートシートを作成,整理しておくこと</strong>が重要です.</p>
<p>プログラミングの学習において, 何かが間違っている場合には, Terminalにエラー文が表示されます. Pythonはエラー文が親切なので,エラー文を読めば大抵のことは解決できるようになっています.</p>
<p>しかし,エラーが起きても<strong>エラー文を一切読まない人</strong>が一定の割合で存在します. そのような人に理由を尋ねると最も多い理由は<strong>英語で書かれていること</strong>,2番目に<strong>どこを見ればいいのか分からないこと</strong>を挙げます.</p>
<p>それほど難しい英語は使われていませんが,まず英語で書かれていても読んでみましょう. 英語が理解できなければ,機械翻訳にかけましょう.</p>
<p>pythonのエラー文は,基本的にエラー文の<strong>一番最初にスクリプトのエラーが発生している場所</strong>が書かれています.また,<strong>一番最後にどのようなエラーが起きているのか</strong>が書かれています. 複雑なプログラムになると,エラー全体を理解する必要が出てきますが,この講義で扱う程度の事例に関してはその2個所のみを読めばほとんどが解決します. ただし,検索結果は珠玉混合です, 正しい情報の取捨選択に関しては,情報入門の教科書などで復習しておきましょう.</p>
<figure>
<img src="/images/python-error-sample1.png" alt="エラー文の読み方" />
<figcaption aria-hidden="true">エラー文の読み方</figcaption>
</figure>
<p><img src="/images/translate-error.png" /></p>
<p>エラー文を読んでも意味が理解できない,あるいは対処方法が分からない場合には,エラー文の最後をそのまま検索しましょう. なお,Googleでは,<code>""</code>で囲うことで文章ごと検索(センテンス検索)できます. Pythonは日本語ユーザーも非常に多いため,<code>エラー文 Python</code>で検索すれば,大抵の問題は日本語で解決方法を読むことができます.</p>
<p>解決しない場合には,AND検索で情報を付加して,結果を絞りましょう. 検索条件に加えるべき情報の候補としては以下のようなものがあります.</p>
<div class="note">
<ul>
<li><p>OS (Windows, Mac)</p></li>
<li><p>Pythonのversion</p></li>
<li><p>利用しているライブラリ</p></li>
<li><p>やろうとしている作業</p></li>
</ul>
</div>
<p>例えば,これから行う<code>pandas</code>を利用した<code>ファイルの読み込み</code>において<code>No such file or directory</code>というエラーが出た場合には <code>pandas ファイル読み込み "No such file or directory" Windows</code>などで検索してみましょう.</p>
<p><strong>エラー文を読んで</strong>,<strong>Webで検索しても</strong>問題が解決しない場合には, 教員に聞いて下さい. 専門的な内容になるほど,日本語のページは少なくなります.また,新しい情報に関しては,日本語に翻訳されておらず公式のドキュメントなどを読む必要があります. それでも解決しない場合には, Pythonのコミュニティなどで質問をする必要があります. 最終的にはこれらを自分でできるようになる必要がありますが,最初は難しいと思います. 講義の教員は,それらを代替するためにいますので,教員に聞きましょう.</p>
<p>しかし,繰り返しになりますが,PCが使える,プログラミングができる,ということは自分で問題の解決策を調べて解決できるということです.したがって,まずは自分で調べて解決する癖をつけるようにしましょう.</p>
<h3 data-number="3.11.2" id="エラーを体験してみよう"><span class="header-section-number">3.11.2</span> エラーを体験してみよう</h3>
<p>皆さんのプログラムが上手く動かない理由の圧倒的No1が<strong>スペルミス,タイプミス</strong>です. プログラミングの作業は,プログラムもコマンドも英語で記述します. プログラムは,1文字でも間違っていると上手く動かないので,しっかりとタイピングしましょう. 特にこれから行う作業で非常に多いスペルミスは以下のようなものです.</p>
<div class="note">
<ul>
<li>学生のスペルミス例
<ul>
<li>Data → Date (なぜか3割くらいの学生が間違えます.)</li>
<li>industry → indusutry, industly, indstry</li>
<li>python → pyton, pyhon</li>
<li>answer → anser, answere, ansewer</li>
<li>salary → sarary, saraly, sarasly</li>
<li>python –version → python version, python –vertion</li>
</ul></li>
</ul>
</div>
<p>スペルミスに対応するには注意するしかありません. 単純に英語の単語を覚えていない or タイピングミスが原因なので注意しましょう.英単語の意味がや綴がわからない場合には検索しましょう.
基本的にプログラミングにおいて無意味な英単語は利用していないので,意味を考えましょう(意味がない単語の例としてhoge,hugaなどは良く使いますが).特に<code>Date (日付)</code>, <code>Data(データ)</code>などは頻出ですが, 単語の意味を考えればミスしづらいかと思います. また,エラー文を読めばどこが間違っているか教えてくれています.
エラー文にでてきた文字列’industry’や’Data’に該当する部分が間違っていないかチェックしましょう.</p>
<p>事例として,以下のプログラムの実行結果と,エラーについて見てみましょう. なお,プログラムの内容や詳細に関しては,このあとやるので理解できなくても問題ありません.</p>
<p>プログラムを実行するにあたって作業ディレクトリに以下のプログラム<code>error_sample.py</code>とプログラム内で読み込むデータ<code>data/error_sample.csv</code>が存在することを前提とします. ここでは,あくまで事例として紹介するので皆さんはデータとプログラムを用意する必要はありません.</p>
<div class="warn">
<p>やる必要はありませんが,同じ作業を試してみたい場合は,作業ディレクトリで以下のコマンドをコピーして実行しましょう</p>
<ul>
<li>Windowsの人</li>
</ul>
<div class="sourceCode" id="cb79"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install pandas</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;name,salary\ntaro,100&quot;</span> <span class="op">&gt;</span> data/error_sample.csv</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;import pandas as pd\ndf = pd.read_csv(&#39;data/error_sample.csv&#39;) \nprint(df[&#39;salary&#39;])&quot;</span> <span class="op">&gt;</span> error_sample.py</span></code></pre></div>
<ul>
<li>Macの人</li>
</ul>
<div class="sourceCode" id="cb80"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip3</span> install pandas</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;name,salary\ntaro,100&quot;</span> <span class="op">&gt;</span> data/error_sample.csv</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;import pandas as pd\ndf = pd.read_csv(&#39;data/error_sample.csv&#39;) \nprint(df[&#39;salary&#39;])&quot;</span> <span class="op">&gt;</span> error_sample.py</span></code></pre></div>
<p>ファイルの構成が以下のようになっていれば問題ありません.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> ls</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="ex">error_sample.py</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> ls data</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="ex">salary_data.csv</span></span></code></pre></div>
<p>それぞれ,以下のようなファイルができているはずです(コメントは入っていません).</p>
<ul>
<li>error_sample.py</li>
</ul>
<div class="sourceCode" id="cb82"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="co">#dataフォルダにある,error_sample.csvファイルを読み込み</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;data/error_sample.csv&#39;</span>)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="co">#読み込んだファイルのsalary列を表示</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">&#39;salary&#39;</span>])</span></code></pre></div>
<ul>
<li>error_sample.csv</li>
</ul>
<div class="sourceCode" id="cb83"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>name,salary</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>taro,<span class="dv">100</span></span></code></pre></div>
</div>
<p>このプログラムを実行してみると,<code>error_sample.csv</code>の<code>salary</code>列の値が表示されます.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python error_sample.py</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    100</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Name:</span> salary, dtype: int64</span></code></pre></div>
<p>プログラムを以下のように修正して実行してみます.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="co"># error_sample.csvをarara_sample.csv に変更</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;data/arara_sample.csv&#39;</span>)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">&#39;salary&#39;</span>])</span></code></pre></div>
<p>以下のようなエラーが表示されます.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 error_sample.py</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Traceback</span> <span class="er">(</span><span class="ex">most</span> recent call last<span class="kw">)</span><span class="bu">:</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="ex">File</span> <span class="st">&quot;/Users/akagi/Documents/Programs/Python/slds/error_sample.py&quot;</span>, line 2, in <span class="op">&lt;</span>module<span class="op">&gt;</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">df</span> = pd.read_csv<span class="er">(</span><span class="st">&#39;data/arara_sample.csv&#39;</span><span class="kw">)</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">File</span> <span class="st">&quot;/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/io/parsers/readers.py&quot;</span>, line 912, in read_csv</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ex">_read</span><span class="er">(</span><span class="ex">filepath_or_buffer,</span> kwds<span class="kw">)</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>  <span class="ex">File</span> <span class="st">&quot;/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/io/parsers/readers.py&quot;</span>, line 577, in _read</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">parser</span> = TextFileReader<span class="er">(</span><span class="ex">filepath_or_buffer,</span> <span class="pp">**</span>kwds<span class="kw">)</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>  <span class="ex">File</span> <span class="st">&quot;/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/io/parsers/readers.py&quot;</span>, line 1407, in __init__</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">self._engine</span> = self._make_engine<span class="er">(</span><span class="ex">f,</span> self.engine<span class="kw">)</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>  <span class="ex">File</span> <span class="st">&quot;/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/io/parsers/readers.py&quot;</span>, line 1661, in _make_engine</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">self.handles</span> = get_handle<span class="er">(</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>  <span class="ex">File</span> <span class="st">&quot;/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/io/common.py&quot;</span>, line 859, in get_handle</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>    <span class="ex">handle</span> = open<span class="er">(</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a><span class="ex">FileNotFoundError:</span> [Errno 2] No such file or directory: <span class="st">&#39;data/arara_sample.csv&#39;</span></span></code></pre></div>
<p>先ほど解説したように最初の部分と,最後の部分だけを見てみましょう.
最初の部分ではエラーの発生場所を説明しています. このエラーは
<code>line 2, in &lt;module&gt;</code>の<code>df = pd.read_csv('data/arara_sample.csv')</code>
部分で発生しています.先ほど変更を加えた2行目のファイル名の部分ですね.</p>
<p>最後の部分では,発生したエラーの中身について説明しています. エラーの詳細は</p>
<p><code>FileNotFoundError: [Errno 2] No such file or directory: 'data/arara_sample.csv'</code></p>
<p>であり,<code>data</code>フォルダに<code>arara_sample.csv</code>というファイルがないという意味です.</p>
<p>プログラムの<code>arara_sample.csv</code>の部分を修正して,今度は,最後の行をエラーが出るように変更しています.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="co">#dataフォルダにある,error_sample.csvファイルを読み込み</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;data/error_sample.csv&#39;</span>)</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="co">#salaryをsararyに変更</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">&#39;sarary&#39;</span>])</span></code></pre></div>
<p>実行すると以下のようなエラーが発生します.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 error_sample.py</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Traceback</span> <span class="er">(</span><span class="ex">most</span> recent call last<span class="kw">)</span><span class="bu">:</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="ex">File</span> <span class="st">&quot;/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/indexes/base.py&quot;</span>, line 3652, in get_loc</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ex">self._engine.get_loc</span><span class="er">(</span><span class="ex">casted_key</span><span class="kw">)</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">File</span> <span class="st">&quot;pandas/_libs/index.pyx&quot;</span>, line 147, in pandas._libs.index.IndexEngine.get_loc</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>  <span class="ex">File</span> <span class="st">&quot;pandas/_libs/index.pyx&quot;</span>, line 176, in pandas._libs.index.IndexEngine.get_loc</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>  <span class="ex">File</span> <span class="st">&quot;pandas/_libs/hashtable_class_helper.pxi&quot;</span>, line 7080, in pandas._libs.hashtable.PyObjectHashTable.get_item</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>  <span class="ex">File</span> <span class="st">&quot;pandas/_libs/hashtable_class_helper.pxi&quot;</span>, line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="ex">KeyError:</span> <span class="st">&#39;sarary&#39;</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> above exception was the direct cause of the following exception:</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a><span class="ex">Traceback</span> <span class="er">(</span><span class="ex">most</span> recent call last<span class="kw">)</span><span class="bu">:</span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>  <span class="ex">File</span> <span class="st">&quot;/Users/akagi/Documents/Programs/Python/slds/error_sample.py&quot;</span>, line 3, in <span class="op">&lt;</span>module<span class="op">&gt;</span></span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>    <span class="ex">print</span><span class="er">(</span><span class="va">df</span><span class="op">[</span><span class="st">&#39;sarary&#39;</span><span class="op">]</span><span class="kw">)</span></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>  <span class="ex">File</span> <span class="st">&quot;/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/frame.py&quot;</span>, line 3761, in __getitem__</span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>    <span class="ex">indexer</span> = self.columns.get_loc<span class="er">(</span><span class="ex">key</span><span class="kw">)</span></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>  <span class="ex">File</span> <span class="st">&quot;/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pandas/core/indexes/base.py&quot;</span>, line 3654, in get_loc</span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>    <span class="ex">raise</span> KeyError<span class="er">(</span><span class="ex">key</span><span class="kw">)</span> <span class="ex">from</span> err</span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a><span class="ex">KeyError:</span> <span class="st">&#39;sarary&#39;</span></span></code></pre></div>
<p>今度のエラー文を見てみると,先ほど変更を加えた</p>
<p><code>File "/Users/akagi/Documents/Programs/Python/slds/error_sample.py", line 3, in &lt;module&gt;</code></p>
<p>の <code>print(df['sarary'])</code>でエラーが発生しており,エラーの内容は,<code>sarary</code>という<code>Key</code>が存在しないという意味の<code>KeyError: 'sarary'</code>です. pandasのDataFrameにおけるKeyについてはまだ扱っていませんが,辞書型で発生するエラーと同様なので,辞書型を参考にして大まかな意味を掴みましょう.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> xs <span class="op">=</span> {<span class="st">&quot;name&quot;</span>:<span class="st">&quot;taro&quot;</span>,<span class="st">&quot;salary&quot;</span>:<span class="dv">100</span>}</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> xs[<span class="st">&#39;salary&#39;</span>]</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="dv">100</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> xs[<span class="st">&#39;sarary&#39;</span>]</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>Traceback (most recent call last):</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>  File <span class="st">&quot;&lt;stdin&gt;&quot;</span>, line <span class="dv">1</span>, <span class="kw">in</span> <span class="op">&lt;</span>module<span class="op">&gt;</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="pp">KeyError</span>: <span class="st">&#39;sarary&#39;</span></span></code></pre></div>
<p>上のコードでは,<code>sarary</code>という<code>xs</code>に存在しない<code>key</code>を呼び出したことで<code>KeyError</code>が発生しています.</p>
<div class="note">
<ul>
<li>演習</li>
</ul>
<p>以下のプログラムをコピーして保存・実行し,エラーを確認しましょう.
どのようなエラーが含まれているのか,エラー文を読んで修正し,説明してください.</p>
<ul>
<li>error_sample2.py</li>
</ul>
<div class="sourceCode" id="cb90"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Morningの&quot;Good&quot;部分を抽出したい.</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="co">#わざとエラーを含むプログラム</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>greetings <span class="op">=</span> {<span class="st">&quot;Morning&quot;</span>:<span class="st">&quot;Good Morning&quot;</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Noon&quot;</span>:<span class="st">&quot;Hello&quot;</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>            ,<span class="st">&quot;Night&quot;</span>:<span class="st">&quot;Good Night&quot;</span>}</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(greeting[<span class="st">&quot;Morming&quot;</span>][<span class="st">&quot;0&quot;</span>:<span class="st">&quot;4&quot;</span>]</span></code></pre></div>
</div>
</details>
<h1 data-number="4" id="ライブラリの利用"><span class="header-section-number">4</span> ライブラリの利用</h1>
<details>
<summary>
開く/閉じる
</summary>
<p>通常のPythonの学習では,基礎的な演算のあとにFor文やIF分を学びます.
しかし,この講義では通常のリストなどよりもむしろPandasとよばれるライブラリの機能を多用します.なので, 先にライブラリの利用法と,Pandasの利用法を学び,それらを事例としてFor文やIF文,関数などの基本的な構文を学習します.</p>
<h2 data-number="4.1" id="ライブラリとは"><span class="header-section-number">4.1</span> ライブラリとは</h2>
<p>第1回の講義で説明しましたが,プログラムをまとめて他の人がプログラム内で利用できるようにしたものをライブラリといいます. Pythonは,統計,データサイエンス関連のライブラリが充実しているために,利用者が多いということでしたね.</p>
<p>Pythonは様々なライブラリを呼び出して利用するための言語として利用されている側面が大きいです.なので, 目的に応じた様々なライブラリの使用法を知って初めてPythonの力を活用できます.</p>
<p>ライブラリのより細かい概念として, <strong>モジュール(Module)</strong>と<strong>Package(Package)</strong>があります.</p>
<div class="note">
<ul>
<li><code>Module</code>
<ul>
<li>他のプログラムに読み込む(<code>import</code>)することができるスクリプトファイル</li>
</ul></li>
<li><code>Package</code>
<ul>
<li>Moduleの名前空間をドットで構造化する手段</li>
</ul></li>
<li><code>Library</code>
<ul>
<li>用途に応じてPackageをまとめたもの</li>
</ul></li>
</ul>
</div>
<p><code>import</code>や名前空間の意味は,実際に使っていきながら見ていきましょう.</p>
<h2 data-number="4.2" id="ライブラリを使ってみよう"><span class="header-section-number">4.2</span> ライブラリを使ってみよう</h2>
<p>データサイエンスは,名前の通りデータを扱いデータから何かしらの示唆を得るための学問です.
データサイエンスにおける分析は概ね以下のように推移します.</p>
<figure>
<img src="/images/data-science-flow.png" alt="データ分析の流れ" />
<figcaption aria-hidden="true">データ分析の流れ</figcaption>
</figure>
<p>それぞれの段階の処理は,基本的には特定のライブラリを利用して行います. したがって,Pythonによるデータ分析の学習では,基本的にそれぞれの段階でのライブラリの利用法を学ぶことが中心になります.それぞれのライブラリの利用法はこれから順次扱いますが,ここでは,第1段階として,データの読み込みに関するライブラリ<code>pandas</code>を事例に一般的なライブラリの使用法を体験します.</p>
<p>何かしらのデータを分析するにはプログラムにデータを読み込む必要があります. Pythonにおいてデータの読み書き,整形,編集,生成などを支援する代表的なライブラリに <code>pandas</code>があります.</p>
<p>ライブラリを利用するためには,まずライブラリを皆さんのコンピュータにインストールする必要があります.
Pythonでライブラリをインストールするには<code>pip</code>を利用します. <code>pip</code>は,Pythonのインストール時に資料の指示に従ってチェックをつけていれば,既にインストールされているはずです.Shellに<code>pip --version</code>と入力してバージョンが表示されていれば,インストールされているので確認してみましょう(Macの人は<code>pip3 --version</code>).</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> pip <span class="ex">--version</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> 24.0 from /Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/pip <span class="er">(</span><span class="ex">python</span> 3.10<span class="kw">)</span></span></code></pre></div>
<p><code>pip install</code>のあとに,インストールしたいライブラリ名を入力すると,ライブラリがインストールされます. 今回は <code>pandas</code>をインストールするので<code>pip install pandas</code>と入力しましょう. 文字が沢山表示されますが, 問題ありません. 画面が止まるまで待ちましょう.</p>
<p>pandasはデータを扱うためのライブラリなので利用するには,何かしらのデータが必要です. 本格的な利用はこのあとでしますが,取り敢えず利用確認用の簡単なデータを作成しましょう.</p>
<p>データはテーブルデータの形式を取ることが多く,pandasで読み込みや書き込みができるテーブルデータとして代表的な形式に<code>CSV(Comma  Separated Values)</code>があります.</p>
<div class="warn">
<p>最近はテーブルデータの高速な処理が可能な<a href="https://pola.rs"><code>Polars</code></a>なども流行っていますが,本資料ではPandasに限定します.</p>
<p>また,<code>JSON</code>や<code>XML</code>などの他のデータ形式に関しては扱いません.</p>
</div>
<p>CSVは,テキストファイルの一種で,その名の通りコンマ(<code>,</code>)で列を区切り,改行で行を区切ることでテーブルを表現します. 標準的なCSVでは最初の1行は,データではなく,各列の中身を表すタイトルとなっており<code>Header</code>と呼びます.2行目以下のデータ部分を<code>Body</code>と呼びます.</p>
<p>Excelを開いて1行目に<code>Weight</code>,<code>Height</code>,<code>BMI</code>と記入し,それぞれの列に以下のように数値を記入しましょう.<code>BMI</code>列は空欄で構いません.</p>
<figure>
<img src="/images/pandas-csv-sample.png" alt="csv sample" />
<figcaption aria-hidden="true">csv sample</figcaption>
</figure>
<p>このファイルを<code>UTF-8</code>の<code>CSV</code>として保存します. ファイル名は<code>body_data.csv</code>としましょう. Excelでは<code>ファイルの種類</code>で<code>CSV UTF-8 (コンマ区切り)(*.csv)</code>と選択することで保存できます.</p>
<figure>
<img src="/images/excel-file-type.png" alt="excel file type" />
<figcaption aria-hidden="true">excel file type</figcaption>
</figure>
<p>このファイルを作業ディレクトリの中に作った<code>data</code>という名前のフォルダに保存します.</p>
<p>試しに,<code>body_data.csv</code>をテキストエディタで開くと,中身がコンマと改行で表現されていることが分かります.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>Height,Weight,BMI</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="dv">170</span>,<span class="dv">55</span>,</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="dv">180</span>,<span class="dv">72</span>,</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="dv">155</span>,<span class="dv">42</span>,</span></code></pre></div>
<p>Sublime Textでは <code>File</code>タブの<code>Save with Encoding</code>内の<code>UTF-8 with BOM</code>で保存し,拡張子を<code>.csv</code>にすることで保存できます.</p>
<p><img src="/images/Sublime-utf-8-bom.png" /></p>
<div class="warn">
<p><strong><code>BOM(Byte Order Mark)</code>について</strong></p>
<p>Unicode(UTF-8, UTF-16など)で文章が記載されていることを示す符号をBOMといい,ファイルの最初に記載されます.
これがついていることで,ソフトウェアでデータを読み込む際に自動的に,適切なエンコーディングが選択されます.
Excelの場合は<code>CSV UTF-8 (コンマ区切り)(*.csv)</code>でBOM付きのUTF-8として保存されますが,日本語環境ではBOMがついていないCSVファイルを<code>Shift-JIS</code>で開くため,外部ファイルの読み込みから適切なエンコーディングを選ばないと文字化けします.</p>
<p>この知識は後ほどpandasを利用したCSVの保存で再度扱います.</p>
</div>
<p>このファイルを読み込んで,pandasの機能をいくつか確認するためのスクリプトを書きます.
テキストエディタで<code>pandas_test.py</code>という空のファイルを作成し,以下のように記述しましょう.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;data/body_data.csv&#39;</span>)</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">&#39;Weight&#39;</span>].mean())</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">&#39;Weight&#39;</span>].median())</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;BMI&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;Weight&#39;</span>] <span class="op">/</span> (df[<span class="st">&#39;Height&#39;</span>]<span class="op">/</span><span class="dv">100</span>) <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<p>このプログラムを実行すると,以下のように表示されるはずです.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 pandas_test.py</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>   <span class="ex">Height</span>  Weight  BMI</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>     170      55  NaN</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>     180      72  NaN</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>     155      42  NaN</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="ex">56.333333333333336</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="ex">170.0</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>   <span class="ex">Height</span>  Weight        BMI</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>     170      55  19.031142</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>     180      72  22.222222</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>     155      42  17.481790</span></code></pre></div>
<p>このプログラムで何をしているのかを簡単に見ていきましょう.</p>
<p>まず一行目の<code>import pandas as pd</code>ですが,<code>import pandas</code>によってこのプログラム内で<code>pandas</code>を利用可能にしています. しかし,<code>pandas</code>と毎回かくのは面倒なので,省略形の<code>pd</code>という名前を定義しています. Pythonでは<code>import [利用したいライブラリ名] as [省略形]</code>
の形で,ライブラリのインポートと省略形の定義を同時に行えます. pandasは<code>df</code>と省略するのが一般的です.</p>
<p>続いて2行目の <code>df = pd.read_csv('data/body_data.csv')</code>で,先ほど作成した <code>data</code>フォルダにある<code>body_data.csv</code>というファイルを読み込んでいます. <code>df =</code>で読み込んだデータに<code>df</code>という名前をつけています.</p>
<p>3行目の<code>print(df)</code>で,読み込んでdfという名前をつかたデータを表示しています. REPLでは,変数を書くだけで表示されていましたが,スクリプトでは標準出力したいものは<code>print()</code>関数を適用する必要があります.</p>
<p>4,5行目は<code>Weight</code>列の平均(<code>mean</code>)と中央値(<code>median</code>)を求めて表示しています.</p>
<p>6,7行目はもともとのデータで空だった,<code>BMI</code>列を計算し,計算結果を表示しています.</p>
<p>これらの操作の具体的な使い方や意味はこのあと細かく扱いますが,取り敢えず,pandasではこのようにして,データを読み込み,処理することができます.</p>
<h2 data-number="4.3" id="なぜexcelではだめなのか"><span class="header-section-number">4.3</span> なぜExcelではだめなのか</h2>
<p>先ほど行った簡単な表計算であれば,Excelでも簡単に同じことができます. では,なぜややこしいPythonなどを学んでプログラムで同じことをするのでしょうか.</p>
<p>まず,第1にPythonを利用することで</p>
<p><strong>機械学習や高度な検定など,Excelではできない高度な処理が可能</strong>になります.</p>
<p>先ほど行った簡単な集計であればExcelでも可能ですが,後ほど行う機械学習や自然言語処理などの高度な処理はExcelでは実行が困難です. また, データに関してもExcelでは最大で1,048,576行程度のデータしか扱うことができませんが,(この講義では扱いませんが)データサイエンスでは,それを超えた大容量のデータを扱うことがしばしばあります.</p>
<p>第2の理由として,</p>
<p><strong>Excelが複数の連続した複雑な処理には向いていない</strong>ということが挙げられます.</p>
<p>Excelでは,何か作業をしても<strong>過程が記録されず,結果だけが残ります.</strong> また,折角複雑な処理を実行しても,異なるデータなどで同じ処理を行う場合にはゼロから繰り返す必要があり,<strong>処理自体を再利用できません</strong>(VBAやマクロなどはありますが,それらは結局プログラミングをしているので同じです.)</p>
<p>Excelのこのような特性から,Excelによる複雑な処理の実行は,人間の作業に依存する傾向が強く,ミスの原因となります.</p>
<p>このことについて,以下のデータを事例にもう少し具体的に意味を見ていきましょう.</p>
<p><img src="/images/excel-procedure1.png" /></p>
<p>例としてこのデータに対して以下の3つの処理をすることを考えます.</p>
<div class="note">
<pre><code>1. いらない部分を削除する
2. 右側に行和を表す列を足す
3. とある列の値が一定以下のデータを抜き出す</code></pre>
</div>
<p><img src="/images/excel-procedure2.png" /></p>
<p>この場合,EXCELでは最後の抜き出したデータだけが残り,中間の段階の処理も,過程も記録されません.
したがって,</p>
<div class="note">
<ol type="1">
<li>途中で間違っていても気づけない,チェックできない</li>
<li>何をしたのかを他の場所にメモして置かなければ分からない,メモも難しい</li>
<li>別のデータを使う場合同じ処理をもう一度する必要がある</li>
</ol>
</div>
<p>などの問題がよく起こります.</p>
<p>また,削除の作業などは(これくらいなら自動でもできますが)一つ一つ消していく必要があり大きなデータ(数万行とか)では非常に手間がかかります.</p>
<p>Excelはこのように,処理が人間の記憶や,正確さに依存しています. その結果,ミスの原因となっています.</p>
<div class="note">
<p>例えば, こちらの記事(<a href="https://www.teampay.co/blog/biggest-excel-mistakes-of-all-time">The 7 Biggest Excel Mistakes of All Time</a>)では,過去にExcelの操作ミスで起きた大規模なミスの事例が紹介されています.</p>
<ul>
<li>2008年 バークレイズ・キャピタル</li>
</ul>
<p>隠していたセルがPDF板では表示されていたことによる数百万ドルの損失が発生.</p>
<ul>
<li>2012年 ロンドン オリンピック</li>
</ul>
<p>作業員のタイプミスで,10万枚のチケットが払い戻し</p>
<ul>
<li>2012 JPモルガン</li>
</ul>
<p>Excelのコピペミスにより60億ドルの損失</p>
<p>ちなみにこの記事には載っていませんが,2019年に話題になった,厚生労働省の毎月勤労統計における不正問題もExcelのミスが原因の一つです.</p>
</div>
<p>一方プログラムでは,これらの問題が解決可能です.</p>
<p>先程のExcelの作業と同じ例で考えてみましょう.
以下のコードは先程のExcelで行った作業を実行しています.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="co">#データの読み込み</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;sample.csv&#39;</span>)</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a><span class="co">#いらない部分を削除する</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>df.dropna(axis<span class="op">=</span><span class="st">&#39;index&#39;</span>,how<span class="op">=</span><span class="st">&#39;any&#39;</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a><span class="co">#右側に行和を追加する</span></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;sum&#39;</span>] <span class="op">=</span> df.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a><span class="co">#data3が50以下の行を消す</span></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df[<span class="st">&#39;data3&#39;</span>]<span class="op">&gt;</span><span class="dv">50</span>]</span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a><span class="co">#確認</span></span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<p>実行結果は当然Excelで行ったものと同じです.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> python <span class="ex">sample.py</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>    <span class="ex">data1</span>   data2   data3    sum</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    86.0      75    67.0  228.0</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>    66.0      92    90.0  248.0</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>     6.0      66    93.0  165.0</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>   27.0      32    52.0  111.0</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="ex">18</span>   27.0      61    91.0  179.0</span></code></pre></div>
<p>しかし, Excelと異なりこのプログラムを実行しても<strong>元データは変わっていない</strong>ため,元の状態にいつでも戻ることが可能です. 更に何を行ったかの<strong>処理がプログラムとして残っている</strong>ため,途中で間違いがないかのチェックや修正が可能です.
(本講義では扱いませんが, 実際にはプログラムでもミスは絶対におきます.そのためテストを実施するのですが,人間の行うチェックリストなどのテストよりもプログラムで行うテストの方が信頼性が高いのも利点です.)</p>
<p>また,
<strong>プログラムがそのまま作業メモ</strong>になっているので,他人に何を行ったかの説明が可能です. 加えて,このプログラムを再利用することで,<strong>異なるデータで同じ作業をする場合に再利用することが可能</strong>です. また,実際の処理はすべてプログラムが自動で行うため<strong>作業の手間がデータの容量にかかわらず一定</strong>です.</p>
<p>確かに,これまでに皆さんが講義で習ってきたような内容であれば,Excelのほうが学習コストが低く手軽に行えます. しかし,今後行うような統計処理やデータサイエンスなど,処理が複雑になればなるほど,プログラムで処理するメリットが大きくなります.</p>
</details>
<h1 data-number="5" id="データの取得と編集"><span class="header-section-number">5</span> データの取得と編集</h1>
<details>
<summary>
開く/閉じる
</summary>
<p>これからデータをプログラム上で扱うにあたって,まずはデータについて考えてみましょう.</p>
<p>データは,基本的に誰かが収集・作成したものです. 自然科学においては,<strong>実験</strong>によってデータを収集し,人文・社会科学では,<strong>調査</strong>によってデータが集められます. データの作成はそれ自体でそれぞれ,<strong>実験計画法</strong>,<strong>社会調査法</strong>といった学問分野になっています.</p>
<p>データサイエンスは,データを利用して行う学問でセウが,データを収集・作成するのは専門知識,技能,時間,お金などが必要であり,データの作成自体が大きな仕事です.</p>
<p>データを自分で集めるには大変な手間がかかるので, 研究機関や,行政,大学,調査会社など他者が集めて公開しているデータを利用するのも一つの手段です. この講義では, 基本的に公開されているデータを利用して, 学習,研究を行います.</p>
<p>実験や調査によって集められたデータを<strong>原データ</strong>といい,調査によって集められた個別の調査票などを<strong>個票</strong>といいます.</p>
<p>原データに統計処理を加えてまとめたものを,<strong>統計資料</strong>あるいは<strong>調査結果</strong>などと呼びます.もともと<strong>統計(statistics)</strong>という言葉は,(国家の状況に関して)
集められた原データを編集してわかりやすく加工することを意味していました. データサイエンスではしばしば原データが利用されますが,公開されているデータはこれらの統計資料である場合が多く,原データを利用するのは困難な場合が多いです.</p>
<p>統計資料に更に加工を加えたものを,<strong>二次統計</strong>や<strong>加工統計</strong>と呼びます.</p>
<p>例えば, 国税調査によって個票が収集され,統計処理を加えた統計資料が公開され, それを更に複数の統計と併せて加工することで,国民経済計算などの加工統計が作成されます.</p>
<figure>
<img src="/images/statistical-data-flow.png" alt="データの作られ方" />
<figcaption aria-hidden="true">データの作られ方</figcaption>
</figure>
<h2 data-number="5.1" id="データの尺度"><span class="header-section-number">5.1</span> データの尺度</h2>
<p>データには様々な種類があり,種類ごとに利用可能な統計やデータサイエンスの手法が異なります.したがって,今後データを分析するにあたって,大まかなデータの区分を知っておく必要があります.</p>
<p>データの区分として,一番大きいものに <strong>量的データ(quantitative data)</strong>,<strong>質的データ(qualitative data)</strong>があります. 質的データはカテゴリーデータなどとも呼ばれます.</p>
<div class="warn">
<p>このどちらにも当てはまらないような,画像,音声,文字データなどの<strong>非構造データ</strong>もありますが,それらはそれぞれ個別の対処手法があります.</p>
<p>この講義では後半で文字データを扱う自然言語処理について扱いますが,しばらくはこれらに関しては無視して,量的データと質的データを扱います.</p>
</div>
<div class="note">
<ul>
<li>量的データ</li>
</ul>
<p>数量的なデータであり,データを数直線上の位置で表現できます.</p>
<p>例:</p>
<pre><code>- 年齢(5歳,10歳,100歳)
- 身長(150cm,170cm,200cm)
- 年収(200万円,500万円,1億円)

など基本的には,何かしらの**単位**で計量されます.</code></pre>
<hr />
<ul>
<li>質的データ</li>
</ul>
<p>あらかじめ定められたカテゴリーのいずれかに属する値を持つデータです.</p>
<p>例:</p>
<pre><code>- 性別(F or M)
- 犬の種類(ゴールデンレトリバー, 柴犬, プードル,など)
- 天気(晴れ,雨,曇など)
- 満足度(とても満足, まぁ満足, どちらでもない,など)</code></pre>
</div>
<p>質的データと量的データは更に細かい区分として<strong>尺度(scale)</strong>に分解されます.
それぞれは,｢比較が可能か｣,｢和差積商｣の計算が可能かどうかという観点で定義されます.</p>
<div class="note">
<ul>
<li>質的データ</li>
</ul>
<hr />
<p><strong>名義尺度(nominal scale)</strong></p>
<p>質的データの中で区分にしか意味がなく順序が定義されていないもの.</p>
<pre><code>- 例:氏名,性別,種類,など</code></pre>
<p>和差積商のどれも定義されない.</p>
<pre><code>- 例:青木 + 赤木 = 紫木 のような計算はできない.
- 青木は赤木よりも良い,大きい,などの比較もできない</code></pre>
<hr />
<p><strong>順序尺度(ordinal scale)</strong></p>
<p>質的データの中で順序が定義されているもの.</p>
<pre><code>- 例: 満足度,成績区分(S,A,B,...)など</code></pre>
<p>和差積商のどれも定義されないが比較が可能</p>
<pre><code>- 例: ｢満足｣は｢不満足｣よりも満足度が高いが,
- 普通 + 普通 = 満足 のような計算はできない.</code></pre>
<hr />
<ul>
<li>量的データ</li>
</ul>
<hr />
<p><strong>間隔尺度(interval scale)</strong></p>
<p>量的データの中で,間隔は定義されているが,比率が定義されていないもの.</p>
<pre><code>- 例: 時刻,日付,IQ,気温,西暦,etc</code></pre>
<p>足し算引き算はできるが,掛け算割り算ができない.</p>
<pre><code>- 1月1日 + 364日 = 12月31日 ですが,
- 1月1日 * 2 = 2月2日 のような計算は定義されていません.</code></pre>
<hr />
<p><strong>比率尺度(ratio scale)</strong></p>
<p>量的データの中で,比率が定義されているもの.</p>
<pre><code>- 例: 長さ,速度,重さ,面積など</code></pre>
<p>和差積商すべて計算できます.</p>
<pre><code>- 10Kg + 10Kg = 20Kg
- 10Kg * 2    = 20Kg</code></pre>
</div>
<p>これらの区分は今後データの処理手法を選択する際に使用するので,
データがでてきたら尺度は何かを判断するようにしましょう.</p>
<div class="note">
<p><strong>演習問題</strong></p>
<p>以下のデータの尺度を判断し,なぜそのように判断できるかを説明してください.</p>
<ol type="1">
<li><p>ペットの種類 (イヌ,ネコ,鳥,魚,爬虫類,その他から選択)</p></li>
<li><p>偏差値</p></li>
<li><p>電話番号</p></li>
<li><p>一週間に読んだ本のページ数</p></li>
</ol>
</div>
<h2 data-number="5.2" id="データの種類"><span class="header-section-number">5.2</span> データの種類</h2>
<p>これまでは一つの種類の値の区分に関して,説明してきましたが,データは複数の値の組み合わせで表現され,<strong>観測対象(ケース)</strong>別の<strong>観測項目(変数)</strong>の<strong>テーブルデータ</strong>として表現される場合が多いです.</p>
<figure>
<img src="/images/case-and-variable.png" alt="観測対象と観測項目" />
<figcaption aria-hidden="true">観測対象と観測項目</figcaption>
</figure>
<p>データの観測項目の数のことを<strong>次元</strong>と呼び, 1観測項目のデータを<strong>1次元データ</strong>,2観測項目以上のデータを<strong>多次元データ</strong>と呼びます.</p>
<figure>
<img src="/images/data-dimention.png" alt="データの次元" />
<figcaption aria-hidden="true">データの次元</figcaption>
</figure>
<p>また,観測項目や観測対象の組み合わせによって,特別に呼称され,それぞれ独自の分析手法が存在するデータもあります(時系列データと時系列解析,パネルデータと,パネルデータ分析など)</p>
<p><img src="/images/data-types.png" /></p>
<p>上の時系列データは,特定の時間単位で集計,区分されたデータを指しますが,データの発生時刻が記録されたデータを<strong>点過程データ</strong>と呼びます. 点過程データを日毎,月ごとなどで集計することで時系列データが作成されます.</p>
<h2 data-number="5.3" id="データの取得と編集-1"><span class="header-section-number">5.3</span> データの取得と編集</h2>
<p>先に述べたように,データは自分で集めることもできますが,手間,時間,お金がかかるため,目的に応じて他人の集めたデータを利用することも一般的です.</p>
<p>現在では,無料で利用可能なデータも多数あり,この講義ではそれらのデータを利用します.</p>
<div class="warn">
<p>後ほど自分で選んだ研究テーマによっては自分でデータを収集することも可能です.
過去のこの講義でも, HPの視線移動データ,アンケートデータ,ヒットチャートの音楽の特徴量を表すデータ
などを自分で作った事例もあります.</p>
<p>それらに関しては,個々の研究計画に応じて必要であれば補足的に講義内で扱います.</p>
</div>
<p>無料で誰でも利用可能なデータの代表として,<strong>公的統計</strong>があります. 公的統計は,国や地方自治体の作成する統計情報であり,政策立案と評価のための基礎資料として利用されており, 作成過程なども含めて一般に公開されているものが多数あります. プライバシーや個人情報保護の観点から個票は公開されていない場合が大半ですが,研究目的であれば申請して利用することも可能です.しかし,通常データが手元に来るまでに1年程度時間を要するのでこの講義では扱いません.</p>
<p>日本の統計情報を活用するには,“日本の統計が閲覧できる政府統計ポータルサイト”<a href="https://www.e-stat.go.jp"><code>e-stat</code></a>があります. e-statでは日本の各種公的統計の情報を統計別,分野別,地域別,時系列などで取得することができます.</p>
<p><img src="/images/e-stat-screenshot1.png" alt="e-stat screenshot1" />
<img src="/images/e-stat-screenshot2.png" alt="e-stat screenshot2" /></p>
<p>日本以外のデータに関しては,各国の統計サイトに直接アクセスするか,あるいは国連による各種子交際期間の統計の横断検索サイト<a href="https://data.un.org"><code>UNData</code></a>などを利用することで取得可能です.</p>
<figure>
<img src="/images/UNData-screenshot.png" alt="UNData" />
<figcaption aria-hidden="true">UNData</figcaption>
</figure>
<p>各国の公的統計は通常数量的なデータを扱っていますが,大学の講義や研究などで欲利用される質的データとして,<a href="https://www.worldvaluessurvey.org/wvs.jsp"><code>World Value Survey</code></a>があります. 世界各国の価値観に関する調査のパネルデータを提供しており, ｢人生において大切にするもの｣｢男女平等意識｣ などの調査結果が利用できます.</p>
<p>その他にも各種研究機関や企業が提供するデータも利用可能です.</p>
<p>統計ではありませんが, <a href="https://disclosure2.edinet-fsa.go.jp/WEEK0010.aspx"><code>EDINET</code></a>のWEB APIを利用して有価証券報告書のデータを取得する,Wikipediaのテキストデータを自然言語処理してデータを作成するなどもこの講義における過去の研究事例があります.</p>
<p>これらに関しては後ほど, Webページから自動でデータを取得する<code>Webスクレイピング</code>やTwitterなどのSNSの提供する<code>API</code>を利用してデータを取得する方法も扱います.</p>
<p>Webから取得可能な情報以外にも, 特定の組織に直接交渉してデータを活用することも可能です. この講義では千葉商科大学の授業データや,電力消費データを提供してもらい分析した事例もあります.</p>
<h2 data-number="5.4" id="e-statを使ってみよう"><span class="header-section-number">5.4</span> e-statを使ってみよう</h2>
<p>e-statを利用して,pandasで読み込める形式のCSVを作成しましょう. 練習用なので,何を持ってきてもいいのですがここでは,｢産業別の給与｣に関するデータを取得します. 就職活動中の学生も多いかと思います. 産業別の給与はどのように異なるのでしょうか.</p>
<p>まずは使いたいデータを探します. 方法はいくつもありますが,ここでは<code>分野</code>から探してみましょう. <code>分野→労働・賃金→民間給与実態調査</code>の順にクリックしてください.</p>
<p><img src="/images/e-stat-salary1.png" /></p>
<p><code>データベース</code>形式か,<code>ファイル</code>形式か選択することができます. データベース形式は必要なデータをブラウザ上で選択,編集してデータを取得することができます. ファイル形式は,ExcelやPDFファイルをダウンロードできます. どちらでも問題ありませんが,ここではただのExcelファイルと,pandasで読み込めるデータの違いを確認するために,<code>ファイル</code>をクリックしましょう.</p>
<p><img src="/images/e-stat-salary2.png" /></p>
<p>官庁の作成する統計は,<code>民間給与実態調査</code>などの調査名,統計名の下位分類として,年次推計,延長推計などの提供分類,その下に対象年次,更にその下に表レベルの分類があります. これはそれぞれの統計にある程度詳しくないと意味がわからないかと思いますが,今は練習ですので気にせず,<code>結果表</code>の<code>年次推計</code>の<code>2018年度</code>の<code>第1表</code> の<code>Excel</code>をクリックしましょう.</p>
<p><img src="/images/e-stat-salary3.png" /></p>
<p>これで,民間給与実態統計調査結果表年次推計2018年度第1表 給与所得者数・給与額・税額 全国計表 がダウンロードできましたので,開いてみましょう.</p>
<p><img src="/images/e-stat-salary4.png" /></p>
<p>省庁から取得したExcel表は,このような形態になっていることが多いですが,このデータはそのままではpandasなどで読み込める形になっていません. もちろん,データベース機能で編集したデータや2018年ではなくもっと新しいデータの場合には,ある程度利用できる形態になっていますが,このようなデータは未だに多数存在します.</p>
<p>ではこのデータは一体,何が駄目なのでしょうか. プログラムで利用できるデータを作成するにあたって,e-statのデータは良い<strong>悪い見本</strong>なので,e-stat全般の問題点に関して少し見ていきましょう.</p>
<p>先ほどダウンロードしたような形式のデータを俗に<strong>ネ申Excel</strong>といいます(以降<strong>神Excel</strong>と記載).</p>
<p>神Excelとは,紙で印刷した際の見栄えを重視した,データとしての利用性のまったくないExcelシートです(参考:<a href="https://okumuralab.org/~okumura/SSS2013.pdf">｢ネ申Excel｣問題</a>).</p>
<p>例えば, 見栄えを重視するために<strong>セルを結合する</strong>,<strong>画像を挿入する</strong>,<strong>スペースなどで幅を揃える</strong>,<strong>1セルに1文字を入力する(Excel方眼紙)</strong>などが神Excelの特徴となります.</p>
<p>先程の民間給与実態統計調査を見てみるとこれらの特徴が見事に当てはまります.</p>
<figure>
<img src="/images/kami-excel.png" alt="神Excel" />
<figcaption aria-hidden="true">神Excel</figcaption>
</figure>
<p>人間は,文字の間に空白が挟まっていてもつながった単語として認識できますが,コンピュータにはできません.また,セルが結合されている場合に表として解釈することもできません,画像も処理できません.このようなExcel表はデータとしては利用できないので,データとして形式を揃えるだけで大変な手間がかかります(このあと実際にやります).</p>
<p>逆に, プログラムで利用可能なデータを<strong>機械判読可能</strong>なデータといいます.
機械判読可能な分析しやすいExcelデータをまとめる基本チェック表として,以下のものが有名です(<a href="https://www.tandfonline.com/doi/full/10.1080/00031305.2017.1375989">Data Organization in Spredsheets</a>).</p>
<div class="note">
<ul>
<li><p>一貫性を保つ</p>
<ul>
<li>名前の一貫性</li>
<li>記述方法の一貫性</li>
</ul></li>
<li><p>名前の付け方</p>
<ul>
<li>スペースを使わない</li>
<li>意味が分かる名前をつける</li>
<li>日付の書き方をYYYY-MM-DDに</li>
</ul></li>
<li><p>空のセルを作らない</p></li>
<li><p>セルに一つしかものを入れない</p></li>
<li><p>長方形にする</p></li>
<li><p>データと計算を分離する</p></li>
<li><p>フォントの色やハイライトをデータとして使用しない</p></li>
<li><p>データ検証機能を使う</p></li>
<li><p>CSVファイルに保存する</p></li>
</ul>
</div>
<p>データをプログラムで処理するのが一般的な現代において,自分で使うためのみならず,データの価値を保つためにも機械判読可能な形式でデータを作成するように心がけましょう.Excelを使っていると,せっかくある機能を使いたくなりますができるだけデータとしての利用可能性を高める意識が必要です.</p>
<div class="warn">
<p>ちなみにe-statの問題点は,神Excelにとどまりません.</p>
<p>一番恐ろしいのは一部のデータにおいて,<strong>データベース機能に登録されている元データが神Excel</strong>のままになっていることです.</p>
<p>Excel表上でスペースが混じっているセルの値などがデータベース機能で編集してもそのまま出てくる場合があります.</p>
<p>その他にも,</p>
<ul>
<li>同じ統計でも作成年毎に表記が異なる</li>
<li>データの構造が統計名-提供分類-年次-表の形式になっているため,APIなどでデータを一意に絞り込めない.</li>
<li>公表が遅い</li>
<li>APIにおける一部文字化けやJSONの構造が崩れている</li>
</ul>
<p>など沢山の問題があります. 徐々に改善されているようですので,今後に期待したいところですね.</p>
</div>
<h2 data-number="5.5" id="機械判読可能データの作成"><span class="header-section-number">5.5</span> 機械判読可能データの作成</h2>
<p>では,e-statからダウンロードしたデータを編集して, <strong>機械判読可能なBOM付きUTF-8のCSV</strong>に変換してみましょう. ここでは, Execelを用いて行います.</p>
<p>今回ダウンロードしたデータの中で扱いたいのは,<strong>業種別の給料</strong>です.
それ以外の邪魔な情報は削除しましょう(コピーして別のシートに貼り付けた方が早いです).
新しいファイルを作成し,一行目にHeaderとして,<code>industry</code>, <code>salary</code> と記入しましょう.
日本語でも大丈夫ですが英語の方が安心です.
しかし,業種名を他のファイルにそのまま貼り付けようとすると,セルが結合されているためうまくいきません.このままでは,プログラムで上手く処理できないので編集します.</p>
<p>ダウンロードしたファイルの業種の部分をコピーしたら,新しいファイルのindustry の下のセルを右クリックして｢値だけ貼り付け｣をしましょう.
一部の行の中に句読点が入っていますがこれもエラーのもととなるので,編集します.</p>
<figure>
<img src="/images/e-stat-salary5.png" alt="ヘッダーの作成" />
<figcaption aria-hidden="true">ヘッダーの作成</figcaption>
</figure>
<figure>
<img src="/images/e-stat-salary6.png" alt="データのコピー" />
<figcaption aria-hidden="true">データのコピー</figcaption>
</figure>
<p>プログラムは基本的に英語の利用を想定されているのでデータも英語の方が安定します.
日本語でも問題ない場合が大半なので,日本語のままでも良いですが,プログラム記述中に日本語と英語が混ざるとエラーの原因となりやすいので,文章自体に意味があるテキストデータなどを除いて可能な限り英語に変換しておくことをおすすめします.
自分で適切な英語に変換できない場合はExcelでは翻訳したいセルを右クリックして<code>翻訳</code>を選ぶと翻訳してくれます. Excelでは現状自分でコピーアンドペーストしなければなりません.
Google Sheetなど使うと一発で全て変換する関数 GoogleTranslate などがあります.</p>
<figure>
<img src="/images/e-stat-salary7.png" alt="翻訳されたデータ" />
<figcaption aria-hidden="true">翻訳されたデータ</figcaption>
</figure>
<figure>
<img src="/images/e-stat-salary8.png" alt="Excelの翻訳機能" />
<figcaption aria-hidden="true">Excelの翻訳機能</figcaption>
</figure>
<p>CSVでデータを詠み込む場合, 空白,コンマ,Tabなどはエラーになりやすいので,可能な限り消しましょう.
特に今回の業種データは｢電気･ガス･熱供給・水道業｣ などなぜか中点を利用しているものもあれば,句点で区切られているものもあり,意味が分かりません.
長過ぎるのも問題が起きやすいので,頭文字のみにするなどわかりやすい形に変更しましょう(電気･ガス･熱供給・水道業 → インフラ, 卸売,小売業 → 商業 など)</p>
<p>再度に作成されたデータをCSVとして保存して終了です.保存する際のデータ型式にCSV UTF-8があるのでそれを選択し, ｢<code>salary.csv</code>｣という名前で作業ディレクトリのDataフォルダに保存します.</p>
<figure>
<img src="/images/e-stat-salary9.png" alt="データの保存" />
<figcaption aria-hidden="true">データの保存</figcaption>
</figure>
<h2 data-number="5.6" id="pandasによるデータ処理"><span class="header-section-number">5.6</span> pandasによるデータ処理</h2>
<p>ここから,先ほど作成したデータを利用してpandasの基本的な機能について確認していきます.
<strong>いくつもの処理を一気に扱いますが,すべて暗記する必要はありません. ただし,それぞれの処理の存在を覚えるようにしましょう. 可能な処理やその名前を覚えておけば,この資料に戻る,あるいは検索して調べることで自分で利用できます.</strong>
取り敢えず,講義内ではそれぞれの処理が何をやっているのかの概要を掴み,体験してみましょう.</p>
<h3 data-number="5.6.1" id="ファイルの読み込み"><span class="header-section-number">5.6.1</span> ファイルの読み込み</h3>
<p>先程作成したデータを作業ディレクトリのdataフォルダに保存して,Pythonで読み込んでみます.
以下,<code>salary.py</code>というファイルを作成してプログラムを追記していきます.</p>
<div class="warn">
<p>スクリプトのファイル名は,中身がなにか後で見ても分かるような英数字であれば何でも構いません.
ただし, <code>pandas</code>,<code>numpy</code>,<code>matplotlib</code>などの今後利用するライブラリと同名のスクリプトを作成すると,
正常にライブラリを利用できなくなるので注意しましょう.</p>
</div>
<p>以下の用に <code>import pandas as pd</code> でpandasをimportしたあとに, <code>pd.read_csv('ファイルパス')</code>でファイルが読み込めます. また,同じ行で読み込んだファイルを<code>df</code>という変数に代入しています.
最後の行で読み込んだファイルを表示しています.</p>
<p>最初のうちは自分で作成するプログラムにも以下の例の用に,それぞれの行で何をしているのかコメントを書くようにしましょう.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pandas を import し, pdと呼ぶという意味</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="co"># pandas はデータの読み込みなどに利用します</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="co"># データの読み込み</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a><span class="co"># CSVファイルを読み込んでデータフレーム(後述)に格納</span></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a><span class="co"># pd.関数名 でpandasの関数が利用できる</span></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataフォルダを作成し,そこにデータを入れておきましょう</span></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a><span class="co"># data/salary_data.csv は  data フォルダの salary.csv という意味</span></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;data/salary.csv&#39;</span>)</span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<p>正しくプログラムをデータが作成できていれば,プログラムを実行することで以下のようにデータの中身が標準出力に表示されるはずです. プログラムを記述する際には,このようにところどころで,<code>print()</code>を利用して,自分のイメージしたとおりにデータが編集されているか確認する癖をつけるようにしましょう.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 salary.py</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>         <span class="ex">industry</span>  salary</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction    4503</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing    4756</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale    3186</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    Accomodation    1949</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance    5711</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate    3786</span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport    3909</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy    8199</span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>            Info    5337</span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu    3913</span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med    4144</span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other    4239</span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice    3086</span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC    2190</span></code></pre></div>
<div class="note">
<p>pandasでは主に<code>DataFrame</code>というデータ型を利用してデータを扱います.
<code>DataFrame</code>オブジェクトには様々な機能が実装されており,様々な形に変形することができますが,基本的には以下の3属性から成っています.</p>
<ul>
<li><p>values : データ部分 n × m の行列</p></li>
<li><p>columns: 列名, header情報</p></li>
<li><p>index: 行名</p></li>
</ul>
<figure>
<img src="/images/data-frame-image.png" alt="DataFrameのイメージ" />
<figcaption aria-hidden="true">DataFrameのイメージ</figcaption>
</figure>
</div>
<p>クラスの属性には<code>オブジェクト名.属性名</code>でアクセスできます. 以下のコードを追加して実行し,それぞれどのように表示されるか確認してみましょう.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dfのvalues属性を表示したい場合</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.values)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="co">#dfのcolumns属性を表示したい場合</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.columns)</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a><span class="co">#dfのindex属性を表示したい場合</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.index)</span></code></pre></div>
<div class="sourceCode" id="cb111"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="ex">[[</span><span class="st">&#39;Construction&#39;</span> 4503]</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">&#39;Manufacturing&#39;</span> 4756]</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">&#39;Wholesale&#39;</span> 3186]</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">&#39;Accomodation&#39;</span> 1949]</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">&#39;Finance&#39;</span> 5711]</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">&#39;Real Estate&#39;</span> 3786]</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">&#39;Transport&#39;</span> 3909]</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">&#39;Energy&#39;</span> 8199]</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">&#39;Info&#39;</span> 5337]</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">&#39;Edu&#39;</span> 3913]</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">&#39;Med&#39;</span> 4144]</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">&#39;Other&#39;</span> 4239]</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">&#39;Suervice&#39;</span> 3086]</span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a> <span class="ex">[</span><span class="st">&#39;AFFC&#39;</span> 2190]]</span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Index</span><span class="er">(</span><span class="ex">[</span><span class="st">&#39;industry&#39;</span><span class="ex">,</span> <span class="st">&#39;salary&#39;</span>], dtype=<span class="st">&#39;object&#39;</span><span class="kw">)</span></span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a><span class="ex">RangeIndex</span><span class="er">(</span><span class="va">start</span><span class="op">=</span>0, <span class="va">stop</span><span class="op">=</span>14, <span class="va">step</span><span class="op">=</span>1<span class="kw">)</span></span></code></pre></div>
<h2 data-number="5.7" id="データの確認"><span class="header-section-number">5.7</span> データの確認</h2>
<p>DataFrameを読み込んだらまずは,その全体像と特徴を確認しましょう.
確認すべき項目として,columnsやindexの他に以下のようなものがあります.</p>
<div class="note">
<ul>
<li>データの中身</li>
</ul>
<p>データが長い場合は標準出力には省略して表示されます.
意図的に,先頭n行を取得したい場合には<code>df.head(n)</code>を利用します.
後ろからn行を取得したい場合には<code>df.tail(n)</code>を利用します.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;head --- </span><span class="ch">\n</span><span class="st">&#39;</span>,df.head(<span class="dv">5</span>))</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;tail --- </span><span class="ch">\n</span><span class="st">&#39;</span>,df.tail(<span class="dv">5</span>))</span></code></pre></div>
<div class="sourceCode" id="cb113"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span> <span class="at">---</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>         <span class="ex">industry</span>  salary</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>   Construction    4503</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>  Manufacturing    4756</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>      Wholesale    3186</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>   Accomodation    1949</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>        Finance    5711</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span> <span class="at">---</span></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>     <span class="ex">industry</span>  salary</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>        Edu    3913</span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>       Med    4144</span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>     Other    4239</span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>  Suervice    3086</span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>      AFFC    2190</span></code></pre></div>
</div>
<div class="note">
<ul>
<li><p>データの形</p>
<ul>
<li><p><code>df.shape</code> でデータの行数,列数を取得できます.</p></li>
<li><p><code>len(df)</code> でデータの長さ(行数)を確認できます.</p></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb114"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co">#形の確認</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.shape)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(df))</span></code></pre></div>
<div class="sourceCode" id="cb115"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">14,</span> 2<span class="kw">)</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="ex">14</span></span></code></pre></div>
</div>
<div class="note">
<ul>
<li>記述統計量</li>
</ul>
<p><code>df.describe()</code>を利用することで <code>データ数(count)</code>,<code>平均(mean)</code>, <code>母標準偏差(std)</code>,<code>最大値(max)</code>,<code>最小値(min)</code>, <code>四分位数(25%,50%,75%)</code>などの特徴量が把握できます.
<code>df[列名].max()</code>で最大値,<code>df[列名].mean()</code>で列の平均,<code>df[列名].median()</code>で中央値など個別に把握することも可能です.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co">#特徴量の把握</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.describe())</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;最大値:&#39;</span>,df[<span class="st">&#39;Salaray&#39;</span>].<span class="bu">max</span>())</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;平均値:&#39;</span>,df[<span class="st">&#39;Salaray&#39;</span>].mean())</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;中央値:&#39;</span>,df[<span class="st">&#39;Salary&#39;</span>].median())</span></code></pre></div>
<div class="sourceCode" id="cb117"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>            <span class="ex">salary</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="ex">count</span>    14.000000</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="ex">mean</span>   4207.714286</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="ex">std</span>    1561.247008</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a><span class="ex">min</span>    1949.000000</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a><span class="ex">25%</span>    3336.000000</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a><span class="ex">50%</span>    4028.500000</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a><span class="ex">75%</span>    4692.750000</span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a><span class="ex">max</span>    8199.000000</span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a><span class="ex">最大値:8199.000000</span></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a><span class="ex">平均値:4207.714286</span></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a><span class="ex">中央値:4028.500000</span></span></code></pre></div>
</div>
<h2 data-number="5.8" id="行名列名の変更"><span class="header-section-number">5.8</span> 行名,列名の変更</h2>
<p>columnsとindexは任意の値を設定できます(ただし重複はなし).
リストでそれぞれの属性を更新することで新しい列名,行名を指定できます.</p>
<ul>
<li>列名の変更</li>
</ul>
<p><code>df.columns = [新しい列名のリスト]</code></p>
<ul>
<li>行名の変更</li>
</ul>
<p><code>df.index = [新しい行名のリスト]</code></p>
<p>試しに列名を<code>['Ind','Sal']</code>に,行名を<code>a~n</code>のアルファベットに変更してみましょう.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="co">#列名の変更</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>df.columns <span class="op">=</span> [<span class="st">&#39;Ind&#39;</span>,<span class="st">&#39;Sal&#39;</span>]</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="co">#行名の変更</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>df.index <span class="op">=</span> [<span class="st">&#39;a&#39;</span>,<span class="st">&#39;b&#39;</span>,<span class="st">&#39;c&#39;</span>,<span class="st">&#39;d&#39;</span>,<span class="st">&#39;e&#39;</span>,<span class="st">&#39;f&#39;</span>,<span class="st">&#39;g&#39;</span>,<span class="st">&#39;h&#39;</span>,<span class="st">&#39;i&#39;</span>,<span class="st">&#39;j&#39;</span>,<span class="st">&#39;k&#39;</span>,<span class="st">&#39;l&#39;</span>,<span class="st">&#39;m&#39;</span>,<span class="st">&#39;n&#39;</span>]</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<p>指定した通りに列名や行名が変更されていれば成功です.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>             <span class="ex">Ind</span>   Sal</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="ex">a</span>   Construction  4503</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span>  Manufacturing  4756</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span>      Wholesale  3186</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="ex">d</span>   Accomodation  1949</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a><span class="ex">e</span>        Finance  5711</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a><span class="ex">f</span>    Real Estate  3786</span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a><span class="ex">g</span>      Transport  3909</span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a><span class="ex">h</span>         Energy  8199</span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a><span class="ex">i</span>           Info  5337</span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a><span class="ex">j</span>            Edu  3913</span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a><span class="ex">k</span>            Med  4144</span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a><span class="ex">l</span>          Other  4239</span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a><span class="ex">m</span>       Suervice  3086</span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a><span class="ex">n</span>           AFFC  2190</span></code></pre></div>
<p>ただし,indexは0から始まる連番を利用するのが一般的なので,むやみに文字などにしないほうが良いです. indexに0から始まる連番を振り直すには,<code>.reset_index()</code>メソッドを利用するのが一般的です.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co">#元の連番に戻す</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="co">## ()の中に inplace = True と書くことでdfのindexが変更される</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="co">## inplace=Trueを書かないと変更されません.</span></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a><span class="co">## drop = True と書くことで,変更前に使用していたindexが消去されます.</span></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a><span class="co">## drop = False の場合先ほどのアルファベットが列として残ります.</span></span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>df.reset_index(inplace<span class="op">=</span><span class="va">True</span>,drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<p>実行結果</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>             <span class="ex">Ind</span>   Sal</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction  4503</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing  4756</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale  3186</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    Accomodation  1949</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance  5711</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate  3786</span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport  3909</span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy  8199</span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>            Info  5337</span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu  3913</span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med  4144</span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other  4239</span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice  3086</span></code></pre></div>
<h2 data-number="5.9" id="値の抽出"><span class="header-section-number">5.9</span> 値の抽出</h2>
<p>valuesにアクセスする方法は多数存在し,用途によって使い分けます.</p>
<p>列の指定は,<code>df['列名']</code>あるいは<code>df.列名</code>のように記述することで指定するのが最も単純な方法です.
<code>df</code>の<code>'Ind'</code>列を抽出したい場合には<code>df['Ind']</code>あるいは<code>df.Ind</code>と書きます.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co">#列の指定(Ind列)</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">&#39;Ind&#39;</span>])</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="co">#列の指定(Sal列)</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.Sal)</span></code></pre></div>
<p>実行結果</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>      Construction</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>     Manufacturing</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>         Wholesale</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>      Accomodation</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>           Finance</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>       Real Estate</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>         Transport</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>            Energy</span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>              Info</span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>               Edu</span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>              Med</span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>            Other</span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>         Suervice</span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>             AFFC</span>
<span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Name:</span> Ind, dtype: object</span>
<span id="cb123-16"><a href="#cb123-16" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>     4503</span>
<span id="cb123-17"><a href="#cb123-17" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>     4756</span>
<span id="cb123-18"><a href="#cb123-18" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>     3186</span>
<span id="cb123-19"><a href="#cb123-19" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>     1949</span>
<span id="cb123-20"><a href="#cb123-20" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>     5711</span>
<span id="cb123-21"><a href="#cb123-21" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     3786</span>
<span id="cb123-22"><a href="#cb123-22" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>     3909</span>
<span id="cb123-23"><a href="#cb123-23" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>     8199</span>
<span id="cb123-24"><a href="#cb123-24" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>     5337</span>
<span id="cb123-25"><a href="#cb123-25" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>     3913</span>
<span id="cb123-26"><a href="#cb123-26" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>    4144</span>
<span id="cb123-27"><a href="#cb123-27" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>    4239</span>
<span id="cb123-28"><a href="#cb123-28" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>    3086</span>
<span id="cb123-29"><a href="#cb123-29" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>    2190</span>
<span id="cb123-30"><a href="#cb123-30" aria-hidden="true" tabindex="-1"></a><span class="ex">Name:</span> Sal, dtype: int64</span></code></pre></div>
<p><code>X列の,Y行</code>のように<code>範囲選択</code>したい場合には<code>df.loc[行番号,列名]</code>と書きます.
また,行名,列名それぞれにスライスを利用することでの,<code>X~Y列のV~W行</code>のような指定ができます.
スライスで表せない行名や列名を指定する場合には,それぞれに抜き出したい列や行のリストを渡します.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co">#範囲指定(3行目,&#39;Sal&#39;列)</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.loc[<span class="dv">3</span>,<span class="st">&#39;Sal&#39;</span>])</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a><span class="co">#スライスを利用した範囲指定</span></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.loc[<span class="dv">3</span>:<span class="dv">5</span>,<span class="st">&#39;Ind&#39;</span>:<span class="st">&#39;Sal&#39;</span>])</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a><span class="co">#リストを利用した範囲指定</span></span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.loc[[<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">7</span>],[<span class="st">&#39;Ind&#39;</span>,<span class="st">&#39;Sal&#39;</span>]])</span></code></pre></div>
<p>実行結果</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1949</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>            <span class="ex">Ind</span>   Sal</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>  Accomodation  1949</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>       Finance  5711</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>   Real Estate  3786</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>         <span class="ex">Ind</span>   Sal</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>  Wholesale  3186</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>    Finance  5711</span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>     Energy  8199</span></code></pre></div>
<p>特定の一つのセルにアクセスする場合には<code>loc</code>を利用することもできますが,<code>df.at[行名,列名]</code>を使うほうが高速です.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co">#atによる単独のセルの指定</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.at[<span class="dv">3</span>,<span class="st">&#39;Sal&#39;</span>])</span></code></pre></div>
<p>実行結果</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1949</span></span></code></pre></div>
<p>行名や列名ではなく,行番号,列番号による指定も可能です. 行番号,列番号は行名や列名とは無関係に,0から始まる連番として指定されています.
範囲選択は<code>df.iloc[行番号,列番号]</code>,単独の値は<code>df.iat[行番号,列番号]</code>で行うことができます.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co">#行番号,列番号による範囲指定</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.iloc[<span class="dv">3</span>:<span class="dv">5</span>,<span class="dv">0</span>:])</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="co">#行番号,列番号による単独のセルの指定</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.iat[<span class="dv">3</span>,<span class="dv">1</span>])</span></code></pre></div>
<p>実行結果</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>         <span class="ex">Ind</span>   Sal</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>  Wholesale  3186</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>    Finance  5711</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>     Energy  8199</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a><span class="ex">1949</span></span></code></pre></div>
<div class="note">
<ul>
<li>演習問題</li>
</ul>
<p>以下の画像における範囲①~③を一度に抽出してください.
単独の値を抜き出す際には<code>.at</code>,<code>.iat</code>メソッドを利用しましょう.</p>
<figure>
<img src="/images/pandas-select-practice.png" alt="値の抽出" />
<figcaption aria-hidden="true">値の抽出</figcaption>
</figure>
</div>
<h2 data-number="5.10" id="条件による抽出"><span class="header-section-number">5.10</span> 条件による抽出</h2>
<p>Excelにおけるフィルター機能のように,pandasでも条件による値の抽出が可能です.
pandsでは,DataFrameオブジェクトに,真偽値のリストを渡すと,<code>True</code>の行のみを抜き出すことができます.</p>
<p>以下のコードでは,<code>False</code>と<code>True</code>を交互に繰り返し,奇数行のみを抜き出しています.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co">#真偽値のリストによる抜き出し</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>bools <span class="op">=</span> [<span class="va">False</span>,<span class="va">True</span>] <span class="op">*</span> <span class="dv">7</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(bools)</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[bools])</span></code></pre></div>
<p>実行結果</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="ex">[False,</span> True, False, True, False, True, False, True, False, True, False, True, False, True]</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>              <span class="ex">Ind</span>   Sal</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing  4756</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    Accomodation  1949</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate  3786</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy  8199</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu  3913</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other  4239</span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC  2190</span></code></pre></div>
<p>DataFrameオブジェクトに対して,真偽値計算をすると,各行に対する真偽値計算の結果が帰ってきます.
以下のコードでは,Salaryが3000以上の行のみ<code>True</code>の値が帰ってきているのが確認できます.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co">#DataFrameオブジェクトに対する論理演算</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">&#39;Sal&#39;</span>])</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">&#39;Sal&#39;</span>] <span class="op">&gt;=</span> <span class="dv">3000</span>)</span></code></pre></div>
<p>実行結果</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>     4503</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>     4756</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>     3186</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>     1949</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>     5711</span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     3786</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>     3909</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>     8199</span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>     5337</span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>     3913</span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>    4144</span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>    4239</span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>    3086</span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>    2190</span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Name:</span> Sal, dtype: int64</span>
<span id="cb133-16"><a href="#cb133-16" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>      True</span>
<span id="cb133-17"><a href="#cb133-17" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>      True</span>
<span id="cb133-18"><a href="#cb133-18" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>      True</span>
<span id="cb133-19"><a href="#cb133-19" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>     False</span>
<span id="cb133-20"><a href="#cb133-20" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>      True</span>
<span id="cb133-21"><a href="#cb133-21" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>      True</span>
<span id="cb133-22"><a href="#cb133-22" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>      True</span>
<span id="cb133-23"><a href="#cb133-23" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>      True</span>
<span id="cb133-24"><a href="#cb133-24" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>      True</span>
<span id="cb133-25"><a href="#cb133-25" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>      True</span>
<span id="cb133-26"><a href="#cb133-26" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>     True</span>
<span id="cb133-27"><a href="#cb133-27" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>     True</span>
<span id="cb133-28"><a href="#cb133-28" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>     True</span>
<span id="cb133-29"><a href="#cb133-29" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>    False</span>
<span id="cb133-30"><a href="#cb133-30" aria-hidden="true" tabindex="-1"></a><span class="ex">Name:</span> Sal, dtype: bool</span></code></pre></div>
<p>この<strong>①BoolのリストをDataFrameに渡すとTrueの行が返ってくる</strong>,<strong>②DataFrameに論理演算を行うとBoolのリストが返ってくる</strong>という機能の2つを組み合わせて,条件抽出を行うことができます.
例えば,<code>Sal列</code>から3000以上の行のみを抜き出すには以下のように書きます.</p>
<p>1行のプログラムですが,いくつかの機能を組み合わせているので,どの部分で何が起きているのかを分解して理解するようにしましょう.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co">#DataFrameオブジェクトに対する条件抽出</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[df[<span class="st">&#39;Sal&#39;</span>] <span class="op">&gt;=</span> <span class="dv">3000</span>][<span class="st">&#39;Sal&#39;</span>])</span></code></pre></div>
<p>実行結果</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Name:</span> Sal, dtype: bool</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>     4503</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>     4756</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>     3186</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>     5711</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     3786</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>     3909</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>     8199</span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>     5337</span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>     3913</span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>    4144</span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>    4239</span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>    3086</span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a><span class="ex">Name:</span> Sal, dtype: int64</span></code></pre></div>
<div class="note">
<ul>
<li>演習</li>
</ul>
<p>Salary.csvから以下の条件に従った抽出を行ってください.</p>
<ol type="1">
<li><p><code>Sal列</code>が偶数の<code>Sal列</code>の行</p></li>
<li><p><code>Sal列</code>が奇数の<code>Ind列</code>の行</p></li>
<li><p><code>Ind列</code>が<code>Info</code>,<code>Edu</code>のいずれかで,<code>Sal列</code>が<code>4000以上</code>の<code>Sal列</code></p></li>
</ol>
</div>
<h2 data-number="5.11" id="値の変更"><span class="header-section-number">5.11</span> 値の変更</h2>
<p>DataFrameでは選択したセルなどに<code>=</code>を利用して代入することで,値の更新が可能です.
以下のコードで,どの部分が変更されているか,コードと結果の対応関係を見てみましょう.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>df.at[<span class="dv">1</span>,<span class="st">&#39;Sal&#39;</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<p>実行結果</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>              <span class="ex">Ind</span>   Sal</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction  4503</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing  4756</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale  3186</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    Accomodation  1949</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance  5711</span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate  3786</span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport  3909</span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy  8199</span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>            Info  5337</span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu  3913</span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med  4144</span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other  4239</span>
<span id="cb137-14"><a href="#cb137-14" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice  3086</span>
<span id="cb137-15"><a href="#cb137-15" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC  2190</span>
<span id="cb137-16"><a href="#cb137-16" aria-hidden="true" tabindex="-1"></a>              <span class="ex">Ind</span>   Sal</span>
<span id="cb137-17"><a href="#cb137-17" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction  4503</span>
<span id="cb137-18"><a href="#cb137-18" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing     0</span>
<span id="cb137-19"><a href="#cb137-19" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale  3186</span>
<span id="cb137-20"><a href="#cb137-20" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    Accomodation  1949</span>
<span id="cb137-21"><a href="#cb137-21" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance  5711</span>
<span id="cb137-22"><a href="#cb137-22" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate  3786</span>
<span id="cb137-23"><a href="#cb137-23" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport  3909</span>
<span id="cb137-24"><a href="#cb137-24" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy  8199</span>
<span id="cb137-25"><a href="#cb137-25" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>            Info  5337</span>
<span id="cb137-26"><a href="#cb137-26" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu  3913</span>
<span id="cb137-27"><a href="#cb137-27" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med  4144</span>
<span id="cb137-28"><a href="#cb137-28" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other  4239</span>
<span id="cb137-29"><a href="#cb137-29" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice  3086</span>
<span id="cb137-30"><a href="#cb137-30" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC  2190</span></code></pre></div>
<p>範囲の変更は,同じ形のリストを渡すことで可能です.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co">#範囲の変更</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="dv">3</span>:<span class="dv">5</span>,<span class="st">&#39;Sal&#39;</span>] <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<div class="sourceCode" id="cb139"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>              <span class="ex">Ind</span>   Sal</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction  4503</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing     0</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale  3186</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    Accomodation     1</span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance     2</span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate     3</span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport  3909</span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy  8199</span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>            Info  5337</span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu  3913</span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med  4144</span>
<span id="cb139-13"><a href="#cb139-13" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other  4239</span>
<span id="cb139-14"><a href="#cb139-14" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice  3086</span>
<span id="cb139-15"><a href="#cb139-15" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC  2190</span></code></pre></div>
<p>リストではなく,単一の値を渡すと一括で変更されます.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co">#一括変更</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="dv">3</span>:<span class="dv">5</span>,<span class="st">&#39;Sal&#39;</span>] <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<div class="sourceCode" id="cb141"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>              <span class="ex">Ind</span>   Sal</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction  4503</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing     0</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale  3186</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    Accomodation     4</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance     4</span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate     4</span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport  3909</span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy  8199</span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>            Info  5337</span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu  3913</span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med  4144</span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other  4239</span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice  3086</span>
<span id="cb141-15"><a href="#cb141-15" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC  2190</span></code></pre></div>
<div class="sourceCode" id="cb142"><pre class="sourceCode py"><code class="sourceCode python"></code></pre></div>
<div class="warn">
<ul>
<li>配列のコピーと変更</li>
</ul>
<p>リストの節でも説明しましたが,pandasのDataFrameは,別の変数に代入して,そのDataFrameの値を変更すると<strong>元のDataFrameの値も変更されます.</strong></p>
<div class="sourceCode" id="cb143"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>df2[<span class="st">&#39;Sal&#39;</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;df --- </span><span class="ch">\n</span><span class="st">&#39;</span>,df)</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;df2 --- </span><span class="ch">\n</span><span class="st">&#39;</span>, df2)</span></code></pre></div>
<p><code>df</code>を<code>df2</code>に代入して,<code>df2</code>の値を変更すると,元の<code>df</code>の値も変更されていることが確認できます.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">df</span> <span class="at">---</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>               <span class="ex">Ind</span>  Sal</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction    0</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing    0</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale    0</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    Accomodation    0</span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance    0</span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate    0</span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport    0</span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy    0</span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>            Info    0</span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu    0</span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med    0</span>
<span id="cb144-14"><a href="#cb144-14" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other    0</span>
<span id="cb144-15"><a href="#cb144-15" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice    0</span>
<span id="cb144-16"><a href="#cb144-16" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC    0</span>
<span id="cb144-17"><a href="#cb144-17" aria-hidden="true" tabindex="-1"></a><span class="ex">df2</span> <span class="at">---</span></span>
<span id="cb144-18"><a href="#cb144-18" aria-hidden="true" tabindex="-1"></a>               <span class="ex">Ind</span>  Sal</span>
<span id="cb144-19"><a href="#cb144-19" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction    0</span>
<span id="cb144-20"><a href="#cb144-20" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing    0</span>
<span id="cb144-21"><a href="#cb144-21" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale    0</span>
<span id="cb144-22"><a href="#cb144-22" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    Accomodation    0</span>
<span id="cb144-23"><a href="#cb144-23" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance    0</span>
<span id="cb144-24"><a href="#cb144-24" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate    0</span>
<span id="cb144-25"><a href="#cb144-25" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport    0</span>
<span id="cb144-26"><a href="#cb144-26" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy    0</span>
<span id="cb144-27"><a href="#cb144-27" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>            Info    0</span>
<span id="cb144-28"><a href="#cb144-28" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu    0</span>
<span id="cb144-29"><a href="#cb144-29" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med    0</span>
<span id="cb144-30"><a href="#cb144-30" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other    0</span>
<span id="cb144-31"><a href="#cb144-31" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice    0</span>
<span id="cb144-32"><a href="#cb144-32" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC    0</span></code></pre></div>
<p>これは割り当てられるメモリの大きなDataFrameを効率的に利用するための仕様ですが,仕様を理解していないと思わぬ結果となるので注意してください.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;id df:&#39;</span>,<span class="bu">id</span>(df))</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;id df2:&#39;</span>,<span class="bu">id</span>(df2))</span></code></pre></div>
<p>実行結果</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">id</span> df: 5013939024</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="fu">id</span> df2: 5013939024</span></code></pre></div>
<p>大きなデータを扱う際に,部分的に抜き出したデータに編集を加えて,元のデータを変更したくない場合があります.そのような場合には,<code>.copy()</code>メソッドを利用します.<code>.copy()</code>メソッドを利用することで,元のデータとは異なるメモリが割り当てられます.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co">#元のDataFrameを保つコピー</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="co">## 一度変更を元に戻す</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;data/salary.csv&#39;</span>)</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>df.columns <span class="op">=</span> [<span class="st">&#39;Ind&#39;</span>,<span class="st">&#39;Sal&#39;</span>]</span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df.copy()</span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>df2[<span class="st">&#39;Sal&#39;</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;df --- </span><span class="ch">\n</span><span class="st">&#39;</span>,df)</span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;df2 --- </span><span class="ch">\n</span><span class="st">&#39;</span>, df2)</span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;id df:&#39;</span>,<span class="bu">id</span>(df))</span>
<span id="cb147-11"><a href="#cb147-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;id df2:&#39;</span>,<span class="bu">id</span>(df2))</span></code></pre></div>
<p>実行結果</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">df</span> <span class="at">---</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>               <span class="ex">Ind</span>   Sal</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction  4503</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing  4756</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale  3186</span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    Accomodation  1949</span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance  5711</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate  3786</span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport  3909</span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy  8199</span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>            Info  5337</span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu  3913</span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med  4144</span>
<span id="cb148-14"><a href="#cb148-14" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other  4239</span>
<span id="cb148-15"><a href="#cb148-15" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice  3086</span>
<span id="cb148-16"><a href="#cb148-16" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC  2190</span>
<span id="cb148-17"><a href="#cb148-17" aria-hidden="true" tabindex="-1"></a><span class="ex">df2</span> <span class="at">---</span></span>
<span id="cb148-18"><a href="#cb148-18" aria-hidden="true" tabindex="-1"></a>               <span class="ex">Ind</span>  Sal</span>
<span id="cb148-19"><a href="#cb148-19" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction    0</span>
<span id="cb148-20"><a href="#cb148-20" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing    0</span>
<span id="cb148-21"><a href="#cb148-21" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale    0</span>
<span id="cb148-22"><a href="#cb148-22" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    Accomodation    0</span>
<span id="cb148-23"><a href="#cb148-23" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance    0</span>
<span id="cb148-24"><a href="#cb148-24" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate    0</span>
<span id="cb148-25"><a href="#cb148-25" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport    0</span>
<span id="cb148-26"><a href="#cb148-26" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy    0</span>
<span id="cb148-27"><a href="#cb148-27" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>            Info    0</span>
<span id="cb148-28"><a href="#cb148-28" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu    0</span>
<span id="cb148-29"><a href="#cb148-29" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med    0</span>
<span id="cb148-30"><a href="#cb148-30" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other    0</span>
<span id="cb148-31"><a href="#cb148-31" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice    0</span>
<span id="cb148-32"><a href="#cb148-32" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC    0</span>
<span id="cb148-33"><a href="#cb148-33" aria-hidden="true" tabindex="-1"></a><span class="fu">id</span> df: 5013945696</span>
<span id="cb148-34"><a href="#cb148-34" aria-hidden="true" tabindex="-1"></a><span class="fu">id</span> df2: 4559223920</span></code></pre></div>
</div>
<div class="note">
<ul>
<li>演習</li>
</ul>
<p>作成したsaraly.csvを読み込み,以下の処理を順に行ってください.</p>
<ol type="1">
<li><p>columnsを日本語(産業,給与)に変更してください.</p></li>
<li><p>サービス業だと思われる行のみを抽出して,<code>.copy()</code>してください.</p></li>
<li><p>コピーされたDataFrameに0から始まるインデックスを振り直してください.</p></li>
<li><p>元のDataFrameとコピーされたデータフレームの中身とidを確認してください.</p></li>
</ol>
</div>
<h2 data-number="5.12" id="データ型の確認と変更"><span class="header-section-number">5.12</span> データ型の確認と変更</h2>
<p>pandasでデータを読み込むと列ごとに自動でデータ型が推論,設定されます. pandasのDataFrameにおけるデータ型(<code>dtype</code>)はこれまでに見てきたpythonの標準的なデータ型(<code>type</code>)とは異なるものですが,同じ名前でも変更が可能です. ただし,<code>str</code>型だけ扱いが特殊なので注意が必要です.</p>
<p>pandasの列ごとのデータ型を確認するには,<code>.dtypes</code>を利用します.
<code>type</code>の<code>int</code>に対応する<code>dtype</code>は<code>int64</code>,<code>float</code>は<code>float64</code>と表示されます. <code>str</code>型は,<code>object</code>型になりますがそれぞれの要素は<code>str</code>型です.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;DataFrameのデータ型:</span><span class="ch">\n</span><span class="st">&#39;</span>,df.dtypes)</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Sal列のデータ型:&#39;</span>,df[<span class="st">&#39;Sal&#39;</span>].dtypes)</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Ind列のデータ型:&#39;</span>,df[<span class="st">&#39;Ind&#39;</span>].dtypes)</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Ind列の要素のデータ型:&#39;</span>,<span class="bu">type</span>(df.at[<span class="dv">0</span>,<span class="st">&#39;Ind&#39;</span>]))</span></code></pre></div>
<div class="sourceCode" id="cb150"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="ex">DataFrameのデータ型:</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a> <span class="ex">Ind</span>    object</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Sal</span>     int64</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="ex">dtype:</span> object</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Sal列のデータ型:</span> int64</span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Ind列のデータ型:</span> object</span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Ind列の要素のデータ型:</span> <span class="op">&lt;</span>class <span class="st">&#39;str&#39;</span><span class="op">&gt;</span></span></code></pre></div>
<p><code>.astype()</code>メソッドでデータ型を変更することができます. 元の列に代入する形で変更しましょう.
今回は,<code>Sal</code>列を<code>int型</code>から<code>float型</code>に変更します.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co">#データ型の変更</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Sal&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;Sal&#39;</span>].astype(<span class="bu">float</span>)</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Sal列のデータ型:&#39;</span>,df[<span class="st">&#39;Sal&#39;</span>].dtypes)</span></code></pre></div>
<div class="sourceCode" id="cb152"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Sal列のデータ型:float64</span></span></code></pre></div>
<p>データを読み込む際に,<code>dtyp=列名とデータ型の辞書</code>を記述することで,データ型を指定することも可能です.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co">#読み込み時のデータ型の指定</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;data/salary.csv&#39;</span></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>                ,dtype <span class="op">=</span> {<span class="st">&#39;Industry&#39;</span>:<span class="bu">str</span></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>                         ,<span class="st">&#39;Salary&#39;</span>:<span class="bu">float</span>})</span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>df.columns <span class="op">=</span> [<span class="st">&#39;Ind&#39;</span>,<span class="st">&#39;Sal&#39;</span>]</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.dtypes)</span></code></pre></div>
<div class="sourceCode" id="cb154"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Ind</span>     object</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Sal</span>    float64</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a><span class="ex">dtype:</span> object</span></code></pre></div>
<h2 data-number="5.13" id="dataframeの作成"><span class="header-section-number">5.13</span> DataFrameの作成</h2>
<p>これまでは,<code>salary.csv</code>を読み込んでDataFrameとして編集してきましたが,プログラム内で新たなDataFrameを作成することも可能です.</p>
<p>新たなDataFrameを作成するためには,<code>pd.DataFrame()メソッド</code>を利用します.丸括弧内には, <code>data</code>, <code>index</code>, <code>columns</code>を設定する必要があります. ただし, <code>index</code>と<code>columns</code>は省略可能です.
<code>data</code>には,必要な<code>行×列の多次元リスト</code>, <code>index</code>と<code>columns</code>には1次元のリストを渡します.</p>
<p>以下の表のようなDataFrameを作成するコードは次のようになります.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co">#DataFrameのvalues部分をリストで作成する</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="co">## 行のリストになっていることに注意</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a><span class="co">#DataFrameのvalues部分をリストで作成する</span></span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 行のリストになっていることに注意</span></span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> [[<span class="st">&#39;dog&#39;</span>,<span class="fl">5.0</span>,<span class="fl">60.0</span>]</span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a>         ,[<span class="st">&#39;cat&#39;</span>,<span class="fl">3.0</span>,<span class="fl">30.0</span>]</span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a>         ,[<span class="st">&#39;fish&#39;</span>,<span class="fl">0.15</span>,<span class="fl">0.5</span>]]</span>
<span id="cb155-9"><a href="#cb155-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-10"><a href="#cb155-10" aria-hidden="true" tabindex="-1"></a><span class="co">#DataFrameの作成</span></span>
<span id="cb155-11"><a href="#cb155-11" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>values</span>
<span id="cb155-12"><a href="#cb155-12" aria-hidden="true" tabindex="-1"></a>                 ,columns<span class="op">=</span>[<span class="st">&#39;animal_kind&#39;</span></span>
<span id="cb155-13"><a href="#cb155-13" aria-hidden="true" tabindex="-1"></a>                          ,<span class="st">&#39;weight&#39;</span></span>
<span id="cb155-14"><a href="#cb155-14" aria-hidden="true" tabindex="-1"></a>                          ,<span class="st">&#39;size&#39;</span>])</span>
<span id="cb155-15"><a href="#cb155-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<div class="sourceCode" id="cb156"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>  <span class="ex">animal_kind</span>  weight  size</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>         dog    5.00  60.0</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>         cat    3.00  30.0</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>        fish    0.15   0.5</span></code></pre></div>
<div class="warn">
<p>行のリストよりも列のリストを渡すほうがデータ型が統一されており簡単です.
そのような場合には,数値計算用ライブラリ<code>numpy</code>の<code>.T</code>を利用して,転置行列を渡します.
Shell上で<code>pip install numpy</code>を実行して, <code>numpy</code>をinstallしたのち,<code>import numpy as np</code>と記述して
<code>numpy</code>をプログラムで利用しましょう.</p>
<p><code>numpy</code>では,ndarray配列というデータ型を利用します.そのため,<code>np.array()</code>メソッドで一度<code>ndarray</code>に変換し,
<code>.T</code>によって転置した配列を<code>.tolist()</code>メソッドでリストに戻しています.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co">#転置行列によるデータの作成</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>animal_kinds <span class="op">=</span> [<span class="st">&#39;dog&#39;</span>,<span class="st">&#39;cat&#39;</span>,<span class="st">&#39;fish&#39;</span>]</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>weights  <span class="op">=</span> [<span class="fl">5.0</span>,<span class="fl">6.0</span>,<span class="fl">0.15</span>]</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>sizes    <span class="op">=</span> [<span class="fl">60.0</span>,<span class="fl">30.0</span>,<span class="fl">0.5</span>]</span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> np.array([animal_kinds</span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>                 ,weights</span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a>                 ,sizes]).T.tolist()</span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>values</span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a>                 ,columns<span class="op">=</span>[<span class="st">&#39;animal_kind&#39;</span></span>
<span id="cb157-13"><a href="#cb157-13" aria-hidden="true" tabindex="-1"></a>                          ,<span class="st">&#39;weight&#39;</span></span>
<span id="cb157-14"><a href="#cb157-14" aria-hidden="true" tabindex="-1"></a>                          ,<span class="st">&#39;size&#39;</span>])</span>
<span id="cb157-15"><a href="#cb157-15" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;weight&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;weight&#39;</span>].astype(<span class="bu">float</span>)</span>
<span id="cb157-16"><a href="#cb157-16" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;size&#39;</span>]   <span class="op">=</span> df[<span class="st">&#39;size&#39;</span>].astype(<span class="bu">float</span>)</span>
<span id="cb157-17"><a href="#cb157-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<p>実行結果</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>  <span class="ex">animal_kind</span> weight  size</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>         dog    5.0  60.0</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>         cat    6.0  30.0</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>        fish   0.15   0.5</span></code></pre></div>
</div>
<p>また,列名を<code>key</code>その列のリストを<code>value</code>とした辞書型によって<code>DataFrame</code>を作成することも可能です.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">&#39;animal_kind&#39;</span>:[<span class="st">&#39;dog&#39;</span>,<span class="st">&#39;cat&#39;</span>,<span class="st">&#39;fisg&#39;</span>]</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>                  ,<span class="st">&#39;weight&#39;</span>:[<span class="fl">5.0</span>,<span class="fl">6.0</span>,<span class="fl">0.15</span>]</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>                  ,<span class="st">&#39;size&#39;</span>:[<span class="fl">60.0</span>,<span class="fl">30.0</span>,<span class="fl">0.5</span>]})</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<p>実行結果</p>
<pre><code>  animal_kind weight  size
0         dog    5.0  60.0
1         cat    6.0  30.0
2        fish   0.15   0.5</code></pre>
<div class="note">
<ul>
<li>演習</li>
</ul>
<p>以下の<code>data</code>をもつDataFrameを作成し,<code>age</code>列を<code>float64</code>に変更しましょう.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">name</th>
<th style="text-align: center;">age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Taro</td>
<td style="text-align: center;">20</td>
</tr>
<tr class="even">
<td style="text-align: center;">Jiro</td>
<td style="text-align: center;">30</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Hanako</td>
<td style="text-align: center;">40</td>
</tr>
</tbody>
</table>
</div>
<h2 data-number="5.14" id="データの追加と削除"><span class="header-section-number">5.14</span> データの追加と削除</h2>
<p>列や行の追加には<code>.assine()</code>や<code>.insert()</code>,<code>.append()</code>などが利用可能ですがここでは分かりやすく代入を利用する方法を紹介します.</p>
<p><code>df[新規列名]=新しい列</code>,のようにDataFrameに新しい列を代入することで列の追加が可能です.行の追加は<code>df.loc[追加したいindex] = 新しい行</code>で行えます.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co">#データの追加</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a><span class="co">#列の追加</span></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;追加前:</span><span class="ch">\n</span><span class="st">&#39;</span>,df)</span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;name&#39;</span>] <span class="op">=</span> [<span class="st">&#39;pochi&#39;</span>,<span class="st">&#39;tama&#39;</span>,<span class="st">&#39;kintaro&#39;</span>]</span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;列の追加:</span><span class="ch">\n</span><span class="st">&#39;</span>,df)</span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="dv">4</span>] <span class="op">=</span> [<span class="st">&#39;bird&#39;</span>,<span class="fl">1.0</span>,<span class="dv">3</span>,<span class="st">&#39;piyo&#39;</span>]</span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;行の追加:</span><span class="ch">\n</span><span class="st">&#39;</span>,df)</span></code></pre></div>
<div class="sourceCode" id="cb162"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="ex">追加前:</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>   <span class="ex">animal_kind</span> weight  size</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>         dog    5.0  60.0</span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>         cat    6.0  30.0</span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>        fish   0.15   0.5</span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a><span class="ex">列の追加:</span></span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>   <span class="ex">animal_kind</span> weight  size     name</span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>         dog    5.0  60.0    pochi</span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>         cat    6.0  30.0     tama</span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>        fish   0.15   0.5  kintaro</span>
<span id="cb162-11"><a href="#cb162-11" aria-hidden="true" tabindex="-1"></a><span class="ex">行の追加:</span></span>
<span id="cb162-12"><a href="#cb162-12" aria-hidden="true" tabindex="-1"></a>   <span class="ex">animal_kind</span> weight  size     name</span>
<span id="cb162-13"><a href="#cb162-13" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>         dog    5.0  60.0    pochi</span>
<span id="cb162-14"><a href="#cb162-14" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>         cat    6.0  30.0     tama</span>
<span id="cb162-15"><a href="#cb162-15" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>        fish   0.15   0.5  kintaro</span>
<span id="cb162-16"><a href="#cb162-16" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>        bird    1.0     3     piyo</span></code></pre></div>
<p>特定の列の値を利用して計算された新たな列を作成することも可能です.ここでは,<code>size</code>あたりの<code>weight</code>を計算してみます. 列を用いた計算では各行の値が計算されます.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co">#列を利用した計算</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;density&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;weight&#39;</span>] <span class="op">/</span> df[<span class="st">&#39;size&#39;</span>]</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<div class="sourceCode" id="cb164"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>  <span class="ex">animal_kind</span>  weight  size     name   density</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>         dog    5.00  60.0    pochi  0.083333</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>         cat    6.00  30.0     tama  0.200000</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>        fish    0.15   0.5  kintaro  0.300000</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>        bird    1.00   3.0     piyo  0.333333</span></code></pre></div>
<p>列や行を削除するには<code>.drop(行名 or 列名, axis= 0/1 )</code>を利用します.行を削除する場合は<code>axis=0</code>,列を削除する場合には<code>axis=1</code>と書きます. <code>axis='column'</code>,<code>axis='index'</code>でも行と列を選択することができます.
<code>inplace = True</code> を設定すると元のDataFrameが変更されますが,設定しないと新しいDataFrameが返され,元のDataFrameは変更されません.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co">#列の削除</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>df.drop(<span class="st">&#39;name&#39;</span></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>       ,axis<span class="op">=</span><span class="st">&#39;columns&#39;</span> <span class="co"># or axis = 1</span></span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>       ,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a><span class="co">#行の削除</span></span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a>df.drop(<span class="dv">4</span></span>
<span id="cb165-9"><a href="#cb165-9" aria-hidden="true" tabindex="-1"></a>       ,axis<span class="op">=</span><span class="st">&#39;index&#39;</span> <span class="co"># or axis = 0</span></span>
<span id="cb165-10"><a href="#cb165-10" aria-hidden="true" tabindex="-1"></a>       ,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb165-11"><a href="#cb165-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<div class="sourceCode" id="cb166"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a> <span class="ex">animal_kind</span>  weight  size   density</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>         dog    5.00  60.0  0.083333</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>         cat    6.00  30.0  0.200000</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>        fish    0.15   0.5  0.300000</span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>        bird    1.00   3.0  0.333333</span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>  <span class="ex">animal_kind</span>  weight  size   density</span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>         dog    5.00  60.0  0.083333</span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>         cat    6.00  30.0  0.200000</span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>        fish    0.15   0.5  0.300000</span></code></pre></div>
<p>行名や列名にリストを指定すると,複数行/列が削除されます.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co">#複数行の削除</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.drop([<span class="st">&#39;weight&#39;</span>,<span class="st">&#39;size&#39;</span>,<span class="st">&#39;density&#39;</span>],axis<span class="op">=</span><span class="dv">1</span>))</span></code></pre></div>
<div class="sourceCode" id="cb168"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>  <span class="ex">animal_kind</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>         dog</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>         cat</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>        fish</span></code></pre></div>
<h2 data-number="5.15" id="欠損値の処理"><span class="header-section-number">5.15</span> 欠損値の処理</h2>
<p>例えば特定の日だけ値を入力し忘れている出勤簿や授業をサボった学生の成績など,現実のデータには抜けや欠損が付き物です. 抜けや欠損の無いデータを<strong>完備データ</strong>といい,欠損している部分を<strong>欠損値</strong>といいます.</p>
<p>pandasでは,csvの空白, 作成時の未定義部分 などが欠損値<code>NaN</code>(Not a Number) として表現されます.</p>
<p>例えば,DataFrame作成時にvaluesのサイズが合わない場合にはデータのない部分が<code>NaN</code>となります.
また,以下のように空白のあるCSVを読み込んだ場合には空白のセルが<code>NaN</code>となります.</p>
<figure>
<img src="/images/salary_nan.png" alt="salary_nan.cav" />
<figcaption aria-hidden="true">salary_nan.cav</figcaption>
</figure>
<div class="sourceCode" id="cb169"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co">#DataFrameの作成</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data <span class="op">=</span> [[<span class="st">&#39;dog&#39;</span>,<span class="dv">5</span>,<span class="dv">60</span>]</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>                         ,[<span class="st">&#39;cat&#39;</span>,<span class="dv">30</span>]</span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>                         ,[<span class="st">&#39;fish&#39;</span>,<span class="fl">0.15</span>]]</span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>                  ,columns<span class="op">=</span>[<span class="st">&#39;animal_kind&#39;</span></span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>                          ,<span class="st">&#39;weight&#39;</span></span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>                          ,<span class="st">&#39;size&#39;</span>])</span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a><span class="co">#かけたデータの読み込み</span></span>
<span id="cb169-12"><a href="#cb169-12" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;data/salary_nan.csv&#39;</span>)</span>
<span id="cb169-13"><a href="#cb169-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;-----</span><span class="ch">\n</span><span class="st">&#39;</span>,df)</span></code></pre></div>
<div class="sourceCode" id="cb170"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>  <span class="ex">animal_kind</span>  weight  size</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>         dog    5.00  60.0</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>         cat   30.00   NaN</span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>        fish    0.15   NaN</span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a><span class="ex">-----</span></span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>          <span class="ex">Industry</span>  Salary</span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction  4503.0</span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing  4756.0</span>
<span id="cb170-9"><a href="#cb170-9" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale  3186.0</span>
<span id="cb170-10"><a href="#cb170-10" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>   Accommodation     NaN</span>
<span id="cb170-11"><a href="#cb170-11" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance  5711.0</span>
<span id="cb170-12"><a href="#cb170-12" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate  3786.0</span>
<span id="cb170-13"><a href="#cb170-13" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport  3909.0</span>
<span id="cb170-14"><a href="#cb170-14" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy  8199.0</span>
<span id="cb170-15"><a href="#cb170-15" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>            Info     NaN</span>
<span id="cb170-16"><a href="#cb170-16" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu  3913.0</span>
<span id="cb170-17"><a href="#cb170-17" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med  4144.0</span>
<span id="cb170-18"><a href="#cb170-18" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other     NaN</span>
<span id="cb170-19"><a href="#cb170-19" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice  3086.0</span>
<span id="cb170-20"><a href="#cb170-20" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC  2190.0</span></code></pre></div>
<p><code>NaN</code>はすべての値に対して,<code>==</code>で<code>True</code>,<code>!=</code>で<code>False</code>を返すため,欠損値か否かの判定には,<code>==</code>や<code>!=</code>を使うことはできません. なお,<code>float('NaN')</code>で<code>float</code>型の<code>NaN</code>を生成できます.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;data/salary_nan.csv&#39;</span>)</span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.at[<span class="dv">8</span>,<span class="st">&#39;Salary&#39;</span>])</span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;NaN == 1:&#39;</span>,df.at[<span class="dv">8</span>,<span class="st">&#39;Salary&#39;</span>] <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;NaN == NaN:&#39;</span>,df.at[<span class="dv">8</span>,<span class="st">&#39;Salary&#39;</span>] <span class="op">==</span> <span class="bu">float</span>(<span class="st">&#39;NaN&#39;</span>))</span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;NaN != 1:&#39;</span>,df.at[<span class="dv">8</span>,<span class="st">&#39;Salary&#39;</span>] <span class="op">!=</span> <span class="dv">1</span>)</span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;NaN != NaN:&#39;</span>,df.at[<span class="dv">8</span>,<span class="st">&#39;Salary&#39;</span>] <span class="op">==</span> <span class="bu">float</span>(<span class="st">&#39;NaN&#39;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb172"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nan</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a><span class="ex">NaN</span> == 1: False</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a><span class="ex">NaN</span> == NaN: False</span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a><span class="ex">NaN</span> != 1: True</span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a><span class="ex">NaN</span> != NaN: False</span></code></pre></div>
<p>欠損値の判定には<code>isna()</code>メソッドを利用します.DataFrameに利用することで<code>NaN</code>のあるセルにはTrue,<code>NaN</code>以外のセルに<code>False</code>を返します.また,<code>pd.isna(値)</code>の形で,値の判定も可能です.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;data/salary_nan.csv&#39;</span>)</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.isna())</span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.isna(df.at[<span class="dv">8</span>,<span class="st">&#39;Salary&#39;</span>]))</span></code></pre></div>
<div class="sourceCode" id="cb174"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Industry</span>  Salary</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>      False   False</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>      False   False</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>      False   False</span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>      False    True</span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>      False   False</span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>      False   False</span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>      False   False</span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>      False   False</span>
<span id="cb174-10"><a href="#cb174-10" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>      False    True</span>
<span id="cb174-11"><a href="#cb174-11" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>      False   False</span>
<span id="cb174-12"><a href="#cb174-12" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>     False   False</span>
<span id="cb174-13"><a href="#cb174-13" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>     False    True</span>
<span id="cb174-14"><a href="#cb174-14" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>     False   False</span>
<span id="cb174-15"><a href="#cb174-15" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>     False   False</span>
<span id="cb174-16"><a href="#cb174-16" aria-hidden="true" tabindex="-1"></a><span class="ex">True</span></span></code></pre></div>
<p>欠損のあるデータを分析する際には,欠損値をどのように処理するかを決める必要があります.
欠損値の処理の方法には<strong>除外</strong>, <strong>置換</strong>, <strong>補定(ほてい)</strong>,<strong>補完</strong>などいくつかの方法があり,pandasにおいても
<code>dropna()</code>,<code>fillna()</code>などのメソッドが提供されています.</p>
<p>元も単純な欠損値の処理方法は,欠損値のある行や列を除外してしまうことです. pandasにおいて欠損値の除外行うメソッドは<code>dropna()</code>です.</p>
<p><code>df.dropna(subset=除外したい列名のリスト,how=‘any’,inplace=True)</code>と記述することで
指定された列においてNaNの含まれる行の削除ができます.
<code>subset</code>を指定しないと,すべての列が対象となります.
<code>how ='any'</code>と指定すると, subsetに含まれる列のどれか, <code>how='all'</code>にすると, subsetに含まれる列の全てがNaNの場合にその行が削除されます.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co">#欠損値の削除</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.dropna(subset<span class="op">=</span>[<span class="st">&#39;Salary&#39;</span>],how<span class="op">=</span><span class="st">&#39;any&#39;</span>))</span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;---</span><span class="ch">\n</span><span class="st">&#39;</span>,df)</span></code></pre></div>
<div class="sourceCode" id="cb176"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>         <span class="ex">Industry</span>  Salary</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction  4503.0</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing  4756.0</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale  3186.0</span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance  5711.0</span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate  3786.0</span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport  3909.0</span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy  8199.0</span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu  3913.0</span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med  4144.0</span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice  3086.0</span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC  2190.0</span>
<span id="cb176-13"><a href="#cb176-13" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span></span>
<span id="cb176-14"><a href="#cb176-14" aria-hidden="true" tabindex="-1"></a>         <span class="ex">Industry</span>  Salary</span>
<span id="cb176-15"><a href="#cb176-15" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction  4503.0</span>
<span id="cb176-16"><a href="#cb176-16" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing  4756.0</span>
<span id="cb176-17"><a href="#cb176-17" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale  3186.0</span>
<span id="cb176-18"><a href="#cb176-18" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>   Accommodation     NaN</span>
<span id="cb176-19"><a href="#cb176-19" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance  5711.0</span>
<span id="cb176-20"><a href="#cb176-20" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate  3786.0</span>
<span id="cb176-21"><a href="#cb176-21" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport  3909.0</span>
<span id="cb176-22"><a href="#cb176-22" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy  8199.0</span>
<span id="cb176-23"><a href="#cb176-23" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>            Info     NaN</span>
<span id="cb176-24"><a href="#cb176-24" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu  3913.0</span>
<span id="cb176-25"><a href="#cb176-25" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med  4144.0</span>
<span id="cb176-26"><a href="#cb176-26" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>          Other     NaN</span>
<span id="cb176-27"><a href="#cb176-27" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice  3086.0</span>
<span id="cb176-28"><a href="#cb176-28" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC  2190.0</span></code></pre></div>
<p>inplace = True と設定するともとのDataFrameが変更されますが Falseに設定すると, もとのDataFrameには反映されません.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>df.dropna(subset<span class="op">=</span>[<span class="st">&#39;Salary&#39;</span>]</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>         ,how<span class="op">=</span><span class="st">&#39;any&#39;</span></span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>         ,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<div class="sourceCode" id="cb178"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>         <span class="ex">Industry</span>  Salary</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    Construction  4503.0</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   Manufacturing  4756.0</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       Wholesale  3186.0</span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>         Finance  5711.0</span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     Real Estate  3786.0</span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       Transport  3909.0</span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>          Energy  8199.0</span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>             Edu  3913.0</span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>            Med  4144.0</span>
<span id="cb178-11"><a href="#cb178-11" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>       Suervice  3086.0</span>
<span id="cb178-12"><a href="#cb178-12" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>           AFFC  2190.0</span></code></pre></div>
<h2 data-number="5.16" id="データの保存"><span class="header-section-number">5.16</span> データの保存</h2>
<p>pandasで作成, 加工したDataFrameオブジェクトは, csv等の形式でファイルに書き出すことができます.
DataFrameオブジェクト<code>df</code>をcsvファイルとして書き出すには<code>df.to_csv('ファイルパス')</code> と記述します. <code>encoding=</code>を追加して記述することでエンコードを指定することも可能です.
BOM付きのUTF-8の場合は<code>encoding='utf-8-sig'</code>と記述します.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> [[<span class="st">&#39;dog&#39;</span>,<span class="fl">5.0</span>,<span class="fl">60.0</span>]</span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>         ,[<span class="st">&#39;cat&#39;</span>,<span class="fl">3.0</span>,<span class="fl">30.0</span>]</span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>         ,[<span class="st">&#39;fish&#39;</span>,<span class="fl">0.15</span>,<span class="fl">0.5</span>]]</span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a><span class="co">#DataFrameの作成</span></span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>values</span>
<span id="cb179-7"><a href="#cb179-7" aria-hidden="true" tabindex="-1"></a>                 ,columns<span class="op">=</span>[<span class="st">&#39;animal_kind&#39;</span></span>
<span id="cb179-8"><a href="#cb179-8" aria-hidden="true" tabindex="-1"></a>                          ,<span class="st">&#39;weight&#39;</span></span>
<span id="cb179-9"><a href="#cb179-9" aria-hidden="true" tabindex="-1"></a>                          ,<span class="st">&#39;size&#39;</span>])</span>
<span id="cb179-10"><a href="#cb179-10" aria-hidden="true" tabindex="-1"></a><span class="co">#csvとして保存</span></span>
<span id="cb179-11"><a href="#cb179-11" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">&#39;data/animal.csv&#39;</span></span>
<span id="cb179-12"><a href="#cb179-12" aria-hidden="true" tabindex="-1"></a>         ,encoding<span class="op">=</span><span class="st">&#39;utf-8-sig&#39;</span>)</span></code></pre></div>
<div class="warn">
<p>pandasで可能なデータの処理のうち,今回紹介したのは基本となるほんの一部です.ライブラリの活用方法や機能は日々増えており, 全部を扱うことはできません.必要に応じて自分で利用方法を調べて学習しましょう.</p>
</div>
<h2 data-number="5.17" id="データの取得と編集全体の演習"><span class="header-section-number">5.17</span> データの取得と編集全体の演習</h2>
<div class="note">
<p>演習問題</p>
<hr />
<ol type="1">
<li>データの作成と編集</li>
</ol>
<p>以下の条件に従うDataFrameを作成してください.</p>
<ul>
<li><p>columnsが’<code>1</code>‘,<code>'2'</code>,<code>'3'</code>,<code>'4'</code>,’<code>5</code>’</p></li>
<li><p>indexが<code>0~19</code></p></li>
<li><p>‘<code>1</code>’列の値はindexの1倍,<code>'2'</code>列の値はindexの2倍,<code>'3'</code>列の値はindexの3倍,<code>'4'</code>列の値はindexの4倍,’<code>5</code>’列の値はindexの5倍の値が入る.</p></li>
</ul>
<p>作成したDataFrameに以下の操作を加えてください.</p>
<ul>
<li><p><code>'3'</code>列を2倍した<code>'6'</code>という列を追加してください.</p></li>
<li><p><code>index</code>が<code>20</code>となる行を追加してください</p></li>
<li><p><code>'mean'</code>という各行の平均値からなる列を追加してください</p></li>
<li><p><code>index</code>が偶数の列のみを残して,すべての列を<code>int</code>型に変更した後<code>BOM付きのUTF-8</code>の<code>csv</code>で保存してください.</p></li>
</ul>
<ol start="2" type="1">
<li>外部データの読み込みと編集</li>
</ol>
<p>以下のURLから近世経済データのEXCELファイルをダウンロードし, 米相場の列に欠損値がないように変更し,データの基本的な構造を確認したのち米相場の平均値を求めてください.</p>
<p><a href="https://www.rieb.kobe-u.ac.jp/project/kinsei-db/database_excel.html">https://www.rieb.kobe-u.ac.jp/project/kinsei-db/database_excel.html</a></p>
</div>
</details>
<h1 data-number="6" id="アルゴリズムとpythonの基本構文"><span class="header-section-number">6</span> アルゴリズムとPythonの基本構文</h1>
<details>
<summary>
開く/閉じる
</summary>
<p>データを適切に処理するためには,これまで扱ったpandasの技法だけでは足りません.ライブラリに含まれていない処理をPythonで自分で記述する必要があります.</p>
<p>Pythonで処理を記述するためにはそのための<strong>構文</strong>を学習する必要があります.</p>
<p>プログラムで記述される処理を,<strong>アルゴリズム</strong>といいます. <strong>アルゴリズム</strong>とは,<strong>有限回適用することで問題を解くことができる規則の集まり</strong>です. プログラミングとは,プログラミング言語の<strong>データ型と構文を利用してアルゴリズムを記述すること</strong>にほかなりません.</p>
<p>基本的に,アルゴリズムを構成する要素は以下のの3つしかありません.</p>
<div class="note">
<ul>
<li><strong>逐次処理</strong></li>
</ul>
<p>手続き型言語は,プログラムは(基本的には)上から順番に実行されます.
プログラムの記述に従って処理を順番に実行することを<strong>逐次処理</strong>といいます.</p>
<ul>
<li><strong>分岐</strong></li>
</ul>
<p>条件に従って処理が分岐します. Pythonでは,<code>if</code>と<code>case</code>という構文によって実装されます.</p>
<ul>
<li><strong>反復</strong></li>
</ul>
<p>指定の回数または,条件が満たされるまで処理を繰り返すこと. Pythonでは,<code>for</code>,<code>while</code>によって実現します. より高度な実装方法として,再帰や高階関数なども利用できますがこの講義では扱いません.</p>
</div>
<p>この3つの組み合わせがプログラムで記述できれば,プログラムを利用してどのような問題でも解けます.</p>
<h3 data-number="6.0.1" id="フローチャート"><span class="header-section-number">6.0.1</span> フローチャート</h3>
<p>アルゴリズムを視覚的に表現する方法の一つにフローチャートがあります. 原理的には,フローチャートを描くことができれば,アルゴリズムが構築できますし,プログラムが記述できます.</p>
<p>フローチャートは,以下の図形と矢印の組み合わで記述されます(厳密には,ループやデータ代入などもっと細かいですが,ここでは簡単のために省略しています.)</p>
<figure>
<img src="/images/flow-chart1.png" alt="フローチャートの部品" />
<figcaption aria-hidden="true">フローチャートの部品</figcaption>
</figure>
<p>例えば,逐次処理は以下のようなフローチャートで表現されます. 以下は,なにかの野菜を育てる手順をフローチャートで表現したものになります.矢印の順番で処理が行われます.</p>
<figure>
<img src="/images/flow-chart2.png" alt="逐次処理" />
<figcaption aria-hidden="true">逐次処理</figcaption>
</figure>
<p>そこに,<strong>実がならなかった場合は刈り取る</strong>という分岐を加えると以下のようになります.</p>
<figure>
<img src="/images/flow-chart3.png" alt="分岐処理" />
<figcaption aria-hidden="true">分岐処理</figcaption>
</figure>
<p>更に,<strong>実がならなかった場合には,肥料をやり,もう一度水を撒くところからやり直す</strong>という形で,前のステップに戻る反復を追加すると以下のようになります.</p>
<figure>
<img src="/images/flow-chart4.png" alt="反復処理" />
<figcaption aria-hidden="true">反復処理</figcaption>
</figure>
<p>プログラムを用いてアルゴリズムを記述するには,①自然言語(日本語)で解きたい問題が書ける,②その解き方をフローチャートなどを利用してアルゴリズムに変換できる,③アルゴリズムをプログラムに変換できる,というステップを踏むのが一般的です.</p>
<p>最近小学生などの教育で良く耳にする<strong>論理的思考力</strong>や<strong>プログラミング的思考</strong>とは,この①から②への変換ができることを意味しているようです.
プログラミングの学習では,①から②への変換は前提として,プログラムの知識,文法,記法,利用方法などを学習し,②から③への変換を扱います.</p>
<p>最近の小学生は,この学習のために,フローチャートを作ることでプログラムが書ける<a href="https://scratch.mit.edu">Scratch</a>などを使っているようですが,この講義ではそこからやっている時間はないので,この章でフローチャートの作成と,そのプログラムへの変換の基礎を学習します.</p>
<div class="note">
<ul>
<li>演習問題</li>
</ul>
<p>以下の処理を表すシンプルなフローチャートをPowerPointを利用して作成してください.</p>
<ol type="1">
<li><p>カレーの作り方
カレーの作り方を想像して,フローチャートで表現してください.</p></li>
<li><p>自動販売機
以下の条件で自動販売機を想定して,
自動販売機にお金が投入されてから商品が出てくるまでのフローチャートを作成してください.</p>
<ul>
<li><p>100円の炭酸飲料と,150円のお茶を販売している自動販売機</p></li>
<li><p>商品を選択してくださいと最初にアナウンスする</p></li>
<li><p>選択された商品に応じた金額を投入してくださいとアナウンスする</p></li>
<li><p>投入された金額が足りている場合は商品を出しお釣りを返す</p></li>
<li><p>投入された金額が足りない場合は,投入されたお金を全部返して,最初に戻る</p></li>
</ul></li>
<li><p>100個の1から100までのランダムな数字が書かれたボールが入っている箱Aから,1つずつボールを取り出し,偶数のボールを箱B,奇数のボールを箱Cに入れる作業を小学生に説明するためのフローチャートを作成してください.</p></li>
</ol>
</div>
<h2 data-number="6.1" id="input関数"><span class="header-section-number">6.1</span> input関数</h2>
<p>これからアルゴリズムをプログラムで記述する練習をするにあたって,スクリプト内のプログラムと人間がやり取りをする場面が何度か出てきます.そのために利用される関数に<code>input()</code>があります. <code>input()</code>はプログラム内で標準入力(Terminalなどに記述された文字列)を受け取る関数です. <code>()</code>内には標準入力を受け取る前に出力される文字列を記述します. 文字列が表示された後,ユーザーが入力した文字列が入力されます.</p>
<p>以下のプログラム(<code>input_test.py</code>)を記述して実行してみましょう.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="bu">input</span>(<span class="st">&#39;あなたの名前を入力してください. </span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;あなたの名前は</span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">ですね. よろしく!&#39;</span>)</span></code></pre></div>
<p>以下のように,<code>()</code>の中の文字列が表示されて,入力された文字列が代入された<code>x</code>が表示されるはずです.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 input_test.py</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a><span class="ex">あなたの名前を入力してください.</span></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a><span class="ex">akagi</span></span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a><span class="ex">あなたの名前はakagiですね.</span> よろしく!</span></code></pre></div>
<h2 data-number="6.2" id="逐次処理インデントブロック"><span class="header-section-number">6.2</span> 逐次処理,インデント,ブロック</h2>
<p>pythonは手続き型言語なので,基本的に上から1行ずつプログラムが実行されます. これによってアルゴリズムの構成要素における逐次処理が実現されています.</p>
<p>これまでにこの講義で扱ってきたプログラムは,基本的に1行に1処理を記述しており,処理は上から1行ずつ実行されていました.</p>
<p>しかし,プログラムがより複雑になると,一つの処理が1行では記述できなくなってきます. そこで,プログラムの中で<strong>処理の塊</strong>を作って,その処理の塊を順番に実行していくことになります. Pythonではこの処理の塊を<code>ブロック</code>と呼び,<code>インデント</code>によって表現します.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sample():</span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;sample&#39;</span>)</span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a><span class="co">####</span></span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a><span class="co">#↑def のブロックをインデントで表現</span></span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a>    total <span class="op">+=</span> i</span>
<span id="cb182-10"><a href="#cb182-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(total)</span>
<span id="cb182-11"><a href="#cb182-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-12"><a href="#cb182-12" aria-hidden="true" tabindex="-1"></a><span class="co">####</span></span>
<span id="cb182-13"><a href="#cb182-13" aria-hidden="true" tabindex="-1"></a><span class="co">#↑forのブロックをインデントで表現</span></span>
<span id="cb182-14"><a href="#cb182-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-15"><a href="#cb182-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-16"><a href="#cb182-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb182-17"><a href="#cb182-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb182-18"><a href="#cb182-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(i<span class="op">*</span>j)</span>
<span id="cb182-19"><a href="#cb182-19" aria-hidden="true" tabindex="-1"></a><span class="co">####</span></span>
<span id="cb182-20"><a href="#cb182-20" aria-hidden="true" tabindex="-1"></a><span class="co">########</span></span>
<span id="cb182-21"><a href="#cb182-21" aria-hidden="true" tabindex="-1"></a><span class="co">#↑ インデントの中でインデントを使って</span></span>
<span id="cb182-22"><a href="#cb182-22" aria-hidden="true" tabindex="-1"></a><span class="co"># ブロックの中のブロックを表現</span></span></code></pre></div>
<p><code>インデント</code>は,パワーポイントと同様に,行頭からの空白を意味します.<code>半角スペース4つ</code>が一つの単位となります. <code>TABキー</code>で入力される<code>TAB</code>をインデントとして利用することもできますが,プログラム中にタブとスペースが混在することになり編集が複雑になるので推奨しません.</p>
<p>しかし,いちいちスペースキーを4回テキストエディタで入力するのは面倒なので,
テキストエディタの設定でタブをスペース4つに変換するように設定しておくと楽です.</p>
<p>Sublime Textでは, <code>View &gt; Indentation &gt; Indent Using Spaces</code> をクリックして, <code>TAB Width: 4</code>を選択すると,自動でタブがスペースになります.</p>
<figure>
<img src="/images/tab-to-spaces.png" alt="TAB to Spaces" />
<figcaption aria-hidden="true">TAB to Spaces</figcaption>
</figure>
<h2 data-number="6.3" id="分岐"><span class="header-section-number">6.3</span> 分岐</h2>
<p>Pythonで分岐を表す基本的な構文として<code>if</code>文があります. <code>if</code>は英語の通り,<strong>もしXXなら</strong>を表しており, <code>if XXX:</code> のインデントブロックに,その条件下で行って欲しい処理を記述します.<code>XXX</code>の部分には,<code>Bool</code>型あるいは<code>Bool</code> 型を返す論理式が入ります. 文の最後に<code>:</code>を記述するのを忘れないようにしましょう. また,続けて, <code>elif YYY:</code>と記述することで条件を追加することができます. 条件を網羅的に書かなくても, <code>if</code>と<code>elif</code>で指定された条件以外のすべての場合の処理を<code>else:</code>で指定することができます.</p>
<figure>
<img src="/images/if1.png" alt="ifのイメージ" />
<figcaption aria-hidden="true">ifのイメージ</figcaption>
</figure>
<p>具体的に,ある変数<code>x</code>の大きさによる分岐は以下のように書かれます. 以下の例では,変数<code>x</code>と<code>10</code>の大小比較の結果によって,表示する文字列を変更しています.</p>
<figure>
<img src="/images/if2.png" alt="ifのイメージ" />
<figcaption aria-hidden="true">ifのイメージ</figcaption>
</figure>
<div class="warn">
<ul>
<li>発展:Bool以外のデータ型とif文の挙動</li>
</ul>
<p><code>if</code>文の<code>if</code>,<code>elif</code>以下の部分には基本的にBool型を記述しますが,<code>Int</code>型や<code>str</code>型なども利用可能です. <code>int</code>の場合<code>1</code>は<code>True</code>,それ以外の数値は<code>False</code>とみなされます. <code>str</code>の場合,<code>''</code>(空白)のみが<code>False</code>それ以外は<code>True</code>となります.こちらのほうが<code>True</code>や<code>False</code>より高速なので,サンプルコードなどで利用されている場合がありますので注意しましょう.</p>
<p>例として下のプログラムを実行すると,<code>1</code>,<code>b</code>,<code>c</code>とだけ表示されるはずですので,確認してみましょう.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="dv">1</span> :</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;1&#39;</span>)</span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="dv">0</span>:</span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;0&#39;</span>)</span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">&#39;&#39;</span>:</span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;a&#39;</span>)</span>
<span id="cb183-9"><a href="#cb183-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-10"><a href="#cb183-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">&#39; &#39;</span>:</span>
<span id="cb183-11"><a href="#cb183-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;b&#39;</span>)</span>
<span id="cb183-12"><a href="#cb183-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-13"><a href="#cb183-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">&#39;c&#39;</span>:</span>
<span id="cb183-14"><a href="#cb183-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;c&#39;</span>)</span></code></pre></div>
</div>
<p>それでは,具体的なプログラムを記述してみましょう.以下のプログラムについて考えてみます.</p>
<div class="note">
<p>動物の名前をうけとって,それが<code>'イヌ'</code>なら,<code>'ワンワン'</code>,<code>'ネコ'</code>なら,<code>'ニャンニャン'</code>,どちらでもないなら<code>'???'</code>と表示するプログラム</p>
</div>
<p>これを,まずは日本語のフローチャートで表現して,日本語の部分をプログラムの構文に書き換えてみると以下のようになります.これくらいのプログラムだと,フローチャートを経由して変換するのは面倒かと思いますが,今後より複雑なプログラムを書くにあたっての訓練ですので,取り組んでみましょう.</p>
<figure>
<img src="/images/if5.png" alt="動物の名前" />
<figcaption aria-hidden="true">動物の名前</figcaption>
</figure>
<p>フローチャートが書けたら,そのままプログラムを上から書いてみましょう. <code>else</code>の部分だけはフローチャートに現れていないので注意してください.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>kind <span class="op">=</span> <span class="bu">input</span>(<span class="st">&#39;動物の名前をカタカナで入力してください. </span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> kind <span class="op">==</span> <span class="st">&#39;イヌ&#39;</span>:</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;ワンワン&#39;</span>)</span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> kind <span class="op">==</span> <span class="st">&#39;ネコ&#39;</span>:</span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;ニャンニャン&#39;</span>)</span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;???&#39;</span>)</span></code></pre></div>
<p>実行して,意図通りに動くかを確認しましょう.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 pet_name.py</span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="ex">動物の名前をカタカナで入力してください.</span></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a><span class="ex">イヌ</span></span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a><span class="ex">ワンワン</span></span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 pet_name.py</span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a><span class="ex">動物の名前をカタカナで入力してください.</span></span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a><span class="ex">サカナ</span></span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a><span class="ex">???</span></span></code></pre></div>
<div class="note">
<ul>
<li>演習問題</li>
</ul>
<p>以下の,処理のフローチャートと,プログラムを作成してください.</p>
<ol type="1">
<li><p>関東の都県を標準入力から受け取り,その都県の県庁所在地を返す.</p></li>
<li><p><code>input()</code>関数で数値を受け取って, 偶数なら偶数, 奇数なら奇数という文字列を返す.</p>
<ul>
<li>ヒント: <code>input()</code>関数の返り値は文字列なので, <code>int(input(‘数値を入力してください /n’))</code> のように<code>int()</code>関数を利用することで数値に変換できる.</li>
</ul></li>
<li><p>ランダムな1から10の数値を発生させて, その数値が5より大きければ<code>'BIG'</code>,小さければ<code>'SMALL'</code>と表示する.</p>
<ul>
<li>ヒント: 一行目に <code>import random</code> と記述して(意味は,後の回で) <code>x = random.randint(1,10)</code>と書くと, 1から10のランダムな整数がxに入ります.</li>
</ul></li>
</ol>
</div>
<h2 data-number="6.4" id="反復"><span class="header-section-number">6.4</span> 反復</h2>
<p>Pythonにおいて,処理を繰り返す<strong>反復</strong>を実装する構文はいくつか存在しますが,代表的なものに <code>while文</code> 及び <code>for文</code>があります. 利用頻度からしても,<code>for文</code>の方が重要ですが, ここではフローチャートと相性が良く,意味が分かりやすい<code>while文</code>で反復の感覚を掴んでから<code>for文</code>を学習しましょう.</p>
<h3 data-number="6.4.1" id="while文"><span class="header-section-number">6.4.1</span> While文</h3>
<p>プログラムは,コンピュータに何かしらの命令をする文を書くものです. <code>while文</code>も<code>if</code>のように英文の意味に沿って,プログラムに命令を与えています.
例えば以下の英語の命令文について考えてみましょう.</p>
<ul>
<li>Keep working while the timer is running.</li>
</ul>
<p>(タイマーが動いている間は,働いてください.)</p>
<ul>
<li>Water the plants every day while they are not bearing fruit.</li>
</ul>
<p>(植物に実が成っていない間は毎日水やりをしてください.)</p>
<ul>
<li>Continue reading while the light is on.</li>
</ul>
<p>(電気がついている間は, 読み続けてください.)</p>
<p>これらの文はいずれも, <strong>命令 while 条件</strong> という形を取っており, <strong>条件が真である限り,命令を実行してください</strong>という意味になっています.</p>
<p>プログラムにおける<code>while文</code>は上の英文の順序を少し入れ替えて, <code>while 条件: 命令</code>の形をとり,<code>条件</code>が真である限り,<code>命令</code>を実行するという意味のプログラムになります.</p>
<figure>
<img src="/images/while1.png" alt="whileのイメージ" />
<figcaption aria-hidden="true">whileのイメージ</figcaption>
</figure>
<p><code>while文</code>は条件によって,プログラムの継続を判断するので,条件の真偽値が変更されない限り,プログラムが終了しません.
試しに以下のコードを実行してみましょう.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co">#実行されない</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">False</span>:</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;never printed&#39;</span>)</span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a><span class="co">#永遠に数字が増え続ける</span></span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a><span class="co">#終了するには Ctrl + C</span></span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb186-8"><a href="#cb186-8" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb186-9"><a href="#cb186-9" aria-hidden="true" tabindex="-1"></a>    x <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb186-10"><a href="#cb186-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x)</span></code></pre></div>
<p>1つ目の<code>while文</code>は,条件が最初から<code>False</code>になっているため実行されません.
2つ目の<code>while文</code>は,条件が永遠に<code>True</code>なので<code>x</code>が<code>1</code>から増え続けて<code>print()</code>によって標準出力され続けます(このように反復を表すプログラムでは, 変数への再代入を多用しますので,忘れている人は復習しましょう.) <strong>プログラムを強制終了するには<code>Ctrl + C</code>を押しましょう.</strong></p>
<p>ウェブサイトやソフトウェアの表示などでは<code>while文</code>を利用して永遠にプログラムを動かし続けることをしますが,通常の反復では,何かしらの条件の変更によってプログラムを終了するように条件部分を変更する必要があります.</p>
<p>先程のプログラムを少し変更して, <code>x</code>の値が<code>1</code>ずつ増えていき,<code>10</code>になったら終了するようにしてみるとどうなるでしょうか.</p>
<p><code>while文</code>のような反復は, フローチャートでは,<strong>条件</strong>部分を表す分岐と,前に戻る矢印で表されます. 分岐のあとに,何かしら条件に関わる値が変更されることで,分岐が終了します.</p>
<figure>
<img src="/images/while2.png" alt="whileのイメージ" />
<figcaption aria-hidden="true">whileのイメージ</figcaption>
</figure>
<div class="sourceCode" id="cb187"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> x <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>    x <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x)</span></code></pre></div>
<div class="sourceCode" id="cb188"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 while_and_for.py</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span></span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span></span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span></span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span></span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span></span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span></span></code></pre></div>
<p>続いて,標準入力の結果によって反復の終了条件を判定するための,以下のフローチャートで表されるプログラムを考えてみましょう.</p>
<figure>
<img src="/images/while3.png" alt="whileのイメージ" />
<figcaption aria-hidden="true">whileのイメージ</figcaption>
</figure>
<p>このフローチャートをプログラムに直すと以下のようになり, 問題文に正解しない限りプログラムが終了しません.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="dv">2</span> <span class="op">!=</span> x:</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(<span class="st">&#39;1 + 1 = ? </span><span class="ch">\n</span><span class="st">&#39;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb190"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 while_and_for.py</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span> + 1 = <span class="pp">?</span></span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span></span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span> + 1 = <span class="pp">?</span></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span></span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span> + 1 = <span class="pp">?</span></span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span></span></code></pre></div>
<h4 data-number="6.4.1.1" id="while文とif文の組み合わせ"><span class="header-section-number">6.4.1.1</span> <code>while文</code>と<code>if文</code>の組み合わせ</h4>
<p><code>while文</code>の中でも<code>if文</code>を利用した分岐が可能です. 先程のプログラムに少し加えて,ヒントを出すようにしてみましょう.</p>
<figure>
<img src="/images/while4.png" alt="whileのイメージ" />
<figcaption aria-hidden="true">whileのイメージ</figcaption>
</figure>
<p><code>while文</code>のインデントの中で,更に<code>if文</code>のインデントが組まれていることに注意しましょう.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="dv">2</span> <span class="op">!=</span> x:</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(<span class="st">&#39;1 + 1 = ? </span><span class="ch">\n</span><span class="st">&#39;</span>))</span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">&gt;</span> <span class="dv">2</span>:</span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;少し数が大きいかも&#39;</span>)</span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> x <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;少し数が小さいかも&#39;</span>)</span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb191-10"><a href="#cb191-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;大正解!!&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb192"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 while_and_for.py</span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span> + 1 = <span class="pp">?</span></span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a><span class="ex">少し数が大きいかも</span></span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span> + 1 = <span class="pp">?</span></span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span></span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a><span class="ex">少し数が小さいかも</span></span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span> + 1 = <span class="pp">?</span></span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span></span>
<span id="cb192-10"><a href="#cb192-10" aria-hidden="true" tabindex="-1"></a><span class="ex">大正解!!</span></span></code></pre></div>
<h4 data-number="6.4.1.2" id="真偽値以外のwhile文"><span class="header-section-number">6.4.1.2</span> 真偽値以外の<code>while文</code></h4>
<p><code>while文</code>では,<code>if文</code>と同様にTrue,False以外の値を条件部分に用いることがあります.
<code>while文</code>では<code>リスト</code>を条件部分に与えることが可能で, <strong>リストが空のとき<code>False</code></strong>として判定されます.</p>
<figure>
<img src="/images/while5.png" alt="whileのイメージ" />
<figcaption aria-hidden="true">whileのイメージ</figcaption>
</figure>
<p>以下のプログラムでは,リストの先頭要素を表示したのち,リストの先頭要素を<code>pop()</code>メソッドによって削除しています. 削除を続けて,リストが空になるとプログラムが終了します.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> xs:</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(xs[<span class="dv">0</span>])</span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#リストの先頭要素を削除(pop())</span></span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>    xs.pop(<span class="dv">0</span>)</span></code></pre></div>
<div class="sourceCode" id="cb194"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 while_and_for.py</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span></span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span></span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span></span></code></pre></div>
<div class="note">
<ul>
<li>演習問題</li>
</ul>
<p>以下のプログラムのフローチャートを作成し,while文を利用してプログラムを記述してください.</p>
<ol type="1">
<li><p><code>x = 1</code> に<code>3</code>ずつ数を足しながら<code>x</code>の値を<code>print()</code>する. <code>x</code>が<code>1000</code>を超えたら終了する.</p></li>
<li><p><code>1</code>から<code>100</code>までの数の和を求める.</p>
<ul>
<li>ヒント: 1ずつ値が増える変数とは別に,増えた値を足す変数を最初に作ろう.</li>
</ul></li>
<li><p><code>100</code>から<code>150</code>までの数のうち,<code>５</code>で割り切れるかつ<code>２</code>で割り切れる数の和を求める</p></li>
</ol>
</div>
<h3 data-number="6.4.2" id="for文"><span class="header-section-number">6.4.2</span> for文</h3>
<p>続いてもう一つの代表的な反復の表現方法である<code>for文</code>について見ていきましょう <code>while文</code>の説明の最後に扱った,<strong>リストから一つずつ値を取り出す操作</strong>のように<strong>なにかから値を取り出す操作を繰り返すこと</strong>に特化したのが,<code>for文</code>です.</p>
<p><code>for文</code>は, <code>for x in y: z</code>の形で,<strong>yから一つずつxを抜き出して,zをしてください</strong>という意味になります.</p>
<p>英文では,以下の用に<strong>For each x in y,</strong>の形で表されますが, プログラムでは<strong>each</strong>が省略されます.</p>
<div class="note">
<ul>
<li>For each mandarin in the box, take it out and peel it</li>
</ul>
<p>(みかんの入った箱から一つずつみかんを取り出して,皮を剥いてください)</p>
<ul>
<li>For each student in the class, collect the handout from them.</li>
</ul>
<p>(クラスの学生一人ひとりからプリントを回収してください.)</p>
<ul>
<li>For each panda in the cage, take it out one by one and line them up.</li>
</ul>
<p>(パンダの檻からパンダを一匹ずつ連れ出して並べてください.)</p>
</div>
<p><code>for文</code>をプログラムの世界で利用するには,現実を対象とした英語における,<strong>みかんの入った箱</strong>や<strong>パンダの檻</strong>のようになにか中身を取り出せる入れ物が必要になります.</p>
<p><code>python</code>では,この入れ物として,リストのように,中身を順番に取り出せるもの(オブジェクト)を<strong>イテラブルオブジェクト( iterable object)</strong>を利用します.</p>
<div class="note">
<ul>
<li><p>Iterable object の例</p>
<ul>
<li>リスト <code>xs = [1,2,3,4,5]</code></li>
</ul>
<p>順番に取り出すと, <code>1,2,3,4,5</code>の順番で一つずつ出てくる</p>
<ul>
<li>辞書 <code>animal_count = {'cat':2,'dog':4,'bird':8}</code></li>
</ul>
<p><code>key</code>を順番に取り出すと, <code>'cat','dog','bird'</code>が順番に一つずつ出てくる</p>
<ul>
<li>タプル <code>xs = ('a','b','c','d')</code></li>
</ul>
<p>順番に取り出すと,<code>'a','b','c','d'</code>の順番で一つずつ出てくる</p>
<ul>
<li>DataFrameの列や行(<code>DataSeries</code>)</li>
</ul></li>
</ul>
</div>
<figure>
<img src="/images/for1.png" alt="forのイメージ" />
<figcaption aria-hidden="true">forのイメージ</figcaption>
</figure>
<p><code>for文</code>における終了条件は,<code>iterable object</code>が空になることです.
リストから要素を取り出して,以下のフローチャートで表されるような合計を求める処理について考えてみましょう.</p>
<figure>
<img src="/images/for2.png" alt="forのイメージ" />
<figcaption aria-hidden="true">forのイメージ</figcaption>
</figure>
<p>プログラムに直すと以下のようになります.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>]</span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> xs:</span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a>    total <span class="op">+=</span> x</span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(total)</span></code></pre></div>
<div class="sourceCode" id="cb196"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 while_and_for.py</span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="ex">15</span></span></code></pre></div>
<p>xs から取り出した値が<code>x</code>に毎回代入されていることに注意しましょう.なお,<code>x</code>は変数名なので,任意の名前をつけることが可能です.
また,<code>pop</code>を利用した<code>while文</code>と違って,元の<code>xs</code>の要素数は実際には減っていません.</p>
<ul>
<li><code>range()</code>関数</li>
</ul>
<p>上の例のように,<strong><code>m</code>から<code>n</code></strong>までの連続した数値が欲しい場合に,毎回リストを作っていると大変です. 単純に数値の列が欲しい場合は<code>range()</code>関数を使いましょう.
<code>range(x)</code>は<code>0</code>から始まる<code>x</code>個の<code>シーケンス</code>(インデックスで位置を指定できるイテラブルオブジェクト)を返します.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x)</span></code></pre></div>
<div class="sourceCode" id="cb198"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span></span></code></pre></div>
<p><code>range(始端,終端,ステップ)</code>の形で複数の引数を指定することで,始端,終端,ステップ(何個とばしにするか)を定めることができます.
終端は,一つ前の値までしか出力されないので注意しましょう.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>,<span class="dv">10</span>):</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x)</span></code></pre></div>
<div class="sourceCode" id="cb200"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span></span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span></span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span></span></code></pre></div>
<div class="sourceCode" id="cb201"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">2</span>):</span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x)</span></code></pre></div>
<div class="sourceCode" id="cb202"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span></span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span></span></code></pre></div>
<h4 data-number="6.4.2.1" id="for文とif文の組み合わせ"><span class="header-section-number">6.4.2.1</span> <code>for文</code>と<code>if文</code>の組み合わせ</h4>
<p><code>while文</code>と同様に<code>for文</code>の中で<code>if文</code>を利用したり,<code>if文</code>の中で<code>for文</code>を利用することができます.</p>
<p>以下のプログラムでは, <code>1</code>から<code>5</code>までの値の中で偶数のものだけを<code>print()</code>しています.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">6</span>):</span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(x)</span></code></pre></div>
<div class="sourceCode" id="cb204"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 while_and_for.py</span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span></span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span></span></code></pre></div>
<h4 data-number="6.4.2.2" id="多重ループ"><span class="header-section-number">6.4.2.2</span> 多重ループ</h4>
<p><code>for文</code>の中で<code>for文</code>を複数回繰り返して多重ループを実現できます. 以下のプログラムでは, リスト<code>xs</code>からリスト<code>x</code>を取り出し,取り出したリスト<code>x</code>から取り出した要素<code>y</code>の合計値を求めています.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> [[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>],[<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>],[<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>]]</span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> xs:</span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> y <span class="kw">in</span> x:</span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a>        total <span class="op">+=</span> y</span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(total)</span></code></pre></div>
<div class="sourceCode" id="cb206"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 while_and_for.py</span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a><span class="ex">45</span></span></code></pre></div>
<div class="note">
<ul>
<li>演習</li>
</ul>
<p>以下の処理のフローチャートとプログラムを作ってみよう.</p>
<ol type="1">
<li><p><code>x=0</code>に<code>[1,3,5,7,9,12]</code>を順番に足して更新する. <code>x</code>の値を更新するたびに<code>print()</code>する.</p></li>
<li><p>人物の名前と成績を記録した辞書型<code>xs={'taro':'S','hanako':'B','yumi':'A','jiro':'D'}</code>から成績A以上の人物名だけをリスト<code>upper=[]</code>に追加し,<code>upper</code>を表示する.</p></li>
<li><p><code>100</code>から<code>150</code>までの数のうち,<code>５</code>で割り切れるかつ<code>２</code>で割り切れる数の和を求める</p></li>
<li><p><code>xs = [[1,2,3,4,5],[6,7,8,9,10],[11,12,13,14,15],[16,17,18,19,20]]</code>として, <code>for文</code>の多重ループを利用して, <code>xs[0]</code>から<code>xs[3]</code>の合計値が入ったリストを求める</p></li>
<li><p><code>FizzBuzz</code>とはプログラミングの動作確認でよく用いられる欧米圏の言葉遊びゲームです..
以下のルールに則って<code>1</code>から<code>100</code>までの数を順番に<code>FizzBuzz</code>の判定を行ってください.</p>
<ul>
<li><p>3の倍数ならFizzと表示する</p></li>
<li><p>5の倍数ならBuzzと表示する</p></li>
<li><p>両方の倍数ならFizzBuzz</p></li>
<li><p>どちらでもないならその数をPrintする.</p></li>
</ul></li>
</ol>
</div>
<h4 data-number="6.4.2.3" id="発展-リスト内包表記"><span class="header-section-number">6.4.2.3</span> 発展: リスト内包表記</h4>
<p>Pythonには<code>for文</code>と<code>while文</code>以外にも,反復を実現するための手法がいくつか存在します.
そのうち良く使われるものに<strong>リスト内包表記</strong>があります.</p>
<p>リスト内包表記は,集合論の記法を取り入れた書き方で,関数型言語からPythonに取り入れられました.
リスト内包表記は,短い行で簡潔に書けるためリストを生成する際に良く用いられます.</p>
<p>例えば, 1~10までの数値のうち,偶数だけが入ったリストを生成することを考えます.
<code>for文</code>を利用すると,例えば以下のようにして得ることができます.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>even_numbers <span class="op">=</span> []</span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">11</span>):</span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">%</span> <span class="dv">2</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">11</span>):</span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a>        even_numbers.append(i)</span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;for文:&#39;</span>, even_numbers)</span>
<span id="cb207-6"><a href="#cb207-6" aria-hidden="true" tabindex="-1"></a><span class="co">#結果&gt;&gt;&gt; for文: [2, 4, 6, 8, 10]</span></span></code></pre></div>
<p>1つのリストを生成するのに4行かかっています.
リスト内包表記で同じリストを作成してみます.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>even_numbers <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">11</span>) <span class="cf">if</span> x <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;内包表記:&#39;</span>,even_numbers)</span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a><span class="co">#結果&gt;&gt;&gt; 内包表記: [2, 4, 6, 8, 10]</span></span></code></pre></div>
<p>同じ結果を一行で得ることができました.</p>
<p>リスト内包表記では<code>[]</code>の中に</p>
<p><code>[得たい値 for 使いたい要素を代入した変数 in イテラブルオブジェクト if 条件]</code></p>
<p>という書き方で,<code>for文</code>や<code>if文</code>を利用します.</p>
<p>詳細は省きますが,これは数学の集合論における内包表記を真似た記述法になります.</p>
<figure>
<img src="/images/list_complehension.png" alt="リスト内包表記" />
<figcaption aria-hidden="true">リスト内包表記</figcaption>
</figure>
<p>なれるまで難しいかと思いますので,いくつか他の例も見てみましょう.</p>
<ul>
<li>1から10までの数字のうち,奇数のものに3を足したリスト</li>
</ul>
<div class="sourceCode" id="cb209"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> [x <span class="op">+</span> <span class="dv">3</span> <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">11</span>) <span class="cf">if</span> x <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(xs) <span class="co">#[5, 7, 9, 11, 13]</span></span></code></pre></div>
<ul>
<li><code>animals_small = ['cat','dog','bird']</code>を大文字に変換したリスト</li>
</ul>
<div class="sourceCode" id="cb210"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>animals_small <span class="op">=</span> [<span class="st">&#39;cat&#39;</span>,<span class="st">&#39;dog&#39;</span>,<span class="st">&#39;bird&#39;</span>]</span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a>animals_large <span class="op">=</span> [x.upper() <span class="cf">for</span> x <span class="kw">in</span> animals_small]</span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(animals_large) <span class="co">#[&#39;CAT&#39;, &#39;DOG&#39;, &#39;BIRD&#39;]</span></span></code></pre></div>
<ul>
<li><code>['CAT', 'DOG', 'BIRD']</code>のうち文字数が3文字以下の文字列の頭文字のリスト</li>
</ul>
<div class="sourceCode" id="cb211"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> [x[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> animals_large <span class="cf">if</span> <span class="bu">len</span>(x) <span class="op">&lt;=</span><span class="dv">3</span> ]</span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(xs) <span class="co"># [&#39;C&#39;, &#39;D&#39;]</span></span></code></pre></div>
<ul>
<li><code>100</code>から<code>150</code>までの数のうち,<code>５</code>で割り切れるかつ<code>２</code>で割り切れる数の和</li>
</ul>
<div class="sourceCode" id="cb212"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">sum</span>([x <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>,<span class="dv">150</span>) <span class="cf">if</span> x <span class="op">%</span> <span class="dv">10</span> <span class="op">==</span> <span class="dv">0</span>]))</span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a><span class="co">#600</span></span></code></pre></div>
<h4 data-number="6.4.2.4" id="発展-breakとcontinue"><span class="header-section-number">6.4.2.4</span> 発展: breakとcontinue</h4>
<p><code>for文</code>や<code>while文</code>の処理を途中で分岐させたい場合には <code>break</code>, <code>continue</code>, <code>else</code> が利用できます.</p>
<div class="note">
<ul>
<li><p><code>continue</code>: <code>continue</code> 後の処理を行わずに反復の最初に戻る</p></li>
<li><p><code>break</code>: 反復を抜け出す</p></li>
<li><p><code>else</code>: <code>break</code>以外で<code>while文</code>が終了したら実行</p></li>
</ul>
</div>
<p>例として,あなたはなんの動物か尋ねてニンゲンですと答えないと終わらない以下のような処理を作ってみます.</p>
<figure>
<img src="/images/while6.png" alt="whileのイメージ" />
<figcaption aria-hidden="true">whileのイメージ</figcaption>
</figure>
<div class="note">
<p>この処理はユーザーに「あなたはなんの動物ですか?(カタカナで回答)」と質問し,正しい答え「ニンゲン」を得るまで質問を繰り返します.</p>
<p>まず,answer変数にユーザーの入力を格納します.whileループを使って,answerが「ニンゲン」でない限りループを続けます.</p>
<p>もし,ユーザーが「ウチュウジン」と答えた場合,「本当に!? 怖いのでさようなら!」と表示し,<code>break</code>でループを終了します.</p>
<p>ユーザーが「カミサマ」と答えた場合,「わお!! 初めて会いました! … 馬鹿にしないでちゃんと答えてください!」と表示し,再度質問を行います.<code>continue</code>で反復の最初に戻ります.</p>
<p>「ニンゲン」「ウチュウジン」「カミサマ」以外の答えの場合,「嘘をつかないで! XXX は喋れません.」と表示し,再度質問を行います.</p>
<p>ループが「ニンゲン」の答えで終了すると,<code>else</code>で定義された「そうですよね!ニンゲンに決まっています!」と表示されます.</p>
<p>プログラムに直すと以下のようになります.
それぞれの行がどのような条件で実行されるのか, 確認してみましょう.</p>
</div>
<div class="sourceCode" id="cb213"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 先に変数を用意します</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>answer <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;あなたはなんの動物ですか?(カタカナで回答)</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a><span class="co"># while文でニンゲンですと答えるまで終わらないプログラムを書きます</span></span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> answer <span class="op">!=</span> <span class="st">&quot;ニンゲン&quot;</span>:</span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 答えによっていろいろな反応を組み込んでみましょう</span></span>
<span id="cb213-7"><a href="#cb213-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> answer <span class="op">==</span> <span class="st">&quot;ウチュウジン&quot;</span>:</span>
<span id="cb213-8"><a href="#cb213-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;本当に!? 怖いのでさようなら!</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb213-9"><a href="#cb213-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># while ループを終了します</span></span>
<span id="cb213-10"><a href="#cb213-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb213-11"><a href="#cb213-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-12"><a href="#cb213-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> answer <span class="op">==</span> <span class="st">&quot;カミサマ&quot;</span>:</span>
<span id="cb213-13"><a href="#cb213-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;わお!! 初めて会いました! ... 馬鹿にしないでちゃんと答えてください!&quot;</span>)</span>
<span id="cb213-14"><a href="#cb213-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># もう一度値を更新して,ループの最初に戻ります</span></span>
<span id="cb213-15"><a href="#cb213-15" aria-hidden="true" tabindex="-1"></a>        answer <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;本当はあなたはなんの動物ですか?</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb213-16"><a href="#cb213-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb213-17"><a href="#cb213-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-18"><a href="#cb213-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ニンゲンとウチュウジン,カミサマ以外は多分喋れないのでもう一度訪ねます</span></span>
<span id="cb213-19"><a href="#cb213-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb213-20"><a href="#cb213-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;嘘をつかないで!&quot;</span> <span class="op">+</span> answer <span class="op">+</span> <span class="st">&quot;は喋れません.&quot;</span>)</span>
<span id="cb213-21"><a href="#cb213-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># もう一度値を更新します</span></span>
<span id="cb213-22"><a href="#cb213-22" aria-hidden="true" tabindex="-1"></a>        answer <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;本当はあなたはなんの動物ですか?</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb213-23"><a href="#cb213-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-24"><a href="#cb213-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># これはcontinue も breakもされなかった場合だけ実行されます</span></span>
<span id="cb213-25"><a href="#cb213-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;今度は真面目に答えましたか?</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb213-26"><a href="#cb213-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-27"><a href="#cb213-27" aria-hidden="true" tabindex="-1"></a><span class="co"># breakで終わらなかった == ニンゲンだった場合の処理を書きます</span></span>
<span id="cb213-28"><a href="#cb213-28" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb213-29"><a href="#cb213-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;そうですよね!ニンゲンに決まっています!&quot;</span>)</span></code></pre></div>
<div class="note">
<ul>
<li>演習問題</li>
</ul>
<p>質問に対する回答をinput関数で受け取り,それに対して返答をする簡単なBotプログラムを作成してください. なお,分岐は最低5つ以上とすること.</p>
</div>
<h4 data-number="6.4.2.5" id="pandasにおけるfor文"><span class="header-section-number">6.4.2.5</span> <code>pandas</code>における<code>for文</code></h4>
<p>PandasのDataFrameの処理においても<code>for文</code>は良く利用されます.
例えば以下のようなデータについて考えてみます.</p>
<p>なお,こちらのデータは以下のコードで作成できます. コピーして使いましょう.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>years <span class="op">=</span> [<span class="bu">str</span>(x) <span class="op">+</span> <span class="st">&#39;年&#39;</span> <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1800</span>,<span class="dv">1820</span>)]</span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> [<span class="st">&#39;101&#39;</span>,<span class="st">&#39;187&#39;</span>,<span class="st">&#39;150&#39;</span>,<span class="st">&#39;117&#39;</span>,<span class="st">&#39;&#39;</span>,<span class="st">&#39;168&#39;</span></span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a>         ,<span class="st">&#39;195&#39;</span>,<span class="st">&#39;140&#39;</span>,<span class="st">&#39;151&#39;</span>,<span class="st">&#39;123&#39;</span>,<span class="st">&#39;192&#39;</span>,<span class="st">&#39;137&#39;</span></span>
<span id="cb214-6"><a href="#cb214-6" aria-hidden="true" tabindex="-1"></a>         ,<span class="st">&#39;なし&#39;</span>,<span class="st">&#39;184&#39;</span>,<span class="st">&#39;136&#39;</span>,<span class="st">&#39;192&#39;</span>,<span class="st">&#39;150&#39;</span>,<span class="st">&#39;163&#39;</span>,<span class="st">&#39;141&#39;</span>,<span class="st">&#39;122&#39;</span>]</span>
<span id="cb214-7"><a href="#cb214-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-8"><a href="#cb214-8" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">&#39;year&#39;</span>:years</span>
<span id="cb214-9"><a href="#cb214-9" aria-hidden="true" tabindex="-1"></a>                  ,<span class="st">&#39;value&#39;</span>:values})</span>
<span id="cb214-10"><a href="#cb214-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-11"><a href="#cb214-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<div class="sourceCode" id="cb215"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python3 while_and_for.py</span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>     <span class="ex">year</span> value</span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>   1800年   101</span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   1801年   187</span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>   1802年   150</span>
<span id="cb215-6"><a href="#cb215-6" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>   1803年   117</span>
<span id="cb215-7"><a href="#cb215-7" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>   1804年</span>
<span id="cb215-8"><a href="#cb215-8" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>   1805年   168</span>
<span id="cb215-9"><a href="#cb215-9" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>   1806年   195</span>
<span id="cb215-10"><a href="#cb215-10" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>   1807年   140</span>
<span id="cb215-11"><a href="#cb215-11" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>   1808年   151</span>
<span id="cb215-12"><a href="#cb215-12" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>   1809年   123</span>
<span id="cb215-13"><a href="#cb215-13" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>  1810年   192</span>
<span id="cb215-14"><a href="#cb215-14" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>  1811年   137</span>
<span id="cb215-15"><a href="#cb215-15" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>  1812年    なし</span>
<span id="cb215-16"><a href="#cb215-16" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>  1813年   184</span>
<span id="cb215-17"><a href="#cb215-17" aria-hidden="true" tabindex="-1"></a><span class="ex">14</span>  1814年   136</span>
<span id="cb215-18"><a href="#cb215-18" aria-hidden="true" tabindex="-1"></a><span class="ex">15</span>  1815年   192</span>
<span id="cb215-19"><a href="#cb215-19" aria-hidden="true" tabindex="-1"></a><span class="ex">16</span>  1816年   150</span>
<span id="cb215-20"><a href="#cb215-20" aria-hidden="true" tabindex="-1"></a><span class="ex">17</span>  1817年   163</span>
<span id="cb215-21"><a href="#cb215-21" aria-hidden="true" tabindex="-1"></a><span class="ex">18</span>  1818年   141</span>
<span id="cb215-22"><a href="#cb215-22" aria-hidden="true" tabindex="-1"></a><span class="ex">19</span>  1819年   122</span></code></pre></div>
<p>このデータは<code>year</code>列に<code>'年'</code>がついており,<code>value</code>列に空白や<code>'なし'</code>があります.こういったデータを数値として処理できるようにすることを考えてみましょう.
まずは,<code>print(df.dtypes)</code>でそれぞれのデータ型を確認して見ましょう.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="ex">year</span>     object</span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a><span class="ex">value</span>    object</span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a><span class="ex">dtype:</span> object</span></code></pre></div>
<p>すべて文字列型であることが分かります.</p>
<p>このまま,<code>year</code>列を<code>astype()</code>を利用して<code>int</code>型に変換してみます.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;year&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;year&#39;</span>].astype(<span class="st">&#39;int&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb218"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Traceback</span> <span class="er">(</span><span class="ex">most</span> recent call last<span class="kw">)</span><span class="bu">:</span></span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">File</span> <span class="st">&quot;/Users/akagi/Documents/Programs/Python/slds/while_and_for.py&quot;</span>, line 74, in <span class="op">&lt;</span>module<span class="op">&gt;</span></span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">df</span><span class="op">[</span><span class="st">&#39;year&#39;</span><span class="op">]</span> <span class="ex">=</span> df<span class="pp">[</span><span class="st">&#39;year&#39;</span><span class="pp">]</span>.astype<span class="er">(</span><span class="st">&#39;int&#39;</span><span class="kw">)</span></span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a>                 <span class="ex">^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span id="cb218-5"><a href="#cb218-5" aria-hidden="true" tabindex="-1"></a><span class="ex">ValueError:</span> invalid literal for int<span class="er">(</span><span class="kw">)</span> <span class="ex">with</span> base 10: <span class="st">&#39;1800年&#39;</span></span></code></pre></div>
<p><code>年</code>の部分が数値に変換出来ないというエラーが出ます.
では,<code>year</code>列から<code>'年'</code>を除外してみましょう.</p>
<p>先程の<code>df['year'] = df['year'].astype('int')</code>をコメントアウトしてから,以下を実行してみましょう.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------</span></span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a><span class="co"># year列をInt型にする</span></span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------</span></span>
<span id="cb219-4"><a href="#cb219-4" aria-hidden="true" tabindex="-1"></a><span class="co"># year列から&quot;年&quot;を抜かす</span></span>
<span id="cb219-5"><a href="#cb219-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 上から順番に処理するので</span></span>
<span id="cb219-6"><a href="#cb219-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 行番号をdf.indexで取得</span></span>
<span id="cb219-7"><a href="#cb219-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> df.index:</span>
<span id="cb219-8"><a href="#cb219-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 一番右の文字をなくせば良い</span></span>
<span id="cb219-9"><a href="#cb219-9" aria-hidden="true" tabindex="-1"></a>    df.at[i, <span class="st">&#39;year&#39;</span>] <span class="op">=</span> df.at[i, <span class="st">&#39;year&#39;</span>][:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb219-10"><a href="#cb219-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-11"><a href="#cb219-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 確認してみる</span></span>
<span id="cb219-12"><a href="#cb219-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">&#39;year&#39;</span>])</span>
<span id="cb219-13"><a href="#cb219-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-14"><a href="#cb219-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 年が消えたので,変換してみる</span></span>
<span id="cb219-15"><a href="#cb219-15" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;year&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;year&#39;</span>].astype(<span class="bu">int</span>)</span>
<span id="cb219-16"><a href="#cb219-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">&#39;year&#39;</span>].dtype) <span class="co">#int64</span></span></code></pre></div>
<div class="sourceCode" id="cb220"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>     1800</span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>     1801</span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>     1802</span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>     1803</span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>     1804</span>
<span id="cb220-6"><a href="#cb220-6" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     1805</span>
<span id="cb220-7"><a href="#cb220-7" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>     1806</span>
<span id="cb220-8"><a href="#cb220-8" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>     1807</span>
<span id="cb220-9"><a href="#cb220-9" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>     1808</span>
<span id="cb220-10"><a href="#cb220-10" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>     1809</span>
<span id="cb220-11"><a href="#cb220-11" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>    1810</span>
<span id="cb220-12"><a href="#cb220-12" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>    1811</span>
<span id="cb220-13"><a href="#cb220-13" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>    1812</span>
<span id="cb220-14"><a href="#cb220-14" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>    1813</span>
<span id="cb220-15"><a href="#cb220-15" aria-hidden="true" tabindex="-1"></a><span class="ex">14</span>    1814</span>
<span id="cb220-16"><a href="#cb220-16" aria-hidden="true" tabindex="-1"></a><span class="ex">15</span>    1815</span>
<span id="cb220-17"><a href="#cb220-17" aria-hidden="true" tabindex="-1"></a><span class="ex">16</span>    1816</span>
<span id="cb220-18"><a href="#cb220-18" aria-hidden="true" tabindex="-1"></a><span class="ex">17</span>    1817</span>
<span id="cb220-19"><a href="#cb220-19" aria-hidden="true" tabindex="-1"></a><span class="ex">18</span>    1818</span>
<span id="cb220-20"><a href="#cb220-20" aria-hidden="true" tabindex="-1"></a><span class="ex">19</span>    1819</span>
<span id="cb220-21"><a href="#cb220-21" aria-hidden="true" tabindex="-1"></a><span class="ex">Name:</span> year, dtype: object</span>
<span id="cb220-22"><a href="#cb220-22" aria-hidden="true" tabindex="-1"></a><span class="ex">int64</span></span></code></pre></div>
<p>上手く数値に変換できたようです.</p>
<p>続いて,<code>value</code>列を数値のみにして<code>float</code>型にしてみましょう.</p>
<p>こちらも同じように<code>df['value'] = df['value'].astype(float)</code>ではエラー(<code>ValueError: could not convert string to float: 'なし'</code>)が出ます.</p>
<p>色々方法はありますが,<code>NaN</code>と<code>'なし'</code>の列は適当な値(<code>150</code>)を入れることにしてみましょう.
数値に変換できる場合に<code>True</code>を返す<code>str.isdecimal()</code>を利用して,上から一つひとつ数値に変換可能か識別して,できない場合”150”を入れてみます.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------</span></span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a><span class="co"># value列をfloat型にする</span></span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------</span></span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> df.index:</span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 数値型に変換可能か調べるには</span></span>
<span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># isdecimal関数を使う</span></span>
<span id="cb221-7"><a href="#cb221-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 変換可能でない場合&#39;150&#39;を入れる</span></span>
<span id="cb221-8"><a href="#cb221-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span>(<span class="bu">str</span>.isdecimal(df.at[i, <span class="st">&#39;value&#39;</span>])):</span>
<span id="cb221-9"><a href="#cb221-9" aria-hidden="true" tabindex="-1"></a>        df.at[i, <span class="st">&#39;value&#39;</span>] <span class="op">=</span> <span class="st">&#39;150&#39;</span></span>
<span id="cb221-10"><a href="#cb221-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-11"><a href="#cb221-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 確認</span></span>
<span id="cb221-12"><a href="#cb221-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">&#39;value&#39;</span>])</span></code></pre></div>
<div class="sourceCode" id="cb222"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>     101</span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>     187</span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>     150</span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>     117</span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>     150</span>
<span id="cb222-6"><a href="#cb222-6" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>     168</span>
<span id="cb222-7"><a href="#cb222-7" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>     195</span>
<span id="cb222-8"><a href="#cb222-8" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>     140</span>
<span id="cb222-9"><a href="#cb222-9" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>     151</span>
<span id="cb222-10"><a href="#cb222-10" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>     123</span>
<span id="cb222-11"><a href="#cb222-11" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>    192</span>
<span id="cb222-12"><a href="#cb222-12" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>    137</span>
<span id="cb222-13"><a href="#cb222-13" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>    150</span>
<span id="cb222-14"><a href="#cb222-14" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>    184</span>
<span id="cb222-15"><a href="#cb222-15" aria-hidden="true" tabindex="-1"></a><span class="ex">14</span>    136</span>
<span id="cb222-16"><a href="#cb222-16" aria-hidden="true" tabindex="-1"></a><span class="ex">15</span>    192</span>
<span id="cb222-17"><a href="#cb222-17" aria-hidden="true" tabindex="-1"></a><span class="ex">16</span>    150</span>
<span id="cb222-18"><a href="#cb222-18" aria-hidden="true" tabindex="-1"></a><span class="ex">17</span>    163</span>
<span id="cb222-19"><a href="#cb222-19" aria-hidden="true" tabindex="-1"></a><span class="ex">18</span>    141</span>
<span id="cb222-20"><a href="#cb222-20" aria-hidden="true" tabindex="-1"></a><span class="ex">19</span>    122</span>
<span id="cb222-21"><a href="#cb222-21" aria-hidden="true" tabindex="-1"></a><span class="ex">Name:</span> value, dtype: object</span></code></pre></div>
<p>無事に数値に変換できました.</p>
<p>このように, <code>pandas</code>ではイテラブルオブジェクトとして<code>index</code>や<code>columns</code>を利用し,<code>.at[]</code>などを利用してデータを編集する必要がある場合が多いです.
<code>pandas</code>で<code>for文</code>,<code>if文</code>などの組み合わせた処理に慣れておきましょう.</p>
<p>もう少し複雑な例についても見てみましょう. 以下のDataFrameにおいて,グループ別の平均点を求めてみましょう.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span>  {<span class="st">&#39;group&#39;</span>: [<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span></span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a>                  , <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span></span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a>                  , <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>]</span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a>        ,<span class="st">&#39;points&#39;</span>: [ <span class="dv">45</span>, <span class="dv">23</span>, <span class="dv">58</span>, <span class="dv">96</span>, <span class="dv">38</span>, <span class="dv">41</span>, <span class="dv">33</span>, <span class="dv">30</span>, <span class="dv">82</span>, <span class="dv">42</span></span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a>                   , <span class="dv">42</span>, <span class="dv">89</span>, <span class="dv">66</span>, <span class="dv">94</span>, <span class="dv">25</span>, <span class="dv">36</span>, <span class="dv">52</span>, <span class="dv">40</span>, <span class="dv">93</span>, <span class="dv">80</span></span>
<span id="cb223-6"><a href="#cb223-6" aria-hidden="true" tabindex="-1"></a>                   , <span class="dv">44</span>, <span class="dv">39</span>, <span class="dv">79</span>, <span class="dv">67</span>, <span class="dv">38</span>, <span class="dv">43</span>, <span class="dv">100</span>, <span class="dv">62</span>, <span class="dv">54</span>]}</span>
<span id="cb223-7"><a href="#cb223-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data)</span>
<span id="cb223-8"><a href="#cb223-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code></pre></div>
<div class="sourceCode" id="cb224"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>    <span class="ex">group</span>  points</span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>       5      45</span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>       5      23</span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>       1      58</span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>       2      96</span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>       1      38</span>
<span id="cb224-7"><a href="#cb224-7" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span>       5      41</span>
<span id="cb224-8"><a href="#cb224-8" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span>       4      33</span>
<span id="cb224-9"><a href="#cb224-9" aria-hidden="true" tabindex="-1"></a><span class="ex">7</span>       3      30</span>
<span id="cb224-10"><a href="#cb224-10" aria-hidden="true" tabindex="-1"></a><span class="ex">8</span>       2      82</span>
<span id="cb224-11"><a href="#cb224-11" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span>       1      42</span>
<span id="cb224-12"><a href="#cb224-12" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span>      5      42</span>
<span id="cb224-13"><a href="#cb224-13" aria-hidden="true" tabindex="-1"></a><span class="ex">11</span>      3      89</span>
<span id="cb224-14"><a href="#cb224-14" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span>      4      66</span>
<span id="cb224-15"><a href="#cb224-15" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span>      1      94</span>
<span id="cb224-16"><a href="#cb224-16" aria-hidden="true" tabindex="-1"></a><span class="ex">14</span>      2      25</span>
<span id="cb224-17"><a href="#cb224-17" aria-hidden="true" tabindex="-1"></a><span class="ex">15</span>      4      36</span>
<span id="cb224-18"><a href="#cb224-18" aria-hidden="true" tabindex="-1"></a><span class="ex">16</span>      5      52</span>
<span id="cb224-19"><a href="#cb224-19" aria-hidden="true" tabindex="-1"></a><span class="ex">17</span>      1      40</span>
<span id="cb224-20"><a href="#cb224-20" aria-hidden="true" tabindex="-1"></a><span class="ex">18</span>      1      93</span>
<span id="cb224-21"><a href="#cb224-21" aria-hidden="true" tabindex="-1"></a><span class="ex">19</span>      1      80</span>
<span id="cb224-22"><a href="#cb224-22" aria-hidden="true" tabindex="-1"></a><span class="ex">20</span>      2      44</span>
<span id="cb224-23"><a href="#cb224-23" aria-hidden="true" tabindex="-1"></a><span class="ex">21</span>      3      39</span>
<span id="cb224-24"><a href="#cb224-24" aria-hidden="true" tabindex="-1"></a><span class="ex">22</span>      1      79</span>
<span id="cb224-25"><a href="#cb224-25" aria-hidden="true" tabindex="-1"></a><span class="ex">23</span>      2      67</span>
<span id="cb224-26"><a href="#cb224-26" aria-hidden="true" tabindex="-1"></a><span class="ex">24</span>      4      38</span>
<span id="cb224-27"><a href="#cb224-27" aria-hidden="true" tabindex="-1"></a><span class="ex">25</span>      4      43</span>
<span id="cb224-28"><a href="#cb224-28" aria-hidden="true" tabindex="-1"></a><span class="ex">26</span>      3     100</span>
<span id="cb224-29"><a href="#cb224-29" aria-hidden="true" tabindex="-1"></a><span class="ex">27</span>      4      62</span>
<span id="cb224-30"><a href="#cb224-30" aria-hidden="true" tabindex="-1"></a><span class="ex">28</span>      4      54</span></code></pre></div>
<p>一度, 以下の解答例を見ずに,自分でフローチャートとプログラムを考えてみましょう.</p>
<ul>
<li><h2 id="回答例">回答例</h2></li>
</ul>
<div class="note">
<p>このような処理のプログラムが書けるかどうかは,どのような手順でデータを操作するかをイメージできるかで決まります. これは,プログラミングの文法知識などの問題ではなく,パズルを解くようないわゆる論理的思考や,プログラミング的思考と呼ばれる能力です.</p>
<p>こういった処理を｢どのようにしたら思いつくことができるのか｣はなかなか教えるのが難しいのですが,一つの手順として,<strong>一旦プログラムのことは忘れて,紙と鉛筆でどのように同じ問題を解くかを考えてみる</strong>というのが有効な場合があります.プログラムになれると,直接プログラムで記述することが出来るようになります. しかし,プログラム的思考に慣れていない人はそもそも何をすればいいのかわからないのでプログラムが書けません.</p>
<p>何をすればいいのか皆目検討がつかないという人は, 自分が,紙と鉛筆でどのように解くのかを考えて,それをアルゴリズムに変更し,プログラムに直すという手順を踏んでみましょう.</p>
</div>
<p>求めなければならないものをまずはイメージしてみましょう.求めるものは,以下のように,グループごとの値の合計値をグループの数で割ったものです.</p>
<figure>
<img src="/images/average_by_group.png" alt="問題のイメージ" />
<figcaption aria-hidden="true">問題のイメージ</figcaption>
</figure>
<p>この問題を紙と鉛筆で求める場合,どのような方法があるでしょうか.</p>
<p>一例として,上から1行ずつデータを確認し,グループ別に<code>points</code>の値をメモする. すべての行を記録し終えたら,グループ別のメモの値を合計値とデータの数を求めて,平均値を計算するという方法でやってみましょう.
小学生でも順番を守れば可能な方法ですね.</p>
<figure>
<img src="/images/average_by_group2.png" alt="解き方のイメージ" />
<figcaption aria-hidden="true">解き方のイメージ</figcaption>
</figure>
<p>まず,グループ別のメモをする場所を作成します.どのようなデータ型でも構いませんが,ここでは辞書型で作成してみます.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>memo <span class="op">=</span> {<span class="dv">1</span>:[]</span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>       ,<span class="dv">2</span>:[]</span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a>       ,<span class="dv">3</span>:[]</span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a>       ,<span class="dv">4</span>:[]</span>
<span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a>       ,<span class="dv">5</span>:[]}</span></code></pre></div>
<p>データを1行ずつ確認し,メモ帳に記録していきます.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> df.index:</span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>    memo[df.at[i,<span class="st">&#39;group&#39;</span>]] <span class="op">+=</span> [df.at[i,<span class="st">&#39;points&#39;</span>]]</span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-4"><a href="#cb226-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(memo)</span>
<span id="cb226-5"><a href="#cb226-5" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb226-6"><a href="#cb226-6" aria-hidden="true" tabindex="-1"></a><span class="co">{ 1: [58, 38, 42, 94, 40, 93, 80, 79]</span></span>
<span id="cb226-7"><a href="#cb226-7" aria-hidden="true" tabindex="-1"></a><span class="co">, 2: [96, 82, 25, 44, 67]</span></span>
<span id="cb226-8"><a href="#cb226-8" aria-hidden="true" tabindex="-1"></a><span class="co">, 3: [30, 89, 39, 100]</span></span>
<span id="cb226-9"><a href="#cb226-9" aria-hidden="true" tabindex="-1"></a><span class="co">, 4: [33, 66, 36, 38, 43, 62, 54]</span></span>
<span id="cb226-10"><a href="#cb226-10" aria-hidden="true" tabindex="-1"></a><span class="co">, 5: [45, 23, 41, 42, 52]}</span></span>
<span id="cb226-11"><a href="#cb226-11" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>記録したメモを元に,一つひとつ合計値とデータ数を求め,平均値を計算してみます.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="co">#グループ1からグループ5まで順番に作業する</span></span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">6</span>):</span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a>    length <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">#グループ別のリストを足していく</span></span>
<span id="cb227-6"><a href="#cb227-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> memo[i]:</span>
<span id="cb227-7"><a href="#cb227-7" aria-hidden="true" tabindex="-1"></a>        total <span class="op">+=</span> x</span>
<span id="cb227-8"><a href="#cb227-8" aria-hidden="true" tabindex="-1"></a>        length <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb227-9"><a href="#cb227-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;group:</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">, mean:</span><span class="sc">{</span>total<span class="op">/</span>length<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb227-10"><a href="#cb227-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-11"><a href="#cb227-11" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb227-12"><a href="#cb227-12" aria-hidden="true" tabindex="-1"></a><span class="co">group:1, mean:65.5</span></span>
<span id="cb227-13"><a href="#cb227-13" aria-hidden="true" tabindex="-1"></a><span class="co">group:2, mean:62.8</span></span>
<span id="cb227-14"><a href="#cb227-14" aria-hidden="true" tabindex="-1"></a><span class="co">group:3, mean:64.5</span></span>
<span id="cb227-15"><a href="#cb227-15" aria-hidden="true" tabindex="-1"></a><span class="co">group:4, mean:47.42857142857143</span></span>
<span id="cb227-16"><a href="#cb227-16" aria-hidden="true" tabindex="-1"></a><span class="co">group:5, mean:40.6</span></span>
<span id="cb227-17"><a href="#cb227-17" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>これで無事に,グループ別のデータが求められました.
当然,もっと効率的で,簡単に計算する方法は沢山あります. 似た問題を検索し特定のメソッドを利用したり,AIに聞くことで,何も考えずに計算することも可能です.</p>
<p>例えば, 先程の平均値の計算部分に関しては,組み込み関数の<code>sum()</code>や<code>len()</code>を利用することで,自分で書かなくても計算が可能です.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">6</span>):</span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;group:</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">,mean:</span><span class="sc">{</span><span class="bu">sum</span>(memo[i])<span class="op">/</span><span class="bu">len</span>(memo[i])<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a><span class="co">group:1,mean:65.5</span></span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a><span class="co">group:2,mean:62.8</span></span>
<span id="cb228-7"><a href="#cb228-7" aria-hidden="true" tabindex="-1"></a><span class="co">group:3,mean:64.5</span></span>
<span id="cb228-8"><a href="#cb228-8" aria-hidden="true" tabindex="-1"></a><span class="co">group:4,mean:47.42857142857143</span></span>
<span id="cb228-9"><a href="#cb228-9" aria-hidden="true" tabindex="-1"></a><span class="co">group:5,mean:40.6</span></span>
<span id="cb228-10"><a href="#cb228-10" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>また,以前扱った条件抽出を使えば,一つ一つデータを集める必要もありません. 以下の3行で同じことが可能です.</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">6</span>):</span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>    group_mean <span class="op">=</span> df[df[<span class="st">&#39;group&#39;</span>] <span class="op">==</span> i][<span class="st">&#39;points&#39;</span>].mean()</span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;group:</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">,mean:</span><span class="sc">{</span>group_mean<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb229-5"><a href="#cb229-5" aria-hidden="true" tabindex="-1"></a><span class="co">group:1,mean:65.5</span></span>
<span id="cb229-6"><a href="#cb229-6" aria-hidden="true" tabindex="-1"></a><span class="co">group:2,mean:62.8</span></span>
<span id="cb229-7"><a href="#cb229-7" aria-hidden="true" tabindex="-1"></a><span class="co">group:3,mean:64.5</span></span>
<span id="cb229-8"><a href="#cb229-8" aria-hidden="true" tabindex="-1"></a><span class="co">group:4,mean:47.42857142857143</span></span>
<span id="cb229-9"><a href="#cb229-9" aria-hidden="true" tabindex="-1"></a><span class="co">group:5,mean:40.6</span></span>
<span id="cb229-10"><a href="#cb229-10" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>更に,<code>pandas</code>の<code>.groupby()</code>メソッドを使えば,1行で同じような処理が可能です.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.groupby(<span class="st">&#39;group&#39;</span>).mean())</span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a><span class="co">         points</span></span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a><span class="co">group</span></span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a><span class="co">1      65.500000</span></span>
<span id="cb230-6"><a href="#cb230-6" aria-hidden="true" tabindex="-1"></a><span class="co">2      62.800000</span></span>
<span id="cb230-7"><a href="#cb230-7" aria-hidden="true" tabindex="-1"></a><span class="co">3      64.500000</span></span>
<span id="cb230-8"><a href="#cb230-8" aria-hidden="true" tabindex="-1"></a><span class="co">4      47.428571</span></span>
<span id="cb230-9"><a href="#cb230-9" aria-hidden="true" tabindex="-1"></a><span class="co">5      40.600000</span></span>
<span id="cb230-10"><a href="#cb230-10" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>しかし,そのような方法ではいつまでたっても自分でプログラムが書けるようにはなりません.また,便利なメソッドが使えても,その背後で何をしているのかを理解していないと,計算した値の意味を理解したり,正しく利用することができません.</p>
<p>まずは自分の頭でどのように処理することで,求めたい値が計算できるのかの手順を考えて,プログラムが書けるようになったあとで,便利なメソッドなどの利用法を覚えることをおすすめします.</p>
<h4 data-number="6.4.2.6" id="発展-高階関数"><span class="header-section-number">6.4.2.6</span> 発展: 高階関数</h4>
<p>Pythonで反復を実現するもう一つの方法として<strong>高階関数</strong>があります.高階関数とは,関数を引数にとる関数であり,こちらも関数型言語から取り入れられ,<code>pandas</code>において<strong>各行に同じ処理を適用したい場合</strong>に良く用いられます.</p>
<p>本資料ではまだ,関数に関して扱っていませんが,発展的内容としてここだけで完結する範囲で簡単に説明します.
興味がある方は, 関数を学んだあとにもう一度こちらを見てみると理解が深まるかもしれません.</p>
<p>以下の<code>DataFrame</code>を事例に考えてみましょう.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">&#39;kind&#39;</span>:[<span class="st">&#39;cat&#39;</span>,<span class="st">&#39;dog&#39;</span>,<span class="st">&#39;fish&#39;</span>]</span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>                  ,<span class="st">&#39;weight&#39;</span>:[<span class="dv">30</span>,<span class="dv">20</span>,<span class="dv">10</span>]})</span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb231-6"><a href="#cb231-6" aria-hidden="true" tabindex="-1"></a><span class="co">   kind  weight</span></span>
<span id="cb231-7"><a href="#cb231-7" aria-hidden="true" tabindex="-1"></a><span class="co">0   cat      30</span></span>
<span id="cb231-8"><a href="#cb231-8" aria-hidden="true" tabindex="-1"></a><span class="co">1   dog      20</span></span>
<span id="cb231-9"><a href="#cb231-9" aria-hidden="true" tabindex="-1"></a><span class="co">2  fish      10</span></span>
<span id="cb231-10"><a href="#cb231-10" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>このデータの<code>kind列</code>を大文字にすることを考えてみましょう.
<code>for文</code>を利用すると以下のようになりますね.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> df.index:</span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>    df.at[i,<span class="st">&#39;kind&#39;</span>] <span class="op">=</span> df.at[i,<span class="st">&#39;kind&#39;</span>].upper()</span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-6"><a href="#cb232-6" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb232-7"><a href="#cb232-7" aria-hidden="true" tabindex="-1"></a><span class="co">   kind  weight</span></span>
<span id="cb232-8"><a href="#cb232-8" aria-hidden="true" tabindex="-1"></a><span class="co">0   CAT      30</span></span>
<span id="cb232-9"><a href="#cb232-9" aria-hidden="true" tabindex="-1"></a><span class="co">1   DOG      20</span></span>
<span id="cb232-10"><a href="#cb232-10" aria-hidden="true" tabindex="-1"></a><span class="co">2  FISH      10</span></span>
<span id="cb232-11"><a href="#cb232-11" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>この処理を,高階関数<code>map()</code>を利用すると,以下のようになります.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;kind&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;kind&#39;</span>].<span class="bu">map</span>(<span class="kw">lambda</span> x : x.upper())</span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a><span class="co">   kind  weight</span></span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a><span class="co">0   CAT      30</span></span>
<span id="cb233-6"><a href="#cb233-6" aria-hidden="true" tabindex="-1"></a><span class="co">1   DOG      20</span></span>
<span id="cb233-7"><a href="#cb233-7" aria-hidden="true" tabindex="-1"></a><span class="co">2  FISH      10</span></span>
<span id="cb233-8"><a href="#cb233-8" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p><code>map()</code>は,与えられた<code>DataFrame</code>の列(<code>DataSeries</code>)の各行に対して,<code>()</code>内の処理を適用した結果を返す高階関数です.</p>
<p><code>lambda x: x.upper()</code>を<code>無名関数</code>や<code>ラムダ式</code>といい, <code>lambda 変数: 変数に適用したい処理</code>の形で書きます. 今は,<code>DataSeries</code>の各行を<code>x</code>として,その<code>x</code>に<code>.upper()</code>を適用しています.</p>
<p><code>条件に合致する場合の処理 if 条件 else 合致しない場合の処理</code> と書くことで条件を加えることも可能です.</p>
<p>以下の例では, <code>weight</code>列の値が<code>15</code>より大きければ2倍するという処理を行っています.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;weight&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;weight&#39;</span>].<span class="bu">map</span>(<span class="kw">lambda</span> x: x<span class="op">*</span><span class="dv">2</span> <span class="cf">if</span> x <span class="op">&gt;</span> <span class="dv">15</span> <span class="cf">else</span> x)</span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a><span class="co">   kind  weight</span></span>
<span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a><span class="co">0   CAT      60</span></span>
<span id="cb234-6"><a href="#cb234-6" aria-hidden="true" tabindex="-1"></a><span class="co">1   DOG      40</span></span>
<span id="cb234-7"><a href="#cb234-7" aria-hidden="true" tabindex="-1"></a><span class="co">2  FISH      10</span></span>
<span id="cb234-8"><a href="#cb234-8" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>高階関数を使った処理は,<code>for文</code>より簡潔に書けて,かつ処理速度も高速です. 機会があれば積極的に使ってみましょう.</p>
<p>例えば,先程の以下のDataFrameで,<code>year列</code>から年を削除し,<code>value列</code>の空白を<code>150</code>に置き換える処理は高階関数を利用すると以下のように書けます.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a>years <span class="op">=</span> [<span class="bu">str</span>(x) <span class="op">+</span> <span class="st">&#39;年&#39;</span> <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1800</span>,<span class="dv">1820</span>)]</span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> [<span class="st">&#39;101&#39;</span>,<span class="st">&#39;187&#39;</span>,<span class="st">&#39;150&#39;</span>,<span class="st">&#39;117&#39;</span>,<span class="st">&#39;&#39;</span>,<span class="st">&#39;168&#39;</span></span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a>         ,<span class="st">&#39;195&#39;</span>,<span class="st">&#39;140&#39;</span>,<span class="st">&#39;151&#39;</span>,<span class="st">&#39;123&#39;</span>,<span class="st">&#39;192&#39;</span>,<span class="st">&#39;137&#39;</span></span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a>         ,<span class="st">&#39;なし&#39;</span>,<span class="st">&#39;184&#39;</span>,<span class="st">&#39;136&#39;</span>,<span class="st">&#39;192&#39;</span>,<span class="st">&#39;150&#39;</span>,<span class="st">&#39;163&#39;</span>,<span class="st">&#39;141&#39;</span>,<span class="st">&#39;122&#39;</span>]</span>
<span id="cb235-7"><a href="#cb235-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-8"><a href="#cb235-8" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">&#39;year&#39;</span>:years</span>
<span id="cb235-9"><a href="#cb235-9" aria-hidden="true" tabindex="-1"></a>                  ,<span class="st">&#39;value&#39;</span>:values})</span>
<span id="cb235-10"><a href="#cb235-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb235-11"><a href="#cb235-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-12"><a href="#cb235-12" aria-hidden="true" tabindex="-1"></a>f[<span class="st">&#39;year&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;year&#39;</span>].<span class="bu">map</span>(<span class="kw">lambda</span> x : x[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb235-13"><a href="#cb235-13" aria-hidden="true" tabindex="-1"></a>f[<span class="st">&#39;value&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;value&#39;</span>].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="st">&#39;150&#39;</span> <span class="cf">if</span> <span class="bu">str</span>.isdecimal(<span class="bu">str</span>(x)) <span class="cf">else</span> x)</span></code></pre></div>
<div class="note">
<ul>
<li>演習問題</li>
</ul>
<p>以下のURLから近世経済データのEXCELファイルをダウンロードし, 米相場の列に欠損値がないように変更し,データの基本的な構造を確認したのち米相場の西暦ごとの平均値を計算し,辞書型に格納してください.</p>
<p><a href="https://www.rieb.kobe-u.ac.jp/project/kinsei-db/database_excel.html">https://www.rieb.kobe-u.ac.jp/project/kinsei-db/database_excel.html</a></p>
</div>
<h2 data-number="6.5" id="関数とクラス"><span class="header-section-number">6.5</span> 関数とクラス</h2>
<p>これまでは,基本的に記述したコードは,コード内で一度しか利用せず,上から順番に一つずつ行いたい処理を記述してきました. しかし,プログラミングを続けていると,同じ処理を何度も適用する場合が出てきます.その場合に,毎回処理を記述するのは労力がかかります.</p>
<p>ここでは, 同じ処理を再利用可能な形でまとめ,様々な場所で利用する方法を学びます.</p>
<p>Pythonでは,基本的に小さな一つの処理は<strong>関数</strong>にまとめて利用します.また,複数の関数やデータ型などを<strong>クラス</strong>という単位にまとめることも可能です.そのようなまとめた塊を組み合わせてプログラムを構築する手法を<strong>オブジェクト指向プログラミング</strong>といいます. 更に,いくつかの関数やクラスをまとめたものを再利用形なファイルにまとめることで<strong>モジュール</strong>が作られ,モジュールに階層構造を設定したものを<strong>ライブラリ</strong>といいます.</p>
<p>この講義では関数の利用法を学びますがクラスやオブジェクト指向プログラミング,モジュールの作成に関しては少し触れるだけにします. 興味がある方は, より専門的なプログラミングの講義などで学習してください.</p>
<h3 data-number="6.5.1" id="関数"><span class="header-section-number">6.5.1</span> 関数</h3>
<p>皆さんはこれまでにもいくつかの関数を利用してきました. 例えば,リストの要素数を求めるための<code>len()</code>や,標準出力するための<code>print()</code>などは関数です.</p>
<p>関数は基本的に<code>()</code>の中に<strong>引数</strong>を与えられて,<strong>返り値</strong>を返します.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>])) <span class="co">#&gt;&gt;&gt; 3</span></span></code></pre></div>
<p>上の<code>len()</code>では,<code>()</code>の中に引数としてリスト<code>[1,2,3]</code>が与えられ,返り値として<code>3</code>を返しています.</p>
<div class="warn">
<p>一方で,関数と似ているが異なる概念として,<code>.mean()</code>のようにオブジェクトの後ろに<code>.</code>を利用してつなげる<strong>メソッド</strong>もあります.
メソッドに関しては, クラスの部分で説明します.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">&#39;x&#39;</span>:[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]})</span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.mean()) <span class="co">#&gt;&gt;&gt; 2.0</span></span></code></pre></div>
</div>
<p>このように,最初からPythonに実装されている関数を<strong>組み込み関数</strong>といいます.また,特定のライブラリで定義された関数もあります.</p>
<p>組み込み関数としては,<code>len()</code>以外にも,合計値を返す<code>sum()</code>や,文字列に変更する<code>str()</code>などを利用してきました. Pythonの組み込み関数は<a href="https://docs.python.org/ja/3/library/functions.html">こちら</a>で確認できます. 利用法のわからないものに関しては調べてみましょう.</p>
<p>これまでは,無名関数を除いて基本的にすでに作成された関数を利用してきましたが,関数は自分で作成することも可能です.</p>
<p>関数は, <code>def 関数名(引数を表す変数):</code>という構文で定義することができます. インデントブロックの中で,引数に加えた処理を記述し, <code>return 返り値</code>の形で,関数の返り値を定義します.</p>
<p>例えば,要素数を数える<code>length()</code>という関数を実装してみましょう.
まずは,関数にする前に今まで通りにリストの要素数を数えるプログラムを書いてみましょう.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> xs:</span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a>    count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(count) <span class="op">&gt;&gt;&gt;</span> <span class="dv">3</span></span></code></pre></div>
<p>これを関数にしてみます. <code>def length(xs):</code>のインデントブロックに,行いたい処理を記述し,<code>return count</code>で<code>count</code>を返します.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> length(xs):</span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>    count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> xs:</span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a>        count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb239-5"><a href="#cb239-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> count</span>
<span id="cb239-6"><a href="#cb239-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-7"><a href="#cb239-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(length([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>])) <span class="co">#&gt;&gt;&gt; 3</span></span>
<span id="cb239-8"><a href="#cb239-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(length([<span class="st">&#39;a&#39;</span>,<span class="st">&#39;b&#39;</span>])) <span class="co">#&gt;&gt;&gt; 2</span></span></code></pre></div>
<p>関数として定義することで,毎回数を数える処理を記述しなくても,様々なリストの要素数を数えることが可能になりました.</p>
<p>引数には複数の値を指定することも出来ます. 例えば以下の関数<code>get_larger_than(xs,y)</code>は<code>xs</code>の中から<code>y</code>より大きな値のみを返します.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_larger_than(xs,y):</span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> []</span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> xs:</span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> x <span class="op">&gt;</span> y:</span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a>            result.append(x)</span>
<span id="cb240-6"><a href="#cb240-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb240-7"><a href="#cb240-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-8"><a href="#cb240-8" aria-hidden="true" tabindex="-1"></a>get_larger_than([<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>],<span class="dv">3</span>) <span class="co">#&gt;&gt;&gt;[4, 5, 6]</span></span></code></pre></div>
<p><code>引数名=デフォルト引数</code> と書くことで,引数にあらかじめ値を指定することも可能です. 関数を実行する際に,何も指定しなければ,デフォルト引数が利用されます.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> greet(name<span class="op">=</span><span class="st">&#39;guest&#39;</span>, greeting<span class="op">=</span><span class="st">&quot;Hello&quot;</span>):</span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f&#39;</span><span class="sc">{</span>greeting<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">!&#39;</span></span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a><span class="co"># デフォルト引数を利用する場合</span></span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(greet())  <span class="co"># Hello, guest!</span></span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a><span class="co"># デフォルトの引数の一部を上書きする場合</span></span>
<span id="cb241-8"><a href="#cb241-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(greet(name<span class="op">=</span><span class="st">&#39;Taro&#39;</span>))  <span class="co"># Hello, Taro!</span></span>
<span id="cb241-9"><a href="#cb241-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(greet(greeting<span class="op">=</span><span class="st">&#39;Good Morning&#39;</span>))  <span class="co"># Good Morning, guest!</span></span>
<span id="cb241-10"><a href="#cb241-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-11"><a href="#cb241-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 全ての引数を指定する場合</span></span>
<span id="cb241-12"><a href="#cb241-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(greet(name<span class="op">=</span><span class="st">&#39;Taro&#39;</span>, greeting<span class="op">=</span><span class="st">&#39;Good Morning&#39;</span>))  <span class="co"># Good Morning, Taro!</span></span></code></pre></div>
<div class="note">
<ul>
<li>演習問題</li>
</ul>
<ol type="1">
<li><p>与えられた数値のリストの合計値を返す関数</p></li>
<li><p>与えられた数値のリストの最大値を返す関数</p></li>
<li><p>与えられた数値にFizzBuzzの結果を,文字列で返す関数</p></li>
<li><p>組み込み関数の<code>filter()</code>の仕様を調べて自分で実装してください.</p></li>
</ol>
</div>
<h3 data-number="6.5.2" id="発展クラスとインスタンス"><span class="header-section-number">6.5.2</span> 発展:クラスとインスタンス</h3>
<p>先ほど関数を自分で定義して使う方法を学習しましたが,Pythonではデータ型も自分で定義することができます.</p>
<div class="note">
<p><strong>クラス(Class)</strong> とは, データ型,データ型の保有するデータ(<strong>属性</strong>)とデータ型に付随する機能(<strong>メソッド</strong>)を定義する機能です.
クラスを具体化したものを<strong>インスタンス</strong>と呼びます.
また,インスタンスが生成される際に実行されるメソッドを<strong>コンストラクタ</strong>といいます.</p>
</div>
<p>これまでに見た例では,pandasの<code>DataFrame</code>などはライブラリによって新たに定義されたデータ型です. <code>.DataFrame()</code>という<strong>コンストラクタ</strong>によって具体的な<code>DataFrame</code><strong>インスタンス</strong>が生成されます.</p>
<p><code>DataFrame</code>オブジェクトの属性として,<code>shape</code>などを取得することができ,<code>.to_csv()</code>などの<code>DataFrame</code>に特有の機能(<strong>メソッド</strong>)を利用することができました.</p>
<p>それでは,具体的にクラスを作成してみましょう.
ここでは,これまでに何度か出てきた,<code>FizzBuzz</code>専用のクラスを作成してみましょう.</p>
<div class="note">
<p>新しいクラスを宣言するには <code>class クラス名:</code> と記述します. インデントブロック内に,コンストラクタと,メソッドを記述します. クラス名は大文字で始めます.</p>
<p>コンストラクタは, <code>def __init__(self,必要な情報):</code>の形で宣言します. <code>__init__(self,</code>の部分は基本的にすべてのクラスで共通です.
<code>FizzBuzz</code>クラスでは, 数値を引数に取ります. <code>self</code>は,属性やメソッドが属するインスタンスを表す変数でコンストラクタやメソッドの第1引数は常に<code>self</code>となります. <code>self.属性</code>,<code>self.メソッド()</code>などの形で,そのインスタンスの属性やメソッドを定義します.</p>
<p>各インスタンスに固有の属性をインスタンス属性といい,ここでは生成された<code>FizzBuzz</code>インスタンスは<code>.number</code>という属性を持ちます. <code>self.number = number</code>と買うことで生成時に引数として与えられた数値<code>number</code>をインスタンス属性として保存します.</p>
<p>最後に,<code>FizzBuzz</code>ゲームを実行するための機能,<code>.evaluate()</code>を実行します.</p>
</div>
<div class="sourceCode" id="cb242"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="co"># FizzBuzzというクラスを宣言します.</span></span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FizzBuzz:</span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">#コンストラクタの定義</span></span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#FizzBazzインスタンスを生成する際に必要となるデータを定義する</span></span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, number):</span>
<span id="cb242-6"><a href="#cb242-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">#インスタンス属性</span></span>
<span id="cb242-7"><a href="#cb242-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.number <span class="op">=</span> number</span>
<span id="cb242-8"><a href="#cb242-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-9"><a href="#cb242-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#メソッド eveluateの定義</span></span>
<span id="cb242-10"><a href="#cb242-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#FizzBuzzインスタンスは,evaluateすることで,`FizzBuzz`の</span></span>
<span id="cb242-11"><a href="#cb242-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">#ゲームが実行されます</span></span>
<span id="cb242-12"><a href="#cb242-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> evaluate(<span class="va">self</span>):</span>
<span id="cb242-13"><a href="#cb242-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.number <span class="op">%</span> <span class="dv">3</span> <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> <span class="va">self</span>.number <span class="op">%</span> <span class="dv">5</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb242-14"><a href="#cb242-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;FizzBuzz&quot;</span></span>
<span id="cb242-15"><a href="#cb242-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>.number <span class="op">%</span> <span class="dv">3</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb242-16"><a href="#cb242-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;Fizz&quot;</span></span>
<span id="cb242-17"><a href="#cb242-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>.number <span class="op">%</span> <span class="dv">5</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb242-18"><a href="#cb242-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&quot;Buzz&quot;</span></span>
<span id="cb242-19"><a href="#cb242-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb242-20"><a href="#cb242-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">str</span>(<span class="va">self</span>.number)</span>
<span id="cb242-21"><a href="#cb242-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-22"><a href="#cb242-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用例</span></span>
<span id="cb242-23"><a href="#cb242-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 単一の数値を評価</span></span>
<span id="cb242-24"><a href="#cb242-24" aria-hidden="true" tabindex="-1"></a>fb <span class="op">=</span> FizzBuzz(<span class="dv">15</span>)</span>
<span id="cb242-25"><a href="#cb242-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fb.evaluate())  <span class="co"># FizzBuzz</span></span>
<span id="cb242-26"><a href="#cb242-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-27"><a href="#cb242-27" aria-hidden="true" tabindex="-1"></a>fb <span class="op">=</span> FizzBuzz(<span class="dv">9</span>)</span>
<span id="cb242-28"><a href="#cb242-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fb.evaluate())  <span class="co"># Fizz</span></span>
<span id="cb242-29"><a href="#cb242-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-30"><a href="#cb242-30" aria-hidden="true" tabindex="-1"></a>fb <span class="op">=</span> FizzBuzz(<span class="dv">10</span>)</span>
<span id="cb242-31"><a href="#cb242-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fb.evaluate())  <span class="co"># Buzz</span></span>
<span id="cb242-32"><a href="#cb242-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-33"><a href="#cb242-33" aria-hidden="true" tabindex="-1"></a>fb <span class="op">=</span> FizzBuzz(<span class="dv">7</span>)</span>
<span id="cb242-34"><a href="#cb242-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fb.evaluate())  <span class="co"># 7</span></span></code></pre></div>
<p>クラスの重要な機能に<strong>継承</strong>があります. 継承は新しいクラス(<strong>サブクラス</strong>)を作成する際に,すでにあるクラス(<strong>スーパークラス</strong>)の属性やメソッドを引き継ぐことを意味します. これによって,コードの再利用や,拡張が用意になります.</p>
<p>以下では,先程定義した <code>FizzBuzz</code>クラスを継承して,<code>3</code>と<code>5</code>以外の場合にも特別な挙動をする<code>AdvancedFizzBuzz</code>クラスを定義してみましょう.</p>
<p>サブクラスを定義するには, <code>class サブクラス名(スーパークラス名)</code>と記述します.
インデントブロック内では, <code>super().属性</code>や<code>super().メソッド</code>と書くことで,スーパークラスの属性やメソッドを利用することができます.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 派生クラス AdvancedFizzBuzz</span></span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ()内にスーパークラスを書きます</span></span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AdvancedFizzBuzz(FizzBuzz):</span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, number, custom_message<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># スーパークラスの__init__を呼び出す</span></span>
<span id="cb243-6"><a href="#cb243-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(number)</span>
<span id="cb243-7"><a href="#cb243-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.custom_message <span class="op">=</span> custom_message</span>
<span id="cb243-8"><a href="#cb243-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-9"><a href="#cb243-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> evaluate(<span class="va">self</span>):</span>
<span id="cb243-10"><a href="#cb243-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># スーパークラスのevaluateメソッドを拡張</span></span>
<span id="cb243-11"><a href="#cb243-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># self.custom_message が定義されている場合のみ実行されます</span></span>
<span id="cb243-12"><a href="#cb243-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.custom_message <span class="kw">and</span> <span class="va">self</span>.number <span class="op">%</span> <span class="dv">7</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb243-13"><a href="#cb243-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.custom_message</span>
<span id="cb243-14"><a href="#cb243-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb243-15"><a href="#cb243-15" aria-hidden="true" tabindex="-1"></a>            <span class="co"># スーパークラスのevaluateメソッドを呼び出す</span></span>
<span id="cb243-16"><a href="#cb243-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">super</span>().evaluate()</span>
<span id="cb243-17"><a href="#cb243-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-18"><a href="#cb243-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-19"><a href="#cb243-19" aria-hidden="true" tabindex="-1"></a><span class="co"># サブクラスの使用例</span></span>
<span id="cb243-20"><a href="#cb243-20" aria-hidden="true" tabindex="-1"></a>afb <span class="op">=</span> AdvancedFizzBuzz(<span class="dv">21</span>, custom_message<span class="op">=</span><span class="st">&quot;Hozz&quot;</span>)</span>
<span id="cb243-21"><a href="#cb243-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(afb.evaluate())  <span class="co"># Hozz (7で割り切れるためカスタムメッセージ)</span></span>
<span id="cb243-22"><a href="#cb243-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-23"><a href="#cb243-23" aria-hidden="true" tabindex="-1"></a>afb <span class="op">=</span> AdvancedFizzBuzz(<span class="dv">10</span>)</span>
<span id="cb243-24"><a href="#cb243-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(afb.evaluate())  <span class="co"># Buzz (スーパークラスのメソッドが呼ばれる)</span></span></code></pre></div>
<div class="note">
<ul>
<li>演習</li>
</ul>
<ol type="1">
<li><p>FizzBuzzクラスを拡張して, <code>3</code>かつ<code>5</code>かつ<code>7</code>の倍数のときに<code>Hozz</code>と表示されるようにしてください.</p></li>
<li><p>ジャンケンを行うためのクラスを定義してください.</p></li>
</ol>
</div>
</details>
<h1 data-number="7" id="データサイエンスを始めよう-研究計画の建て方"><span class="header-section-number">7</span> データサイエンスを始めよう 研究計画の建て方</h1>
<details>
<summary>
開く/閉じる
</summary>
<p>ライブラリの章で説明したように,データサイエンスの作業は基本的に以下の順序で進みます.</p>
<figure>
<img src="/images/data-science-flow.png" alt="データ分析の流れ" />
<figcaption aria-hidden="true">データ分析の流れ</figcaption>
</figure>
<p>皆さんは, ここまでの講義において, データを取得し,前処理を実施する方法を学びました. データサイエンスは, 文字通りデータを利用する学問ですが,データが使える,編集できる状態にやっとなったわけです.</p>
<p>ここから,順に可視化, 数値化, 分析に進みますが,それと並行して,皆さんの研究計画を立てていきましょう. できれば,研究計画に沿ったデータを取得し, その可視化,数値化,分析を学習しながら自分のデータに適用していくことを目指します.</p>
<h1 data-number="8" id="モデルとデータ執筆中"><span class="header-section-number">8</span> モデルとデータ(執筆中)</h1>
<p>統計学やデータサイエンスはいずれもデータを利用しますが,データを利用して得たいものは何でしょうか. 統計学や,データサイエンスは,世界に何かしらの<strong>構造(モデル)</strong>が存在するという<strong>仮定</strong>をおいて,情報を利用してその構造を明らかにすることを目的としています.</p>
<ul>
<li><p>星の動きは特定のルールに従っている</p></li>
<li><p>コインを投げて表が出るか,裏が出るかは,コインの構造や投げ方で決まる</p></li>
</ul>
<p>社会科学では,そのような構造がない,あるいは変化する,作るなどの立場もありますが,ここでは深くは扱いません.</p>
<p>しかし, 世の中の何かしらの対象の動きや現象を決める構造はどのようにすれば明らかになるのでしょうか. 私達は,情報を解釈することでお野中の何かしらの現象の背景にモデルを見出します. 単純な法則であれば,目で見て,耳で聞いて,触ってという五感によってモデルを発見しますが, そのようなものも,視覚,聴覚,触覚などの情報といえます. 自然の情報は複雑すぎるためにそのような情報全ては利用できません, 私達は<strong>データ</strong>と言う形で情報を抽出し,利用可能な形態にまとめます. 情報をそのまま眺めていても,まだ人間には複雑過ぎます,そこで,統計やデータサイエンスの技法を用いてそれらの情報を何らかの基準でまとめて,理解可能な形,すなわち<strong>モデル</strong>に変形します.</p>
<figure>
<img src="/images/info-to-model.png" alt="情報の抽出" />
<figcaption aria-hidden="true">情報の抽出</figcaption>
</figure>
<div class="warn">
<p>統計におけるモデルの話(あとで載せる予定)</p>
</div>
<p>この講義はデータサイエンスを扱うので, <strong>データからデータを生み出した世界の背景にある構造を明らかにする</strong>ことを目指します. なので, これから皆さんに立ててもらう研究テーマを決めるには,<strong>自分が明らかにしたい構造</strong>を決めて貰う必要があります.</p>
<div class="note">
<p>過去のこの講義における研究テーマでは,</p>
<ul>
<li><h2 id="大学の学生の成績が決定する構造とは"><strong>大学の学生の成績が決定する構造とは?</strong></h2>
<p>大学の学習データを用いたカテゴリーデータ解析によって, 授業形態別に良い成績を取る学生とそうでない学生の特徴を明らかにしました.</p></li>
<li><h2 id="ヒット曲を生み出す構造は"><strong>ヒット曲を生み出す構造は?</strong></h2>
<p>過去のヒット曲データや歌詞を利用したクラスタリングによって, 時代ごとのヒット曲の変遷と,ヒット曲になりやすい曲の特徴を明らかにしました.</p></li>
<li><h2 id="大学の電力消費を決めている構造は"><strong>大学の電力消費を決めている構造は?</strong></h2>
<p>大学の棟別の電力データを利用した時系列解析によって,大学の電力消費に影響の大きい要素を明らかにしました.</p></li>
<li><h2 id="国ごとのlgbtqに関する言説を決める要因は"><strong>国ごとのLGBTQに関する言説を決める要因は?</strong></h2>
<p>言語毎のLGBTQに関するWikipediaの記事の自然言語解析結果と,世界LGBTQ需要度ランキングの関係性を明らかにしました.</p></li>
<li><h2 id="大学生のメンタルヘルスを決める構造は"><strong>大学生のメンタルヘルスを決める構造は?</strong></h2>
<p>アンケート調査を利用した共分散構造分析によって,大学生の大学生活の様子とメンタルヘルスの関係を明らかにしました.</p></li>
</ul>
<p>などなど,それぞれが知りたい,何かの現象を生み出す構造を明らかにする研究を実施しました.</p>
<p>皆さんが研究テーマを決めるにあたって,必要となる第一歩は,<strong>何の</strong>,<strong>何を決める</strong>構造が知りたいのかを決めることです.</p>
</div>
<p>ところで,<strong>構造を明らかにする</strong>と言ってもどのようにするのでしょうか.</p>
<p>これから学ぶ様々な統計,データサイエンスの手法によって,明らかにすることができる構造は異なります.</p>
<div class="note">
<p>例えば,</p>
<ul>
<li><h2 id="関係がある-相関"><strong>関係がある → 相関</strong></h2>
<p>SDGsに取り組む企業は, 生産性が高い傾向がある
成績が良い学生は, 勉強時間が長い傾向がある
ただし, 傾向があるだけで, 勉強を沢山すれば,成績が伸びるという説明(因果関係)はできない</p></li>
<li><h2 id="違いがある-検定"><strong>違いがある → 検定</strong></h2>
<p>オンデマンド授業の方が, 対面授業よりも学生の成績が高い</p></li>
<li><h2 id="モデルで説明できる予測できる-多変量解析-統計モデリング回帰など"><strong>モデルで説明できる(予測できる) → 多変量解析, 統計モデリング(回帰など)</strong></h2>
<p>生産性がX高まると,SDGsへの取り組みの量がY増える</p></li>
<li><h2 id="区別要約できる-クラスタリング次元削減"><strong>区別/要約できる → クラスタリング,次元削減</strong></h2>
<p>流行りの音楽は,5つのグループに区別できる
流行りの音楽の特徴をまとめると,XやYである.</p></li>
</ul>
<p>といった手法があります. 自分が,対象の何を知りたいのかを明らかにすることで,使用する手法は異なります.</p>
</div>
<p>この講義では, 分析手法を扱う章でこれらの手法を扱います. 時間の都合上すべてを詳細に扱うことはできませんが,自分の知りたい対象に使える手法1つか2つだけを選んで,それを利用できるようにしていきましょう.</p>
<h2 data-number="8.1" id="手法の決め方"><span class="header-section-number">8.1</span> 手法の決め方</h2>
<p>統計やデータサイエンスは非常に広い学問なので,その学習では様々な手法を断片的に学習し, その後必要となる特定の手法を深く学ぶというのが一般的です. では,必要となる手法はどのように決めるのでしょうか.</p>
<p>手法は,目的とデータによって決まります. まず,目的(何が知りたいか)が決まり,利用できるデータが決まったあとに,使える手法(何が言えるか)が決まります. これは目的が先にあるパターンですが,データが先,使いたい手法が先などで研究計画が決まる場合もあります.</p>
<figure>
<img src="/images/purpose_method_data.png" alt="目的,手法,データ" />
<figcaption aria-hidden="true">目的,手法,データ</figcaption>
</figure>
<div class="warn">
<ul>
<li><h2 id="harkingについて"><strong>HARKing</strong>について</h2></li>
</ul>
<p>この講義はあくまで,研究を通じてデータサイエンスの手法を学習することを目指しているため, 以下の様に,手法やデータ優先で研究計画を立てることも認めていますが,研究の世界では, データが有り,何かしらの手法で分析した後に,その結果を元々知りたかったかのように報告することは<a href="http://journals.sagepub.com/doi/10.1207/s15327957pspr0203_4"><strong>HARKing</strong></a>と呼ばれる研究不正の一種とみなされる場合があります.</p>
<p>データ優位の分析は,データサイエンス分野や,観察研究と呼ばれる分野でしばしば行われていますし,特定の手法が利用可能な分野やデータを選択することは特定の手法の学習のためには有用です.</p>
<p>しかし,<strong>統計的仮説検定</strong>などの統計的な仮説を前提とする分野では,望ましい態度ではないとされています.</p>
<p>卒業研究などで,研究をする場合には,指導教官の指導方針に従って,研究計画を立てるようにしましょう.</p>
</div>
<div class="note">
<ul>
<li><h2 id="目的から"><strong>目的から</strong></h2>
<ul>
<li><p>この構造を明らかにしたい.</p></li>
<li><p>→ この構造から生じたデータを集める → このデータを使って構造を表す手法を選ぶ</p></li>
<li><p>→ この手法で明らかになる →この手法が使えるデータを集める</p></li>
</ul></li>
<li><h2 id="データから"><strong>データから</strong></h2>
<ul>
<li><p>このデータを分析したい</p></li>
<li><p>→ このデータを分析できる手法を選ぶ → この手法とデータから明らかになることを考える</p></li>
<li><p>→ このデータから明らかにしたい構造を考える → データから構造を明らかにする手法を考える</p></li>
</ul></li>
<li><h2 id="手法から"><strong>手法から</strong></h2>
<ul>
<li><p>この手法を使いたい,作りたい</p></li>
<li><p>→ この手法で何が明らかになるのかを決める → この手法が使えるデータを集める</p></li>
<li><p>→この手法が使えるデータを集める → この手法とデータから明らかになることを考える</p></li>
</ul></li>
</ul>
</div>
<h2 data-number="8.2" id="研究計画を建てよう"><span class="header-section-number">8.2</span> 研究計画を建てよう</h2>
<p><strong>目的,データ,手法</strong>いずれかを決めましょう.</p>
<div class="note">
<ul>
<li><h2 id="目的の決め方"><strong>目的の決め方</strong></h2>
<ul>
<li><p>自分の知りたい構造を沢山挙げる</p></li>
<li><p>その構造の仮説を立てる</p>
<p>例: Twitterでバズる方法には規則があるかもしれない?, 少子高齢化には背景に構造があるかもしれない?</p></li>
<li><p>→ すでに明らかになっていないか,本,論文を探す(先行研究).</p>
<p>何が分かっていて何が分かっていないのか?</p></li>
<li><p>大変なところ: アイデア勝負(創造性), 先行研究を調べるのが大変</p></li>
</ul></li>
<li><h2 id="手法の決め方-1"><strong>手法の決め方</strong></h2>
<ul>
<li><p>沢山の手法の原理/使い方を学ぶ</p></li>
<li><p>興味のある,自分で使えるようになりたい手法を選ぶ</p>
<p>例:兎に角テキスト解析してみたいぜ!, 取り敢えず統計モデルっていうものを作ってみたいぜ!</p></li>
<li><p>→ その手法について学習して, 使えるようにする.</p>
<p>どんな原理で,何が明らかになるもので,どのように使うのか?</p></li>
<li><p>大変なところ: 手法は難しい,沢山ありすぎる,数学とかプログラミングが必要</p></li>
</ul></li>
<li><h2 id="データの決め方"><strong>データの決め方</strong></h2>
<ul>
<li><p>様々なデータを探す/自分でデータを作ってみる(実験,調査)</p></li>
<li><p>→ データの特徴を分析(記述統計学),設計する(実験計画)</p>
<p>例: 取り敢えずYoutubeの視聴データが面白そう!, 大学の教育のデータから何が言えるかな?, アンケート調査とかしてみたい!</p></li>
<li><p>大変なところ: 実験や調査は手間がかかる. データの特徴を調べないといけない.</p></li>
</ul></li>
</ul>
<p>この3つをそれぞれ,自分の興味のあるものを考えて見よう.
最低3アイデアを考えてみましょう.(目的1つで3つでも, それぞれ1つずつでもOK)</p>
</div>
<p>どれか1つ(目的/手法/データ)が決まったら,残り2つを順番に探してみましょう.
しかし, 実際に行ってみると,途中でうまくいかないことが大半です.</p>
<div class="note">
<ul>
<li><h2 id="目的も手法も決まったけどデータがない"><strong>目的も手法も決まったけどデータがない!</strong></h2>
<ul>
<li>千葉商科大学生の親の所得と成績について,回帰分析したい!</li>
</ul>
<p>→ けどそんなデータはない</p>
<p>→ アンケート調査する?/変更する</p></li>
<li><h2 id="データも手法も決まったけど出てくる構造がすでに知られているつまらない"><strong>データも手法も決まったけど,出てくる構造がすでに知られている/つまらない</strong></h2>
<p>天気と気温のデータがあるので検定をすれば,晴れの日は雨の日より気温が高いことが分かる</p>
<p>→ そんな当たり前のことが分かっても…..</p></li>
<li><h2 id="目的もデータもあるけど手法が難しすぎる存在しない"><strong>目的もデータもあるけど,手法が難しすぎる/存在しない</strong></h2>
<p>企業の会計データと取引経路のデータがあるので,これで経済構造を明らかにできる!</p>
<p>→ エージェントベースモデリングをやるには,数百万円の計算機と,数万行のコードを書く必要があるし,モデル作成も複雑すぎる….</p></li>
</ul>
<p>ので行ったり来たりするのが通常です.</p>
</div>
<p>卒業研究などではこの過程に,1年以上かけますが,この講義では数ヶ月しか時間がとれません. そこで,<strong>少し妥協する必要があります</strong>.</p>
<p>本当に知りたいこと,本当にやりたいこと,本当に分析したいデータなどが,上手く使えればそれに越したことはありませんが,なかなか上手くは行きません.
一生物の仕事になる場合もあります(その場合は是非,大学院に進んで研究者になりましょう.)</p>
<p>この講義では,1年で0から行うので,</p>
<div class="note">
<ul>
<li><h2 id="すぐに結果が出そうな目的"><strong>すぐに結果が出そうな目的</strong></h2>
<ul>
<li><p>おおよそ明らかになっていることを少し変える</p></li>
<li><p>既に知られていることでも取り敢えずやってみる</p></li>
<li><p>本当に知りたいことのほんの一部だけに限定する</p></li>
</ul></li>
<li><h2 id="手頃なデータ"><strong>手頃なデータ</strong></h2>
<ul>
<li><p>昨年の講義で利用されているデータ</p></li>
<li><p>簡単に手に入るデータ</p></li>
</ul></li>
<li><h2 id="簡単な手法"><strong>簡単な手法</strong></h2>
<ul>
<li><p>授業で扱っている基礎的な手法に限定する</p></li>
<li><p>やりたいことの簡単なバージョンを利用する</p></li>
</ul></li>
</ul>
</div>
<p>くらいに,妥協する必要があります(それでも半年で行うのはかなり大変です.)</p>
<p>これから,具体的な統計やデータサイエンスの手法を学習するので, 並行してできるだけ早くに,自分がこの講義で何をやるのかを決めていきましょう.</p>
<div class="note">
<ul>
<li><p><strong>演習</strong></p></li>
<li><p>目的,手法,データ,どれでも良いので,3つ思いついたものをスライドにまとめてください.</p>
<ul>
<li><p>デザインを入れるなど,きれいにまとめる必要はありません.議論のためのメモ帳として作成してください.</p></li>
<li><p>あとで補足,追加できるように1つのテーマにつき,1ページ使用してください.</p></li>
<li><p>何かを調べた,読んだ,参考にした場合はその出典を書いておいてください.</p>
<p>URL直張りでも構わないので,必ずあとで参照できる形でメモを残しておいてください.</p></li>
<li><p>途中経過で構わないのでグループウェアの自分のチャネルにアップロードしてください.</p></li>
</ul>
<p>現時点では,実現が困難なものでも,不可能なものでも,つまらないものでも構いません,取り敢えず沢山やってみたいこと,興味のあることをまとめましょう.後ほど,その資料を元に,説明してもらい,ディスカッションします.</p></li>
</ul>
</div>
</details>
<h1 data-number="9" id="データの可視化-執筆中"><span class="header-section-number">9</span> データの可視化 (執筆中)</h1>
<details open>
<summary>
開く/閉じる
</summary>
<p>ここまでで,プログラミングを利用してデータを読み込み,編集ができるようになりました. これから,データを分析する手法を学習しましょう. データ分析の第一歩は,データの<strong>可視化</strong>です.</p>
<p>統計データはテーブル形式のまま,眺めても理解できません. データを可視化することで,データの特徴や意味を理解する助けになります. ここでは,データを可視化するいくつかの方法を学びましょう.</p>
<div class="note">
<ul>
<li><h2 id="ライブラリのインストール">ライブラリのインストール</h2></li>
</ul>
<p>Pythonにおけるグラフ作成の,代表的なライブラリには,<a href="https://matplotlib.org"><code>matplotlib</code></a>や<a href="https://seaborn.pydata.org"><code>seaborn</code></a>があります.
それぞれ, <code>pip install</code>しておきましょう.</p>
<p><code>matplotlib</code>,<code>seaborn</code>はそれぞれ以下のようにインポートするのが一般的です.</p>
<ul>
<li><p><code>import matplotlib.pyplot as plt</code></p></li>
<li><p><code>import searborn as sns</code></p></li>
</ul>
</div>
<div class="warn">
<ul>
<li><h2 id="matplotlibにおける日本語表示"><code>matplotlib</code>における日本語表示</h2>
<code>matplotlib</code>は日本語などのマルチバイト文字に対応しておらず,日本語を使用すると日本語部分が日本語部分が, □(通称豆腐)に変わります.</li>
</ul>
<p>例: ｢Hello こんにちは｣ → ｢Hello □ □ □ □ □ ｣</p>
<p><code>matplotlib</code>で日本語を利用する方法として一番簡単なものに, <code>japanize-matplotlib</code>の利用があります.
<code>pip install</code> したあとに, <code>import japanize_matplotlib</code> をしましょう(<code>pip</code> では <code>'-'</code>(ハイフン)ですが,<code>import</code>文では,<code>'_'</code>(アンダーバー)なので注意してください.)</p>
</div>
<div class="warn">
<ul>
<li>Python 3.12 における<code>japanize_matplotlib</code></li>
</ul>
<p>Python3.12では,<code>japanize_matplotlib</code>を読み込もうとすると,<code>ModuleNotFoundError: No module named 'distutils'</code> と表示されます.</p>
<p>これは,<code>japanize_matplotlib</code>内で利用されている<code>distutils</code>というモジュールが廃止されたことによります. こちらのエラーは, <code>distutils</code>の代替である<code>setuptools</code>を <code>pip install</code>することで消えます.</p>
<p>参考: <a href="https://qiita.com/pitao/items/1740a62ddee797aed807">【inshellisense】ModuleNotFoundError: No module named ’distutils’の対処法</a></p>
</div>
<p>本章におけるコードは以下, 先頭に以下のような記述があることが前提となります.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> japanize_matplotlib</span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code></pre></div>
<h2 data-number="9.1" id="基礎的なグラフ棒グラフ円グラフ折れ線グラフ"><span class="header-section-number">9.1</span> 基礎的なグラフ(棒グラフ,円グラフ,折れ線グラフ)</h2>
<p><code>matplotlib</code>を利用して,グラフを作成する大まかな手順は以下のようになります.</p>
<div class="note">
<ol type="1">
<li><p>データを準備する.
BOMなしのCSVを作りましょう</p></li>
<li><p><code>pandas</code>でプログラムでCSVを読み込みましょう</p></li>
<li><p>グラフにしたい部分を抽出します.</p>
<p>グラフを作るために何が必要かはグラフの種類によります.</p></li>
<li><p><code>matplotlib</code>のメソッドを利用してグラフを生成します.</p>
<p>基本的なメソッドは以下のとおりです.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">グラフの種類</th>
<th style="text-align: center;">メソッド</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">棒グラフ</td>
<td style="text-align: center;"><code>plt.bar(x軸のリスト,y軸のリスト)</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;">円グラフ</td>
<td style="text-align: center;"><code>plt.pie(カテゴリー別のデータのリスト,label=ラベル)</code></td>
</tr>
<tr class="even">
<td style="text-align: center;">折れ線グラフ</td>
<td style="text-align: center;"><code>plt.plot(x軸のリスト,y軸のリスト)</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;">散布図</td>
<td style="text-align: center;"><code>plt.scatter(x軸のリスト,y軸のリスト)</code></td>
</tr>
</tbody>
</table>
<p>これら以外の,グラフに関しては個別に扱います.</p></li>
<li><p>グラフの見た目を整えます.</p>
<p>ある程度自動で設定されますが,色,メモリ,形,軸などを個別に設定できます.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">グラフの要素</th>
<th style="text-align: center;">メソッド</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">タイトル</td>
<td style="text-align: center;"><code>plt.title('タイトル')</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;">判例</td>
<td style="text-align: center;"><code>plt.legend()</code></td>
</tr>
<tr class="even">
<td style="text-align: center;">y軸</td>
<td style="text-align: center;"><code>plt.yticks(軸の目盛のリスト)</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;">x軸</td>
<td style="text-align: center;"><code>plt.xticks(軸の目盛のリスト)</code></td>
</tr>
<tr class="even">
<td style="text-align: center;">y軸ラベル</td>
<td style="text-align: center;"><code>plt.ylabel('ラベル')</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;">x軸ラベル</td>
<td style="text-align: center;"><code>plt.xlabel('ラベル')</code></td>
</tr>
<tr class="even">
<td style="text-align: center;">補助線の追加</td>
<td style="text-align: center;"><code>plt.minorticks_on()</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;"><code>plt.grid(which='both')</code></td>
</tr>
<tr class="even">
<td style="text-align: center;">表示領域</td>
<td style="text-align: center;"><code>plt.ylim(min,max)</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;"><code>plt.xlim(min,max)</code></td>
</tr>
</tbody>
</table></li>
<li><p><code>plt.show()</code>でグラフを出力.</p></li>
</ol>
<p>ポップアップウィンドウでグラフが表示されます.</p>
<ol start="8" type="1">
<li>グラフの保存</li>
</ol>
<p>ポップアップウィンドウの保存ボタンを押すことで画像に名前をつけて保存することが可能です.</p>
<figure>
<img src="/images/graph_size_setting.png" alt="画像の表示" />
<figcaption aria-hidden="true">画像の表示</figcaption>
</figure>
</div>
<p>例えば,以下のコードで次のグラフが表示されます.
<code>np.arange(0,100,1)</code>は,<code>0</code>から<code>100</code>までの数値を<code>1</code>ずつ増える<code>numpy</code>の配列を生成しています.
<code>[x for x in range(0,101,1)]</code> でも同様の結果となります.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>plt.plot(np.arange(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">1</span>)</span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a>        ,np.arange(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">1</span>)</span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a>        ,color<span class="op">=</span><span class="st">&#39;red&#39;</span></span>
<span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a>        ,label<span class="op">=</span><span class="st">&#39;sample&#39;</span>)</span>
<span id="cb245-5"><a href="#cb245-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;title&#39;</span>)</span>
<span id="cb245-6"><a href="#cb245-6" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="dv">0</span>,<span class="dv">100</span>)</span>
<span id="cb245-7"><a href="#cb245-7" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="dv">0</span>,<span class="dv">100</span>)</span>
<span id="cb245-8"><a href="#cb245-8" aria-hidden="true" tabindex="-1"></a>plt.xticks(np.arange(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">10</span>))</span>
<span id="cb245-9"><a href="#cb245-9" aria-hidden="true" tabindex="-1"></a>plt.yticks(np.arange(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">10</span>))</span>
<span id="cb245-10"><a href="#cb245-10" aria-hidden="true" tabindex="-1"></a>plt.minorticks_on()</span>
<span id="cb245-11"><a href="#cb245-11" aria-hidden="true" tabindex="-1"></a>plt.grid(which<span class="op">=</span><span class="st">&#39;both&#39;</span>)</span>
<span id="cb245-12"><a href="#cb245-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;x_label&#39;</span>)</span>
<span id="cb245-13"><a href="#cb245-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;y_label&#39;</span>)</span>
<span id="cb245-14"><a href="#cb245-14" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb245-15"><a href="#cb245-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="/images/python_graph_elem.png" alt="グラフの要素" />
<figcaption aria-hidden="true">グラフの要素</figcaption>
</figure>
<div class="warn">
<p>画像は<code>plt.show()</code>で表示されるポップアップウィンドウを立ち上げなくても,<code>plt.savefig('figure.png')</code>と記述することで保存することができます.</p>
<p>ただし,<code>plt.show()</code>をして自分でポップアップウィンドウを閉じないと,<code>plt.</code>による設定がメモリに保存されたままになります.</p>
<p><code>plt.show()</code>を実行しない場合は必ず最後に<code>plt.close()</code>を追加してメモリを開放しましょう.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a>plt.plot(np.arange(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">1</span>)</span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>        ,np.arange(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">1</span>)</span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>        ,color<span class="op">=</span><span class="st">&#39;red&#39;</span></span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>        ,label<span class="op">=</span><span class="st">&#39;sample&#39;</span>)</span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">&#39;figure.png&#39;</span>)</span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code></pre></div>
</div>
<h3 data-number="9.1.1" id="棒グラフの作成"><span class="header-section-number">9.1.1</span> 棒グラフの作成</h3>
<p><a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/bar_pie.csv">こちら</a>からデータをダウンロードし,棒グラフを作成してみましょう.</p>
<p>まずはデータを確認します.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import 部分は省略されています</span></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dataフォルダにあるbar_pie.csvというファイルを読み込みます.</span></span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;data/bar_pie.csv&quot;</span>)</span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 読み込んだファイルの中身を見てみます.</span></span>
<span id="cb247-6"><a href="#cb247-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb247-7"><a href="#cb247-7" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb247-8"><a href="#cb247-8" aria-hidden="true" tabindex="-1"></a><span class="co">    cat dog bird</span></span>
<span id="cb247-9"><a href="#cb247-9" aria-hidden="true" tabindex="-1"></a><span class="co">0    10  12   20</span></span>
<span id="cb247-10"><a href="#cb247-10" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span></code></pre></div>
<p>プログラムは読み込むデータと,作りたいグラフの形によって変化します.
どのようなデータが必要かを意識して,データを抽出しましょう.</p>
<div class="note">
<p>棒グラフの作成に必要なデータは,</p>
<ul>
<li><code>棒毎のラベル</code></li>
</ul>
<p>それぞれの棒の名前です.文字列で指定します.
今回は<code>'cat'</code>,<code>'dog'</code>,<code>'bird'</code>とします.</p>
<ul>
<li><code>棒毎のx軸の位置</code></li>
</ul>
<p>棒グラフの位置は,<code>0</code>から始まる整数の列として指定します.
今回は,<code>0</code>,<code>1</code>,<code>2</code>を指定します.</p>
<ul>
<li><code>棒毎の高さ</code>になります.</li>
</ul>
<p>高さに<code>10</code>,<code>12</code>,<code>20</code>を指定します.</p>
</div>
<div class="sourceCode" id="cb248"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 棒グラフのラベルを抽出します</span></span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a><span class="co"># df.columns でDataFrameからHeaderを抽出し,</span></span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a><span class="co"># list()関数でDataFrameからlist型に変換しています</span></span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> <span class="bu">list</span>(df.columns)</span>
<span id="cb248-5"><a href="#cb248-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-6"><a href="#cb248-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 棒グラフのx軸のどこに置くのかを指定しています.</span></span>
<span id="cb248-7"><a href="#cb248-7" aria-hidden="true" tabindex="-1"></a><span class="co"># np.arange(x) は [0,1,..,x]というarrayを作ります.</span></span>
<span id="cb248-8"><a href="#cb248-8" aria-hidden="true" tabindex="-1"></a>x_position <span class="op">=</span> np.arange(<span class="bu">len</span>(labels))</span>
<span id="cb248-9"><a href="#cb248-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-10"><a href="#cb248-10" aria-hidden="true" tabindex="-1"></a><span class="co">#棒グラフの高さを抽出します</span></span>
<span id="cb248-11"><a href="#cb248-11" aria-hidden="true" tabindex="-1"></a><span class="co"># メソッド icloc[x]はDataFrameのx行目を抽出します.</span></span>
<span id="cb248-12"><a href="#cb248-12" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> <span class="bu">list</span>(df.iloc[<span class="dv">0</span>])</span></code></pre></div>
<p>抽出した情報を元に,棒グラフを作成します.
<code>plt.bar(X軸のリスト,Y軸のリスト)</code>の形で,データを指定します.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 棒グラフを作成します.</span></span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a><span class="co"># x 軸 にx_position</span></span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a><span class="co"># それぞれの棒グラフの高さにvaluesを与えています.</span></span>
<span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a><span class="co"># その他にも沢山の引数があります.</span></span>
<span id="cb249-5"><a href="#cb249-5" aria-hidden="true" tabindex="-1"></a>plt.bar(x<span class="op">=</span>x_position, height<span class="op">=</span>values)</span></code></pre></div>
<p>このままだと,X軸のラベルに何も記述されないので,
<code>plt.xticks(ラベルの位置のリスト,ラベルのリスト)</code>で,ラベルを指定します.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ラベルの位置を指定します.</span></span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a>plt.xticks(ticks<span class="op">=</span>x_position,labels<span class="op">=</span>labels)</span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Y軸ラベルを指定します</span></span>
<span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;number&quot;</span>)</span>
<span id="cb250-5"><a href="#cb250-5" aria-hidden="true" tabindex="-1"></a><span class="co"># タイトルを指名します</span></span>
<span id="cb250-6"><a href="#cb250-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;kind&quot;</span>)</span>
<span id="cb250-7"><a href="#cb250-7" aria-hidden="true" tabindex="-1"></a><span class="co"># グラフの表示</span></span>
<span id="cb250-8"><a href="#cb250-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="/images/bar_graph.png" alt="棒グラフの表示" />
<figcaption aria-hidden="true">棒グラフの表示</figcaption>
</figure>
<p>表示されたグラフは, 保存ボタンで画像として保存できます.</p>
<p>グラフ作成の基本は,これで終わりです.あとは,それぞれのグラフ毎に<code>plt.bar()</code>の部分を使い分け,グラフのデザインを変更することで,様々なグラフが作成できます.</p>
<p>グラフのデザインに関する要素は,無数にあるためこの講義ですべてを扱うことはできませんが,いくつかの要素を実際に変更してみましょう.</p>
<h3 data-number="9.1.2" id="色の変更"><span class="header-section-number">9.1.2</span> 色の変更</h3>
<p>matplotlibではグラフの各部に以下の色を指定できます.
これ以外の指定の仕方もあります.色の変え方は,それぞれのグラフで異なります.</p>
<figure>
<img src="/images/graph_color.png" alt="グラフの色" />
<figcaption aria-hidden="true">グラフの色</figcaption>
</figure>
<p>棒グラフは<code>plt.bar(color=棒毎の色のリスト)</code>の形で棒ごとに色を指定することができます.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 棒グラフの色を指定します.</span></span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1つ目 red</span></span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2つ目 blue</span></span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 3つ目 yellow</span></span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a>color_list <span class="op">=</span> [<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;yellow&quot;</span>]</span>
<span id="cb251-6"><a href="#cb251-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 引数に色の指定をします</span></span>
<span id="cb251-7"><a href="#cb251-7" aria-hidden="true" tabindex="-1"></a>plt.bar(color<span class="op">=</span>color_list, x<span class="op">=</span>x_position, height<span class="op">=</span>values)</span>
<span id="cb251-8"><a href="#cb251-8" aria-hidden="true" tabindex="-1"></a><span class="co">#ラベルの位置を指定します.</span></span>
<span id="cb251-9"><a href="#cb251-9" aria-hidden="true" tabindex="-1"></a>plt.xticks(ticks<span class="op">=</span>x_position,labels<span class="op">=</span>labels)</span>
<span id="cb251-10"><a href="#cb251-10" aria-hidden="true" tabindex="-1"></a><span class="co"># yラベルを指定します</span></span>
<span id="cb251-11"><a href="#cb251-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;number&quot;</span>)</span>
<span id="cb251-12"><a href="#cb251-12" aria-hidden="true" tabindex="-1"></a><span class="co"># タイトルを指名します</span></span>
<span id="cb251-13"><a href="#cb251-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;kind&quot;</span>)</span>
<span id="cb251-14"><a href="#cb251-14" aria-hidden="true" tabindex="-1"></a><span class="co"># グラフの表示</span></span>
<span id="cb251-15"><a href="#cb251-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="/images/bar_graph_color.png" alt="棒グラフの色の変更" />
<figcaption aria-hidden="true">棒グラフの色の変更</figcaption>
</figure>
<h3 data-number="9.1.3" id="スタイルの変更"><span class="header-section-number">9.1.3</span> スタイルの変更</h3>
<p>毎回細かなデザインを自分で調整すると手間なので,デフォルトで準備されているスタイルを利用すると楽です.</p>
<p>matplotlibではいくつかのデフォルトのスタイルが準備されています. 使用可能なスタイルは,plt.style.available で確認できます.</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> python</span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Python</span> 3.12.3 <span class="er">(</span><span class="ex">main,</span> Jun  3 2024, 08:31:31<span class="kw">)</span> <span class="ex">[Clang</span> 15.0.0 <span class="er">(</span><span class="ex">clang-1500.3.9.4</span><span class="kw">)</span><span class="ex">]</span> on darwin</span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Type</span> <span class="st">&quot;help&quot;</span>, <span class="st">&quot;copyright&quot;</span>, <span class="st">&quot;credits&quot;</span> or <span class="st">&quot;license&quot;</span> for more information.</span>
<span id="cb252-4"><a href="#cb252-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> import <span class="ex">matplotlib.pyplot</span> as plt</span>
<span id="cb252-5"><a href="#cb252-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> plt.style.available</span>
<span id="cb252-6"><a href="#cb252-6" aria-hidden="true" tabindex="-1"></a><span class="ex">[</span><span class="st">&#39;Solarize_Light2&#39;</span><span class="ex">,</span> <span class="st">&#39;_classic_test_patch&#39;</span>, <span class="st">&#39;_mpl-gallery&#39;</span>, <span class="st">&#39;_mpl-gallery-nogrid&#39;</span>, <span class="st">&#39;bmh&#39;</span>, <span class="st">&#39;classic&#39;</span>, <span class="st">&#39;dark_background&#39;</span>, <span class="st">&#39;fast&#39;</span>, <span class="st">&#39;fivethirtyeight&#39;</span>, <span class="st">&#39;ggplot&#39;</span>, <span class="st">&#39;grayscale&#39;</span>, <span class="st">&#39;seaborn-v0_8&#39;</span>, <span class="st">&#39;seaborn-v0_8-bright&#39;</span>, <span class="st">&#39;seaborn-v0_8-colorblind&#39;</span>, <span class="st">&#39;seaborn-v0_8-dark&#39;</span>, <span class="st">&#39;seaborn-v0_8-dark-palette&#39;</span>, <span class="st">&#39;seaborn-v0_8-darkgrid&#39;</span>, <span class="st">&#39;seaborn-v0_8-deep&#39;</span>, <span class="st">&#39;seaborn-v0_8-muted&#39;</span>, <span class="st">&#39;seaborn-v0_8-notebook&#39;</span>, <span class="st">&#39;seaborn-v0_8-paper&#39;</span>, <span class="st">&#39;seaborn-v0_8-pastel&#39;</span>, <span class="st">&#39;seaborn-v0_8-poster&#39;</span>, <span class="st">&#39;seaborn-v0_8-talk&#39;</span>, <span class="st">&#39;seaborn-v0_8-ticks&#39;</span>, <span class="st">&#39;seaborn-v0_8-white&#39;</span>, <span class="st">&#39;seaborn-v0_8-whitegrid&#39;</span>, <span class="st">&#39;tableau-colorblind10&#39;</span>]</span></code></pre></div>
<p>それぞれのスタイルのイメージは<a href="https://matplotlib.org/stable/gallery/style_sheets/style_sheets_reference.html">こちら</a>で確認できます.</p>
<p>スタイルは<code>plt.style.use('スタイル名')</code>で指定し,以降のコード全てに適用されます.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="co"># スタイル &#39;ggplot&#39; を使ってみます</span></span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">&#39;ggplot&#39;</span>)</span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 引数に色の指定をします</span></span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a>plt.bar(x<span class="op">=</span>x_position, height<span class="op">=</span>values)</span>
<span id="cb253-5"><a href="#cb253-5" aria-hidden="true" tabindex="-1"></a><span class="co">#ラベルの位置を指定します.</span></span>
<span id="cb253-6"><a href="#cb253-6" aria-hidden="true" tabindex="-1"></a>plt.xticks(ticks<span class="op">=</span>x_position,labels<span class="op">=</span>labels)</span>
<span id="cb253-7"><a href="#cb253-7" aria-hidden="true" tabindex="-1"></a><span class="co"># yラベルを指定します</span></span>
<span id="cb253-8"><a href="#cb253-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;number&quot;</span>)</span>
<span id="cb253-9"><a href="#cb253-9" aria-hidden="true" tabindex="-1"></a><span class="co"># タイトルを指名します</span></span>
<span id="cb253-10"><a href="#cb253-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;kind&quot;</span>)</span>
<span id="cb253-11"><a href="#cb253-11" aria-hidden="true" tabindex="-1"></a><span class="co"># グラフの表示</span></span>
<span id="cb253-12"><a href="#cb253-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="/images/bar_graph_style.png" alt="スタイルの適用" />
<figcaption aria-hidden="true">スタイルの適用</figcaption>
</figure>
<h3 data-number="9.1.4" id="要素の追加"><span class="header-section-number">9.1.4</span> 要素の追加</h3>
<p>グラフに新しい要素を付け加えるのも簡単です.
ここでは試しに凡例を追加してみます.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="co"># スタイル seaborn を使ってみます</span></span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">&#39;seaborn&#39;</span>)</span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 棒グラフを2つ並べます</span></span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a>plt.bar(color<span class="op">=</span><span class="st">&#39;red&#39;</span>, x<span class="op">=</span>x_position, width<span class="op">=</span><span class="fl">0.3</span>,height<span class="op">=</span>values)</span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a>plt.bar(color<span class="op">=</span><span class="st">&#39;blue&#39;</span>,x<span class="op">=</span>x_position<span class="op">+</span><span class="fl">0.3</span>, width<span class="op">=</span><span class="fl">0.3</span>,height<span class="op">=</span>[<span class="dv">11</span>,<span class="dv">15</span>,<span class="dv">14</span>])</span>
<span id="cb254-6"><a href="#cb254-6" aria-hidden="true" tabindex="-1"></a><span class="co">#凡例を追加します</span></span>
<span id="cb254-7"><a href="#cb254-7" aria-hidden="true" tabindex="-1"></a><span class="co"># loc で位置を指定します</span></span>
<span id="cb254-8"><a href="#cb254-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 上下 upper center lower</span></span>
<span id="cb254-9"><a href="#cb254-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 左右 left center right</span></span>
<span id="cb254-10"><a href="#cb254-10" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">&#39;2020&#39;</span>,<span class="st">&#39;2000&#39;</span>], loc<span class="op">=</span><span class="st">&#39;upper left&#39;</span>)</span>
<span id="cb254-11"><a href="#cb254-11" aria-hidden="true" tabindex="-1"></a><span class="co">#ラベルの位置を指定します.</span></span>
<span id="cb254-12"><a href="#cb254-12" aria-hidden="true" tabindex="-1"></a>plt.xticks(ticks<span class="op">=</span>x_position<span class="op">+</span><span class="fl">0.15</span>,labels<span class="op">=</span>labels)</span>
<span id="cb254-13"><a href="#cb254-13" aria-hidden="true" tabindex="-1"></a><span class="co"># yラベルを指定します</span></span>
<span id="cb254-14"><a href="#cb254-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;number&quot;</span>)</span>
<span id="cb254-15"><a href="#cb254-15" aria-hidden="true" tabindex="-1"></a><span class="co"># タイトルを指名します</span></span>
<span id="cb254-16"><a href="#cb254-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;kind&quot;</span>)</span>
<span id="cb254-17"><a href="#cb254-17" aria-hidden="true" tabindex="-1"></a><span class="co"># グラフの表示</span></span>
<span id="cb254-18"><a href="#cb254-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="/images/bar_graph_style2.png" alt="凡例の追加" />
<figcaption aria-hidden="true">凡例の追加</figcaption>
</figure>
<p>デザインのすべてのパターンをここで扱うことは出来ないので,
やりたいことに応じて,
<a href="https://matplotlib.org/stable/users/index">matplotlubの公式ドキュメント</a>を確認しましょう.</p>
<h2 data-number="9.2" id="円グラフ"><span class="header-section-number">9.2</span> 円グラフ</h2>
<p>先ほどと同じデータ<code>bar_pie.csv</code>を利用して円グラフを作成してみます.</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a><span class="co">header1 header2 header3 ...</span></span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a><span class="co">value1  value2  value3  ...</span></span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a><span class="co">の形のcsvから棒グラフを作成する</span></span>
<span id="cb255-5"><a href="#cb255-5" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb255-6"><a href="#cb255-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-7"><a href="#cb255-7" aria-hidden="true" tabindex="-1"></a><span class="co"># dataフォルダにあるbar_pie.csvというファイルを読み込みます.</span></span>
<span id="cb255-8"><a href="#cb255-8" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;data/bar_pie.csv&quot;</span>)</span>
<span id="cb255-9"><a href="#cb255-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-10"><a href="#cb255-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 読み込んだファイルの中身を見てみます.</span></span>
<span id="cb255-11"><a href="#cb255-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb255-12"><a href="#cb255-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-13"><a href="#cb255-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 棒グラフのラベルを抽出します</span></span>
<span id="cb255-14"><a href="#cb255-14" aria-hidden="true" tabindex="-1"></a><span class="co"># df.columns でDataFrameからHeaderを抽出し,</span></span>
<span id="cb255-15"><a href="#cb255-15" aria-hidden="true" tabindex="-1"></a><span class="co"># list()関数でDataFrameからlist型に変換しています</span></span>
<span id="cb255-16"><a href="#cb255-16" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> <span class="bu">list</span>(df.columns)</span>
<span id="cb255-17"><a href="#cb255-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-18"><a href="#cb255-18" aria-hidden="true" tabindex="-1"></a><span class="co"># メソッド icloc[x]はDataFrameのx行目を抽出します.</span></span>
<span id="cb255-19"><a href="#cb255-19" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> <span class="bu">list</span>(df.iloc[<span class="dv">0</span>])</span>
<span id="cb255-20"><a href="#cb255-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-21"><a href="#cb255-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 円グラフの作成</span></span>
<span id="cb255-22"><a href="#cb255-22" aria-hidden="true" tabindex="-1"></a>plt.pie(values, labels<span class="op">=</span>labels, autopct<span class="op">=</span><span class="st">&#39;</span><span class="sc">%1.1f%%</span><span class="st">&#39;</span>)</span>
<span id="cb255-23"><a href="#cb255-23" aria-hidden="true" tabindex="-1"></a><span class="co"># タイトルを指名します</span></span>
<span id="cb255-24"><a href="#cb255-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;kind&quot;</span>)</span>
<span id="cb255-25"><a href="#cb255-25" aria-hidden="true" tabindex="-1"></a><span class="co"># グラフの表示</span></span>
<span id="cb255-26"><a href="#cb255-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>円グラフは, <code>plt.pie()</code>にそれぞれの領域の割合と,ラベルを与えることで,作成できます.
グラフに数字を表示するには,<code>autopct=</code>に<code>フォーマット文字列</code>で表示内容を指定します.
上記の例では<code>'%1.1f%%'</code>と書くことで,小数点1桁まで数値を表示しています.</p>
<figure>
<img src="/images/pie_graph1.png" alt="円グラフ" />
<figcaption aria-hidden="true">円グラフ</figcaption>
</figure>
<div class="note">
<ul>
<li>演習</li>
</ul>
<p><a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/pie_chart_practice.csv">円グラフデータ</a>,<a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/line_chart_practice.csv">折れ線グラフデータ2</a>,<a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/bar_chart_practice.csv">棒グラフデータ3</a>を利用し,それぞれのグラフを作成してください.
表示が必要だと思われるデザインを設定してください.</p>
</div>
<h2 data-number="9.3" id="for文を利用したグラフ"><span class="header-section-number">9.3</span> for文を利用したグラフ</h2>
<p>これまでのように単純な一つのグラフを作成するだけであれば,恐らくExcelなどのほうが手軽ですが,多数のグラフを作成したり, 複数のデータを組み合わせた複雑なグラフを作成する場合にはプログラミングの方が便利になります.</p>
<p>例えば<a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/temperature_10location.csv">こちら</a>のデータを利用して棒グラフを作成することを考えてみましょう.このデータは10箇所の気温が記録された時系列データです.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a>          <span class="ex">Date</span>  Location_1  Location_2  ...  Location_8  Location_9  Location_10</span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>   2023-01-01   18.211700   21.553371  ...   18.665620   29.108637    21.634069</span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   2023-01-02   15.108630   16.172744  ...   20.135756    9.212193    24.209877</span>
<span id="cb256-4"><a href="#cb256-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>   2023-01-03   14.938279   24.593193  ...   16.778431   22.291269    19.815977</span>
<span id="cb256-5"><a href="#cb256-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>   2023-01-04   20.640249   18.862405  ...   13.282269   16.040627    15.993132</span>
<span id="cb256-6"><a href="#cb256-6" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>   2023-01-05   14.218562   16.281882  ...   15.729466   24.951213    18.053277</span>
<span id="cb256-7"><a href="#cb256-7" aria-hidden="true" tabindex="-1"></a><span class="ex">..</span>         ...         ...         ...  ...         ...         ...          ...</span>
<span id="cb256-8"><a href="#cb256-8" aria-hidden="true" tabindex="-1"></a><span class="ex">95</span>  2023-04-06   21.312739   19.613363  ...   16.497553   20.446656    13.644605</span>
<span id="cb256-9"><a href="#cb256-9" aria-hidden="true" tabindex="-1"></a><span class="ex">96</span>  2023-04-07   26.388210   31.533854  ...   18.999736   15.603714    19.215097</span>
<span id="cb256-10"><a href="#cb256-10" aria-hidden="true" tabindex="-1"></a><span class="ex">97</span>  2023-04-08   16.914329   20.479892  ...   21.698464   17.705697    16.867517</span>
<span id="cb256-11"><a href="#cb256-11" aria-hidden="true" tabindex="-1"></a><span class="ex">98</span>  2023-04-09   14.316258   17.841650  ...   31.885071   20.816917    16.895196</span>
<span id="cb256-12"><a href="#cb256-12" aria-hidden="true" tabindex="-1"></a><span class="ex">99</span>  2023-04-10   23.595042   19.896247  ...   17.534881   15.180066    15.104460</span></code></pre></div>
<p>このデータの<code>Location_1</code>から<code>Location_10</code>までの折れ線グラフを一つのグラフに表示することを考えてみます.</p>
<p><code>matplotlib</code>では, <code>plt.show()</code>までに要素を重ねることで複数のグラフを重ねることができます.</p>
<p>例えば,10本の折れ線グラフを表示する場合,一つ一つ手書きすると以下のようになります.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;data/temperature_10location.csv&#39;</span>)</span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-4"><a href="#cb257-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;Date&#39;列を日付型に変更しています.</span></span>
<span id="cb257-5"><a href="#cb257-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;Date&#39;</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">&#39;Date&#39;</span>])</span>
<span id="cb257-6"><a href="#cb257-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-7"><a href="#cb257-7" aria-hidden="true" tabindex="-1"></a><span class="co">#一つ一つ手書きする方法</span></span>
<span id="cb257-8"><a href="#cb257-8" aria-hidden="true" tabindex="-1"></a>plt.plot(df[<span class="st">&#39;Date&#39;</span>],df[<span class="st">&#39;Location_1&#39;</span>],label<span class="op">=</span><span class="st">&#39;Location_1&#39;</span>)</span>
<span id="cb257-9"><a href="#cb257-9" aria-hidden="true" tabindex="-1"></a>plt.plot(df[<span class="st">&#39;Date&#39;</span>],df[<span class="st">&#39;Location_2&#39;</span>],label<span class="op">=</span><span class="st">&#39;Location_2&#39;</span>)</span>
<span id="cb257-10"><a href="#cb257-10" aria-hidden="true" tabindex="-1"></a>plt.plot(df[<span class="st">&#39;Date&#39;</span>],df[<span class="st">&#39;Location_3&#39;</span>],label<span class="op">=</span><span class="st">&#39;Location_3&#39;</span>)</span>
<span id="cb257-11"><a href="#cb257-11" aria-hidden="true" tabindex="-1"></a>plt.plot(df[<span class="st">&#39;Date&#39;</span>],df[<span class="st">&#39;Location_4&#39;</span>],label<span class="op">=</span><span class="st">&#39;Location_4&#39;</span>)</span>
<span id="cb257-12"><a href="#cb257-12" aria-hidden="true" tabindex="-1"></a>plt.plot(df[<span class="st">&#39;Date&#39;</span>],df[<span class="st">&#39;Location_5&#39;</span>],label<span class="op">=</span><span class="st">&#39;Location_5&#39;</span>)</span>
<span id="cb257-13"><a href="#cb257-13" aria-hidden="true" tabindex="-1"></a>plt.plot(df[<span class="st">&#39;Date&#39;</span>],df[<span class="st">&#39;Location_6&#39;</span>],label<span class="op">=</span><span class="st">&#39;Location_6&#39;</span>)</span>
<span id="cb257-14"><a href="#cb257-14" aria-hidden="true" tabindex="-1"></a>plt.plot(df[<span class="st">&#39;Date&#39;</span>],df[<span class="st">&#39;Location_7&#39;</span>],label<span class="op">=</span><span class="st">&#39;Location_7&#39;</span>)</span>
<span id="cb257-15"><a href="#cb257-15" aria-hidden="true" tabindex="-1"></a>plt.plot(df[<span class="st">&#39;Date&#39;</span>],df[<span class="st">&#39;Location_8&#39;</span>],label<span class="op">=</span><span class="st">&#39;Location_8&#39;</span>)</span>
<span id="cb257-16"><a href="#cb257-16" aria-hidden="true" tabindex="-1"></a>plt.plot(df[<span class="st">&#39;Date&#39;</span>],df[<span class="st">&#39;Location_9&#39;</span>],label<span class="op">=</span><span class="st">&#39;Location_9&#39;</span>)</span>
<span id="cb257-17"><a href="#cb257-17" aria-hidden="true" tabindex="-1"></a>plt.plot(df[<span class="st">&#39;Date&#39;</span>],df[<span class="st">&#39;Location_10&#39;</span>],label<span class="op">=</span><span class="st">&#39;Location_10&#39;</span>)</span>
<span id="cb257-18"><a href="#cb257-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-19"><a href="#cb257-19" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb257-20"><a href="#cb257-20" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">15</span>) <span class="co">#x軸を15度傾かせています</span></span>
<span id="cb257-21"><a href="#cb257-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="/images/temperature_10location.png" alt="10本の折れ線グラフ" />
<figcaption aria-hidden="true">10本の折れ線グラフ</figcaption>
</figure>
<p>10本程度であれば,まだ書けなくもありませんが,それでも手間がかかります.こういった繰り返しの作業は<code>for文</code>を利用しましょう.</p>
<p><code>for文</code>を利用した場合には以下のようになります.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> df.columns[<span class="dv">1</span>:]:</span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a>    plt.plot(df[<span class="st">&#39;Date&#39;</span>],df[x],label<span class="op">=</span>x)</span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>グラフの内容は同じですが,こちらのほうが労力が少なく,コードもスッキリしており,何か修正を加える場合でも修正箇所が少なくて済みます.
繰り返し作業は積極的に<code>for文</code>や<code>while文</code>を利用するようにしましょう.</p>
<h2 data-number="9.4" id="グラフの分割"><span class="header-section-number">9.4</span> グラフの分割</h2>
<p>先程は一つのグラフ内に複数の折れ線グラフを表示しましたが,個別に表示する場合にはどのようになるでしょうか.
一つの方法として,以下の用に複数のグラフを個別に作成することも可能です.
(先に保存先のディレクトリ <code>result/multi_plot</code> を作成しておきましょう.)</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> df.columns[<span class="dv">1</span>:]:</span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a>    plt.plot(df[<span class="st">&#39;Date&#39;</span>],df[x])</span>
<span id="cb259-3"><a href="#cb259-3" aria-hidden="true" tabindex="-1"></a>    plt.title(x)</span>
<span id="cb259-4"><a href="#cb259-4" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb259-5"><a href="#cb259-5" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="st">&#39;result/multi_plot/&#39;</span> <span class="op">+</span> x <span class="op">+</span> <span class="st">&#39;.png&#39;</span>)</span>
<span id="cb259-6"><a href="#cb259-6" aria-hidden="true" tabindex="-1"></a>    plt.close()</span></code></pre></div>
<figure>
<img src="/images/temperature_10location2.png" alt="保存された10個のグラフ" />
<figcaption aria-hidden="true">保存された10個のグラフ</figcaption>
</figure>
<p>しかし,レポートなどに10枚の画像を貼り付けるのは手間がかかりますし,余白など無駄も多いです.</p>
<ul>
<li>subplots()</li>
</ul>
<p><code>matplotlib</code>には1枚の画像を分割して複数のグラフを載せるためのメソッド<code>.subplots()</code>があるので,関連するグラフや比較のためのグラフなどはできるだけ1枚の画像に集約しましょう.</p>
<p><code>.subplots()</code>は1枚の画像を<code>n行</code>,<code>n列</code>に分割し,それぞれの領域にグラフを描画します.</p>
<p>各領域は <code>axes</code>などと呼ばれ,画像全体を<code>figure</code>などと呼びます.
利用するためには,まず <code>fig, axes = plt.subplot()</code>の形で宣言します. 引数として,行数は<code>nrows=</code>,列数は<code>ncols=</code>にそれぞれ<code>int</code>で指定します.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplot(nrows<span class="op">=</span> <span class="dv">5</span> <span class="co">#行数の指定</span></span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>                       ,ncols<span class="op">=</span> <span class="dv">2</span> <span class="co">#列数の指定</span></span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a>                        )</span></code></pre></div>
<p>宣言のあと,各領域のグラフを <code>axes[行,列]</code>の形で指定していきます.行や列は<code>0</code>から始まるので注意してください.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].plot(df[<span class="st">&#39;Date&#39;</span>],df[<span class="st">&#39;Location_1&#39;</span>],label<span class="op">=</span><span class="st">&#39;Location_1&#39;</span>)</span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].plot(df[<span class="st">&#39;Date&#39;</span>],df[<span class="st">&#39;Location_2&#39;</span>],label<span class="op">=</span><span class="st">&#39;Location_2&#39;</span>)</span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].plot(df[<span class="st">&#39;Date&#39;</span>],df[<span class="st">&#39;Location_3&#39;</span>],label<span class="op">=</span><span class="st">&#39;Location_3&#39;</span>)</span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].plot(df[<span class="st">&#39;Date&#39;</span>],df[<span class="st">&#39;Location_4&#39;</span>],label<span class="op">=</span><span class="st">&#39;Location_4&#39;</span>)</span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>,<span class="dv">0</span>].plot(df[<span class="st">&#39;Date&#39;</span>],df[<span class="st">&#39;Location_5&#39;</span>],label<span class="op">=</span><span class="st">&#39;Location_5&#39;</span>)</span>
<span id="cb261-6"><a href="#cb261-6" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>,<span class="dv">1</span>].plot(df[<span class="st">&#39;Date&#39;</span>],df[<span class="st">&#39;Location_6&#39;</span>],label<span class="op">=</span><span class="st">&#39;Location_6&#39;</span>)</span>
<span id="cb261-7"><a href="#cb261-7" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">3</span>,<span class="dv">0</span>].plot(df[<span class="st">&#39;Date&#39;</span>],df[<span class="st">&#39;Location_7&#39;</span>],label<span class="op">=</span><span class="st">&#39;Location_7&#39;</span>)</span>
<span id="cb261-8"><a href="#cb261-8" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">3</span>,<span class="dv">1</span>].plot(df[<span class="st">&#39;Date&#39;</span>],df[<span class="st">&#39;Location_8&#39;</span>],label<span class="op">=</span><span class="st">&#39;Location_8&#39;</span>)</span>
<span id="cb261-9"><a href="#cb261-9" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">4</span>,<span class="dv">0</span>].plot(df[<span class="st">&#39;Date&#39;</span>],df[<span class="st">&#39;Location_9&#39;</span>],label<span class="op">=</span><span class="st">&#39;Location_9&#39;</span>)</span>
<span id="cb261-10"><a href="#cb261-10" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">4</span>,<span class="dv">1</span>].plot(df[<span class="st">&#39;Date&#39;</span>],df[<span class="st">&#39;Location_10&#39;</span>],label<span class="op">=</span><span class="st">&#39;Location_10&#39;</span>)</span>
<span id="cb261-11"><a href="#cb261-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>以下のようなグラフが作成されます. しかし, 少し見にくいですね.</p>
<figure>
<img src="/images/subplot1.png" alt="subplots" />
<figcaption aria-hidden="true">subplots</figcaption>
</figure>
<p><code>.subplots(sharex=True)</code>とすると,x軸を共有することができます.今回のグラフはx軸がすべて同じなので,共有してみましょう.
また,それぞれのグラフにタイトルを付けてみます.
更に,一つ一つ手で入力するのは手間なので<code>for文</code>を利用してみましょう.</p>
<p>タイトルを付けるには今までの<code>plt.title()</code>ではなく<code>axes[r,c].set_title()</code>になります. <code>axes</code>毎の要素に関しては<a href="https://matplotlib.org/stable/users/explain/axes/axes_intro.html">公式サイト</a>を参考にしてください.</p>
<figure>
<img src="https://matplotlib.org/stable/_images/anatomy.png" alt="axesの要素(https://matplotlib.orgより)" />
<figcaption aria-hidden="true">axesの要素(https://matplotlib.orgより)</figcaption>
</figure>
<div class="sourceCode" id="cb262"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span> <span class="dv">5</span> <span class="co">#行数の指定</span></span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a>                        ,ncols<span class="op">=</span> <span class="dv">2</span> <span class="co">#列数の指定</span></span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a>                        ,sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-5"><a href="#cb262-5" aria-hidden="true" tabindex="-1"></a>count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb262-6"><a href="#cb262-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb262-7"><a href="#cb262-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>):</span>
<span id="cb262-8"><a href="#cb262-8" aria-hidden="true" tabindex="-1"></a>        col <span class="op">=</span> df.columns[<span class="dv">1</span>:]</span>
<span id="cb262-9"><a href="#cb262-9" aria-hidden="true" tabindex="-1"></a>        axes[i,j].plot(df[<span class="st">&#39;Date&#39;</span>],df[col[count]])</span>
<span id="cb262-10"><a href="#cb262-10" aria-hidden="true" tabindex="-1"></a>        axes[i,j].set_title(col[count])</span>
<span id="cb262-11"><a href="#cb262-11" aria-hidden="true" tabindex="-1"></a>        axes[i,j].tick_params(axis<span class="op">=</span><span class="st">&#39;x&#39;</span>, rotation<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb262-12"><a href="#cb262-12" aria-hidden="true" tabindex="-1"></a>        count <span class="op">+=</span><span class="dv">1</span></span>
<span id="cb262-13"><a href="#cb262-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="/images/subplot2.png" alt="subplots" />
<figcaption aria-hidden="true">subplots</figcaption>
</figure>
<p>グラフ全体の要素は<code>fig.</code>の形で指定します.
タイトルを付ける場合は<code>fig.suptitle('title')</code>となります.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span> <span class="dv">5</span> <span class="co">#行数の指定</span></span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a>                        ,ncols<span class="op">=</span> <span class="dv">2</span> <span class="co">#列数の指定</span></span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a>                        ,sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-5"><a href="#cb263-5" aria-hidden="true" tabindex="-1"></a>count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb263-6"><a href="#cb263-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb263-7"><a href="#cb263-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>):</span>
<span id="cb263-8"><a href="#cb263-8" aria-hidden="true" tabindex="-1"></a>        col <span class="op">=</span> df.columns[<span class="dv">1</span>:]</span>
<span id="cb263-9"><a href="#cb263-9" aria-hidden="true" tabindex="-1"></a>        axes[i,j].plot(df[<span class="st">&#39;Date&#39;</span>],df[col[count]])</span>
<span id="cb263-10"><a href="#cb263-10" aria-hidden="true" tabindex="-1"></a>        axes[i,j].set_title(col[count])</span>
<span id="cb263-11"><a href="#cb263-11" aria-hidden="true" tabindex="-1"></a>        axes[i,j].tick_params(axis<span class="op">=</span><span class="st">&#39;x&#39;</span>, rotation<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb263-12"><a href="#cb263-12" aria-hidden="true" tabindex="-1"></a>        count <span class="op">+=</span><span class="dv">1</span></span>
<span id="cb263-13"><a href="#cb263-13" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">&#39;subplots title&#39;</span>)</span>
<span id="cb263-14"><a href="#cb263-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="/images/subplot3.png" alt="subplots" />
<figcaption aria-hidden="true">subplots</figcaption>
</figure>
<div class="note">
<ul>
<li>flatten()</li>
</ul>
<p><code>for文</code>を二重ループで記述するのは大変なので,しばしば<code>axes.flatten()</code>を利用して,連番に変換すると便利です.</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span> <span class="dv">5</span> <span class="co">#行数の指定</span></span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a>                        ,ncols<span class="op">=</span> <span class="dv">2</span> <span class="co">#列数の指定</span></span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a>                        ,sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-5"><a href="#cb264-5" aria-hidden="true" tabindex="-1"></a><span class="co">#連番に変換</span></span>
<span id="cb264-6"><a href="#cb264-6" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> axes.flatten()</span>
<span id="cb264-7"><a href="#cb264-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb264-8"><a href="#cb264-8" aria-hidden="true" tabindex="-1"></a>    col <span class="op">=</span> df.columns[<span class="dv">1</span>:][i] <span class="co">#countをiで共通化</span></span>
<span id="cb264-9"><a href="#cb264-9" aria-hidden="true" tabindex="-1"></a>    axes[i].plot(df[<span class="st">&#39;Date&#39;</span>],df[col])</span>
<span id="cb264-10"><a href="#cb264-10" aria-hidden="true" tabindex="-1"></a>    axes[i].set_title(col)</span>
<span id="cb264-11"><a href="#cb264-11" aria-hidden="true" tabindex="-1"></a>    axes[i].tick_params(axis<span class="op">=</span><span class="st">&#39;x&#39;</span>, rotation<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb264-12"><a href="#cb264-12" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">&#39;subplots title&#39;</span>)</span>
<span id="cb264-13"><a href="#cb264-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
</div>
<h2 data-number="9.5" id="度数分布表とヒストグラム"><span class="header-section-number">9.5</span> 度数分布表とヒストグラム</h2>
<p>データを手に入れたら最初にデータを可視化してデータの特徴を掴む必要があります. データの特徴として重要なものに,データの<strong>分布</strong>があります.</p>
<div class="warn">
<ul>
<li><h2 id="分布の意味">分布の意味</h2></li>
</ul>
<p><strong>分布</strong>という語の詳細な意味に関しては,後ほど検定や回帰の章でも簡単に扱いますが,統計学入門において数理的に詳しく扱っています.</p>
<p>統計学入門を履修していない人はここでは,単に<strong>データの散らばり具合</strong>という意味として捉えておきましょう.</p>
</div>
<p>分布を可視化する手法として代表的なものに,<strong>度数分布表</strong>と,<strong>ヒストグラム</strong>があります. 1次元のデータの可視化において,度数分布表とヒストグラムは,<strong>データ分析のファーストステップ</strong>とも称される,重要な手法です. データを手に入れたらまずは度数分布表と,ヒストグラムを作成してみましょう.</p>
<h3 data-number="9.5.1" id="度数分布表"><span class="header-section-number">9.5.1</span> 度数分布表</h3>
<div class="note">
<p><strong>度数分布表</strong>とは,データの数を区切られた範囲ごとに数え上げた表のことです. 質的データの場合は,データのカテゴリー毎に,量的データの場合は分析者が定めた区間毎にデータがいくつかるのかを数え上げます.</p>
<p>普通ヒストグラムというと,量的データを対象としたものをいいますが,ここではわかりやすさのために,質的データから見ていきましょう.</p>
<p>以下の表は,何かしらの商品の美味しさに関するアンケート結果です. 商品を食べて,｢とても美味しい｣と回答した人の人数が9人,｢不味い｣と回答した人の人数が5人であることなどがわかります.</p>
<p>このように<strong>データのカテゴリー別にその値が生じたケースの数</strong>を<strong>度数</strong>といい,<strong>度数を数え上げ表に整理したもの</strong>を<strong>度数分布表</strong>といいます.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">アンケート区分</th>
<th style="text-align: center;">度数</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">とても美味しい</td>
<td style="text-align: center;">9</td>
</tr>
<tr class="even">
<td style="text-align: center;">どちらかといえば美味しい</td>
<td style="text-align: center;">11</td>
</tr>
<tr class="odd">
<td style="text-align: center;">普通</td>
<td style="text-align: center;">34</td>
</tr>
<tr class="even">
<td style="text-align: center;">どちらかといえば不味い</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="odd">
<td style="text-align: center;">不味い</td>
<td style="text-align: center;">5</td>
</tr>
</tbody>
</table>
<p>度数の亜種には,以下のようなものがあり,それぞれによってデータの分布が把握できます.</p>
<ul>
<li><p>累積度数:</p>
<p>順序尺度データの度数を少ない方から足し上げた値</p></li>
<li><p>相対度数(構成比率):</p>
<p>度数の総和を100%としたときの構成比率</p></li>
<li><p>累積相対度数(累積比率):</p>
<p>相対度数を上から足し上げた値</p></li>
</ul>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">アンケート区分</th>
<th style="text-align: center;">度数</th>
<th style="text-align: center;">累積度数</th>
<th style="text-align: center;">相対度数</th>
<th style="text-align: center;">累積相対度数</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">とても美味しい</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">14%</td>
<td style="text-align: center;">14%</td>
</tr>
<tr class="even">
<td style="text-align: center;">どちらかといえば美味しい</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">17%</td>
<td style="text-align: center;">31%</td>
</tr>
<tr class="odd">
<td style="text-align: center;">普通</td>
<td style="text-align: center;">34</td>
<td style="text-align: center;">54</td>
<td style="text-align: center;">53%</td>
<td style="text-align: center;">84%</td>
</tr>
<tr class="even">
<td style="text-align: center;">どちらかといえば不味い</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">59</td>
<td style="text-align: center;">8%</td>
<td style="text-align: center;">92%</td>
</tr>
<tr class="odd">
<td style="text-align: center;">不味い</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">64</td>
<td style="text-align: center;">8%</td>
<td style="text-align: center;">100%</td>
</tr>
<tr class="even">
<td style="text-align: center;">計</td>
<td style="text-align: center;">64</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">100%</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p>度数分布表を作成することで,データがどの分類に偏っているのかなど,データの分布の傾向がつかめます. 度数分布表を見る場合には,相対度数や累積度数から<strong>データが一番多いカテゴリー</strong>,<strong>度数データの過半数が属するカテゴリー</strong>,<strong>データのほとんど(90%程度)が属するカテゴリー</strong>などに注目してみましょう.
上のデータでは,最も回答が多いのは｢普通｣であること, ｢とても美味しい｣｢どちらかといえば美味しい｣の回答が,31%であるのに対して,｢どちらかといえば不味い｣｢不味い｣の回答が18%であり,全体的にこの商品の味は高評価側に集中していることなどがわかります.</p>
</div>
<p>Pythonで度数分布表を作成するにはどのようにしたら良いのでしょうか. 質的データの場合は,ただそれぞれの値を数えればいいので,<code>for文</code>などを利用することも可能ですが,<code>pandas</code>の<code>value_counts()</code>メソッドを利用することで簡単に作成できます.</p>
<p><a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/diff_class.csv">こちら</a>のとある授業の難易度に関する質的データをダウンロードして度数分布表を作成してみましょう.</p>
<p>データは以下のように,｢難しすぎてついていけない｣,｢難しいが許容できる｣,｢ちょうどよい｣,｢簡単だが許容できる｣｢簡単すぎて退屈｣の5段階のカテゴリーが記述されています.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a>         <span class="ex">Diff</span></span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>   難しいが許容できる</span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   簡単すぎて退屈</span>
<span id="cb265-4"><a href="#cb265-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>   難しいが許容できる</span>
<span id="cb265-5"><a href="#cb265-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>   簡単だが許容できる</span>
<span id="cb265-6"><a href="#cb265-6" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>      ちょうどよい</span>
<span id="cb265-7"><a href="#cb265-7" aria-hidden="true" tabindex="-1"></a><span class="ex">..</span>        ...</span></code></pre></div>
<div class="sourceCode" id="cb266"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> japanize_matplotlib</span>
<span id="cb266-5"><a href="#cb266-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb266-6"><a href="#cb266-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> module.sturges <span class="im">as</span> st</span>
<span id="cb266-7"><a href="#cb266-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-8"><a href="#cb266-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-9"><a href="#cb266-9" aria-hidden="true" tabindex="-1"></a><span class="co">#データの読み込み</span></span>
<span id="cb266-10"><a href="#cb266-10" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;Data/diff.csv&#39;</span>)</span>
<span id="cb266-11"><a href="#cb266-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb266-12"><a href="#cb266-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-13"><a href="#cb266-13" aria-hidden="true" tabindex="-1"></a><span class="co">#ヒストグラムを作りたいデータの列名を指定</span></span>
<span id="cb266-14"><a href="#cb266-14" aria-hidden="true" tabindex="-1"></a>target_column <span class="op">=</span> <span class="st">&#39;Diff&#39;</span></span>
<span id="cb266-15"><a href="#cb266-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-16"><a href="#cb266-16" aria-hidden="true" tabindex="-1"></a><span class="co">#度数</span></span>
<span id="cb266-17"><a href="#cb266-17" aria-hidden="true" tabindex="-1"></a>freq <span class="op">=</span> df[target_column].value_counts(sort<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb266-18"><a href="#cb266-18" aria-hidden="true" tabindex="-1"></a><span class="co">#順番の入れ替え</span></span>
<span id="cb266-19"><a href="#cb266-19" aria-hidden="true" tabindex="-1"></a>freq <span class="op">=</span> freq.reindex([<span class="st">&#39;難しすぎてついていけない&#39;</span></span>
<span id="cb266-20"><a href="#cb266-20" aria-hidden="true" tabindex="-1"></a>                    ,<span class="st">&#39;難しいが許容できる&#39;</span></span>
<span id="cb266-21"><a href="#cb266-21" aria-hidden="true" tabindex="-1"></a>                    ,<span class="st">&#39;ちょうどよい&#39;</span></span>
<span id="cb266-22"><a href="#cb266-22" aria-hidden="true" tabindex="-1"></a>                    ,<span class="st">&#39;簡単だが許容できる&#39;</span></span>
<span id="cb266-23"><a href="#cb266-23" aria-hidden="true" tabindex="-1"></a>                    ,<span class="st">&#39;簡単すぎて退屈&#39;</span>],axis<span class="op">=</span><span class="st">&#39;index&#39;</span>)</span>
<span id="cb266-24"><a href="#cb266-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;度数&#39;</span>,freq)</span>
<span id="cb266-25"><a href="#cb266-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-26"><a href="#cb266-26" aria-hidden="true" tabindex="-1"></a>rel_freq <span class="op">=</span> freq <span class="op">/</span> df[target_column].count()  <span class="co"># 相対度数</span></span>
<span id="cb266-27"><a href="#cb266-27" aria-hidden="true" tabindex="-1"></a>cum_freq <span class="op">=</span> freq.cumsum()  <span class="co"># 累積度数</span></span>
<span id="cb266-28"><a href="#cb266-28" aria-hidden="true" tabindex="-1"></a>rel_cum_freq <span class="op">=</span> rel_freq.cumsum()  <span class="co"># 相対累積度数</span></span>
<span id="cb266-29"><a href="#cb266-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-30"><a href="#cb266-30" aria-hidden="true" tabindex="-1"></a>dist <span class="op">=</span> pd.DataFrame(</span>
<span id="cb266-31"><a href="#cb266-31" aria-hidden="true" tabindex="-1"></a>    {   <span class="st">&quot;Value&quot;</span>: freq.index,        <span class="co">#階級値</span></span>
<span id="cb266-32"><a href="#cb266-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Freq&quot;</span>: freq,               <span class="co">#度数</span></span>
<span id="cb266-33"><a href="#cb266-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Rel&quot;</span>: rel_freq,            <span class="co">#相対度数</span></span>
<span id="cb266-34"><a href="#cb266-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Cum&quot;</span>: cum_freq,            <span class="co">#累積度数</span></span>
<span id="cb266-35"><a href="#cb266-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;RelCum&quot;</span>: rel_cum_freq,     <span class="co">#相対累積度数</span></span>
<span id="cb266-36"><a href="#cb266-36" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb266-37"><a href="#cb266-37" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>freq.index</span>
<span id="cb266-38"><a href="#cb266-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb266-39"><a href="#cb266-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-40"><a href="#cb266-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dist)</span>
<span id="cb266-41"><a href="#cb266-41" aria-hidden="true" tabindex="-1"></a>dist.to_csv(<span class="st">&#39;frequency_table.csv&#39;</span>,)</span></code></pre></div>
<p>保存されたcsv(<code>frequency_table.csv</code>)を確認してみると,度数分布表が作成されていることが確認できます.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Value</th>
<th style="text-align: center;">Freq</th>
<th style="text-align: center;">Rel</th>
<th style="text-align: center;">Cum</th>
<th style="text-align: center;">RelCum</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">難しいが許容できる</td>
<td style="text-align: center;">44</td>
<td style="text-align: center;">0.494382022</td>
<td style="text-align: center;">44</td>
<td style="text-align: center;">0.494382022</td>
</tr>
<tr class="even">
<td style="text-align: center;">簡単すぎて退屈</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.011235955</td>
<td style="text-align: center;">45</td>
<td style="text-align: center;">0.505617978</td>
</tr>
<tr class="odd">
<td style="text-align: center;">簡単だが許容できる</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">0.04494382</td>
<td style="text-align: center;">49</td>
<td style="text-align: center;">0.550561798</td>
</tr>
<tr class="even">
<td style="text-align: center;">ちょうどよい</td>
<td style="text-align: center;">38</td>
<td style="text-align: center;">0.426966292</td>
<td style="text-align: center;">87</td>
<td style="text-align: center;">0.97752809</td>
</tr>
<tr class="odd">
<td style="text-align: center;">難しすぎてついていけない</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.02247191</td>
<td style="text-align: center;">89</td>
<td style="text-align: center;">1</td>
</tr>
</tbody>
</table>
<p>質的データはあらかじめデータのカテゴリーが定められているのでその数を数えるだけで,度数分布表が作成できました.
それでは,カテゴリーが存在しない量的データではどのようにして度数分布表を作成するのでしょうか.</p>
<div class="note">
<ul>
<li><strong>量的データと度数分布表</strong></li>
</ul>
<p>量的データには当てはまるデータを数えるためのカテゴリーが存在しません. 年収のデータを考えた場合,年収1万円ごとに表を作ると1から数億まで,非常に細かくなります.
そこで,量的データで度数分布表を作成するには,100万円ごと,300万円ごとなどデータをいくつかの区間に分けて,区間別の度数を数える必要があります. ここで, 作られた区間を<strong>階級</strong>,階級の幅を<strong>階級幅</strong>,階級を代表する値を<strong>階級値</strong>といいます. 階級値は大抵の場合,区間の中間の値が用いられます(100万円~200万円の区間だとすると,150万円など).</p>
<p>以下の度数分布表は,ある情報クラスの成績(0-100点)を10点毎に区分したものです. それぞれの点数に当てはまる人数を数えて度数とします.</p>
<figure>
<img src="/images/histgram1.png" alt="度数分布表の例" />
<figcaption aria-hidden="true">度数分布表の例</figcaption>
</figure>
<p>量的データの階級数や階級幅は,100万円ごとなどある程度人間の判断によって作成しても構いませんが,数理的に決定する方法もあります.</p>
<p>階級幅は階級数が決まることで自動的に決まるため,階級数を決める一般的な目安として,<strong>スタージェスの公式</strong>が利用されます.</p>
<p>観測数を<span class="math inline">\(n\)</span>,階級数を<span class="math inline">\(k\)</span>とすると.</p>
<p><span class="math display">\[ k = 1 + log_2 n = \frac{log_{10} n}{log_{10} 2}\]</span></p>
<p>程度の<span class="math inline">\(k\)</span>が望ましいとされています.</p>
<p>計算結果はおおよそ以下のようになります.</p>
<figure>
<img src="/images/sturges_number.png" alt="スタージェス数" />
<figcaption aria-hidden="true">スタージェス数</figcaption>
</figure>
</div>
<p>Pythonではスタージェス数は対数計算をするためのモジュール<code>math</code>を利用して以下のように求めることができます.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2進対数を返す math.log2() 関数などを利用するために必要なモジュール</span></span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb267-3"><a href="#cb267-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-4"><a href="#cb267-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 関数名を sturgesNumber として引数をnとします</span></span>
<span id="cb267-5"><a href="#cb267-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sturgesNumber(n):</span>
<span id="cb267-6"><a href="#cb267-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 公式の通り k = 1 + log2 n</span></span>
<span id="cb267-7"><a href="#cb267-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 階級数は整数が良いので,math.floor()で小数点以下を切り捨てます</span></span>
<span id="cb267-8"><a href="#cb267-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (math.floor (<span class="dv">1</span> <span class="op">+</span> math.log2(n)))</span>
<span id="cb267-9"><a href="#cb267-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-10"><a href="#cb267-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sturges(<span class="dv">2048</span>)) <span class="co">#&gt;&gt;&gt; 12</span></span></code></pre></div>
<p>階級数が決まることで階級幅が
<span class="math display">\[\frac{(データの最大値 - データの最小値)}{階級数}\]</span></p>
<p>として決まります.</p>
<p>それでは,<a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/histgram_quantitative.csv">こちら</a>のデータを利用して,度数分布表を作成してみます. 量的データの度数分布表を作成するには,<code>value-counts()</code>の引数<code>bins=</code>に各階級の終点を表すリストを指定します.</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ヒストグラムを作りたいデータの列名を指定</span></span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a>target_column <span class="op">=</span> <span class="st">&#39;Values&#39;</span></span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-4"><a href="#cb268-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 関数名を sturgesNumber として引数をnとします</span></span>
<span id="cb268-5"><a href="#cb268-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sturgesNumber(n):</span>
<span id="cb268-6"><a href="#cb268-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 公式の通り k = 1 + log2 n</span></span>
<span id="cb268-7"><a href="#cb268-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 階級数は整数が良いので,math.floor()で小数点以下を切り捨てます</span></span>
<span id="cb268-8"><a href="#cb268-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (math.floor (<span class="dv">1</span> <span class="op">+</span> math.log2(n)))</span>
<span id="cb268-9"><a href="#cb268-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-10"><a href="#cb268-10" aria-hidden="true" tabindex="-1"></a><span class="co"># dataフォルダにあるhistgram_quantitative.csvというファイルを読み込みます.</span></span>
<span id="cb268-11"><a href="#cb268-11" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;data/histgram_quantitative.csv&quot;</span>)</span>
<span id="cb268-12"><a href="#cb268-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 読み込んだファイルの中身を見てみます.</span></span>
<span id="cb268-13"><a href="#cb268-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb268-14"><a href="#cb268-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-15"><a href="#cb268-15" aria-hidden="true" tabindex="-1"></a><span class="co">#階級数を決定</span></span>
<span id="cb268-16"><a href="#cb268-16" aria-hidden="true" tabindex="-1"></a>stnum <span class="op">=</span> sturgesNumber(<span class="bu">len</span>(df[target_column]))</span>
<span id="cb268-17"><a href="#cb268-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;sturges number:&#39;</span>,stnum)</span>
<span id="cb268-18"><a href="#cb268-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-19"><a href="#cb268-19" aria-hidden="true" tabindex="-1"></a><span class="co">#階級幅を決定</span></span>
<span id="cb268-20"><a href="#cb268-20" aria-hidden="true" tabindex="-1"></a>space <span class="op">=</span> <span class="bu">int</span>((df[target_column].<span class="bu">max</span>() <span class="op">-</span> df[target_column].<span class="bu">min</span>()) <span class="op">/</span> stnum)</span>
<span id="cb268-21"><a href="#cb268-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;space:&#39;</span>,space)</span>
<span id="cb268-22"><a href="#cb268-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-23"><a href="#cb268-23" aria-hidden="true" tabindex="-1"></a><span class="co">#階級幅の終端を指定</span></span>
<span id="cb268-24"><a href="#cb268-24" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> np.arange(start <span class="op">=</span> <span class="bu">int</span>(df[target_column].<span class="bu">min</span>()) <span class="op">-</span> <span class="dv">1</span> <span class="co">#最小値</span></span>
<span id="cb268-25"><a href="#cb268-25" aria-hidden="true" tabindex="-1"></a>                ,stop  <span class="op">=</span> <span class="bu">int</span>(df[target_column].<span class="bu">max</span>()) <span class="op">+</span> <span class="dv">1</span> <span class="co">#最大値</span></span>
<span id="cb268-26"><a href="#cb268-26" aria-hidden="true" tabindex="-1"></a>                ,step  <span class="op">=</span> space <span class="co">#階級幅</span></span>
<span id="cb268-27"><a href="#cb268-27" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb268-28"><a href="#cb268-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-29"><a href="#cb268-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;bins:&#39;</span>,bins)</span>
<span id="cb268-30"><a href="#cb268-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-31"><a href="#cb268-31" aria-hidden="true" tabindex="-1"></a><span class="co">#度数</span></span>
<span id="cb268-32"><a href="#cb268-32" aria-hidden="true" tabindex="-1"></a>freq <span class="op">=</span> df[target_column].value_counts(bins <span class="op">=</span>bins, sort<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb268-33"><a href="#cb268-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;度数&#39;</span>,freq)</span>
<span id="cb268-34"><a href="#cb268-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-35"><a href="#cb268-35" aria-hidden="true" tabindex="-1"></a>rel_freq <span class="op">=</span> freq <span class="op">/</span> df[target_column].count()  <span class="co"># 相対度数</span></span>
<span id="cb268-36"><a href="#cb268-36" aria-hidden="true" tabindex="-1"></a>cum_freq <span class="op">=</span> freq.cumsum()  <span class="co"># 累積度数</span></span>
<span id="cb268-37"><a href="#cb268-37" aria-hidden="true" tabindex="-1"></a>rel_cum_freq <span class="op">=</span> rel_freq.cumsum()  <span class="co"># 相対累積度数</span></span>
<span id="cb268-38"><a href="#cb268-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-39"><a href="#cb268-39" aria-hidden="true" tabindex="-1"></a>dist <span class="op">=</span> pd.DataFrame(</span>
<span id="cb268-40"><a href="#cb268-40" aria-hidden="true" tabindex="-1"></a>    {   <span class="st">&quot;Value&quot;</span>: freq.index,        <span class="co">#階級値</span></span>
<span id="cb268-41"><a href="#cb268-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Freq&quot;</span>: freq,               <span class="co">#度数</span></span>
<span id="cb268-42"><a href="#cb268-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Rel&quot;</span>: rel_freq,            <span class="co">#相対度数</span></span>
<span id="cb268-43"><a href="#cb268-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Cum&quot;</span>: cum_freq,            <span class="co">#累積度数</span></span>
<span id="cb268-44"><a href="#cb268-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;RelCum&quot;</span>: rel_cum_freq,     <span class="co">#相対累積度数</span></span>
<span id="cb268-45"><a href="#cb268-45" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb268-46"><a href="#cb268-46" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>freq.index</span>
<span id="cb268-47"><a href="#cb268-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb268-48"><a href="#cb268-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-49"><a href="#cb268-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dist)</span>
<span id="cb268-50"><a href="#cb268-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-51"><a href="#cb268-51" aria-hidden="true" tabindex="-1"></a>dist.to_csv(<span class="st">&#39;frequency_table_qualitative.csv&#39;</span></span>
<span id="cb268-52"><a href="#cb268-52" aria-hidden="true" tabindex="-1"></a>           ,encoding<span class="op">=</span><span class="st">&#39;utf-8-sig&#39;</span></span>
<span id="cb268-53"><a href="#cb268-53" aria-hidden="true" tabindex="-1"></a>           ,index<span class="op">=</span><span class="va">False</span>)</span></code></pre></div>
<p>結果作成された,<code>frequency_table_qualitative.csv</code>を開いてみると,以下のような度数分布表が作成されたことが確認できます.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Value</th>
<th style="text-align: center;">Freq</th>
<th style="text-align: center;">Rel</th>
<th style="text-align: center;">Cum</th>
<th style="text-align: center;">RelCum</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">(8.999, 18.0]</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.01</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.01</td>
</tr>
<tr class="even">
<td style="text-align: center;">(18.0, 27.0]</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">0.05</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">0.06</td>
</tr>
<tr class="odd">
<td style="text-align: center;">(27.0, 36.0]</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;">0.11</td>
<td style="text-align: center;">17</td>
<td style="text-align: center;">0.17</td>
</tr>
<tr class="even">
<td style="text-align: center;">(36.0, 45.0]</td>
<td style="text-align: center;">21</td>
<td style="text-align: center;">0.21</td>
<td style="text-align: center;">38</td>
<td style="text-align: center;">0.38</td>
</tr>
<tr class="odd">
<td style="text-align: center;">(45.0, 54.0]</td>
<td style="text-align: center;">27</td>
<td style="text-align: center;">0.27</td>
<td style="text-align: center;">65</td>
<td style="text-align: center;">0.65</td>
</tr>
<tr class="even">
<td style="text-align: center;">(54.0, 63.0]</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">0.2</td>
<td style="text-align: center;">85</td>
<td style="text-align: center;">0.85</td>
</tr>
<tr class="odd">
<td style="text-align: center;">(63.0, 72.0]</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">0.09</td>
<td style="text-align: center;">94</td>
<td style="text-align: center;">0.94</td>
</tr>
</tbody>
</table>
<h3 data-number="9.5.2" id="度数分布表の可視化ヒストグラム"><span class="header-section-number">9.5.2</span> 度数分布表の可視化:<strong>ヒストグラム</strong></h3>
<p>ここまでで,データの分布,偏りを把握する手段としての度数分布表を学びました. 度数分布表を眺めることである程度データの形は分かりますが,よりわかりやすく可視化する方法として<strong>ヒストグラム</strong>があります.</p>
<p><strong>ヒストグラム(Histgram)/柱状図</strong>とは,量的データの度数分布を棒グラフで表現したものです.ただし,通常の棒グラフと異なり値が連続しているので,棒と棒の間にスペースを置きません. 統計における最も基本的なグラフです.</p>
<p>ヒストグラムはいくつかの代表的なパターンがあり,それぞれ注意するべきポイントがありますので,順に見ていきましょう.</p>
<div class="note">
<ul>
<li><h2 id="単峰型unimodalで左右対称">単峰型(unimodal)で左右対称</h2></li>
</ul>
<p>ヒストグラムの盛り上がっている部分を<strong>峰</strong>といいます. 峰の数が一つのヒストグラムを<strong>単峰(unimodal)</strong>なヒストグラムといいます.</p>
<p>ヒストグラムの基本となる形は,単峰で左右対称な分布です. この分布は,<strong>データが同質な集団から発生していること</strong>を表しています.</p>
<pre><code>- 例:同じ人種の,同じ年代の,男性の集団の身長

- 例:同じ種類,同じ時期,同じ地域のうさぎの集団のサイズ</code></pre>
<p>峰からの左右のデータのばらつきは集団の個体差を表しています. 異なる,質を持つ集団が混じっている場合は峰が複数になることが多いです.</p>
<figure>
<img src="/images/histgram_unimodal.png" alt="単峰で左右対称なヒストグラム" />
<figcaption aria-hidden="true">単峰で左右対称なヒストグラム</figcaption>
</figure>
<ul>
<li><h2 id="多峰型bimodalなヒストグラム">多峰型(bimodal)なヒストグラム</h2></li>
</ul>
<p>峰が2つ以上あるヒストグラムを<strong>多峰(bimodal)</strong>なヒストグラムといいます.
異質な集団が混ざっているデータでは,ヒストグラムが多峰になることがあります.</p>
<pre><code>- 例:男女の混ざった集団の身長や体重
男性の峰と女性の峰が現れます.

- 例:小学生と中学生に同じテストを受けた点数
小学生の点数の峰と,中学生の点数の峰が現れます.</code></pre>
<p>ヒストグラムを作成し,多峰性が現れたらデータを集団別・要因別に分割して分析するのが良いとされています.データを特定の属性で分割することを<strong>層別</strong>といいます.</p>
<figure>
<img src="/images/histgram_bimodal.png" alt="多峰なヒスグラム" />
<figcaption aria-hidden="true">多峰なヒスグラム</figcaption>
</figure>
<ul>
<li><h2 id="左右非対称なヒストグラム">左右非対称なヒストグラム</h2></li>
</ul>
<p>ヒストグラムは峰を中心として左右対称な場合もありますが,どちらかの方向に歪んでいるものも良く見られます.</p>
<pre><code>- 例:社会人の年収,企業の売上など</code></pre>
<p>ヒストグラムの細くなっている部分をヒストグラムの<strong>尾</strong>といいます.</p>
<pre><code>- **尾が**左に伸びている場合に **左に歪んだ分布**

- **尾が**右に伸びている場合に **右に歪んだ分布**</code></pre>
<p>といいます.</p>
<figure>
<img src="/images/histgram_right_left.png" alt="左右に歪んだヒストグラム" />
<figcaption aria-hidden="true">左右に歪んだヒストグラム</figcaption>
</figure>
<p>左右に歪んだ分布では,後に扱う<strong>中心を表す代表値</strong>(平均値や中央値)が適切に集団を代表しない場合があるので,代表値の使い分けが必要になります.</p>
<p>また, 後に扱う<strong>検定</strong>手法のうち,<strong>正規分布</strong>を仮定する検定が利用できないなど,手法の選択において,分布の歪みは重要なポイントです.</p>
<ul>
<li><h2 id="外れ値outlierのあるヒストグラム"><strong>外れ値(Outlier)</strong>のあるヒストグラム</h2></li>
</ul>
<p>大多数のデータとは離れた位置にある少数のデータを<strong>外れ値(Outlier)</strong>といいます.</p>
<p>外れ値は,データ分析において非常に重要な意味を持ち,外れ値が現れた場合にはその原因を探ることが必要となります.
外れ値が発生する原因としては以下のようなものがあり,いずれも注目する必要があります.</p>
<pre><code>- データの取得におけるミス
    単純な入力ミスや計算ミスなど
    発見した場合は修正,除外する必要がある.

- 異質な存在の発見
    新種や新しい現象の発見などにつながる可能性があります.</code></pre>
<p>また,代表値の計算においては歪みが生じる可能性があるので,外れ値を除外する必要があります.</p>
<figure>
<img src="/images/histgram_outlier.png" alt="外れ値のあるヒストグラム" />
<figcaption aria-hidden="true">外れ値のあるヒストグラム</figcaption>
</figure>
</div>
<p>それでは,Pythonでヒストグラムを作成してみましょう. 度数分布表を作成している場合は,棒グラフを作成し,棒の幅を<code>0</code>にすることで,ヒストグラムが作成できます.</p>
<p><code>plt.bar()</code>では,引数<code>width=1</code>を与えることで,棒の太さを<code>1</code>(棒の間を0)にすることができます.</p>
<p>まずは,以前扱った<a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/diff_class.csv">質的データ</a>の例におけるヒストグラムを作成してみましょう.</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="co">#データの読み込み</span></span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;Data/diff_class.csv&#39;</span>)</span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-5"><a href="#cb274-5" aria-hidden="true" tabindex="-1"></a><span class="co">#ヒストグラムを作りたいデータの列名を指定</span></span>
<span id="cb274-6"><a href="#cb274-6" aria-hidden="true" tabindex="-1"></a>target_column <span class="op">=</span> <span class="st">&#39;Diff&#39;</span></span>
<span id="cb274-7"><a href="#cb274-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-8"><a href="#cb274-8" aria-hidden="true" tabindex="-1"></a><span class="co">#度数</span></span>
<span id="cb274-9"><a href="#cb274-9" aria-hidden="true" tabindex="-1"></a>freq <span class="op">=</span> df[target_column].value_counts(sort<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb274-10"><a href="#cb274-10" aria-hidden="true" tabindex="-1"></a><span class="co">#順番の入れ替え</span></span>
<span id="cb274-11"><a href="#cb274-11" aria-hidden="true" tabindex="-1"></a>freq <span class="op">=</span> freq.reindex([<span class="st">&#39;難しすぎてついていけない&#39;</span></span>
<span id="cb274-12"><a href="#cb274-12" aria-hidden="true" tabindex="-1"></a>                    ,<span class="st">&#39;難しいが許容できる&#39;</span></span>
<span id="cb274-13"><a href="#cb274-13" aria-hidden="true" tabindex="-1"></a>                    ,<span class="st">&#39;ちょうどよい&#39;</span></span>
<span id="cb274-14"><a href="#cb274-14" aria-hidden="true" tabindex="-1"></a>                    ,<span class="st">&#39;簡単だが許容できる&#39;</span></span>
<span id="cb274-15"><a href="#cb274-15" aria-hidden="true" tabindex="-1"></a>                    ,<span class="st">&#39;簡単すぎて退屈&#39;</span>],axis<span class="op">=</span><span class="st">&#39;index&#39;</span>)</span>
<span id="cb274-16"><a href="#cb274-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;度数&#39;</span>,freq)</span>
<span id="cb274-17"><a href="#cb274-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-18"><a href="#cb274-18" aria-hidden="true" tabindex="-1"></a>rel_freq <span class="op">=</span> freq <span class="op">/</span> df[target_column].count()  <span class="co"># 相対度数</span></span>
<span id="cb274-19"><a href="#cb274-19" aria-hidden="true" tabindex="-1"></a>cum_freq <span class="op">=</span> freq.cumsum()  <span class="co"># 累積度数</span></span>
<span id="cb274-20"><a href="#cb274-20" aria-hidden="true" tabindex="-1"></a>rel_cum_freq <span class="op">=</span> rel_freq.cumsum()  <span class="co"># 相対累積度数</span></span>
<span id="cb274-21"><a href="#cb274-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-22"><a href="#cb274-22" aria-hidden="true" tabindex="-1"></a>dist <span class="op">=</span> pd.DataFrame(</span>
<span id="cb274-23"><a href="#cb274-23" aria-hidden="true" tabindex="-1"></a>    {   <span class="st">&quot;Value&quot;</span>: freq.index,        <span class="co">#階級値</span></span>
<span id="cb274-24"><a href="#cb274-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Freq&quot;</span>: freq,               <span class="co">#度数</span></span>
<span id="cb274-25"><a href="#cb274-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Rel&quot;</span>: rel_freq,            <span class="co">#相対度数</span></span>
<span id="cb274-26"><a href="#cb274-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Cum&quot;</span>: cum_freq,            <span class="co">#累積度数</span></span>
<span id="cb274-27"><a href="#cb274-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;RelCum&quot;</span>: rel_cum_freq,     <span class="co">#相対累積度数</span></span>
<span id="cb274-28"><a href="#cb274-28" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb274-29"><a href="#cb274-29" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>freq.index</span>
<span id="cb274-30"><a href="#cb274-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb274-31"><a href="#cb274-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-32"><a href="#cb274-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dist)</span>
<span id="cb274-33"><a href="#cb274-33" aria-hidden="true" tabindex="-1"></a>dist.to_csv(<span class="st">&#39;frequency_table.csv&#39;</span>,encoding<span class="op">=</span><span class="st">&#39;utf-8-sig&#39;</span>,index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb274-34"><a href="#cb274-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-35"><a href="#cb274-35" aria-hidden="true" tabindex="-1"></a><span class="co"># ヒストグラム</span></span>
<span id="cb274-36"><a href="#cb274-36" aria-hidden="true" tabindex="-1"></a>plt.bar(x<span class="op">=</span>dist[<span class="st">&#39;Value&#39;</span>], height<span class="op">=</span>dist[<span class="st">&quot;Freq&quot;</span>],width<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb274-37"><a href="#cb274-37" aria-hidden="true" tabindex="-1"></a>plt.xticks(np.arange(<span class="bu">len</span>(dist)),<span class="bu">list</span>(dist.index),rotation<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb274-38"><a href="#cb274-38" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>以下のように,単峰で右に歪んだグラフが作成されるはずです.</p>
<figure>
<img src="/images/histgram_qualitative.png" alt="質的データのヒストグラム" />
<figcaption aria-hidden="true">質的データのヒストグラム</figcaption>
</figure>
<p>同様に<a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/histgram_quantitative.csv">量的データ</a>についても作成してみます.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ヒストグラムを作りたいデータの列名を指定</span></span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a>target_column <span class="op">=</span> <span class="st">&#39;Values&#39;</span></span>
<span id="cb275-3"><a href="#cb275-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-4"><a href="#cb275-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 関数名を sturgesNumber として引数をnとします</span></span>
<span id="cb275-5"><a href="#cb275-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sturgesNumber(n):</span>
<span id="cb275-6"><a href="#cb275-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 公式の通り k = 1 + log2 n</span></span>
<span id="cb275-7"><a href="#cb275-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 階級数は整数が良いので,math.floor()で小数点以下を切り捨てます</span></span>
<span id="cb275-8"><a href="#cb275-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (math.floor (<span class="dv">1</span> <span class="op">+</span> math.log2(n)))</span>
<span id="cb275-9"><a href="#cb275-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-10"><a href="#cb275-10" aria-hidden="true" tabindex="-1"></a><span class="co"># dataフォルダにあるhistgram_quantitative.csvというファイルを読み込みます.</span></span>
<span id="cb275-11"><a href="#cb275-11" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;data/histgram_quantitative.csv&quot;</span>)</span>
<span id="cb275-12"><a href="#cb275-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 読み込んだファイルの中身を見てみます.</span></span>
<span id="cb275-13"><a href="#cb275-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb275-14"><a href="#cb275-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-15"><a href="#cb275-15" aria-hidden="true" tabindex="-1"></a><span class="co">#階級数を決定</span></span>
<span id="cb275-16"><a href="#cb275-16" aria-hidden="true" tabindex="-1"></a>stnum <span class="op">=</span> sturgesNumber(<span class="bu">len</span>(df[target_column]))</span>
<span id="cb275-17"><a href="#cb275-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;sturges number:&#39;</span>,stnum)</span>
<span id="cb275-18"><a href="#cb275-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-19"><a href="#cb275-19" aria-hidden="true" tabindex="-1"></a><span class="co">#階級幅を決定</span></span>
<span id="cb275-20"><a href="#cb275-20" aria-hidden="true" tabindex="-1"></a>space <span class="op">=</span> <span class="bu">int</span>((df[target_column].<span class="bu">max</span>() <span class="op">-</span> df[target_column].<span class="bu">min</span>()) <span class="op">/</span> stnum)</span>
<span id="cb275-21"><a href="#cb275-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;space:&#39;</span>,space)</span>
<span id="cb275-22"><a href="#cb275-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-23"><a href="#cb275-23" aria-hidden="true" tabindex="-1"></a><span class="co">#階級幅の終端を指定</span></span>
<span id="cb275-24"><a href="#cb275-24" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> np.arange(start <span class="op">=</span> <span class="bu">int</span>(df[target_column].<span class="bu">min</span>()) <span class="op">-</span> <span class="dv">1</span> <span class="co">#最小値</span></span>
<span id="cb275-25"><a href="#cb275-25" aria-hidden="true" tabindex="-1"></a>                ,stop  <span class="op">=</span> <span class="bu">int</span>(df[target_column].<span class="bu">max</span>()) <span class="op">+</span> <span class="dv">1</span> <span class="co">#最大値</span></span>
<span id="cb275-26"><a href="#cb275-26" aria-hidden="true" tabindex="-1"></a>                ,step  <span class="op">=</span> space <span class="co">#階級幅</span></span>
<span id="cb275-27"><a href="#cb275-27" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb275-28"><a href="#cb275-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-29"><a href="#cb275-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;bins:&#39;</span>,bins)</span>
<span id="cb275-30"><a href="#cb275-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-31"><a href="#cb275-31" aria-hidden="true" tabindex="-1"></a><span class="co">#度数</span></span>
<span id="cb275-32"><a href="#cb275-32" aria-hidden="true" tabindex="-1"></a>freq <span class="op">=</span> df[target_column].value_counts(bins <span class="op">=</span>bins, sort<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb275-33"><a href="#cb275-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;度数&#39;</span>,freq)</span>
<span id="cb275-34"><a href="#cb275-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-35"><a href="#cb275-35" aria-hidden="true" tabindex="-1"></a>rel_freq <span class="op">=</span> freq <span class="op">/</span> df[target_column].count()  <span class="co"># 相対度数</span></span>
<span id="cb275-36"><a href="#cb275-36" aria-hidden="true" tabindex="-1"></a>cum_freq <span class="op">=</span> freq.cumsum()  <span class="co"># 累積度数</span></span>
<span id="cb275-37"><a href="#cb275-37" aria-hidden="true" tabindex="-1"></a>rel_cum_freq <span class="op">=</span> rel_freq.cumsum()  <span class="co"># 相対累積度数</span></span>
<span id="cb275-38"><a href="#cb275-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-39"><a href="#cb275-39" aria-hidden="true" tabindex="-1"></a>dist <span class="op">=</span> pd.DataFrame(</span>
<span id="cb275-40"><a href="#cb275-40" aria-hidden="true" tabindex="-1"></a>    {   <span class="st">&quot;Value&quot;</span>: freq.index,        <span class="co">#階級値</span></span>
<span id="cb275-41"><a href="#cb275-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Freq&quot;</span>: freq,               <span class="co">#度数</span></span>
<span id="cb275-42"><a href="#cb275-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Rel&quot;</span>: rel_freq,            <span class="co">#相対度数</span></span>
<span id="cb275-43"><a href="#cb275-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Cum&quot;</span>: cum_freq,            <span class="co">#累積度数</span></span>
<span id="cb275-44"><a href="#cb275-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;RelCum&quot;</span>: rel_cum_freq,     <span class="co">#相対累積度数</span></span>
<span id="cb275-45"><a href="#cb275-45" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb275-46"><a href="#cb275-46" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>freq.index</span>
<span id="cb275-47"><a href="#cb275-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb275-48"><a href="#cb275-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-49"><a href="#cb275-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dist)</span>
<span id="cb275-50"><a href="#cb275-50" aria-hidden="true" tabindex="-1"></a>dist.to_csv(<span class="st">&#39;frequency_table_qualitative.csv&#39;</span></span>
<span id="cb275-51"><a href="#cb275-51" aria-hidden="true" tabindex="-1"></a>           ,encoding<span class="op">=</span><span class="st">&#39;utf-8-sig&#39;</span>,index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb275-52"><a href="#cb275-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-53"><a href="#cb275-53" aria-hidden="true" tabindex="-1"></a><span class="co"># ヒストグラム</span></span>
<span id="cb275-54"><a href="#cb275-54" aria-hidden="true" tabindex="-1"></a><span class="co">## dist[&#39;Value&#39;]は文字列でないので,</span></span>
<span id="cb275-55"><a href="#cb275-55" aria-hidden="true" tabindex="-1"></a><span class="co">## .astype(str) で文字列に変換しています.</span></span>
<span id="cb275-56"><a href="#cb275-56" aria-hidden="true" tabindex="-1"></a>plt.bar(x<span class="op">=</span>dist[<span class="st">&#39;Value&#39;</span>].astype(<span class="bu">str</span>)</span>
<span id="cb275-57"><a href="#cb275-57" aria-hidden="true" tabindex="-1"></a>       ,height<span class="op">=</span>dist[<span class="st">&quot;Freq&quot;</span>],width<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb275-58"><a href="#cb275-58" aria-hidden="true" tabindex="-1"></a>plt.xticks(np.arange(<span class="bu">len</span>(dist)),<span class="bu">list</span>(dist.index),rotation<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb275-59"><a href="#cb275-59" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>以下のように単峰で左に歪んだヒストグラムが作成されます.</p>
<figure>
<img src="/images/histgram_quantitative.png" alt="量的データのヒストグラム" />
<figcaption aria-hidden="true">量的データのヒストグラム</figcaption>
</figure>
<p>一方で,量的データに関しては,度数分布表を作成せずとも<code>matplotlib</code>の<code>plt.hist()</code>を利用して直接作成することも可能です.</p>
<p><code>plt.hist()</code>では<code>bins=</code>に階級数を指定することで,その階級数で自然に分割したヒストグラムを作成してくれます.</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ヒストグラムの作成</span></span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a>label  <span class="op">=</span> df.columns[<span class="dv">0</span>]</span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> df[label]</span>
<span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a>plt.hist(values, bins<span class="op">=</span>stnum)</span>
<span id="cb276-5"><a href="#cb276-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="/images/histgram_quantitative2.png" alt="量的データのヒストグラム" />
<figcaption aria-hidden="true">量的データのヒストグラム</figcaption>
</figure>
<p>階級幅の設定によって,見た目が変わることが分かります. 作成手法や階級の設定は目的に応じて,使い分けるようにしましょう.</p>
<div class="note">
<ul>
<li>演習</li>
</ul>
<p><a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/qualitative_histogram_practice.csv">データ1</a>,<a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/quantitative_histogram_practice.csv">データ2</a>の度数分布表とヒストグラムを作成し,pptなどでグラフとその解釈をまとめてください.</p>
</div>
<h2 data-number="9.6" id="箱ひげ図"><span class="header-section-number">9.6</span> 箱ひげ図</h2>
<p>データの観測対象が複数のグループに層別可能な場合には, それぞれのヒストグラムを作成して比較することなどが必要です. グループの数が多い場合には, 何個もヒストグラムを作成することになりますし,比較には剥いていない場合があります.
そのような複数のグループの分布を比較する際に良く用いられるグラフが,箱ひげ図です.</p>
<p><a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/boxplot_data_300.csv">こちら</a>のデータは, 複数の種類の馬鈴薯のサイズがまとまっています.</p>
<p>試しに,ヒストグラム馬鈴薯の種類毎のヒストグラムを作成してみます.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;data/boxplot_data_300.csv&#39;</span>)</span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a><span class="co">#馬鈴薯の種類を抜き出す</span></span>
<span id="cb277-4"><a href="#cb277-4" aria-hidden="true" tabindex="-1"></a>types <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(df[<span class="st">&#39;Type&#39;</span>]))</span>
<span id="cb277-5"><a href="#cb277-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(types)</span>
<span id="cb277-6"><a href="#cb277-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-7"><a href="#cb277-7" aria-hidden="true" tabindex="-1"></a><span class="co">#馬鈴薯の種類別にヒストグラムを作成してみる</span></span>
<span id="cb277-8"><a href="#cb277-8" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(ncols<span class="op">=</span><span class="dv">2</span></span>
<span id="cb277-9"><a href="#cb277-9" aria-hidden="true" tabindex="-1"></a>                      ,nrows<span class="op">=</span><span class="bu">int</span>(<span class="bu">len</span>(types) <span class="op">/</span> <span class="dv">2</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb277-10"><a href="#cb277-10" aria-hidden="true" tabindex="-1"></a>                      ,sharex <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb277-11"><a href="#cb277-11" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> ax.flatten()</span>
<span id="cb277-12"><a href="#cb277-12" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">&#39;Potato Weight&#39;</span>)</span>
<span id="cb277-13"><a href="#cb277-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-14"><a href="#cb277-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(types)):</span>
<span id="cb277-15"><a href="#cb277-15" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> types[i]</span>
<span id="cb277-16"><a href="#cb277-16" aria-hidden="true" tabindex="-1"></a>    df_temp <span class="op">=</span> df[df[<span class="st">&#39;Type&#39;</span>] <span class="op">==</span> t]</span>
<span id="cb277-17"><a href="#cb277-17" aria-hidden="true" tabindex="-1"></a>    axes[i].hist(df_temp[<span class="st">&#39;Weight&#39;</span>])</span>
<span id="cb277-18"><a href="#cb277-18" aria-hidden="true" tabindex="-1"></a>    axes[i].set_title(t)</span>
<span id="cb277-19"><a href="#cb277-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-20"><a href="#cb277-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="/images/box_plot1.png" alt="馬鈴薯の重さのヒストグラム" />
<figcaption aria-hidden="true">馬鈴薯の重さのヒストグラム</figcaption>
</figure>
<p>これでも比較はできますが1枚の画像にまとめる手段として,箱ひげ図が利用できます.
箱ひげ図は<code>plt.boxplot(データのリスト,labels=ラベルのリスト)</code>で生成できます.</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> [df[df[<span class="st">&#39;Type&#39;</span>]<span class="op">==</span>x][<span class="st">&#39;Weight&#39;</span>] <span class="cf">for</span> x <span class="kw">in</span> types]</span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a><span class="co">#内包表記を利用しない場合は</span></span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a><span class="co">data = []</span></span>
<span id="cb278-5"><a href="#cb278-5" aria-hidden="true" tabindex="-1"></a><span class="co">for x in types:</span></span>
<span id="cb278-6"><a href="#cb278-6" aria-hidden="true" tabindex="-1"></a><span class="co">    data.append(df[df[&#39;Type&#39;]==x][&#39;Weight&#39;])</span></span>
<span id="cb278-7"><a href="#cb278-7" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb278-8"><a href="#cb278-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data)</span>
<span id="cb278-9"><a href="#cb278-9" aria-hidden="true" tabindex="-1"></a>plt.boxplot(data,labels<span class="op">=</span>types)</span>
<span id="cb278-10"><a href="#cb278-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="/images/box_plot2.png" alt="馬鈴薯の重さのヒストグラム" />
<figcaption aria-hidden="true">馬鈴薯の重さのヒストグラム</figcaption>
</figure>
<p>箱ひげ図は,線がそれぞれ四分位数を表しており,それぞれ上から<strong>最大値</strong>,<strong>75%点</strong>,<strong>中央値</strong>,<strong>25%点</strong>,<strong>最小値</strong>となります.また,外れ値は丸で表されます.</p>
<p>ヒストグラムと比較して情報量は減りますが, 一覧性と比較においては優れています.それぞれ一長一短なので,用途に応じて使い分けるようにしましょう.</p>
<h2 data-number="9.7" id="発展密度プロット"><span class="header-section-number">9.7</span> 発展:密度プロット</h2>
<p>データの分布を表現する手法としてヒストグラムは非常に便利ですが,階級数や階級幅を自分で定める必要があり,その設定によって見た目が変わってしまいます. また, データ数が少ないときには正確なデータの分布をつかめないという問題点もあります.</p>
<p>そこで, データを階級で区分せずに,度数ではなく確率分布を直接推定する手法に<strong>カーネル密度推定(Karnel Density Estimation)</strong>があります.</p>
<h2 data-number="9.8" id="発展sinaplot"><span class="header-section-number">9.8</span> 発展:sinaplot</h2>
<h2 data-number="9.9" id="発展バイオリンプロット"><span class="header-section-number">9.9</span> 発展:バイオリンプロット</h2>
<h2 data-number="9.10" id="散布図"><span class="header-section-number">9.10</span> 散布図</h2>
<p>これまではデータの各観測項目を独立に可視化してきました. 複数の観測項目の関係性を可視化する代表的な手法に散布図があります.</p>
<p><a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/scatter.csv">こちら</a>のデータはGoogle Trendにおける同時期の<code>AI</code>というワードのの検索量と,<code>Python</code>というワードの検索量を表しています.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a>     <span class="ex">AI</span>  Python</span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    34      27</span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>    40      26</span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>    59      28</span>
<span id="cb279-5"><a href="#cb279-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    46      29</span>
<span id="cb279-6"><a href="#cb279-6" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>    36      29</span>
<span id="cb279-7"><a href="#cb279-7" aria-hidden="true" tabindex="-1"></a><span class="ex">..</span>   ..     ...</span>
<span id="cb279-8"><a href="#cb279-8" aria-hidden="true" tabindex="-1"></a><span class="ex">255</span>  58      83</span>
<span id="cb279-9"><a href="#cb279-9" aria-hidden="true" tabindex="-1"></a><span class="ex">256</span>  69      87</span>
<span id="cb279-10"><a href="#cb279-10" aria-hidden="true" tabindex="-1"></a><span class="ex">257</span>  59      82</span>
<span id="cb279-11"><a href="#cb279-11" aria-hidden="true" tabindex="-1"></a><span class="ex">258</span>  62      84</span>
<span id="cb279-12"><a href="#cb279-12" aria-hidden="true" tabindex="-1"></a><span class="ex">259</span>  59      87</span></code></pre></div>
<p>この2つの検索量がどのような関係にあるのかを散布図を用いて確認してみましょう.
散布図は<code>plt.scatter(x軸の値のリスト,y軸の値のリスト)</code>の形で作成できます.</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;data/scatter.csv&#39;</span>)</span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a><span class="co">#散布図のx軸を指定</span></span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a>x_column <span class="op">=</span> <span class="st">&#39;AI&#39;</span></span>
<span id="cb280-4"><a href="#cb280-4" aria-hidden="true" tabindex="-1"></a><span class="co">#散布図のy軸を指定</span></span>
<span id="cb280-5"><a href="#cb280-5" aria-hidden="true" tabindex="-1"></a>y_column <span class="op">=</span> <span class="st">&#39;Python&#39;</span></span>
<span id="cb280-6"><a href="#cb280-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-7"><a href="#cb280-7" aria-hidden="true" tabindex="-1"></a>x_value <span class="op">=</span> df[x_column]</span>
<span id="cb280-8"><a href="#cb280-8" aria-hidden="true" tabindex="-1"></a>y_value <span class="op">=</span> df[y_column]</span>
<span id="cb280-9"><a href="#cb280-9" aria-hidden="true" tabindex="-1"></a>plt.scatter(x_value, y_value)</span>
<span id="cb280-10"><a href="#cb280-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(y_column)</span>
<span id="cb280-11"><a href="#cb280-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(x_column)</span>
<span id="cb280-12"><a href="#cb280-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="/images/scatter.png" alt="散布図" />
<figcaption aria-hidden="true">散布図</figcaption>
</figure>
<p>散布図を見ると,<code>AI</code>に関する検索量が増えるにつれて,<code>Python</code>の検索量が増えるという関係が見えてきます.</p>
<p>この関係の度合いを数値化する<strong>相関係数</strong>や,関係の仕方を説明する<strong>回帰分析</strong>に関しては後ほど扱います.</p>
<h3 data-number="9.10.1" id="観測項目が複数ある場合の散布図"><span class="header-section-number">9.10.1</span> 観測項目が複数ある場合の散布図</h3>
<p>データが3つある場合には,以下のように3Dで表現することも可能ですがこの講義では,3次元のグラフに関しては深く扱いません.興味のある方は調べてみましょう.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.random.rand(<span class="dv">100</span>)</span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.random.rand(<span class="dv">100</span>)</span>
<span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> np.random.rand(<span class="dv">100</span>)</span>
<span id="cb281-4"><a href="#cb281-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-5"><a href="#cb281-5" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure()</span>
<span id="cb281-6"><a href="#cb281-6" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fig.add_subplot(projection<span class="op">=</span><span class="st">&#39;3d&#39;</span>)</span>
<span id="cb281-7"><a href="#cb281-7" aria-hidden="true" tabindex="-1"></a>ax.scatter(x, y, z, color<span class="op">=</span><span class="st">&#39;blue&#39;</span>)</span>
<span id="cb281-8"><a href="#cb281-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb281-9"><a href="#cb281-9" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code></pre></div>
<figure>
<img src="/images/3dscatter.png" alt="3次元の散布図" />
<figcaption aria-hidden="true">3次元の散布図</figcaption>
</figure>
<p>観測項目が4つ以上ある場合に散布図のように関係を表す手法としては,複数の観測項目の値を合成して3次元以下にする<strong>次元削減</strong>が良く利用されます. <strong>次元削減</strong>に関しては後ほど扱うとして,ここではいくつかの観測項目を<strong>色</strong>や<strong>大きさ</strong>などの要素の変換して関係を見る方法を紹介します.</p>
<p><code>plt.scatter()</code>では<code>s=</code>に数値を与えることでサイズ,<code>c=</code>に数値を与えることで色を指定できます.
また,色と数値の関係は<code>plt.colorbar()</code>で表示可能です.</p>
<p>複数の点が重なると見にくくなるために <code>alpha=</code>に<code>0-1</code>の間の数値を指定して透明度を指定することができます.</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.random.rand(<span class="dv">100</span>)</span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.random.rand(<span class="dv">100</span>)</span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> np.random.rand(<span class="dv">100</span>)</span>
<span id="cb282-4"><a href="#cb282-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-5"><a href="#cb282-5" aria-hidden="true" tabindex="-1"></a><span class="co">#色とサイズをzで指定する</span></span>
<span id="cb282-6"><a href="#cb282-6" aria-hidden="true" tabindex="-1"></a><span class="co">#そのままだとサイズが小さすぎるので,100倍している</span></span>
<span id="cb282-7"><a href="#cb282-7" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,y,alpha<span class="op">=</span><span class="fl">0.5</span>,s<span class="op">=</span>z<span class="op">*</span><span class="dv">100</span>,c<span class="op">=</span>z)</span>
<span id="cb282-8"><a href="#cb282-8" aria-hidden="true" tabindex="-1"></a>plt.colorbar() <span class="co">#カラーバーの表示</span></span>
<span id="cb282-9"><a href="#cb282-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="/images/scatter_color_size.png" alt="色とサイズによる表現" />
<figcaption aria-hidden="true">色とサイズによる表現</figcaption>
</figure>
<h3 data-number="9.10.2" id="クラスタリングにおける散布図"><span class="header-section-number">9.10.2</span> クラスタリングにおける散布図</h3>
<p>散布図は複数の観測項目間の関係性を可視化するための手法ですが,データから特定の観測対象の集まり(<strong>クラスター</strong>)を発見する<strong>クラスタリング</strong>とも深い関わりがあります.
クラスタリングの手法は後ほど扱いますが,ここでは可視化手法としての散布図とクラスタ表現の関係に関して確認してみましょう.</p>
<p><a href="https://github.com/yakagika/yakagika.github.io/blob/main/slds_data/scatter_class.csv">こちら</a>のデータはクラスタリングによって得られたクラスタ毎のラベルがなされています.</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a>           <span class="ex">x</span>          y  Cluster</span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>  <span class="at">-8.149818</span>  <span class="at">-9.152380</span>        2</span>
<span id="cb283-3"><a href="#cb283-3" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>   5.860155   0.126873        1</span>
<span id="cb283-4"><a href="#cb283-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>  <span class="at">-3.213409</span>   9.828126        0</span>
<span id="cb283-5"><a href="#cb283-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>   6.744070  <span class="at">-0.129607</span>        1</span>
<span id="cb283-6"><a href="#cb283-6" aria-hidden="true" tabindex="-1"></a><span class="ex">4</span>  <span class="at">-6.342946</span>  <span class="at">-6.038933</span>        2</span>
<span id="cb283-7"><a href="#cb283-7" aria-hidden="true" tabindex="-1"></a><span class="ex">..</span>       ...        ...      ...</span>
<span id="cb283-8"><a href="#cb283-8" aria-hidden="true" tabindex="-1"></a><span class="ex">95</span> <span class="at">-3.524581</span>   9.931801        0</span>
<span id="cb283-9"><a href="#cb283-9" aria-hidden="true" tabindex="-1"></a><span class="ex">96</span> <span class="at">-0.962698</span>  10.411206        0</span>
<span id="cb283-10"><a href="#cb283-10" aria-hidden="true" tabindex="-1"></a><span class="ex">97</span>  4.397950   2.579246        1</span>
<span id="cb283-11"><a href="#cb283-11" aria-hidden="true" tabindex="-1"></a><span class="ex">98</span> <span class="at">-5.255050</span>  <span class="at">-5.299407</span>        2</span>
<span id="cb283-12"><a href="#cb283-12" aria-hidden="true" tabindex="-1"></a><span class="ex">99</span> <span class="at">-3.768024</span>   8.550468        0</span></code></pre></div>
<p>クラスタを表現は<code>.scatter(color=)</code>で色を指定することが一般的です.</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="co">#散布図をクラスタごとに色を変えて表示</span></span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb284-3"><a href="#cb284-3" aria-hidden="true" tabindex="-1"></a>    df_temp<span class="op">=</span> df[df[<span class="st">&#39;Cluster&#39;</span>] <span class="op">==</span> i]</span>
<span id="cb284-4"><a href="#cb284-4" aria-hidden="true" tabindex="-1"></a>    plt.scatter(df_temp[<span class="st">&#39;x&#39;</span>]</span>
<span id="cb284-5"><a href="#cb284-5" aria-hidden="true" tabindex="-1"></a>               ,df_temp[<span class="st">&#39;y&#39;</span>]</span>
<span id="cb284-6"><a href="#cb284-6" aria-hidden="true" tabindex="-1"></a>               ,c<span class="op">=</span>color_list[i]</span>
<span id="cb284-7"><a href="#cb284-7" aria-hidden="true" tabindex="-1"></a>               ,label<span class="op">=</span><span class="st">&#39;Cluster:&#39;</span> <span class="op">+</span> <span class="bu">str</span>(i))</span>
<span id="cb284-8"><a href="#cb284-8" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb284-9"><a href="#cb284-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="/images/scatter_class.png" alt="クラスタリング" />
<figcaption aria-hidden="true">クラスタリング</figcaption>
</figure>
<h2 data-number="9.11" id="同時度数分布表"><span class="header-section-number">9.11</span> 同時度数分布表</h2>
<h2 data-number="9.12" id="ヒートマップ"><span class="header-section-number">9.12</span> ヒートマップ</h2>
</details>
<h1 data-number="10" id="データの数値化-執筆中"><span class="header-section-number">10</span> データの数値化 (執筆中)</h1>
<details>
<summary>
開く/閉じる
</summary>
<p>中央値,平均値,分散などをメソッドで求める.
定義を理解するために関数で定義する.</p>
<p>平均値には,用途に応じて,算術平均,幾何平均,調和平均などがあります.
𝑛個の観測値 𝑥_1, 𝑥_2, …, 𝑥_𝑛があるとき
算術平均: 𝑥 ̅ =1/𝑛 (𝑥_1+ …+𝑥_𝑛 )</p>
<p>幾何平均: 𝑥_G=√(𝑛&amp;𝑥_1∙𝑥_2∙ …∙𝑥_𝑛 )</p>
<p>調和平均 :𝑥_H=𝑛/(1/𝑥_1 +…+1/𝑥_𝑛 )</p>
<p>それぞれの平均値の用途を調べてください.
3個程度の変数を作成し,それぞれの算術平均,幾何平均,調和平均を計算してください,</p>
<h2 data-number="10.1" id="相関係数"><span class="header-section-number">10.1</span> 相関係数</h2>
<p>相関,順位相関,偏相関</p>
<p>相関係数のヒートマップ</p>
<h2 data-number="10.2" id="距離と類似度"><span class="header-section-number">10.2</span> 距離と類似度</h2>
<p>ユークリッド距離,コサイン距離</p>
</details>
<h1 data-number="11" id="検定"><span class="header-section-number">11</span> 検定</h1>
<h1 data-number="12" id="回帰分析"><span class="header-section-number">12</span> 回帰分析</h1>
<h1 data-number="13" id="教師ありなし学習-執筆中"><span class="header-section-number">13</span> 教師あり/なし学習 (執筆中)</h1>
<details>
<summary>
開く/閉じる
</summary>
<p>それぞれ様々な手法があり,使い分ける必要があります</p>
<p>教師あり学習
* 回帰
* 重回帰ロジスティック回帰
* 決定木分析
* k-近傍法
* サポートベクターマシン
* ニューラルネットワーク
* パーセプトロン,畳込み,再起,etc</p>
<p>教師なし学習
* クラスタリング
* 階層(ウォード法
* 非階層(k-means法
* 主成分分析
* 確率密度推定</p>
<p><br></p>
<p>P3の図</p>
<h3 data-number="13.0.1" id="主成分分析principle-component-analysis"><span class="header-section-number">13.0.1</span> 主成分分析(Principle component analysis)</h3>
<ul>
<li>多数のデータが有る際に, それら全てを使うことは大変です.
<ul>
<li>多次元になると可視化が困難</li>
<li>データの説明が困難</li>
<li>モデル化が困難</li>
<li>計算が困難</li>
</ul></li>
<li>主成分分析
<ul>
<li>多数の変数の持つ情報を損なわずに圧縮する技術(次数削減)であり,予測モデル構築の前処理としてもよく使われる.</li>
<li>主成分の分散が最大になる軸を探し,その軸に直行する軸の中で分散が最大になる軸を探していく.</li>
</ul></li>
</ul>
<p><br></p>
<p>P4の図</p>
<p>非線形SVMで天気を当ててるときに選ぶべき説明変数は?
* 先週は電力データで休日かどうかを当てることを考えたが,今度は天気を当ててみよう.
* Lightning,Lamp,Power,Airがある中でどのように説明変数を選ぶきだろうか.
* 休日と同じ変数だと,正解率はあまり良くない.
* 変数を2つ選ぶとして,今回は 4C2 = 4*3/2 = 6通りだが, 変数が増えればその組み合わせは莫⼤になる.</p>
<p><br></p>
<p>主成分を使って天気を当てよう.
電力データの次元削減をして, その主成分で天気を当てる非線形SVMを実行してみよう.
第1成分と第2成分で,情報の85%以上を説明できることが分かる.この2成分を利用して,SVMを実行してみる.</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -*- coding: utf-8 -*-</span></span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb285-3"><a href="#cb285-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb285-4"><a href="#cb285-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb285-5"><a href="#cb285-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb285-6"><a href="#cb285-6" aria-hidden="true" tabindex="-1"></a><span class="co"># svmのパッケージ</span></span>
<span id="cb285-7"><a href="#cb285-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> svm</span>
<span id="cb285-8"><a href="#cb285-8" aria-hidden="true" tabindex="-1"></a><span class="co">#主成分分析</span></span>
<span id="cb285-9"><a href="#cb285-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb285-10"><a href="#cb285-10" aria-hidden="true" tabindex="-1"></a><span class="co">#4つある電力データを主成分分析で次元削減してみる</span></span>
<span id="cb285-11"><a href="#cb285-11" aria-hidden="true" tabindex="-1"></a><span class="co"># データを読み込み</span></span>
<span id="cb285-12"><a href="#cb285-12" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&quot;./data/energy_data.csv&quot;</span>)</span>
<span id="cb285-13"><a href="#cb285-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 主成分分析のターゲットとなる電力データを抽出</span></span>
<span id="cb285-14"><a href="#cb285-14" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> df[[<span class="st">&#39;Lighting&#39;</span>, <span class="st">&#39;Lamp&#39;</span>, <span class="st">&#39;Power&#39;</span>, <span class="st">&#39;Air&#39;</span>]]</span>
<span id="cb285-15"><a href="#cb285-15" aria-hidden="true" tabindex="-1"></a><span class="co">#データを標準化します</span></span>
<span id="cb285-16"><a href="#cb285-16" aria-hidden="true" tabindex="-1"></a><span class="co"># apply メソッドは,DataFlame全体に与えた関数を適用</span></span>
<span id="cb285-17"><a href="#cb285-17" aria-hidden="true" tabindex="-1"></a><span class="co"># axis = 1 行に対して</span></span>
<span id="cb285-18"><a href="#cb285-18" aria-hidden="true" tabindex="-1"></a><span class="co"># axis = 0 列に対して</span></span>
<span id="cb285-19"><a href="#cb285-19" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> target.<span class="bu">apply</span>(<span class="kw">lambda</span> x: (x<span class="op">-</span>x.mean())<span class="op">/</span>x.std(), axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb285-20"><a href="#cb285-20" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb285-21"><a href="#cb285-21" aria-hidden="true" tabindex="-1"></a><span class="co">ラムダ式を使わなければ</span></span>
<span id="cb285-22"><a href="#cb285-22" aria-hidden="true" tabindex="-1"></a><span class="co">def standardization(x):</span></span>
<span id="cb285-23"><a href="#cb285-23" aria-hidden="true" tabindex="-1"></a><span class="co">return (x-x.mean())/x.std()</span></span>
<span id="cb285-24"><a href="#cb285-24" aria-hidden="true" tabindex="-1"></a><span class="co">target = target.apply(standardization(), axis=1)</span></span>
<span id="cb285-25"><a href="#cb285-25" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb285-26"><a href="#cb285-26" aria-hidden="true" tabindex="-1"></a><span class="co">#主成分分析の実行</span></span>
<span id="cb285-27"><a href="#cb285-27" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA()</span>
<span id="cb285-28"><a href="#cb285-28" aria-hidden="true" tabindex="-1"></a>pca.fit(target)</span>
<span id="cb285-29"><a href="#cb285-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 寄与率</span></span>
<span id="cb285-30"><a href="#cb285-30" aria-hidden="true" tabindex="-1"></a><span class="co"># その主成分で情報量のどの程度を説明できているか</span></span>
<span id="cb285-31"><a href="#cb285-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;第1主成分の寄与率&#39;</span>, pca.explained_variance_ratio_[<span class="dv">0</span>])</span>
<span id="cb285-32"><a href="#cb285-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;第2主成分の寄与率&#39;</span>, pca.explained_variance_ratio_[<span class="dv">1</span>])</span>
<span id="cb285-33"><a href="#cb285-33" aria-hidden="true" tabindex="-1"></a><span class="co">#主成分ベクトル</span></span>
<span id="cb285-34"><a href="#cb285-34" aria-hidden="true" tabindex="-1"></a>feature <span class="op">=</span> pca.transform(target)</span>
<span id="cb285-35"><a href="#cb285-35" aria-hidden="true" tabindex="-1"></a><span class="co"># データを主成分空間に写像</span></span>
<span id="cb285-36"><a href="#cb285-36" aria-hidden="true" tabindex="-1"></a><span class="co"># n列目が第n主成分空間への写像</span></span>
<span id="cb285-37"><a href="#cb285-37" aria-hidden="true" tabindex="-1"></a>feature <span class="op">=</span> pca.transform(target)</span>
<span id="cb285-38"><a href="#cb285-38" aria-hidden="true" tabindex="-1"></a>plt.scatter(feature[:, <span class="dv">0</span>], feature[:, <span class="dv">1</span>], alpha<span class="op">=</span><span class="fl">0.8</span>, c<span class="op">=</span><span class="bu">list</span>(df[<span class="st">&#39;weather&#39;</span>]))</span>
<span id="cb285-39"><a href="#cb285-39" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb285-40"><a href="#cb285-40" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;PC1&#39;</span>)</span>
<span id="cb285-41"><a href="#cb285-41" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;PC2&#39;</span>)</span>
<span id="cb285-42"><a href="#cb285-42" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<pre><code>第1主成分の寄与率 0.5903597077929026
第2主成分の寄与率 0.27288683569579475</code></pre>
<p><img src="19_weather.png" /></p>
<p><br></p>
<p>P6の図</p>
<p>説明変数に第1主成分と第2主成分を利用して,非線形SVMを実行(図示のプログラムはほぼ同じなので省略) .
TestDataは,それほど良くないが, TrainDataに関しては,かなり良く予測できている.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------</span></span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ここからSVMに適用</span></span>
<span id="cb287-3"><a href="#cb287-3" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------------------------------------------</span></span>
<span id="cb287-4"><a href="#cb287-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 主成分をDFに追加</span></span>
<span id="cb287-5"><a href="#cb287-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;PC1&#39;</span>] <span class="op">=</span> feature[:,<span class="dv">0</span>]</span>
<span id="cb287-6"><a href="#cb287-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;PC2&#39;</span>] <span class="op">=</span> feature[:,<span class="dv">1</span>]</span>
<span id="cb287-7"><a href="#cb287-7" aria-hidden="true" tabindex="-1"></a><span class="co">#説明変数を主成分とする</span></span>
<span id="cb287-8"><a href="#cb287-8" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df[[<span class="st">&#39;PC1&#39;</span>,<span class="st">&#39;PC2&#39;</span>]]</span>
<span id="cb287-9"><a href="#cb287-9" aria-hidden="true" tabindex="-1"></a><span class="co">#被説明変数</span></span>
<span id="cb287-10"><a href="#cb287-10" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">&#39;weather&#39;</span>]</span>
<span id="cb287-11"><a href="#cb287-11" aria-hidden="true" tabindex="-1"></a><span class="co">#トレーニングデータの作成</span></span>
<span id="cb287-12"><a href="#cb287-12" aria-hidden="true" tabindex="-1"></a>(train_X, test_X ,train_y, test_y) <span class="op">=</span> train_test_split( X</span>
<span id="cb287-13"><a href="#cb287-13" aria-hidden="true" tabindex="-1"></a>, y</span>
<span id="cb287-14"><a href="#cb287-14" aria-hidden="true" tabindex="-1"></a>, stratify<span class="op">=</span> y</span>
<span id="cb287-15"><a href="#cb287-15" aria-hidden="true" tabindex="-1"></a>, random_state <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb287-16"><a href="#cb287-16" aria-hidden="true" tabindex="-1"></a><span class="co"># SVMオブジェクトを定義</span></span>
<span id="cb287-17"><a href="#cb287-17" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> svm.SVC(kernel<span class="op">=</span><span class="st">&#39;rbf&#39;</span>)</span>
<span id="cb287-18"><a href="#cb287-18" aria-hidden="true" tabindex="-1"></a><span class="co">#学習</span></span>
<span id="cb287-19"><a href="#cb287-19" aria-hidden="true" tabindex="-1"></a>clf.fit(train_X, train_y)</span>
<span id="cb287-20"><a href="#cb287-20" aria-hidden="true" tabindex="-1"></a><span class="co">#結果の表示</span></span>
<span id="cb287-21"><a href="#cb287-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;正解率(train):&#39;</span>, clf.score(train_X,train_y))</span>
<span id="cb287-22"><a href="#cb287-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;正解率(test):&#39;</span>, clf.score(test_X,test_y))</span></code></pre></div>
<pre><code>第1主成分の寄与率 0.5903597077929026
第2主成分の寄与率 0.27288683569579475
正解率(train): 0.9130434782608695
正解率(test): 0.625</code></pre>
<p><br></p>
<p>P7の図</p>
<h3 data-number="13.0.2" id="k-means法"><span class="header-section-number">13.0.2</span> k-means法</h3>
<p>最も広く使われているクラスタリング手法(データを類似度の高いグループに分ける手法). データをk個のグループに分割する場合は以下の手順で行われる.事前にクラスター数を指定する必要がある.
1. 入力データをプロットする
2. ランダムにk個の点をプロットする
3. 各ランダム点を,クラスター1,クラスター2,…,クラスターkの重心点とみなす.
4. 入力データの各点について,k個の重心点の中で最も近いものを選び,そのクラスターに分類する.
5. クラスター毎に重心を計算する.
6. 5.で定めたk個の重心を新しいクラスターの重心とする.
7. 4-6を設定した上限回数か,重心の移動距離が十分に小さくなるまで繰り返す.</p>
<p><br></p>
<p>P8の図</p>
<p>これまでのデータはクラスタリングにあまり適していないので新しく配られたデータenergy.csv をクラスタリングしてみる.
* energy.csvは, 5~6⽉の1号館,研究館,体育館のデータを結合したもの.
* 建物を適切にクラスタリングできるかやってみよう.</p>
<p><br></p>
<p>k-means法で電力データの建物をクラスタリング
本来の教師なし学習では,事前にクラスターが分からないが,ここでは練習用として,実際のクラスタと,k-means法による結果を比較してみる.</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -*- coding:utf-8 -*-</span></span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans</span>
<span id="cb289-5"><a href="#cb289-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1号館, 研究館, 体育館のデータをk-means法でクラスタリングしてみる</span></span>
<span id="cb289-6"><a href="#cb289-6" aria-hidden="true" tabindex="-1"></a><span class="co">#データの読み込み</span></span>
<span id="cb289-7"><a href="#cb289-7" aria-hidden="true" tabindex="-1"></a><span class="co">#単位が同じなので,標準化は必要ない</span></span>
<span id="cb289-8"><a href="#cb289-8" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;./data/energy.csv&#39;</span>)</span>
<span id="cb289-9"><a href="#cb289-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb289-10"><a href="#cb289-10" aria-hidden="true" tabindex="-1"></a><span class="co"># まずは図示してみる</span></span>
<span id="cb289-11"><a href="#cb289-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 通常は事前にクラスターが分からないことに注意</span></span>
<span id="cb289-12"><a href="#cb289-12" aria-hidden="true" tabindex="-1"></a>plt.scatter(df[<span class="st">&#39;Lighting&#39;</span>], df[<span class="st">&#39;Lamp&#39;</span>], alpha<span class="op">=</span><span class="fl">0.8</span>, c<span class="op">=</span><span class="bu">list</span>(df[<span class="st">&#39;Building&#39;</span>]))</span>
<span id="cb289-13"><a href="#cb289-13" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb289-14"><a href="#cb289-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;raw data&#39;</span>)</span>
<span id="cb289-15"><a href="#cb289-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Lighting&#39;</span>)</span>
<span id="cb289-16"><a href="#cb289-16" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Lamp&#39;</span>)</span>
<span id="cb289-17"><a href="#cb289-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb289-18"><a href="#cb289-18" aria-hidden="true" tabindex="-1"></a><span class="co">#k-means法で分類</span></span>
<span id="cb289-19"><a href="#cb289-19" aria-hidden="true" tabindex="-1"></a><span class="co"># init = &#39;random&#39; とすると kmeans法になる</span></span>
<span id="cb289-20"><a href="#cb289-20" aria-hidden="true" tabindex="-1"></a><span class="co"># init を指定しないとk-means++という手法になる</span></span>
<span id="cb289-21"><a href="#cb289-21" aria-hidden="true" tabindex="-1"></a><span class="co"># k-means++ は 初期の重心を広範に取る手法でk-meansより安定した結果が得られる</span></span>
<span id="cb289-22"><a href="#cb289-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 分割するクラスタ数は3に設定</span></span>
<span id="cb289-23"><a href="#cb289-23" aria-hidden="true" tabindex="-1"></a>kmeans <span class="op">=</span> KMeans(init<span class="op">=</span><span class="st">&#39;random&#39;</span>, n_clusters<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb289-24"><a href="#cb289-24" aria-hidden="true" tabindex="-1"></a><span class="co">#重心を計算</span></span>
<span id="cb289-25"><a href="#cb289-25" aria-hidden="true" tabindex="-1"></a>kmeans.fit(df[[<span class="st">&#39;Lighting&#39;</span>,<span class="st">&#39;Lamp&#39;</span>]])</span>
<span id="cb289-26"><a href="#cb289-26" aria-hidden="true" tabindex="-1"></a>prediction <span class="op">=</span> kmeans.predict(df[[<span class="st">&#39;Lighting&#39;</span>,<span class="st">&#39;Lamp&#39;</span>]])</span>
<span id="cb289-27"><a href="#cb289-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(prediction)</span>
<span id="cb289-28"><a href="#cb289-28" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果を図示</span></span>
<span id="cb289-29"><a href="#cb289-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 通常は事前にクラスターが分からないことに注意</span></span>
<span id="cb289-30"><a href="#cb289-30" aria-hidden="true" tabindex="-1"></a>plt.scatter(df[<span class="st">&#39;Lighting&#39;</span>], df[<span class="st">&#39;Lamp&#39;</span>], alpha<span class="op">=</span><span class="fl">0.8</span>, c<span class="op">=</span>prediction)</span>
<span id="cb289-31"><a href="#cb289-31" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb289-32"><a href="#cb289-32" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;prediction&#39;</span>)</span>
<span id="cb289-33"><a href="#cb289-33" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Lighting&#39;</span>)</span>
<span id="cb289-34"><a href="#cb289-34" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Lamp&#39;</span>)</span>
<span id="cb289-35"><a href="#cb289-35" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>P9の結果載せる</p>
<p><br></p>
<p>P10の図</p>
<h3 data-number="13.0.3" id="階層クラスタリング"><span class="header-section-number">13.0.3</span> 階層クラスタリング</h3>
<p>似たデータ点を集めて一つの点とみなすことを全体が一つの点になるまで繰り返すクラスタリング手法を階層クラスタリングといいます(k-means法は非階層クラスタリング).
｢似ている｣ことを表す概念に様々な距離を用います.
* ユークリッド距離
* マハラノビス距離
* コサイン類似度,etc…</p>
<p>階層クラスタリングは,全てのデータ点ごとの距離を計算するのであまり大きなデータには使えません(時間がかかる)
一方で,デンドログラムという結合順序を表す図を得ることで,直感的な理解が可能になります.</p>
<p><br></p>
<p>ユークリッド距離
* ユークリッド距離
一般的によく用いられる距離.ピタゴラスの定理で求められる.</p>
<p>数式</p>
<ul>
<li>標準化ユークリッド距離
ユークリッド距離を標準化したもの. 各要素の重みをなくしたユークリッド距離.</li>
</ul>
<p>数式</p>
<p><br></p>
<p>コサイン類似度
* n次元ベクトルの向きの類似性をcosθで表す.</p>
<p>数式</p>
<p>θ=0° → cosθ=1 ∶同じ向き
θ=90° → cosθ=0 ∶直行
θ=180° → cosθ=−1:逆向き</p>
<p><br></p>
<p>P13の図</p>
<p>クラスター同士の距離
階層クラスタリングなどでは,複数の点からなるクラスター間の距離
をどのように定義するかによっても,結果が異なります.
* 最短距離法
2つのクラスターのデータ間距離の最小のものをクラスター間の
距離とする.
計算量が少ないが,クラスターが帯状になりやすい.
* 群平均法
各クラスター同士の全てのデータの組み合わせの距離を測りそ
の平均をクラスター間距離とする.
* ウォード法
①各クラスターを結合した場合の重心(平均)と各クラスターの データとのユークリッド距離
②もともとのクラスターの重心と各クラスターのデータとのユークリッド距離
① - ② の値を距離とする.
計算量は多いが,精度が良い.</p>
<p><br></p>
<p>階層クラスタリングで電力データの建物をクラスタリング
k-means法と同じ分類を階層クラスタリングで行ってみる.</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -*- coding:utf-8 -*-</span></span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb290-4"><a href="#cb290-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 階層クラスタリング</span></span>
<span id="cb290-5"><a href="#cb290-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.cluster.hierarchy <span class="im">import</span> dendrogram, linkage, fcluster</span>
<span id="cb290-6"><a href="#cb290-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 1号館, 研究館, 体育館のデータを階層的クラスタリングしてみる</span></span>
<span id="cb290-7"><a href="#cb290-7" aria-hidden="true" tabindex="-1"></a><span class="co">#データの読み込み</span></span>
<span id="cb290-8"><a href="#cb290-8" aria-hidden="true" tabindex="-1"></a><span class="co">#単位が同じなので,標準化は必要ない</span></span>
<span id="cb290-9"><a href="#cb290-9" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;./data/energy.csv&#39;</span>)</span>
<span id="cb290-10"><a href="#cb290-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb290-11"><a href="#cb290-11" aria-hidden="true" tabindex="-1"></a><span class="co"># データが多すぎるとデンドログラムを見ても良くわからないので,</span></span>
<span id="cb290-12"><a href="#cb290-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 各建物10個程度に減らす</span></span>
<span id="cb290-13"><a href="#cb290-13" aria-hidden="true" tabindex="-1"></a>build1 <span class="op">=</span> df[df[<span class="st">&#39;Building&#39;</span>] <span class="op">==</span> <span class="dv">0</span>].head(<span class="dv">10</span>)</span>
<span id="cb290-14"><a href="#cb290-14" aria-hidden="true" tabindex="-1"></a>research <span class="op">=</span> df[df[<span class="st">&#39;Building&#39;</span>] <span class="op">==</span> <span class="dv">1</span>].head(<span class="dv">10</span>)</span>
<span id="cb290-15"><a href="#cb290-15" aria-hidden="true" tabindex="-1"></a>gym <span class="op">=</span> df[df[<span class="st">&#39;Building&#39;</span>] <span class="op">==</span> <span class="dv">2</span>].head(<span class="dv">10</span>)</span>
<span id="cb290-16"><a href="#cb290-16" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.concat([build1,research,gym])</span>
<span id="cb290-17"><a href="#cb290-17" aria-hidden="true" tabindex="-1"></a>df.index <span class="op">=</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">30</span>)</span>
<span id="cb290-18"><a href="#cb290-18" aria-hidden="true" tabindex="-1"></a><span class="co"># まずは図示してみる</span></span>
<span id="cb290-19"><a href="#cb290-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 通常は事前にクラスターが分からないことに注意</span></span>
<span id="cb290-20"><a href="#cb290-20" aria-hidden="true" tabindex="-1"></a>plt.scatter(df[<span class="st">&#39;Lighting&#39;</span>], df[<span class="st">&#39;Lamp&#39;</span>], alpha<span class="op">=</span><span class="fl">0.8</span>, c<span class="op">=</span><span class="bu">list</span>(df[<span class="st">&#39;Building&#39;</span>]))</span>
<span id="cb290-21"><a href="#cb290-21" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb290-22"><a href="#cb290-22" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;raw data&#39;</span>)</span>
<span id="cb290-23"><a href="#cb290-23" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Lighting&#39;</span>)</span>
<span id="cb290-24"><a href="#cb290-24" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Lamp&#39;</span>)</span>
<span id="cb290-25"><a href="#cb290-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>P14の結果載せる</p>
<p><br></p>
<p>階層クラスタリングで電力
データの建物をクラスタリ
ング
デンドログラムで各点がどのように統合されているかを確認</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a><span class="co">クラスタリングの実行</span></span>
<span id="cb291-3"><a href="#cb291-3" aria-hidden="true" tabindex="-1"></a><span class="co">method で データの結合の方法を指示します</span></span>
<span id="cb291-4"><a href="#cb291-4" aria-hidden="true" tabindex="-1"></a><span class="co">･ average 重みのない平均距離</span></span>
<span id="cb291-5"><a href="#cb291-5" aria-hidden="true" tabindex="-1"></a><span class="co">･ centroid 重みのない重心までの距離</span></span>
<span id="cb291-6"><a href="#cb291-6" aria-hidden="true" tabindex="-1"></a><span class="co">･ complete 最大距離</span></span>
<span id="cb291-7"><a href="#cb291-7" aria-hidden="true" tabindex="-1"></a><span class="co">･ median 重みのある重心までの距離</span></span>
<span id="cb291-8"><a href="#cb291-8" aria-hidden="true" tabindex="-1"></a><span class="co">･ single 最小距離</span></span>
<span id="cb291-9"><a href="#cb291-9" aria-hidden="true" tabindex="-1"></a><span class="co">･ ward 内部平方距離</span></span>
<span id="cb291-10"><a href="#cb291-10" aria-hidden="true" tabindex="-1"></a><span class="co">･ weighted 重みのある平均距離</span></span>
<span id="cb291-11"><a href="#cb291-11" aria-hidden="true" tabindex="-1"></a><span class="co">metric で距離の測り方を選択します</span></span>
<span id="cb291-12"><a href="#cb291-12" aria-hidden="true" tabindex="-1"></a><span class="co">・euclidean ユークリッド距離</span></span>
<span id="cb291-13"><a href="#cb291-13" aria-hidden="true" tabindex="-1"></a><span class="co">・cosine コサイン類似度</span></span>
<span id="cb291-14"><a href="#cb291-14" aria-hidden="true" tabindex="-1"></a><span class="co">・correlation 相関係数</span></span>
<span id="cb291-15"><a href="#cb291-15" aria-hidden="true" tabindex="-1"></a><span class="co">・canberra キャンベラ距離</span></span>
<span id="cb291-16"><a href="#cb291-16" aria-hidden="true" tabindex="-1"></a><span class="co">・chebyshev チェビシェフ距離</span></span>
<span id="cb291-17"><a href="#cb291-17" aria-hidden="true" tabindex="-1"></a><span class="co">・cityblock 都市ブロック距離</span></span>
<span id="cb291-18"><a href="#cb291-18" aria-hidden="true" tabindex="-1"></a><span class="co">・hamming ハミング距離</span></span>
<span id="cb291-19"><a href="#cb291-19" aria-hidden="true" tabindex="-1"></a><span class="co">・jaccard Jaccard係数</span></span>
<span id="cb291-20"><a href="#cb291-20" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb291-21"><a href="#cb291-21" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> linkage(df[[<span class="st">&#39;Lighting&#39;</span>,<span class="st">&#39;Lamp’]]</span></span>
<span id="cb291-22"><a href="#cb291-22" aria-hidden="true" tabindex="-1"></a><span class="er"> , method = &#39;average’</span></span>
<span id="cb291-23"><a href="#cb291-23" aria-hidden="true" tabindex="-1"></a> , metric <span class="op">=</span> <span class="st">&#39;euclidean&#39;</span> )</span>
<span id="cb291-24"><a href="#cb291-24" aria-hidden="true" tabindex="-1"></a><span class="co"># デンドログラムの図示</span></span>
<span id="cb291-25"><a href="#cb291-25" aria-hidden="true" tabindex="-1"></a>dendrogram(res)</span>
<span id="cb291-26"><a href="#cb291-26" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Dedrogram&quot;</span>)</span>
<span id="cb291-27"><a href="#cb291-27" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Threshold&quot;</span>)</span>
<span id="cb291-28"><a href="#cb291-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>P15の結果載せる</p>
<p><br></p>
<p>階層クラスタリングで電力
データの建物をクラスタリ
ング
最後に結果を確認.データの数が違うので一概には言えないが,
k-meansでは上手くいっていなかった点も上手く分類できている.</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="co"># クラスターの数(t)を指定して,どのクラスターにそれぞれが属するかを得る</span></span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a>clusters <span class="op">=</span> fcluster(res, t<span class="op">=</span><span class="dv">3</span>, criterion<span class="op">=</span><span class="st">&#39;maxclust&#39;</span>)</span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(clusters)</span>
<span id="cb292-4"><a href="#cb292-4" aria-hidden="true" tabindex="-1"></a>plt.scatter(df[<span class="st">&#39;Lighting&#39;</span>], df[<span class="st">&#39;Lamp&#39;</span>], alpha<span class="op">=</span><span class="fl">0.8</span>, c<span class="op">=</span>clusters)</span>
<span id="cb292-5"><a href="#cb292-5" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb292-6"><a href="#cb292-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;prediction&#39;</span>)</span>
<span id="cb292-7"><a href="#cb292-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Lighting&#39;</span>)</span>
<span id="cb292-8"><a href="#cb292-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Lamp&#39;</span>)</span>
<span id="cb292-9"><a href="#cb292-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>P16の結果載せる</p>
<p><br></p>
<h2 data-number="13.1" id="自然言語処理nplnatural-language-processing"><span class="header-section-number">13.1</span> 自然言語処理(NPL,Natural Language Processing)</h2>
<p>自然言語処理の流れ
文章
<strong><em>
トークン化(トークナイザー)
* 文を適当な単位に分割すること
* 分割によって得られた文の構成要素をトークンと呼ぶ
* 方法としては
* 単語分割
* 単語に分割する
* 日本語の場合MeCabやSudochi, Jumanなどの形態素解析ツール(品詞や活用で分類)が有名
* 文字分割
* サブワード分割
* 文字分割を更に分割する (東京タワー → 東京 + タワー)
* BERTはこれを採用
</em></strong>
言語モデルによる処理
* 文章の出現しやすさを同時確率でモデル化
* p(私はパンを食べた) &gt; p(私は家を⾷べた) ← “⾷べた” と “パン” が同じ⽂章に出現しやすい
* p(私はパンを食べた)&gt; p(私にパンを食べた) ← “パンを⾷べた” と “は” が同じ⽂章に出現しやすい
* P(w|c)の条件の部分(c)を⽂脈と呼ぶ
* この学習にニューラルネットワークを利用
<strong><em>
ベクトル化(分散表現の作成)
* トークンに対応付けたベクトル(分散表現)を作成.
</em></strong>
クラスタリング
* 分散表現をクラスタ数に次元圧縮し, モデルとクラスタのラベルの損失関数を最⼩化する.</p>
<p><br></p>
<p>形態素解析
* 形態素解析
* 文章を最小の意味を持つ言語単位（形態素）に分割し,それぞれの品詞を識別する処理
* テキスト解析の前段階の処理として行われることが多い
* 手順
* データの作成
* PDFなどから直接処理することも可能だが,.txtデータにすると楽
* 入力例文: 「太陽が昇る東の空が美しい」
* テキストの前処理
* 不要なスペースや記号を除去しテキストを処理しやすい形に整理
* 形態素への分割
* 文章を形態素と呼ばれる最小単位に分割
* 「太陽」,「が」,「昇る」,「東」,「の」,「空」,「が」,「美しい」
* 品詞のタグ付け
* 分割された形態素に品詞情報を付与
* 「太陽」: 名詞
* 「が」: 助詞
* 「昇る」: 動詞
* 「東」: 名詞
* 「の」: 助詞
* 「空」: 名詞
* 「が」: 助詞
* 「美しい」: 形容詞</p>
<p><br></p>
<p>形態素解析
* Pythonで利用可能な(日本語)形態素解析パッケージ
* Mecab
* 日本語のオープンソース形態素解析システム
* pythonのライブラリとしてはmecab-python3
* janome
* Pythonで書かれた日本語形態素解析器
* MecabよりインストールなどがPythonに最適化されており,インストールなどが楽
* ただし,遅いので大規模な処理では余り使われない
* どっちでも良いが,Mecabを今回は使う
* pip install mecab-python3==0.996.5
* == 0.996.5 は新しいVerだとMacで利用するときに色々面倒くさいので古いバージョンを指定しています.
* ついでにWordCloudもInstallしておく.
* pip install wordcloud</p>
<p><br></p>
<p>形態素解析 → ワードクラウドを試してみる. (cf. https://rinsaka.com/python/nltk/05-wordcloud.html)</p>
<ul>
<li>千葉商科大学の理念(https://www.cuc.ac.jp/about_cuc/outline/spirits/index.html )の
WordCloudを作成する.</li>
<li>テキスト部分をコピペ→UTF-8のcuc.txtとしてdataフォルダに保存</li>
</ul>
<p>P21の図</p>
<p><br></p>
<p>形態素解析 → ワードクラウドを試してみる. (cf. https://rinsaka.com/python/nltk/05-wordcloud.html)</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> wordcloud <span class="im">import</span> WordCloud</span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb293-3"><a href="#cb293-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb293-4"><a href="#cb293-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> MeCab <span class="im">as</span> mc</span>
<span id="cb293-5"><a href="#cb293-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> strip_CRLF_from_Text(text):</span>
<span id="cb293-6"><a href="#cb293-6" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;テキストファイルの改行，タブを削除し，形態素解析を実行する．</span></span>
<span id="cb293-7"><a href="#cb293-7" aria-hidden="true" tabindex="-1"></a><span class="co">改行前後が日本語文字の場合は改行を削除する．</span></span>
<span id="cb293-8"><a href="#cb293-8" aria-hidden="true" tabindex="-1"></a><span class="co">それ以外はスペースに置換する．</span></span>
<span id="cb293-9"><a href="#cb293-9" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb293-10"><a href="#cb293-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 改行前後の文字が日本語文字の場合は改行を削除する</span></span>
<span id="cb293-11"><a href="#cb293-11" aria-hidden="true" tabindex="-1"></a>plaintext <span class="op">=</span> re.sub(<span class="st">&#39;([ぁ-んー]+|[ァ-ンー]+|[</span><span class="ch">\\</span><span class="st">u4e00-</span><span class="ch">\\</span><span class="st">u9FFF]+|[ぁ-んァ-ンー</span><span class="ch">\\</span><span class="st">u4e00-</span><span class="ch">\\</span><span class="st">u9FFF]+)(</span><span class="ch">\n</span><span class="st">)([ぁ-んー]+|[ァンー]+|[</span><span class="ch">\\</span><span class="st">u4e00-</span><span class="ch">\\</span><span class="st">u9FFF]+|[ぁ-んァ-ンー</span><span class="ch">\\</span><span class="st">u4e00-</span><span class="ch">\\</span><span class="st">u9FFF]+)&#39;</span>,</span>
<span id="cb293-12"><a href="#cb293-12" aria-hidden="true" tabindex="-1"></a><span class="vs">r&#39;\1\3&#39;</span>,</span>
<span id="cb293-13"><a href="#cb293-13" aria-hidden="true" tabindex="-1"></a>text)</span>
<span id="cb293-14"><a href="#cb293-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 残った改行とタブ記号はスペースに置換する</span></span>
<span id="cb293-15"><a href="#cb293-15" aria-hidden="true" tabindex="-1"></a>plaintext <span class="op">=</span> plaintext.replace(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>, <span class="st">&#39; &#39;</span>).replace(<span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span>, <span class="st">&#39; &#39;</span>)</span>
<span id="cb293-16"><a href="#cb293-16" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> plaintext</span>
<span id="cb293-17"><a href="#cb293-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mecab_wakati(text):</span>
<span id="cb293-18"><a href="#cb293-18" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb293-19"><a href="#cb293-19" aria-hidden="true" tabindex="-1"></a><span class="co">MeCabで分かち書き．</span></span>
<span id="cb293-20"><a href="#cb293-20" aria-hidden="true" tabindex="-1"></a><span class="co">ただし品詞は名詞だけに限定．</span></span>
<span id="cb293-21"><a href="#cb293-21" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb293-22"><a href="#cb293-22" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> mc.Tagger()</span>
<span id="cb293-23"><a href="#cb293-23" aria-hidden="true" tabindex="-1"></a><span class="co"># t = mc.Tagger(&#39;-d /usr/local/lib/mecab/dic/mecab-ipadic-neologd/&#39;)</span></span>
<span id="cb293-24"><a href="#cb293-24" aria-hidden="true" tabindex="-1"></a>node <span class="op">=</span> t.parseToNode(text)</span>
<span id="cb293-25"><a href="#cb293-25" aria-hidden="true" tabindex="-1"></a><span class="co"># print(node)</span></span>
<span id="cb293-26"><a href="#cb293-26" aria-hidden="true" tabindex="-1"></a>sent <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb293-27"><a href="#cb293-27" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(node):</span>
<span id="cb293-28"><a href="#cb293-28" aria-hidden="true" tabindex="-1"></a><span class="co"># print(node.surface, node.feature)</span></span>
<span id="cb293-29"><a href="#cb293-29" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> node.surface <span class="op">!=</span> <span class="st">&quot;&quot;</span>: <span class="co"># ヘッダとフッタを除外</span></span>
<span id="cb293-30"><a href="#cb293-30" aria-hidden="true" tabindex="-1"></a>word_type <span class="op">=</span> node.feature.split(<span class="st">&quot;,&quot;</span>)[<span class="dv">0</span>]</span>
<span id="cb293-31"><a href="#cb293-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 名詞だけをリストに追加する</span></span>
<span id="cb293-32"><a href="#cb293-32" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> word_type <span class="kw">in</span> [<span class="st">&quot;名詞&quot;</span>]:</span>
<span id="cb293-33"><a href="#cb293-33" aria-hidden="true" tabindex="-1"></a>sent <span class="op">+=</span> node.surface <span class="op">+</span> <span class="st">&quot; &quot;</span> <span class="co"># node.surface は「表層形」</span></span>
<span id="cb293-34"><a href="#cb293-34" aria-hidden="true" tabindex="-1"></a><span class="co"># 動詞（の原型），形容詞，副詞もリストに加えたい場合は次の２行を有効にする</span></span>
<span id="cb293-35"><a href="#cb293-35" aria-hidden="true" tabindex="-1"></a><span class="co">#if word_type in [ &quot;動詞&quot;, &quot;形容詞&quot;,&quot;副詞&quot;]:</span></span>
<span id="cb293-36"><a href="#cb293-36" aria-hidden="true" tabindex="-1"></a><span class="co"># sent += node.feature.split(&quot;,&quot;)[6] + &quot; &quot; # node.feature.split(&quot;,&quot;)[6] は形態素解析結果の</span></span>
<span id="cb293-37"><a href="#cb293-37" aria-hidden="true" tabindex="-1"></a>「原型」</span>
<span id="cb293-38"><a href="#cb293-38" aria-hidden="true" tabindex="-1"></a>node <span class="op">=</span> node.<span class="bu">next</span></span>
<span id="cb293-39"><a href="#cb293-39" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> node <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb293-40"><a href="#cb293-40" aria-hidden="true" tabindex="-1"></a><span class="cf">break</span></span>
<span id="cb293-41"><a href="#cb293-41" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> sent</span>
<span id="cb293-42"><a href="#cb293-42" aria-hidden="true" tabindex="-1"></a><span class="co"># テキストファイル読み込み</span></span>
<span id="cb293-43"><a href="#cb293-43" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="bu">open</span>(<span class="st">&#39;data/cuc.txt&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>)</span>
<span id="cb293-44"><a href="#cb293-44" aria-hidden="true" tabindex="-1"></a>raw <span class="op">=</span> f.read()</span>
<span id="cb293-45"><a href="#cb293-45" aria-hidden="true" tabindex="-1"></a>f.close()</span>
<span id="cb293-46"><a href="#cb293-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(raw)</span>
<span id="cb293-47"><a href="#cb293-47" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> strip_CRLF_from_Text(raw)</span>
<span id="cb293-48"><a href="#cb293-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(text)</span>
<span id="cb293-49"><a href="#cb293-49" aria-hidden="true" tabindex="-1"></a>sent <span class="op">=</span> mecab_wakati(text)</span>
<span id="cb293-50"><a href="#cb293-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sent)</span>
<span id="cb293-51"><a href="#cb293-51" aria-hidden="true" tabindex="-1"></a><span class="co"># フォントの保存先を指定する（環境によって書き換えてください）</span></span>
<span id="cb293-52"><a href="#cb293-52" aria-hidden="true" tabindex="-1"></a><span class="co">#font_path = &quot;C:\\WINDOWS\\FONTS\\MEIRYO.TTC&quot; ## Windows 版はこちら</span></span>
<span id="cb293-53"><a href="#cb293-53" aria-hidden="true" tabindex="-1"></a>font_path <span class="op">=</span> <span class="st">&quot;/System/Library/Fonts/ヒラギノ角ゴシック W3.ttc&quot;</span> <span class="co">## Mac 版はこちら</span></span>
<span id="cb293-54"><a href="#cb293-54" aria-hidden="true" tabindex="-1"></a><span class="co"># WordCloud画像を生成する</span></span>
<span id="cb293-55"><a href="#cb293-55" aria-hidden="true" tabindex="-1"></a>wc <span class="op">=</span> WordCloud(max_font_size<span class="op">=</span><span class="dv">36</span></span>
<span id="cb293-56"><a href="#cb293-56" aria-hidden="true" tabindex="-1"></a>,font_path<span class="op">=</span>font_path</span>
<span id="cb293-57"><a href="#cb293-57" aria-hidden="true" tabindex="-1"></a>,background_color<span class="op">=</span><span class="st">&#39;white&#39;</span>).generate(sent)</span>
<span id="cb293-58"><a href="#cb293-58" aria-hidden="true" tabindex="-1"></a>wc.to_file(<span class="st">&quot;cuc.png&quot;</span>)</span></code></pre></div>
<p>P22の結果載せる</p>
<p><br></p>
<p>WordCloud
* 今回は,頻出単語(文章中の出現回数)ほど大きく文字が表示されている.
* 重要度などの情報を与えることも可能だが,重要度を測るには他の手法が必要.
* Bertの固有単語抽出など</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> japanize_matplotlib</span>
<span id="cb294-3"><a href="#cb294-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> wordcloud <span class="im">import</span> WordCloud</span>
<span id="cb294-4"><a href="#cb294-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 日本語のテキストデータ（基本計画の内容を代表するキーワード）</span></span>
<span id="cb294-5"><a href="#cb294-5" aria-hidden="true" tabindex="-1"></a><span class="co">#最初に出てきたものほど大きく表示される</span></span>
<span id="cb294-6"><a href="#cb294-6" aria-hidden="true" tabindex="-1"></a><span class="co">#こういったリストを別の手法で作成することが必要</span></span>
<span id="cb294-7"><a href="#cb294-7" aria-hidden="true" tabindex="-1"></a>japanese_text <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb294-8"><a href="#cb294-8" aria-hidden="true" tabindex="-1"></a><span class="st">公的統計, 経済統計, 国民経済計算, データ, 統計改革, 統計ニーズ, 国際比較, 統計データ, PDCA, 統計リソース,</span></span>
<span id="cb294-9"><a href="#cb294-9" aria-hidden="true" tabindex="-1"></a><span class="st">デジタル化, 情報基盤, 統計調査, データ審査, 品質管理, ユーザー視点, 効率化, 統計作成, 政策立案, 統計行政,</span></span>
<span id="cb294-10"><a href="#cb294-10" aria-hidden="true" tabindex="-1"></a><span class="st">報告者, 利便性, 統計システム, 可視化, 報告, 支援, モニタリング, 評価, 総合的, 品質表示, 更新, 保存, 管理,</span></span>
<span id="cb294-11"><a href="#cb294-11" aria-hidden="true" tabindex="-1"></a><span class="st">正確性, 新たな統計, 対応, 負担軽減, 変化, 進展, 進化, 計画期間, 目標, 統計委員会, 建議, 方策, 様々な観点,</span></span>
<span id="cb294-12"><a href="#cb294-12" aria-hidden="true" tabindex="-1"></a><span class="st">社会経済, 統計作成方法, 仕様, 整備, デジタル経済, 実態把握, 報告者負担, 利用者利便性, 統計ユーザー,</span></span>
<span id="cb294-13"><a href="#cb294-13" aria-hidden="true" tabindex="-1"></a><span class="st">エラーチェック, 汎用ツール, 改善, 効率的, 統計リソース, 統計改革, 防止, 確保, 第Ⅳ期基本計画, 第Ⅲ期基本計画,</span></span>
<span id="cb294-14"><a href="#cb294-14" aria-hidden="true" tabindex="-1"></a><span class="st">相互関連, 整合性, 進め方, 効果的, 活用</span></span>
<span id="cb294-15"><a href="#cb294-15" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb294-16"><a href="#cb294-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 日本語フォントの使用</span></span>
<span id="cb294-17"><a href="#cb294-17" aria-hidden="true" tabindex="-1"></a>font_path <span class="op">=</span> <span class="st">&quot;/System/Library/Fonts/ヒラギノ角ゴシック W3.ttc&quot;</span> <span class="co">#Mac</span></span>
<span id="cb294-18"><a href="#cb294-18" aria-hidden="true" tabindex="-1"></a><span class="co">#font_path = &quot;C:\\WINDOWS\\FONTS\\MEIRYO.TTC&quot; #Win</span></span>
<span id="cb294-19"><a href="#cb294-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 日本語ワードクラウドの生成</span></span>
<span id="cb294-20"><a href="#cb294-20" aria-hidden="true" tabindex="-1"></a>japanese_wordcloud <span class="op">=</span> WordCloud(width<span class="op">=</span><span class="dv">800</span></span>
<span id="cb294-21"><a href="#cb294-21" aria-hidden="true" tabindex="-1"></a>, height<span class="op">=</span><span class="dv">400</span></span>
<span id="cb294-22"><a href="#cb294-22" aria-hidden="true" tabindex="-1"></a>, background_color<span class="op">=</span><span class="st">&#39;white&#39;</span></span>
<span id="cb294-23"><a href="#cb294-23" aria-hidden="true" tabindex="-1"></a>, font_path<span class="op">=</span>font_path</span>
<span id="cb294-24"><a href="#cb294-24" aria-hidden="true" tabindex="-1"></a>, colormap<span class="op">=</span><span class="st">&#39;viridis&#39;</span>).generate(japanese_text)</span>
<span id="cb294-25"><a href="#cb294-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 日本語ワードクラウドの表示</span></span>
<span id="cb294-26"><a href="#cb294-26" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb294-27"><a href="#cb294-27" aria-hidden="true" tabindex="-1"></a>plt.imshow(japanese_wordcloud, interpolation<span class="op">=</span><span class="st">&#39;bilinear&#39;</span>)</span>
<span id="cb294-28"><a href="#cb294-28" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&#39;off&#39;</span>)</span>
<span id="cb294-29"><a href="#cb294-29" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>P23の結果載せる</p>
<p><br></p>
<p>BERTについて</p>
<p>BERT
* Bidirectional Encoder Representations from Transformers
* 2018年にGoogleから発表されたニューラル言語モデ ル.• 後継にELECTRAというのがある(こっちのほうが軽く高速) • SEOなど検索エンジンの精度向上に利用 • 文章をトークンに分割したものを入力として受けて,それぞれのトークンに対応するベクトルを出力する
* 既存の方法では, トークン間の関係に関してあ まり上手く処理できなかった.
* 文章に現れるトークンに応じて各トークンの関係を決めるAttention
(注意機構)を散り入れている.
* より深く文脈を考慮したトークンの分散表現を得ることができる</p>
<p>P25の図</p>
<p><br></p>
<p>穴埋め
* BERTやchatGPTが行っているのは文章の穴埋め.
* 私はりんごを[MASK]
* MASKの部分に入る文字列の確率計算をしている.
* 私はりんごを行った ← 確率低い
* 私はりんごを食べた ← 確率高い
* コーパス(文例集)から教師あり学習をして,あらゆる語彙の連なりやすさの確率を計算している.
* Wikipediaやスクローリングして取得した文章
* � 食べた 私はりんごを = コーパス中の頻度(私はりんごを食べた)
コーパス中の頻度(私はりんごを)
* � 食べた 私はりんごを = コーパス中の頻度(私はりんごを行った)
コーパス中の頻度(私はりんごを)
* 単語間の確率による距離をベクトル表現する(学習)</p>
<p><br></p>
<p>学習
* BERTは二段階の学習を行っている.
* 事前学習
* (日本語など)言語全般に関して大規模なテキストコーパス(Wikipediaなど)で学習
* こちらのモデルがGoogleによって公開されている(ライブラリとして利用可能)
* ファインチューニング
* 事前学習済みのBERTモデルをタスク(穴埋め,ラベリング,校正などの用途)によって追加学習さ
せる.
* タスクに関連した新たなデータセットが必要
* ラベリングをするのであれば,ラベル付けされた教師データが必要</p>
<p><br></p>
<p>データセット
* BERTの利用のためには,目的に応じたデータセットが必要
* 日本語データセットとして有名なもの
* Twitter日本語評判分析データセット
* https://www.db.info.gifu-u.ac.jp/sentiment_analysis/
* Twitterの商品に関するポジティブ,ネガティブ,ニュートラルのラベリングデータ
* SNOW D18日本語感情表現辞書
* 日本語を48の勘定に分類
* 安らぎ,楽しさ親しみ,尊敬・尊さ,感謝,気持ちが良い,誇らしい,感動,喜び,悲しさ,寂しさ不満,切なさ,苦しさ,不安,憂鬱,辛さ,好き,嫌悪,恥ずかしい,焦り,驚き,怒り,幸福感,恨み,恐れ（恐縮等の意味で）,恐怖,悔しさ,祝う気持ち,困惑,きまずさ,興奮,悩み,願望,失望,あわれみ,見下し,謝罪,ためらい,不快,怠さ,あきれ,心配,緊張,妬み,憎い,残念,情けない,穏やか
* livedorニュースコーパス
* ニュース記事をサイト別/ジャンル別に分類
* 有価証券報告書ネガポジデータセット
* https://github.com/chakki-works/chABSA-dataset
* TIS株式会社が公開している上場企業の有価証券報告書を用いて作成されたマルチラベルのネガポジデータセット
* ネガティブ, ポジティブ, ニュートラルの3ラベル</p>
<p><br></p>
<p>BERT利用の流れ</p>
<p>トークン化
* MeCab(Fugashi);PythonのMeCabライブラリ
* iadic ; MeCab用のシソーラス
<strong><em>
ベクトル化
</em></strong>
学習
* FacebookのPyTorchを利用とニュラルネットワーク言語モデルライブラリであるTransformersを利用
* 事前学習
* 大規模な文章コーパスを用いて汎用的な言語のパターンを学習する
* BERTでは, ある単語を周りの単語を予測するタスクを学習
* ランダムに選ばれた15%のトークンをMASKという特殊トークンに置き換え, その位置のトークンを予測する(マスク付き⾔語モデル)
* ⼊⼒された2つの⽂が連続したものであるかを学習( Next Sentence Prediction)
* ⼤抵はこの部分はすでに⾏われたモデルを利⽤する
* ⽇本語で有名なものは東北⼤がWikipediaの⽇本語記事ので学習したもの(cl-tohoku/bert-base-japanese-whole-word-masking)
* ファインチューニング
* 事前学習を利⽤して,個別のタスクのラベル付きデータからタスクに特化した学習を⾏う.</p>
<p><br></p>
<p>P30の図</p>
<p>文章の穴埋め
* 今日は[MASK]に行く → MASK部分を予測
<strong><em>
文章分類
* ポジティブ,ネガティブなどに文章を分類(マーケティングやレ
コメンドなど
</em></strong>
マルチラベル文章分類
* ポジティブかつネガティブなど
<strong><em>
固有表現抽出
* 文章から人名・組織名といった固有名詞を抽出する
</em></strong>
文章校正
* Grammary的な
___
データの可視化と類似文章検索
* PCAからクラスタリング</p>
<p><br></p>
<p>人工知能の歴史
cf. 寺野隆雄,生成系AIの歴史・原理・現状,千葉商科大学 2023年 第1回FD 「生成系AIに関するFD」 ,2023/05/18</p>
<p>第1次AIブーム
* 1956年: ダートマス会議でスタート
* 汎⽤問題解決機(問題:現状と理想との差異)
* 問題の解決⼿法をプログラム
* 1960年代はじめ:機械翻訳の失敗で収斂
<strong><em>
第2次AIブーム
* 1980年代はじめ:エキスパートシステム,機械翻訳
* 沢山の知識を詰め込む
* 1980年代はじめ:第5世代コンピュータープロジェクト
* 1990年代はじめ:知識獲得・脆弱性で収斂
</em></strong>
第3次AIブーム
* 2010年から現在:ANN(ArYfical Neural Network)の復活
* 検索エンジン分野で発達
* ゲームでの成功(チェス,将棋,囲碁)
* パターン認識での成功(画像解析,音声解析,etc…)
___
第4次AIブーム
* 現在:生成系AI
* 言語・絵画・音声</p>
<p><br></p>
<p>GPU計算とCPU計算
* PCにおける計算は通常CPUによって行われます.
* これまでに実行してきたPythonプログラムは全てCPUを用いた計算.
* 一方でGPU(Graphics Processing Unit,画像処理装置,いわゆるグラボ)を利用した計算も可能
* ニューラルネットワークモデルは,GPUを用いて計算が行われることが多い.</p>
<p>CPU計算の特徴
* 汎⽤性: CPUは汎⽤的な計算に最適化. 様々な種類のタスクを処理可能.
* シリアル処理: CPUは⼀度に⼀つのタスクを処理するシリアル処理に適している
* 少数のコア: CPUは⽐較的少数のコアを保有.それぞれのコアが⾼速で複雑な計算を実⾏可能</p>
<p>GPU計算の特徴
* 特化した計算: GPUはグラフィックス処理や機械学習のような特定の種類の計算に最適化
* 並列処理: GPUは並列処理に特化.同時に多数の計算を実⾏可能
* 多数のコア: GPUには数百から数千のコアを保有.⼀度に多数の簡単な計算を実⾏可能</p>
<p><br></p>
<p>GPU計算でマルチラベル分類
* この講義ではGPU計算はローカル環境(それぞれのPC)で行いません.
* WindowsとMacで環境構築が全く異なり面倒
* 学生のPCのGPUが貧弱
* 処理が重く,時間がかかるのでノートPCには不向き
* なので,Googleの提供しているPython計算用のSaaS Google Colaboratryを利用します.
* 今回はColaboratry上で, 文章のマルチラベル分類を試してみます.
* マルチラベル分類
* 選択肢の中から復数のカテゴリーを選ぶ分類
* multi-hot ベクトル
文章が属すカテゴリーを表す0,1の2値ベクトル
* 今回は有価証券報告書データを利用して[ネガティブ,ニュートラル,ポジティブ]に分類
* ネガティブと判定されると[1,0,0]
* ニュートラルと判定されると[0,1,0]</p>
<p><br></p>
<p>Googleのアカウントを作る</p>
<p>P34の図</p>
<p><br></p>
<p>Google Driveの設定をする
* データなどはGoogleのクラウドストレージに保存されます.
* Google Drive上にこの授業のフォルダとデータを入れるフォルダ
を作ります</p>
<p>P35の図</p>
<p><br></p>
<p>Google Driveの設定をする</p>
<p>P36の図</p>
<p><br></p>
<p>Google Driveの設定をする
今回の授業用のフォルダをクリックして中に入ります.Teamsで配布された multi_label.ipynb をドラッグアンドドロップでフォルダに保存します.</p>
<p>P37の図</p>
<p><br></p>
<p>Google Colaboratoryが利用できるようにする
* Google のアカウントにGoogle Colaboratoryをインストールします.</p>
<p>P38の図</p>
<p><br></p>
<p>Google Colaboratoryの利用
* sldsフォルダのmul9_label.ipynb をダブルクリックするとGoogle Colaboratoryが開く.
* 右上の設定をGPU計算に変更する</p>
<p>P39の図</p>
<p><br></p>
<p>Google Colaboratoryの利用
* Runtime → run all でプログラムが動く</p>
<p>P40の図</p>
<p><br></p>
<p>Google Colaboratry の利用
出てきたらGoogle Driveのアクセスを許可する</p>
<p>P41の図</p>
<p><br></p>
<p>結果の確認</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode python"><code class="sourceCode python"></code></pre></div>
</details>
<h1 data-number="14" id="一般化線形モデル執筆中"><span class="header-section-number">14</span> 一般化線形モデル(執筆中)</h1>
<details>
<summary>
開く/閉じる
</summary>
</details>
<p>yakagika</p>
]]></description>
    <pubDate>Fri, 29 Mar 2024 00:00:00 UT</pubDate>
    <guid>/lectures/2024-03-29-special-lecture-datascience.html</guid>
    <dc:creator>yakagika</dc:creator>
</item>
<item>
    <title>特別講義(データサイエンス)演習回答</title>
    <link>/lectures/2024-03-29-special-lecture-datascience-answer.html</link>
    <description><![CDATA[<div class="toc"><div class="header">Table of Contents</div>
<ul>
<li><a href="#演習" id="toc-演習"><span class="toc-section-number">1</span> 3.3 演習</a></li>
<li><a href="#演習-1" id="toc-演習-1"><span class="toc-section-number">2</span> 3.4 演習</a></li>
<li><a href="#演習-2" id="toc-演習-2"><span class="toc-section-number">3</span> 3.5 演習</a></li>
<li><a href="#演習-3" id="toc-演習-3"><span class="toc-section-number">4</span> 3.6 演習</a></li>
<li><a href="#演習-4" id="toc-演習-4"><span class="toc-section-number">5</span> 3.8 演習</a></li>
<li><a href="#演習-5" id="toc-演習-5"><span class="toc-section-number">6</span> 3.9 演習</a></li>
<li><a href="#演習-6" id="toc-演習-6"><span class="toc-section-number">7</span> 5.9 演習</a></li>
<li><a href="#演習-7" id="toc-演習-7"><span class="toc-section-number">8</span> 5.10 演習</a></li>
<li><a href="#演習-8" id="toc-演習-8"><span class="toc-section-number">9</span> 5.11 演習</a></li>
<li><a href="#演習-9" id="toc-演習-9"><span class="toc-section-number">10</span> 5.13 演習</a></li>
<li><a href="#演習①" id="toc-演習①"><span class="toc-section-number">11</span> 5.17 演習①</a></li>
<li><a href="#演習②" id="toc-演習②"><span class="toc-section-number">12</span> 5.17 演習②</a></li>
<li><a href="#演習-10" id="toc-演習-10"><span class="toc-section-number">13</span> 6.3 演習</a></li>
<li><a href="#演習-11" id="toc-演習-11"><span class="toc-section-number">14</span> 6.4.1 演習</a></li>
<li><a href="#演習-12" id="toc-演習-12"><span class="toc-section-number">15</span> 6.4.2 演習</a></li>
<li><a href="#演習-13" id="toc-演習-13"><span class="toc-section-number">16</span> 6.4.2.4 演習</a></li>
<li><a href="#演習-14" id="toc-演習-14"><span class="toc-section-number">17</span> 6.4.2.5 演習</a></li>
<li><a href="#section" id="toc-section"><span class="toc-section-number">18</span> 7.1</a></li>
</ul>
</div>
<p><a href="https://yakagika.github.io/lectures/2024-03-29-special-lecture-datascience.html">特別講義(データサイエンス)</a>の演習回答例です.</p>
<p>講義中の学生の回答を参考にSAにまとめてもらったものです.
修正点などありましたら,教員に連絡してください.</p>
<h1 data-number="1" id="演習"><span class="header-section-number">1</span> 3.3 演習</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 飴が40個あります.7人で同じ数ずつ分けると1人分は何個で何個あまりますか?</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1人分の個数</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">40</span><span class="op">//</span><span class="dv">7</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 余り</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">40</span><span class="op">%</span><span class="dv">7</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 底辺5cm,高さ4cmの三角形の面積はいくつですか?</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">5</span><span class="op">*</span><span class="dv">4</span><span class="op">*</span><span class="fl">0.5</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 2の8乗はいくつですか?</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">2</span><span class="op">**</span><span class="dv">8</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 累乗と掛け算の計算順序を丸括弧を使った計算で確かめてください.</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">2</span><span class="op">+</span><span class="dv">3</span><span class="op">*</span><span class="dv">4</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>((<span class="dv">2</span><span class="op">+</span><span class="dv">3</span>)<span class="op">*</span><span class="dv">4</span>)</span></code></pre></div>
<h1 data-number="2" id="演習-1"><span class="header-section-number">2</span> 3.4 演習</h1>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 変数を利用して以下の猫型ロボットのBMIを計算してください</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># BMI = 体重(kg)÷身長(m)の2乗</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 猫型ロボットの身長 129.3cm</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 猫型ロボットの体重 129.3kg</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>height_cm <span class="op">=</span> <span class="fl">129.3</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>weight <span class="op">=</span> <span class="fl">129.3</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>height_m <span class="op">=</span> height_cm<span class="op">/</span><span class="dv">100</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>BMI <span class="op">=</span> weight<span class="op">/</span>(height_m<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(BMI)</span></code></pre></div>
<h1 data-number="3" id="演習-2"><span class="header-section-number">3</span> 3.5 演習</h1>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="st">&#39;abcdefg&#39;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;abcdefg&#39; から &#39;cde&#39;をスライスで抜き出してください.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x[<span class="dv">2</span>:<span class="dv">5</span>])</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># x = &#39;abcdefg&#39;と定義して, xに操作を加えて&#39;abfg&#39;を作ってください.</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x[<span class="dv">0</span>:<span class="dv">2</span>] <span class="op">+</span> x[<span class="dv">5</span>:])</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># x = &#39;abcdefg&#39;と定義して, xに操作を加えて&#39;bbbeee&#39;を作ってください.</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x[<span class="dv">1</span>]<span class="op">*</span><span class="dv">3</span> <span class="op">+</span> x[<span class="dv">4</span>]<span class="op">*</span><span class="dv">3</span>)</span></code></pre></div>
<h1 data-number="4" id="演習-3"><span class="header-section-number">4</span> 3.6 演習</h1>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> [[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>],[<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>],[<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>]]</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># xsの長さを求める</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(xs))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># スライスを使って以下を抽出する</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">## [[4,5,6],[7,8,9]]</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(xs[<span class="dv">1</span>:])</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">## [[1,2,3]]</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(xs[:<span class="dv">1</span>])</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">## [[7,8,9]]</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(xs[<span class="dv">2</span>:])</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">## [8,9]</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(xs[<span class="dv">2</span>][<span class="dv">1</span>:])</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co"># [4,5,6]を[-4,-5,-6]に更新する</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>xs[<span class="dv">1</span>] <span class="op">=</span> [<span class="op">-</span><span class="dv">4</span>, <span class="op">-</span><span class="dv">5</span>, <span class="op">-</span><span class="dv">6</span>]</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(xs)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 を -1に,9を-9にする</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>xs[<span class="dv">0</span>][<span class="dv">0</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>xs[<span class="dv">2</span>][<span class="dv">2</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">9</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(xs)</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="co"># [7,8,-9]のあとに,[10,11,12]を追加する</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> [<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>]</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>xs.append(a)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(xs)</span></code></pre></div>
<h1 data-number="5" id="演習-4"><span class="header-section-number">5</span> 3.8 演習</h1>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>fruits <span class="op">=</span> {<span class="st">&quot;リンゴ&quot;</span>:<span class="st">&quot;apple&quot;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>		 ,<span class="st">&quot;レモン&quot;</span>:<span class="st">&quot;lemon&quot;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>		 ,<span class="st">&quot;ブドウ&quot;</span>:<span class="st">&quot;grape&quot;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>		 ,<span class="st">&quot;バナナ&quot;</span>:<span class="st">&quot;banana&quot;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>		 ,<span class="st">&quot;イチゴ&quot;</span>:<span class="st">&quot;strawberry&quot;</span>}</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fruits)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># keyを指定してvalueにアクセス</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fruits[<span class="st">&quot;リンゴ&quot;</span>])</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 新しいkeyとvalueの追加</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>fruits[<span class="st">&quot;モモ&quot;</span>] <span class="op">=</span> <span class="st">&quot;peach&quot;</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fruits)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># valueの変更</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>fruits[<span class="st">&quot;リンゴ&quot;</span>] <span class="op">=</span> <span class="st">&quot;ringo&quot;</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fruits)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>fruits[<span class="st">&quot;リンゴ&quot;</span>] <span class="op">=</span> <span class="st">&quot;apple&quot;</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fruits)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co"># keyを指定して要素を削除</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>fruits.pop(<span class="st">&quot;レモン&quot;</span>)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fruits)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co"># keyの一覧を取得</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>keys <span class="op">=</span> fruits.keys()</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(keys)</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 値の一覧を取得</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> fruits.values()</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(values)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="co"># リストとして値の一覧を取得</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">list</span>(fruits.values()))</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="co"># keyとvalueのペアの一覧(タプルのリスト)を取得</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>items <span class="op">=</span> fruits.items()</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(items)</span></code></pre></div>
<h1 data-number="6" id="演習-5"><span class="header-section-number">6</span> 3.9 演習</h1>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ある値が偶数かどうかは,2で割った余りが0かどうかを判定することで判定できます.</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># x=101,y=202として, 以下の命題の真偽をPythonで計算してください.</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">101</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="dv">102</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># xが偶数</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x<span class="op">%</span><span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># yが偶数</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y<span class="op">%</span><span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># xが偶数かつyが偶数</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x<span class="op">%</span><span class="dv">2</span><span class="op">==</span><span class="dv">0</span> <span class="kw">and</span> y<span class="op">%</span><span class="dv">2</span><span class="op">==</span><span class="dv">0</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># xが偶数またはyが偶数</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x<span class="op">%</span><span class="dv">2</span><span class="op">==</span><span class="dv">0</span> <span class="kw">or</span> y<span class="op">%</span><span class="dv">2</span><span class="op">==</span><span class="dv">0</span>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co"># x+yが奇数</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>((x<span class="op">+</span>y)<span class="op">%</span><span class="dv">2</span> <span class="op">==</span> <span class="dv">1</span>)</span></code></pre></div>
<h1 data-number="7" id="演習-6"><span class="header-section-number">7</span> 5.9 演習</h1>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;data/salary.csv&#39;</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ①</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.loc[<span class="dv">1</span>:<span class="dv">13</span>, <span class="st">&#39;industry&#39;</span>:<span class="st">&#39;salary&#39;</span>])</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.iloc[<span class="dv">1</span>:<span class="dv">14</span>, <span class="dv">0</span>:])</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ②</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.at[<span class="dv">4</span>, <span class="st">&#39;salary&#39;</span>])</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.iat[<span class="dv">4</span>, <span class="dv">1</span>])</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ③</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.loc[[<span class="dv">6</span>,<span class="dv">8</span>,<span class="dv">10</span>], [<span class="st">&#39;industry&#39;</span>]])</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.iloc[[<span class="dv">6</span>,<span class="dv">8</span>,<span class="dv">10</span>], [<span class="dv">0</span>]])</span></code></pre></div>
<h1 data-number="8" id="演習-7"><span class="header-section-number">8</span> 5.10 演習</h1>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;data/salary.csv&#39;</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>df.columns <span class="op">=</span> [<span class="st">&#39;Ind&#39;</span>,<span class="st">&#39;Sal&#39;</span>]</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Sal列が偶数のSal列の行</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[df[<span class="st">&#39;Sal&#39;</span>] <span class="op">%</span><span class="dv">2</span><span class="op">==</span><span class="dv">0</span> ][<span class="st">&#39;Sal&#39;</span>])</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Sal列が奇数のInd列の行</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[df[<span class="st">&#39;Sal&#39;</span>] <span class="op">%</span><span class="dv">2</span><span class="op">==</span><span class="dv">1</span> ][<span class="st">&#39;Ind&#39;</span>])</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Ind列がInfo,Edu,Medのいずれかで,Sal列が4000以上5000未満のSal列</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> df.loc[<span class="dv">8</span>:<span class="dv">10</span>, <span class="st">&#39;Sal&#39;</span>]</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> x[(x <span class="op">&gt;=</span> <span class="dv">4000</span>) <span class="op">&amp;</span> (x <span class="op">&lt;</span> <span class="dv">5000</span>)]</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[(df[<span class="st">&#39;Ind&#39;</span>].isin([<span class="st">&#39;Information&#39;</span>, <span class="st">&#39;Academic&#39;</span>, <span class="st">&#39;Medical&#39;</span>])) <span class="op">&amp;</span> (df[<span class="st">&#39;Sal&#39;</span>] <span class="op">&gt;=</span> <span class="dv">4000</span>) <span class="op">&amp;</span> (df[<span class="st">&#39;Sal&#39;</span>] <span class="op">&lt;</span> <span class="dv">5000</span>)][<span class="st">&#39;Sal&#39;</span>])</span></code></pre></div>
<h1 data-number="9" id="演習-8"><span class="header-section-number">9</span> 5.11 演習</h1>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;data/salary.csv&#39;</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>df.columns <span class="op">=</span> [<span class="st">&#39;Ind&#39;</span>,<span class="st">&#39;Sal&#39;</span>]</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># columnsを日本語(産業,給与)に変更</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>df.columns <span class="op">=</span> [<span class="st">&#39;産業&#39;</span>,<span class="st">&#39;給与&#39;</span>]</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># サービス業だと思われる行のみを抽出して,copy()</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df.loc[[<span class="dv">3</span>,<span class="dv">9</span>,<span class="dv">11</span>,<span class="dv">12</span>],[<span class="st">&#39;産業&#39;</span>,<span class="st">&#39;給与&#39;</span>]].copy()</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df2)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># コピーされたDataFrameに0から始まるインデックスを振り直す</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df2.reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df2)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 元のDataFrameとコピーされたデータフレームの中身とidを確認</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;id df:&#39;</span>,<span class="bu">id</span>(df))</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;id df2:&#39;</span>,<span class="bu">id</span>(df2))</span></code></pre></div>
<h1 data-number="10" id="演習-9"><span class="header-section-number">10</span> 5.13 演習</h1>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> [[<span class="st">&#39;Taro&#39;</span>,<span class="dv">20</span>]</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>         ,[<span class="st">&#39;Jiro&#39;</span>,<span class="dv">30</span>]</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>         ,[<span class="st">&#39;Hanako&#39;</span>,<span class="dv">40</span>]]</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>values</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                 ,columns<span class="op">=</span>[<span class="st">&#39;name&#39;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                          ,<span class="st">&#39;age&#39;</span>])</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co"># age列をfloat型に変更</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;age&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;age&#39;</span>].astype(<span class="bu">float</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">&#39;age&#39;</span>].dtypes)</span></code></pre></div>
<h1 data-number="11" id="演習①"><span class="header-section-number">11</span> 5.17 演習①</h1>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(index <span class="op">=</span> <span class="bu">range</span>(<span class="dv">20</span>))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;1&#39;</span>] <span class="op">=</span> df.index</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;2&#39;</span>] <span class="op">=</span> df.index<span class="op">*</span><span class="dv">2</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;3&#39;</span>] <span class="op">=</span> df.index<span class="op">*</span><span class="dv">3</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;4&#39;</span>] <span class="op">=</span> df.index<span class="op">*</span><span class="dv">4</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;5&#39;</span>] <span class="op">=</span> df.index<span class="op">*</span><span class="dv">5</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">#df = pd.DataFrame()</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">#for i in range(1,6):</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">#    x = []</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">#    for j in range(20):</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">#        x.append(i*j)</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co">#    df[str(i)] = x</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co">#print(df)</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;3&#39;列を2倍した&#39;6&#39;という列を追加</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;6&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;3&#39;</span>]<span class="op">*</span><span class="dv">2</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co"># indexが20となる行を追加</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="dv">20</span>] <span class="op">=</span> df.loc[<span class="dv">1</span>]<span class="op">*</span><span class="dv">20</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;mean&#39;という各行の平均値からなる列を追加</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;mean&#39;</span>] <span class="op">=</span> df.mean(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="co"># indexが偶数の列のみを残して,すべての列をint型に変更した後BOM付きのUTF-8のcsvで保存</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[df.index<span class="op">%</span><span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y)</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> y.astype(<span class="bu">int</span>)</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y)</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y.dtypes)</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>y.to_csv(<span class="st">&#39;data/5.17_ensyu1.csv&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8-sig&#39;</span>)</span></code></pre></div>
<h1 data-number="12" id="演習②"><span class="header-section-number">12</span> 5.17 演習②</h1>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">#データをrice.csvとしてutf-8で保存します.</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">#今回は&#39;米相場&#39;列だけを残してあります.</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;data/rice.csv&#39;</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;data/rice.csv&#39;</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.isna())</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;#欠損値をNaNに----------------------------------&quot;</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># pd.to_numeric&#39;米相場&#39;列を数値型に変換</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;coerce&#39;：変換できない値をNaNに変換します。</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;米相場&#39;</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">&#39;米相場&#39;</span>], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co"># DataFrameを確認して、変換後の値を確認</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;#NaNを0に〇----------------------------------</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;@NaNを0に置き換える（必要に応じて適切な値を選択</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;@filledは欠損値を特定の値で埋める</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;@df.filled(特定の値,元のデータを直接変える）</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;@df[&#39;米相場&#39;]=df[&#39;米相場&#39;].fillna(0))</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;@しかしこれではデータのサイズが変わってしまうので平均が狂う</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;#NaNの削除◯----------------------------------</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.dropna(subset<span class="op">=</span>[<span class="st">&#39;米相場&#39;</span>],how<span class="op">=</span><span class="st">&#39;any&#39;</span>))</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;#浮動小数点数型に変換〇----------------------------------&quot;</span>)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;米相場&#39;列を浮動小数点型に変換</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;米相場&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;米相場&#39;</span>].astype(<span class="bu">float</span>)</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;#平均値の計算〇----------------------------------&quot;</span>)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="co"># 平均値の計算（元の数値データを使うため、再計算）</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="st">&quot;average&quot;</span>,<span class="st">&quot;米相場&quot;</span>] <span class="op">=</span>df.loc[<span class="dv">0</span>:,<span class="st">&quot;米相場&quot;</span>].mean()</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df) </span></code></pre></div>
<h1 data-number="13" id="演習-10"><span class="header-section-number">13</span> 6.3 演習</h1>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 関東の都県を標準入力から受け取り,その都県の県庁所在地を返す.</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="bu">input</span>(<span class="st">&#39;関東の都道府県を入力してください&#39;</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> x <span class="op">==</span> <span class="st">&#39;千葉県&#39;</span> <span class="kw">or</span> x <span class="op">==</span> <span class="st">&#39;千葉&#39;</span>:</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;千葉市&#39;</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> x <span class="op">==</span> <span class="st">&#39;東京都&#39;</span> <span class="kw">or</span> x <span class="op">==</span> <span class="st">&#39;東京&#39;</span>:</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;東京&#39;</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> x <span class="op">==</span> <span class="st">&#39;神奈川県&#39;</span> <span class="kw">or</span> x <span class="op">==</span> <span class="st">&#39;神奈川&#39;</span>:</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;横浜市&#39;</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> x <span class="op">==</span> <span class="st">&#39;埼玉県&#39;</span> <span class="kw">or</span> x <span class="op">==</span> <span class="st">&#39;埼玉&#39;</span>:</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;さいたま市&#39;</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> x <span class="op">==</span> <span class="st">&#39;茨城県&#39;</span> <span class="kw">or</span> x <span class="op">==</span> <span class="st">&#39;茨城&#39;</span>:</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;水戸市&#39;</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> x <span class="op">==</span> <span class="st">&#39;栃木県&#39;</span> <span class="kw">or</span> x <span class="op">==</span> <span class="st">&#39;栃木&#39;</span>:</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;宇都宮市&#39;</span>)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> x <span class="op">==</span> <span class="st">&#39;群馬県&#39;</span> <span class="kw">or</span> x <span class="op">==</span> <span class="st">&#39;群馬&#39;</span>:</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;前橋市&#39;</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;関東の都道府県ではありません&#39;</span>)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co"># input()関数で数値を受け取って, 偶数なら偶数, 奇数なら奇数という文字列を返す.</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(<span class="st">&#39;数値を入力してください&#39;</span>))</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> x<span class="op">%</span><span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;偶数&#39;</span>)</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> x<span class="op">%</span><span class="dv">2</span> <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;奇数&#39;</span>)</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="co"># ランダムな1から10の数値を発生させて, その数値が5より大きければ&#39;BIG&#39;,小さければ&#39;SMALL&#39;と表示する.</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> random.randint(<span class="dv">1</span>,<span class="dv">10</span>)</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;数値:&#39;</span>,x)</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> x <span class="op">&gt;</span> <span class="dv">5</span>:</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;BIG&#39;</span>)</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;SMALL&#39;</span>)</span></code></pre></div>
<h1 data-number="14" id="演習-11"><span class="header-section-number">14</span> 6.4.1 演習</h1>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># x = 1 に3ずつ数を足しながらxの値をprint()する. xが1000を超えたら終了する.</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> x <span class="op">&lt;</span> <span class="dv">1001</span>:</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">+=</span> <span class="dv">3</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;---------&#39;</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 1から100までの数の和を求める.</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> x <span class="op">&lt;</span> <span class="dv">100</span>:</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    x <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    total <span class="op">+=</span> x</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;総和:&#39;</span>, total)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;---------&#39;</span>)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 100から150までの数のうち,5で割り切れるかつ2で割り切れる数の和を求める</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">99</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> x <span class="op">&lt;</span> <span class="dv">150</span>:</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    x <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x<span class="op">%</span><span class="dv">10</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>        total <span class="op">+=</span> x</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;総和:&#39;</span>,total)</span></code></pre></div>
<h1 data-number="15" id="演習-12"><span class="header-section-number">15</span> 6.4.2 演習</h1>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># x=0に[1,3,5,7,9,12]を順番に足して更新する. xの値を更新するたびにprint()する.</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> [<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">9</span>,<span class="dv">12</span>]:</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">+=</span> i</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 人物の名前と成績を記録した辞書型xs={&#39;taro&#39;:&#39;S&#39;,&#39;hanako&#39;:&#39;B&#39;,&#39;yumi&#39;:&#39;A&#39;,&#39;jiro&#39;:&#39;D&#39;}から成績A以上の人物名だけをリストupper=[]に追加し,upperを表示する.</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> {<span class="st">&#39;taro&#39;</span>:<span class="st">&#39;S&#39;</span>,<span class="st">&#39;hanako&#39;</span>:<span class="st">&#39;B&#39;</span>,<span class="st">&#39;yumi&#39;</span>:<span class="st">&#39;A&#39;</span>,<span class="st">&#39;jiro&#39;</span>:<span class="st">&#39;D&#39;</span>}</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>upper <span class="op">=</span> []</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, grade <span class="kw">in</span> xs.items():</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> grade <span class="kw">in</span> [<span class="st">&#39;S&#39;</span>, <span class="st">&#39;A&#39;</span>]:</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>        upper.append(name)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;---------</span><span class="ch">\n</span><span class="st">&#39;</span>, upper)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 100から150までの数のうち,５で割り切れるかつ２で割り切れる数の和を求める</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>,<span class="dv">151</span>):</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i<span class="op">%</span><span class="dv">10</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>        total <span class="op">+=</span> i</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;---------</span><span class="ch">\n</span><span class="st">&#39;</span>, <span class="st">&#39;総和:&#39;</span>, total)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="co"># xs = [[1,2,3,4,5],[6,7,8,9,10],[11,12,13,14,15],[16,17,18,19,20]]として, for文の多重ループを利用して, xs[0]からxs[3]の合計値が入ったリストを求める</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> [[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>],[<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>],[<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">15</span>],[<span class="dv">16</span>,<span class="dv">17</span>,<span class="dv">18</span>,<span class="dv">19</span>,<span class="dv">20</span>]]</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>sum_list <span class="op">=</span> []</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> xs:</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> i:</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>        total <span class="op">+=</span> j</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>    sum_list.append(total)</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;---------</span><span class="ch">\n</span><span class="st">&#39;</span>, sum_list)</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;---------&#39;</span>)</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a><span class="co"># FizzBuzzとはプログラミングの動作確認でよく用いられる欧米圏の言葉遊びゲームです.. 以下のルールに則って1から100までの数を順番にFizzBuzzの判定を行ってください.</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">101</span>):</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i<span class="op">%</span><span class="dv">3</span> <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> i<span class="op">%</span><span class="dv">5</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(i, <span class="st">&#39;FizzBuzz&#39;</span>)</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> i<span class="op">%</span><span class="dv">3</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(i, <span class="st">&#39;Fizz&#39;</span>)</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> i<span class="op">%</span><span class="dv">5</span> <span class="op">==</span><span class="dv">0</span>:</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(i, <span class="st">&#39;Buzz&#39;</span>)</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(i)</span></code></pre></div>
<h1 data-number="16" id="演習-13"><span class="header-section-number">16</span> 6.4.2.4 演習</h1>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 質問に対する回答をinput関数で受け取り,それに対して返答をする簡単なBotプログラムを作成してください. なお,分岐は最低5つ以上とすること.</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>answer <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;テストは何点でしたか?(終了する場合は[終了]と入力してください.)</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> answer <span class="op">==</span> <span class="st">&#39;終了&#39;</span>:</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">int</span>(answer) <span class="op">&gt;</span> <span class="dv">100</span> <span class="kw">or</span> <span class="bu">int</span>(answer) <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;0 ~ 100の数値を入力してください.&quot;</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        answer <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;テストは何点でしたか?</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">int</span>(answer) <span class="op">&gt;=</span> <span class="dv">90</span>:</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;S:素晴らしいです.&quot;</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        answer <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;他のテストは何点でしたか?</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">int</span>(answer) <span class="op">&gt;=</span> <span class="dv">80</span>:</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;A:よく頑張りました.&quot;</span>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>        answer <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;他のテストは何点でしたか?</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">int</span>(answer) <span class="op">&gt;=</span> <span class="dv">70</span>:</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;B:お疲れ様でした.&quot;</span>)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>        answer <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;他のテストは何点でしたか?</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">int</span>(answer) <span class="op">&gt;=</span> <span class="dv">60</span>:</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;C:もう少し頑張りましょう.&quot;</span>)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>        answer <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;他のテストは何点でしたか?</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">int</span>(answer) <span class="op">&lt;=</span> <span class="dv">59</span>:</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;F:残念です.&quot;</span>)</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>        answer <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;他のテストは何点でしたか?</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span></code></pre></div>
<h1 data-number="17" id="演習-14"><span class="header-section-number">17</span> 6.4.2.5 演習</h1>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;data/kome.csv&#39;</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 米相場列を数値型に変換</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 変換できない値 → NaN</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;米相場&#39;</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">&#39;米相場&#39;</span>], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># NaNの削除</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>df.dropna(subset<span class="op">=</span>[<span class="st">&#39;米相場&#39;</span>], how<span class="op">=</span><span class="st">&#39;any&#39;</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co"># indexを振り直す</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>df.reset_index(inplace<span class="op">=</span><span class="va">True</span>,drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co">#米相場列をfloat型にする</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;米相場&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;米相場&#39;</span>].astype(<span class="bu">float</span>)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 西暦列から&#39;年&#39;を抜く</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> df.index:</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    df.at[i, <span class="st">&#39;西暦&#39;</span>] <span class="op">=</span> df.at[i, <span class="st">&#39;西暦&#39;</span>][:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 西暦列をint型にする</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;西暦&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;西暦&#39;</span>].astype(<span class="bu">int</span>)</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">&#39;西暦&#39;</span>].dtype)</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 西暦列の重複を除いた値を確認</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">&#39;西暦&#39;</span>].unique())</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a><span class="co"># 西暦ごとに米相場列の値をまとめる</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> {i: [] <span class="cf">for</span> i <span class="kw">in</span> df[<span class="st">&#39;西暦&#39;</span>].unique()}</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data)</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> df.index:</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>    data[df.at[i,<span class="st">&#39;西暦&#39;</span>]] <span class="op">+=</span> [df.at[i,<span class="st">&#39;米相場&#39;</span>]]</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data)</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a><span class="co"># 西暦ごとの米相場の平均値を計算</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> df[<span class="st">&#39;西暦&#39;</span>].unique():</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>    length <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> data[i]:</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>        total <span class="op">+=</span> j</span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>        length <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">年, mean:</span><span class="sc">{</span>total<span class="op">/</span>length<span class="sc">}</span><span class="ss">&#39;</span>)</span></code></pre></div>
<h1 data-number="18" id="section"><span class="header-section-number">18</span> 7.1</h1>
<div class="sourceCode" id="cb18"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 与えられた数値のリストの合計値を返す関数</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_sum(xs):</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> xs:</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        total <span class="op">+=</span> x</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> total</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 与えられた数値のルストの最大値を返す関数</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_max(xs):</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    max_value <span class="op">=</span> xs[<span class="dv">0</span>]</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> xs[<span class="dv">1</span>:]:</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> x <span class="op">&gt;</span> max_value:</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>            max_value <span class="op">=</span> x</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> max_value</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 与えられた数値にFizzBuzzの結果を文字列で返す関数</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fizzBuzz(x):</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">%</span> <span class="dv">3</span> <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> x <span class="op">%</span> <span class="dv">5</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;FizzBuzz&#39;</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> x <span class="op">%</span> <span class="dv">3</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;Fizz&#39;</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> x <span class="op">%</span> <span class="dv">5</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;Buzz&#39;</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">str</span>(x)</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> filter_list(f,xs):</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> []</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> xs:</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> f(x):</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>            result.append(x)</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>filter_list((<span class="kw">lambda</span> x: <span class="va">True</span> <span class="cf">if</span> x <span class="op">&gt;</span> <span class="dv">3</span> <span class="cf">else</span> <span class="va">False</span> ), [<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>]) <span class="co"># &gt;&gt;&gt;[4, 5]</span></span></code></pre></div>
]]></description>
    <pubDate>Fri, 29 Mar 2024 00:00:00 UT</pubDate>
    <guid>/lectures/2024-03-29-special-lecture-datascience-answer.html</guid>
    <dc:creator>yakagika</dc:creator>
</item>
<item>
    <title>統計学入門</title>
    <link>/lectures/2024-03-29-introduction-to-statistics.html</link>
    <description><![CDATA[<div class="toc"><div class="header">Table of Contents</div>
<ul>
<li><a href="#第1回-イントロダクション" id="toc-第1回-イントロダクション"><span class="toc-section-number">1</span> 第1回 イントロダクション</a>
<ul>
<li><a href="#python-環境構築" id="toc-python-環境構築"><span class="toc-section-number">1.1</span> Python 環境構築</a></li>
</ul></li>
</ul>
</div>
<p>(執筆準備中)</p>
<p>統計学の入門と,pythonを利用した実装について,
昨年までの授業資料スライドををまとめていく予定です.
授業スライドの主要な内容のみ,特にコード関連を整理する.</p>
<h1 data-number="1" id="第1回-イントロダクション"><span class="header-section-number">1</span> 第1回 イントロダクション</h1>
<h2 data-number="1.1" id="python-環境構築"><span class="header-section-number">1.1</span> Python 環境構築</h2>
<p>yakagika</p>
]]></description>
    <pubDate>Fri, 29 Mar 2024 00:00:00 UT</pubDate>
    <guid>/lectures/2024-03-29-introduction-to-statistics.html</guid>
    <dc:creator>yakagika</dc:creator>
</item>
<item>
    <title>代数プログラミング入門</title>
    <link>/lectures/2024-03-29-introduction-to-algebraic-programing.html</link>
    <description><![CDATA[<div class="toc"><div class="header">Table of Contents</div>
<ul>
<li><a href="#はじめに" id="toc-はじめに"><span class="toc-section-number">1</span> はじめに</a>
<ul>
<li><a href="#本資料の読み方" id="toc-本資料の読み方"><span class="toc-section-number">1.1</span> 本資料の読み方</a></li>
<li><a href="#haskellとは" id="toc-haskellとは"><span class="toc-section-number">1.2</span> Haskellとは</a></li>
<li><a href="#関数型言語の雰囲気" id="toc-関数型言語の雰囲気"><span class="toc-section-number">1.3</span> 関数型言語の雰囲気</a></li>
<li><a href="#関数型だと何が嬉しいのか" id="toc-関数型だと何が嬉しいのか"><span class="toc-section-number">1.4</span> 関数型だと何が嬉しいのか</a></li>
<li><a href="#設計も関数型で" id="toc-設計も関数型で"><span class="toc-section-number">1.5</span> 設計も関数型で</a>
<ul>
<li><a href="#雑談なんでhaskell" id="toc-雑談なんでhaskell"><span class="toc-section-number">1.5.1</span> 雑談:なんでHaskell?</a></li>
</ul></li>
</ul></li>
<li><a href="#haskellセットアップ" id="toc-haskellセットアップ"><span class="toc-section-number">2</span> Haskellセットアップ</a>
<ul>
<li><a href="#環境構築" id="toc-環境構築"><span class="toc-section-number">2.1</span> 環境構築</a></li>
</ul></li>
<li><a href="#haskellを使ってみよう" id="toc-haskellを使ってみよう"><span class="toc-section-number">3</span> Haskellを使ってみよう</a>
<ul>
<li><a href="#ghci" id="toc-ghci"><span class="toc-section-number">3.1</span> ghci</a></li>
<li><a href="#終了" id="toc-終了"><span class="toc-section-number">3.2</span> 終了</a></li>
<li><a href="#コメントアウト" id="toc-コメントアウト"><span class="toc-section-number">3.3</span> コメントアウト</a></li>
<li><a href="#複数行モード" id="toc-複数行モード"><span class="toc-section-number">3.4</span> 複数行モード</a></li>
<li><a href="#データ型" id="toc-データ型"><span class="toc-section-number">3.5</span> データ型</a>
<ul>
<li><a href="#数値型" id="toc-数値型"><span class="toc-section-number">3.5.1</span> 数値型</a></li>
<li><a href="#リスト" id="toc-リスト"><span class="toc-section-number">3.5.2</span> リスト</a></li>
<li><a href="#タプル" id="toc-タプル"><span class="toc-section-number">3.5.3</span> タプル</a></li>
<li><a href="#文字列型" id="toc-文字列型"><span class="toc-section-number">3.5.4</span> 文字列型</a></li>
</ul></li>
<li><a href="#論理型bool" id="toc-論理型bool"><span class="toc-section-number">3.6</span> 論理型(Bool)</a></li>
</ul></li>
<li><a href="#関数" id="toc-関数"><span class="toc-section-number">4</span> 関数</a>
<ul>
<li><a href="#スクリプトファイルの実行" id="toc-スクリプトファイルの実行"><span class="toc-section-number">4.1</span> スクリプトファイルの実行</a></li>
<li><a href="#関数と演算子" id="toc-関数と演算子"><span class="toc-section-number">4.2</span> 関数と演算子</a>
<ul>
<li><a href="#結合性" id="toc-結合性"><span class="toc-section-number">4.2.1</span> 結合性</a></li>
</ul></li>
<li><a href="#分岐" id="toc-分岐"><span class="toc-section-number">4.3</span> 分岐</a>
<ul>
<li><a href="#パターンマッチ" id="toc-パターンマッチ"><span class="toc-section-number">4.3.1</span> パターンマッチ</a></li>
<li><a href="#ガード" id="toc-ガード"><span class="toc-section-number">4.3.2</span> ガード</a></li>
<li><a href="#case式" id="toc-case式"><span class="toc-section-number">4.3.3</span> case式</a></li>
<li><a href="#if式" id="toc-if式"><span class="toc-section-number">4.3.4</span> if式</a></li>
</ul></li>
<li><a href="#再帰" id="toc-再帰"><span class="toc-section-number">4.4</span> 再帰</a></li>
<li><a href="#ラムダ式" id="toc-ラムダ式"><span class="toc-section-number">4.5</span> ラムダ式</a></li>
<li><a href="#高階関数" id="toc-高階関数"><span class="toc-section-number">4.6</span> 高階関数</a></li>
<li><a href="#合成" id="toc-合成"><span class="toc-section-number">4.7</span> 合成</a></li>
<li><a href="#値の束縛" id="toc-値の束縛"><span class="toc-section-number">4.8</span> 値の束縛</a></li>
</ul></li>
<li><a href="#代数的データ型" id="toc-代数的データ型"><span class="toc-section-number">5</span> 代数的データ型</a>
<ul>
<li><a href="#命題と条件式" id="toc-命題と条件式"><span class="toc-section-number">5.1</span> 命題と条件式</a></li>
<li><a href="#集合" id="toc-集合"><span class="toc-section-number">5.2</span> 集合</a></li>
<li><a href="#型注釈と関数" id="toc-型注釈と関数"><span class="toc-section-number">5.3</span> 型注釈と関数</a>
<ul>
<li><a href="#内包表記" id="toc-内包表記"><span class="toc-section-number">5.3.1</span> 内包表記</a></li>
</ul></li>
<li><a href="#包含" id="toc-包含"><span class="toc-section-number">5.4</span> 包含</a></li>
<li><a href="#積と和" id="toc-積と和"><span class="toc-section-number">5.5</span> 積と和</a></li>
</ul></li>
<li><a href="#代数とクラス" id="toc-代数とクラス"><span class="toc-section-number">6</span> 代数とクラス</a>
<ul>
<li><a href="#マグマ" id="toc-マグマ"><span class="toc-section-number">6.1</span> マグマ</a></li>
<li><a href="#半群" id="toc-半群"><span class="toc-section-number">6.2</span> 半群</a></li>
<li><a href="#モノイド" id="toc-モノイド"><span class="toc-section-number">6.3</span> モノイド</a></li>
<li><a href="#群" id="toc-群"><span class="toc-section-number">6.4</span> 群</a></li>
<li><a href="#リスト-1" id="toc-リスト-1"><span class="toc-section-number">6.5</span> リスト</a></li>
<li><a href="#ツリー" id="toc-ツリー"><span class="toc-section-number">6.6</span> ツリー</a></li>
<li><a href="#ネットワーク" id="toc-ネットワーク"><span class="toc-section-number">6.7</span> ネットワーク</a></li>
</ul></li>
<li><a href="#手続き型haskell" id="toc-手続き型haskell"><span class="toc-section-number">7</span> 手続き型Haskell</a></li>
<li><a href="#圏論とhaskell" id="toc-圏論とhaskell"><span class="toc-section-number">8</span> 圏論とHaskell</a></li>
<li><a href="#発展会計プログラム" id="toc-発展会計プログラム"><span class="toc-section-number">9</span> 発展:会計プログラム</a></li>
</ul>
</div>
<p>(執筆準備中)</p>
<p>代数の基礎と,代数による仕様記述,Haskellの基礎に関して書いていく予定です.
現在執筆中のため, 構成及び内容が今後変わります.</p>
<h1 data-number="1" id="はじめに"><span class="header-section-number">1</span> はじめに</h1>
<details>
<summary>
開く/閉じる
</summary>
<p>本資料は,正規の大学の科目ではなく, 学内での学生,教員の勉強会において使用する予定のものとなります. したがって,講義形式で作成しますが,通常の講義よりはかなり緩めの記述,内容が含まれます.</p>
<p>本講義では,関数型プログラミング言語Haskellの基礎,使用法,及び設計に関して扱います.
想定する履修者はPythonやJavaScriptなどの手続き型言語の使用経験はあるが,関数型言語を利用したことがない大学学部生です. 関数型言語の特徴を説明する際に手続き型言語の例としてPythonでの記述が出てきますが,Pythonの文法等に関しては既知のものとして扱います.(こちらはもとも官庁用の報告書として執筆したものを(大幅に)改変したものですので,もともとの資料ではVBAやJavaを事例として用いていました.)</p>
<p>また,本講義では代数学を利用したプログラミングの設計に関する方法論も扱います.集合論や代数学に関する知識は前提とせず,初歩から扱いますので,数学に関する前提知識は特に必要ありません. なお,本講義は集合論や代数学の習得を目的としているわけではないので,これらに関してはかなり簡略化した説明になります.専門的に数学を学びたい方向けの講義ではないことを理解したうえで受講してください.</p>
<p>一方で,CLIの操作やディレクトリの概念,ソフトウェアのインストール,テキストエディタの設定などの基本的なPC操作に関しては,扱いません. それらが分からない方は,それらを自分で学習するか,それらを扱っている講義を履修してから受講することをおすすめします.</p>
<h2 data-number="1.1" id="本資料の読み方"><span class="header-section-number">1.1</span> 本資料の読み方</h2>
<p>(執筆中)</p>
<h2 data-number="1.2" id="haskellとは"><span class="header-section-number">1.2</span> Haskellとは</h2>
<p><a href="https://www.haskell.org"><code>Haskell</code></a>は,1987年に生まれた<strong>静的型付けの純粋関数型言語</strong>です. Haskellには,様々な特徴がありますが,本講義では,特に代数的データ型による,代数的なプログラミングに焦点をあてて,代数的な仕様記述とHaskellの関連を中心に議論します.</p>
<p>Haskellがどんな言語で,どのようなメリットがあるのか,という話は今後本講義でも扱いますが,ここでは深入りしません. 取り敢えず,どのような言語かを細かく説明する前に,関数型言語の雰囲気を掴んでもらおうと思います.</p>
<h2 data-number="1.3" id="関数型言語の雰囲気"><span class="header-section-number">1.3</span> 関数型言語の雰囲気</h2>
<p>HaskellはLispやOCamlなどと同じ関数型言語です.関数型言語は関数によってプログラムを構築していく点にありますが,近年ではこのスタイルは関数型言語の専売特許というわけではなくなりつつあり,関数で書くことの特別さは,薄れつつあります. なので,ここでは,関数型言語の細かい機能について見る前に,関数型言語の考え方について,手続き型言語との違いという観点で見ていきましょう.</p>
<p>関数型言語でプログラミングををするとは,<strong>｢それが何か｣</strong>を分解して書いていくことです.
関数型プログラミングが宣言的であると言われる所以はそこにあります.手続き型言語が,｢何をどうするのか｣という手続きを書くのにたいして,｢欲しいものはなにか｣を宣言します.</p>
<p>こちらの(Haskell界隈では)有名な<a href="https://bartoszmilewski.com/2014/11/04/category-the-essence-of-composition/">ブログ</a>では,関数型言語の考え方について以下のように説明しています.</p>
<blockquote>
<p>Functional programmers have a peculiar way of approaching problems. They start by asking very Zen-like questions. For instance, when designing an interactive program, they would ask: What is interaction? When implementing Conway’s Game of Life, they would probably ponder about the meaning of life.</p>
</blockquote>
<ul>
<li>翻訳(DeepL大先生)</li>
</ul>
<blockquote>
<p>関数型プログラマーは問題への取り組み方が独特だ. 禅問答のような質問から始めるのだ.例えば,インタラクティブなプログラムを設計するとき,彼らは「インタラクションとは何か?コンウェイの「人生ゲーム」を実装するとき,彼らはおそらく人生の意味について熟考するだろう.</p>
</blockquote>
<p>手続き型プログラミングと関数型プログラミングの違いは色々とありますが,取り敢えずここでは,この文章に習って</p>
<ul>
<li>関数型プログラミング: <strong>｢それが何か｣</strong>を問い,<strong>｢それが何か｣</strong>をプログラムする.</li>
</ul>
<p>という観点に注目します. 例として以下の｢ウサギの問題｣について考えてみましょう.</p>
<div class="note">
<p><strong>ウサギの問題</strong></p>
<ul>
<li><p>1つがいのウサギは,生まれてから2ヶ月後から毎月1つがいずつのウサギを産む</p></li>
<li><p>ウサギが死ぬことはない</p></li>
<li><p>この条件の下で,生まれたばかりの1つがいのウサギは1年の間に何つがいのウサギになるか</p></li>
</ul>
</div>
<p>これについて,取り敢えず12ヶ月までのつがいの数をプログラムを用いて計算してみましょう.</p>
<p>まずは手続き型の考え方で数を数えてみます. 手続き型言語的には,｢ウサギのつがいの数｣を｢どのように求めるのかという手続き｣をプログラムに記述します.</p>
<div class="note">
<details>
<summary>
note
</summary>
<p>学生にプログラミングを教えているとこれくらいのプログラムは,for文,if文,代入などの概念をちらっと読んだだけで簡単にできる人もいれば,数時間教えてもできない人もいます.これが何によって異なるのかというのは,長年の謎で,教育の難しいところです.</p>
<p>しかも,プログラムを教える人間は大抵前者なので,教師も学生も何が分からないのか分からないという事態によくなってしまいますね.</p>
<p>しかし,大抵の場合後者の人に話を聞いていくと,そもそもこの手続きを日本語であっても書けないという人が多いようです. なので,本当に苦労するタイプの人は,パワーポイントでウサギの絵を並べてルールにのっとってウサギが増えていく様子を小学生に教える日本語資料を作ってというような作業を一緒にすることになります.</p>
これを書きながらこういった学生が実は関数型なら簡単だったりしないだろうか,と考えていますが,楽観的に過ぎるだろうなという予感がしています.
</details>
</div>
<p>いろいろな方法がありますが手続き型言語っぽいフィボナッチ数の数え方を一つ考えると,例えば</p>
<div class="note">
<ul>
<li><p>つがいは,新生ウサギ(0ヶ月)→子供ウサギ(1ヶ月)→大人うさぎ(2ヶ月)の順で変化する</p></li>
<li><p>大人うさぎのつがいは毎月1つの新生うさぎのつがいを産む</p></li>
<li><p>0ヶ月の新生うさぎの(こどもが産めない),子供ウサギ,大人うさぎの数を記録する</p>
<ul>
<li>新生 1</li>
<li>子供 0</li>
<li>大人 0</li>
</ul></li>
<li><p>1月たつと</p>
<ul>
<li>大人と同じ数だけ新生が生まれる</li>
<li>子供が大人になる</li>
<li>新生が子供になる</li>
</ul></li>
<li><p>これを12ヶ月繰り返す</p></li>
</ul>
</div>
<p>というように｢何がどうなる｣という｢手順｣を書いた説明になるかと思います.
授業では大抵,これをフローチャートに書き直させて,フローチャートをプログラムに直すという作業をさせますが,そこは省略します.</p>
<p>これをPythonのプログラムにすると以下のようになり,結果は<code>233</code>となります.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 初期化</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>months <span class="op">=</span> <span class="dv">12</span>  <span class="co"># シミュレートする月数</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#1ヶ月目の状態</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>new_born_pairs <span class="op">=</span> <span class="dv">0</span> <span class="co">#新生のつがいの数</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>young_pairs <span class="op">=</span> <span class="dv">1</span>  <span class="co"># 子供のつがいの数</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>mature_pairs <span class="op">=</span> <span class="dv">0</span>  <span class="co"># 大人のつがいの数</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 各月におけるうさぎのつがいの数をシミュレート</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> month <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, months <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 大人と同じ数だけ新生が生まれる</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    new_born_pairs <span class="op">=</span> mature_pairs</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 子供が大人になる</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    mature_pairs <span class="op">+=</span> young_pairs</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 新生が子供になる</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    young_pairs <span class="op">=</span> new_born_pairs</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 成熟したつがいと若いつがいの合計</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>total_pairs <span class="op">=</span> mature_pairs <span class="op">+</span> young_pairs</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(total_pairs)</span></code></pre></div>
<p>こういった考え方が,いわゆる手続き型的な考え方とプログラミングの方法になります.</p>
<p>では,関数型の考え方とはどのようなものでしょうか. 先ほど引用したように,関数型では,それが何かを考えます.つまり,ここで問われている｢つがいの数｣を抽象化して,その特徴を記述するわけですね.</p>
<p>特定の数がなにかのルールに基づいて段々と増えていくというときに,それを並べてみて,法則性を探るということが一般的に行われます.これは,高校数学で扱う漸化式の考え方ですね.</p>
<p>月ごとのつがいの数を,並べてみると以下のようになります. そして,その増え方を計算してみると一定のルールに基づいていることが分かります.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">月</th>
<th style="text-align: center;">つがいの数</th>
<th style="text-align: center;">計算</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: center;">2</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">1 + 1</td>
</tr>
<tr class="even">
<td style="text-align: center;">3</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">1 + 2</td>
</tr>
<tr class="odd">
<td style="text-align: center;">4</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">2 + 3</td>
</tr>
<tr class="even">
<td style="text-align: center;">5</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">3 + 5</td>
</tr>
<tr class="odd">
<td style="text-align: center;">6</td>
<td style="text-align: center;">13</td>
<td style="text-align: center;">5 + 8</td>
</tr>
<tr class="even">
<td style="text-align: center;">7</td>
<td style="text-align: center;">21</td>
<td style="text-align: center;">8 + 13</td>
</tr>
<tr class="odd">
<td style="text-align: center;">8</td>
<td style="text-align: center;">34</td>
<td style="text-align: center;">13 + 21</td>
</tr>
<tr class="even">
<td style="text-align: center;">9</td>
<td style="text-align: center;">55</td>
<td style="text-align: center;">21 + 34</td>
</tr>
<tr class="odd">
<td style="text-align: center;">10</td>
<td style="text-align: center;">89</td>
<td style="text-align: center;">34 + 55</td>
</tr>
<tr class="even">
<td style="text-align: center;">11</td>
<td style="text-align: center;">144</td>
<td style="text-align: center;">55 + 89</td>
</tr>
<tr class="odd">
<td style="text-align: center;">12</td>
<td style="text-align: center;">233</td>
<td style="text-align: center;">89 + 144</td>
</tr>
</tbody>
</table>
<p>実はこのウサギのつがいの合計どの月でもは,1,1,2,3,5,8という風に前々月と前月のつがいの合計になることが知られています. このような,前の数字と前の前の数字の和によって次の数字を作る数をフィボナッチ数といいます.</p>
<div class="warn">
<p>※
普通フィボナッチ数というと,0から始まりますが,ここではウサギの例で考えたいので1から始まることにします.</p>
</div>
<p>フィボナッチ数を漸化式として捉えると,第n月のフィボナッチ数の正体は以下のように得られます.</p>
<div class="note">
<p><span class="math display">\[ F_0 = 1 \]</span>
<span class="math display">\[ F_1 = 1 \]</span>
<span class="math display">\[ F_n = F_{n-1} + F_{n-2} (n &gt;= 2)  \]</span></p>
</div>
<p>したがって,上の条件での12ヶ月後のウサギの数はなにかという問題は,フィボナッチ数の第12番めの項<span class="math inline">\(F_{12}\)</span>がなにかという問題であり,フィボナッチ数とはなにかといえば上の漸化式である,という風に考えることができます.</p>
<p>実際に計算手順を,一つひとつ追っていくのではなく,このように求めたい対象がなにかということを考えて,抽象化し記述するというのが,関数型言語の基本的な考え方になります.</p>
<p>ちなみに,これをHaskellで書くと以下のようになり,上の漸化式の書き方とかなり近い対応関係があることが分かります.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>fib <span class="dv">0</span> <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>fib <span class="dv">1</span> <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>fib n <span class="ot">=</span> fib (n <span class="op">-</span> <span class="dv">1</span>) <span class="op">+</span> fib (n <span class="op">-</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="warn">
<p>※メモ化とかそういったことは,取り敢えずここでは置いておきます.
(この辺の数学的定義そのままだと,実用には向かない問題は,後ほど扱います.)</p>
</div>
<p>これを実行してみると確かに正しい数が求められています.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ghci</span><span class="op">&gt;</span> :{</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">ghci</span><span class="kw">|</span> <span class="ex">fib</span> :: Int <span class="at">-</span><span class="op">&gt;</span> Int</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ex">ghci</span><span class="kw">|</span> <span class="ex">fib</span> 0 = 1</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="ex">ghci</span><span class="kw">|</span> <span class="ex">fib</span> 1 = 1</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="ex">ghci</span><span class="kw">|</span> <span class="ex">fib</span> n = fib <span class="er">(</span><span class="ex">n-1</span><span class="kw">)</span> <span class="ex">+</span> fib <span class="er">(</span><span class="ex">n-2</span><span class="kw">)</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="ex">ghci</span><span class="kw">|</span> <span class="ex">:}</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="ex">ghci</span><span class="op">&gt;</span> fib 12</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="ex">233</span></span></code></pre></div>
<p>当然フィボナッチ数の漸化式は広く知られていますし, むしろ最初から漸化式として学習することが多いでしょう. したがって, Pythonでの実装もフィボナッチ数が漸化式であるという前提で,以下のように書くほうが一般的です.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Fib(n):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> n <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Fib(n<span class="op">-</span><span class="dv">1</span>) <span class="op">+</span> Fib(n<span class="op">-</span><span class="dv">2</span>)</span></code></pre></div>
<p>また,最近では,PythonやJavaScriptなどの手続き型の言語にも,関数型の考え方が導入され,内包表記,再帰,ラムダ式などの関数型のシンタックスも一般的に使われるようになっています(これらの詳細についてはこのあとやっていきます).逆にHaskell等の関数型言語においても,手続き型のほうが便利な場合には手続き型の記法を利用します.</p>
<p>したがって,現在では関数型的な考え方と,手続き型の考え方というのは,それほど明確に分かれるものではありません.</p>
<p>ここでは,手続き型の考え方と関数型の考え方の違いを説明するために,Pythonの事例をあえてあまり用いられない方法で書きましたが,大げさに書けば手続き型と関数型の考え方の違いとはこのような考え方,問題へのアプローチの仕方にあります.</p>
<h2 data-number="1.4" id="関数型だと何が嬉しいのか"><span class="header-section-number">1.4</span> 関数型だと何が嬉しいのか</h2>
<p>前節では,関数型の考え方に関して簡単な事例をしましました. 関数型の考え方がしっくり来る人は,それが関数型を使う理由になるでしょうが,しっくり来るという抽象的な話ではなく,具体的な関数型言語のメリット/デメリットをこの節では紹介します. なお,関数型言語と一言でいっても,様々な言語がありますし,前述のように手続き型と関数型が明確に分かれる時代でもありません.</p>
<p>関数型言語の設計仕様は,関数型です. 手続き型言語の仕様定義にもいろいろな種類があります.</p>
<p>(執筆中)
例の論文のまとめ</p>
<p>厳密な仕様記述を書くとプログラムと1体1対応になる.そもそもHaskellで書けばプログラムと仕様が対応関係を持つようになりますし,数式への変換も容易です.</p>
<p>そういった意図もあり,私が内閣府で統計作成を市ていた時代には, 数式による定義,とプログラムのペアを対応付けたOSSとして基幹統計を開発することを提唱していましたが,それは色々な制約でまだ実現していません.</p>
<h2 data-number="1.5" id="設計も関数型で"><span class="header-section-number">1.5</span> 設計も関数型で</h2>
<p>(執筆中)</p>
<h3 data-number="1.5.1" id="雑談なんでhaskell"><span class="header-section-number">1.5.1</span> 雑談:なんでHaskell?</h3>
<p>(執筆中)</p>
</details>
<h1 data-number="2" id="haskellセットアップ"><span class="header-section-number">2</span> Haskellセットアップ</h1>
<details>
<summary>
開く/閉じる
</summary>
<p>言語の特徴や意味を色々と説明してきましたが,習うより慣れろということで,そろそろHaskellを利用してみましょう.Haskell Haskellの開発環境には様々なものがありますが,現在良く使われているものとして<a href="https://www.haskell.org/cabal/">Cabal</a> + <a href="https://www.haskell.org/ghcup/">GHCup</a>あるいは<a href="https://docs.haskellstack.org/en/stable/">Stack</a>の2つがあります. CabalとStackはプロジェクトのビルドを行うためのアーキテクチャであり,GHCupは周辺環境のインストーラーです. どちらで開発を行ってもいいのですが,本稿ではStackを用います.</p>
<p>Stackは現在のHaskellの標準的なコンパイラである,Glasgow Haskell Compiler（GHC）に基づいたビルド環境である.(cabalもGHCですが). 他の言語と同様にHaskellでも様々なpackage(ライブラリ)を利用するのですが,package毎に他のpackageや,GHC(Haskellのコンパイラ)との依存関係があります.それらを使用するpackage事に調整することが人間には至難の業であり, 特定のpackageの依存関係を満たせば他のpackageの依存関係が満たされなくなるという試行錯誤を永遠と繰り返すことを<code>cabal hell</code>などと呼びます.</p>
<p>Stackにはそのようなpackage間の依存関係を満たすバージョンの組み合わせ(resolver)を利用して,自動で解決してくれる機能があり,Haskellでのブロジェクトの開発を容易にしてくれます. resolverの集まりを<a href="https://www.stackage.org">Stackage</a>といい, resolverで扱われるpackageをまとめて管理するレポジトリのことを<a href="https://hackage.haskell.org">Hackage</a>といいます.</p>
<h2 data-number="2.1" id="環境構築"><span class="header-section-number">2.1</span> 環境構築</h2>
<p>Stackの環境構築の方法は基本的には,<a href="https://docs.haskellstack.org/en/stable/">公式サイト</a>に従ってください. 使用しているOS毎にインストール方法が異なるので注意しましょう特にMacユーザーはIntel Mac と Apple silliconでインストール方法が異なるので正しい方を選択するようにしてください.</p>
<p>インストールが終わったら,以下のコマンドでstackを最新版にupgradeします.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">stack</span> upgrade</span></code></pre></div>
<p>次に,開発用のディレクトリに移動して,開発用のプロジェクトを作成していきます. Stackでは,新しいプロジェクトの作成は<code>stack new [project-name]</code> コマンドで行われます. <code>stack new [project-name]</code>コマンドで新しいプロジェクトを作成すると,必要なファイルが含まれた<code>[project-name]</code>という名前のディレクトリが作成されます. 作成されたディレクトリに移動しましょう.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> ls</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> stack <span class="ex">new</span> hello-world</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> ls</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="ex">hello-world</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> cd <span class="ex">hello-world</span></span></code></pre></div>
<p>作成されたディレクトリの構成は以下のようになっています.</p>
<pre><code>.
├── app
│    └── Main.hs
├── src
│    └── Lib.hs
├── test
│   └── Spec.hs
├── hello-world.cabal
├── package.yaml
└── stack.yaml
</code></pre>
<p>それぞれの用途と意味は以下のとおりです.</p>
<div class="note">
<ul>
<li><p><code>app</code>フォルダの中には,実行可能ファイル用のプログラム</p>
<ul>
<li><p>プロジェクトをbuildすると,<code>Main.hs</code>から実行可能ファイル(executable)が生成されます</p></li>
<li><p>この後,<code>Main.hs</code>の中身を編集して<code>Hello World</code>用のプログラムを作成します.</p></li>
</ul></li>
<li><p><code>src</code>フォルダ内には,実行可能ファイルで利用するライブラリが格納されます.</p>
<ul>
<li>ここに自分で開発したライブラリを含めることも可能です.</li>
</ul></li>
<li><p><code>package.yaml</code>ファイルはプロジェクトの設定を記入するファイルです.</p>
<ul>
<li><p>Hackageなどの外部のライブラリを利用する場合には,<code>package.yaml</code>内の<code>dependencies:</code>部分に,使用したいライブラリを記述します.</p></li>
<li><p>Stackは<code>stack setup</code>コマンドによって,package.yaml内に記述されたライブラリの依存関係を解決するresolverを自動で選択しますが,
自分で使いたいresolverを<code>package.yaml</code>内の<code>resolver:</code>に続けて書くことで,指定することも可能です.</p></li>
<li><p>その他実行可能ファイルの設定や,コンパイルオプションなどを指定することができます.</p></li>
<li><p><code>package.yaml</code> の設定に従って,プロジェクトの設定ファイル <code>test.cabal</code>が自動で作成されます.
基本的にstackを使っている範囲では<code>.cabal</code>ファイルを自分で編集することはありません.</p></li>
</ul></li>
<li><p><code>stack.yaml</code>ファイルは,stackの設定を記入します</p>
<ul>
<li>resolverに含まれないライブラリ(自分のGitHub上にあるライブラリなど)を指定する,あるいはあえてresolverとは異なるバージョンを利用するときなどには
<code>extra-deps:</code>に続けて,使用したいライブラリのレポジトリやバージョンを明示します.</li>
</ul></li>
</ul>
</div>
<p>これらの利用法は,今後ライブラリを使用し始めたときに改めて学習すれば大丈夫ですが,取り敢えずプログラムを作成してきましょう.</p>
<p><code>app/Main.hs</code>をテキストエディタで開いて編集していきましょう.</p>
<p><code>app/Main.hs</code>を開くと,以下のようなファイル担っているかと思います. Haskellのプログラムをコンパイルした実行可能ファイルでは,<code>main =</code> 内の記述が実行されます.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> <span class="dt">Main</span> (main) <span class="kw">where</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Lib</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> someFunc</span></code></pre></div>
<p>現在は<code>sumFunc</code>という関数が実行されます. <code>sumFunc</code>は <code>import Lib</code> の記述によって, <code>src/Lib.hs</code>からimportされています. <code>src/Lib.hs</code>を開くと,</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> <span class="dt">Lib</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    ( someFunc</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    ) <span class="kw">where</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="ot">someFunc ::</span> <span class="dt">IO</span> ()</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>someFunc <span class="ot">=</span> <span class="fu">putStrLn</span> <span class="st">&quot;someFunc&quot;</span></span></code></pre></div>
<p>という風に<code>someFunc</code>が定義されています. プログラム内の <code>someFunc :: IO ()</code> は<code>someFunc</code>の型注釈です. <code>IO ()</code> というのは,標準入出力 <code>IO</code> において, アクション <code>()</code> を実行するという意味ですが,ここではそれぞれの詳細は省きます. <code>putStrLn</code> は文字列を引数にとり,標準入出力<code>IO</code>に受け取った文字列を出力するというアクション<code>()</code>を返す関数であり,ここでは,<code>"someFunc"</code>という文字列が出力されます. この<code>"someFunc"</code> 部分を <code>"Hello World"</code>に書き換えれば,Hello Worldは実行できます.関数の定義はこのあと徐々に扱いますが, someFuncは,引数を取らないので関数というよりは実際には値です.</p>
<p><code>Lib.hs</code> に<code>helloWorld</code>と出力する値<code>helloWorld</code>を追加し,全体を以下のように書き換えましょう.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> <span class="dt">Lib</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    ( someFunc</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    , helloWorld</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    ) <span class="kw">where</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="ot">someFunc ::</span> <span class="dt">IO</span> ()</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>someFunc <span class="ot">=</span> <span class="fu">putStrLn</span> <span class="st">&quot;someFunc&quot;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="ot">helloWorld ::</span> <span class="dt">IO</span> ()</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>helloWorld <span class="ot">=</span> <span class="fu">putStrLn</span> <span class="st">&quot;Hello World&quot;</span></span></code></pre></div>
<p><code>module Lib () where</code> はモジュール宣言で,他のプログラムから<code>import Lib</code>で,<code>src/Lib.hs</code>内に定義された関数や値などの内 <code>()</code>内に記述されたものを読み込むことができるようにします.
作成した値<code>helloWorld</code>を<code>()</code>内に<code>helloWorld</code>を追加することを忘れないようにしましょう.</p>
<p>併せて <code>app/Main.hs</code> を書き換えて,作成した<code>helloWorld</code>を実行しましょう.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> <span class="dt">Main</span> (main) <span class="kw">where</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Lib</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> helloWorld</span></code></pre></div>
<p>このプログラムをコンパイルして得られる実行可能ファイルの名前などは,<code>package.yaml</code>内で定義されています.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ghc-options</span><span class="kw">:</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> -Wall</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> -Wcompat</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> -Widentities</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> -Wincomplete-record-updates</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> -Wincomplete-uni-patterns</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> -Wmissing-export-lists</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> -Wmissing-home-modules</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> -Wpartial-fields</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> -Wredundant-constraints</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span><span class="kw">:</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">source-dirs</span><span class="kw">:</span><span class="at"> src</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="fu">executables</span><span class="kw">:</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">hello-world-exe</span><span class="kw">:</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">main</span><span class="kw">:</span><span class="at">                Main.hs</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">source-dirs</span><span class="kw">:</span><span class="at">         app</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ghc-options</span><span class="kw">:</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> -threaded</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> -rtsopts</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> -with-rtsopts=-N</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> hello-world</span></span></code></pre></div>
<p><code>ghc-options:</code> 以下の項目はghcのコンパイルオプションであり,<code>W</code>で始まるいずれのオプションもコンパイル時の<code>Warning</code>を追加するものである. これらのコンパイルオプションがあると,プログラムの品質を高めることができるが, 利用していてWarningが邪魔に感じた場合は,すべて削除しても問題ありません(
その場合は以下のように,<code>ghc-options:</code>部分を<code>#</code>でコメントアウトしてください.)</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ghc-options:</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span><span class="kw">:</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">source-dirs</span><span class="kw">:</span><span class="at"> src</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">executables</span><span class="kw">:</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">hello-world-exe</span><span class="kw">:</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">main</span><span class="kw">:</span><span class="at">                Main.hs</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">source-dirs</span><span class="kw">:</span><span class="at">         app</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ghc-options</span><span class="kw">:</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> -threaded</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> -rtsopts</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> -with-rtsopts=-N</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> hello-world</span></span></code></pre></div>
<p>特に,本講義資料では,品質よりも分かりやすさを優先してできるだけシンプルな実装を紹介する他,事例としてあえて間違ったコードを入力する場面も存在する. そのままサンプルを入力すると多数のWarningが表示されることになるので,以下の説明中で登場する出力結果ではこれらのオプションはすべて切った状態のものとなっている点に留意していただきたい.</p>
<p><code>library:</code>以下の記述で,利用するライブラリのPATH,<code>executables:</code>以下の記述で実行可能ファイルについて記述されています. ここでは, executableとして’app’フォルダ内にある’Main.hs’が’hello-world-exe’という名称でコンパイルされることが書かれています.<code>ghc-options:</code>以下は,コンパイル時のオプションを設定していますが,ここでは詳細は省略します.</p>
<p><code>Main.hs</code>以外のファイルをここに追加すれば,いくらでも実行可能ファイルは増やすことができます.</p>
<p><code>hello-world-exe</code>部分をもっと短い名前に変更することも可能です.なお生成される実行可能ファイルはMacでは<code>hello-world-exe</code>,Windowsでは<code>hello-world-exe.exe</code>になるので注意してください.</p>
<p>それでは,以下のコマンドでこのプロジェクトをbuildして,実行してみましょう.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">stack</span> build</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="ex">stack</span> exec hello-world-exe</span></code></pre></div>
<p><code>stack build</code>のあと,プログラムにミスがなければ以下のように出力されるはずです(一部省略しています).</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> stack build</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ex">hello-world</span><span class="op">&gt;</span> build <span class="er">(</span><span class="ex">lib</span> + exe<span class="kw">)</span> <span class="ex">with</span> ghc-9.6.4</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Preprocessing</span> library for hello-world-0.1.0.0..</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Building</span> library for hello-world-0.1.0.0..</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="ex">[1</span> of 2] Compiling Lib [Source file changed]</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Preprocessing</span> executable <span class="st">&#39;hello-world-exe&#39;</span> for hello-world-0.1.0.0..</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Building</span> executable <span class="st">&#39;hello-world-exe&#39;</span> for hello-world-0.1.0.0..</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="ex">[1</span> of 2] Compiling Main [Source file changed]</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="ex">[3</span> of 3] Linking .stack-work/dist/x86_64-osx/ghc-9.6.4/build/hello-world-exe/hello-world-exe [Objects changed]</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="ex">hello-world</span><span class="op">&gt;</span> copy/register</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Registering</span> library for hello-world-0.1.0.0..</span></code></pre></div>
<p>どこかで,タイプミスなどがあると例えば以下のようなエラーが表示される可能性もあります(一部省略しています).</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">hello-world</span><span class="op">&gt;</span> build <span class="er">(</span><span class="ex">lib</span> + exe<span class="kw">)</span> <span class="ex">with</span> ghc-9.6.4</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Preprocessing</span> library for hello-world-0.1.0.0..</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Building</span> library for hello-world-0.1.0.0..</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Preprocessing</span> executable <span class="st">&#39;hello-world-exe&#39;</span> for hello-world-0.1.0.0..</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Building</span> executable <span class="st">&#39;hello-world-exe&#39;</span> for hello-world-0.1.0.0..</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="ex">[1</span> of 2] Compiling Main [Source file changed]</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="ex">/Users/akagi/Documents/Programs/Haskell/blog/hello-world/app/Main.hs:6:8:</span> error: <span class="pp">[</span><span class="ss">GHC</span><span class="pp">-</span><span class="ss">88464</span><span class="pp">]</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Variable</span> not in scope: hellWorld :: IO <span class="er">(</span><span class="kw">)</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Suggested</span> fix: Perhaps use ‘helloWorld’ <span class="er">(</span><span class="ex">imported</span> from Lib<span class="kw">)</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">|</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span> <span class="kw">|</span> <span class="ex">main</span> = hellWorld</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">|</span>        <span class="ex">^^^^^^^^^</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Error:</span> <span class="pp">[</span><span class="ss">S</span><span class="pp">-</span><span class="ss">7282</span><span class="pp">]</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>       <span class="ex">Stack</span> failed to execute the build plan.</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>       <span class="ex">While</span> executing the build plan, Stack encountered the error:</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>       <span class="ex">[S-7011]</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>       <span class="ex">While</span> building package hello-world-0.1.0.0</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>       <span class="ex">Process</span> exited with code: ExitFailure 1</span></code></pre></div>
<p>上のエラーでは, <code>Main.hs</code>の6行目で使用されている,<code>hellWorld</code>が定義されていないという意味になります.
<code>helloWorld</code>と<code>o</code>を追加して正しい名称にしたあともう一度 <code>stack build</code>をしてみましょう.</p>
<p><code>stack exec hello-world-exe</code>の後,<code>Hello World</code>と出力されていれば成功です.</p>
<p>なお,build と exec を併せて一つのコマンド<code>stack run</code> で代替することも可能です.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> stack run hello-world-exe</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="ex">hello-world</span><span class="op">&gt;</span> build <span class="er">(</span><span class="ex">lib</span> + exe<span class="kw">)</span> <span class="ex">with</span> ghc-9.6.4</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Preprocessing</span> library for hello-world-0.1.0.0..</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Building</span> library for hello-world-0.1.0.0..</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Preprocessing</span> executable <span class="st">&#39;hello-world-exe&#39;</span> for hello-world-0.1.0.0..</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Building</span> executable <span class="st">&#39;hello-world-exe&#39;</span> for hello-world-0.1.0.0..</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="ex">hello-world</span><span class="op">&gt;</span> copy/register</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Registering</span> library for hello-world-0.1.0.0..</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Hello</span> World</span></code></pre></div>
</details>
<h1 data-number="3" id="haskellを使ってみよう"><span class="header-section-number">3</span> Haskellを使ってみよう</h1>
<details>
<summary>
開く/閉じる
</summary>
<h2 data-number="3.1" id="ghci"><span class="header-section-number">3.1</span> ghci</h2>
<p>前節では, Stackを利用した,プロジェクトの作成と実行に関して扱いましたが, Haskellにも対話環境が存在します.
<code>stack ghci</code>コマンドを打つことで, Haskellの対話環境が立ち上がります.</p>
<p>この節では,Haskellの基礎について学びますが,ghciの紹介も併せて,いくつかの基礎的な仕様については,ghci上で確認してみましょう.</p>
<h2 data-number="3.2" id="終了"><span class="header-section-number">3.2</span> 終了</h2>
<p>ghciではコマンドを<code>:</code>の後に入力します. ghciの終了コマンドは<code>:q</code>です.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">❯</span> stack ghci</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="ex">ghci</span><span class="op">&gt;</span>:q</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Leaving</span> GHCi.</span></code></pre></div>
<h2 data-number="3.3" id="コメントアウト"><span class="header-section-number">3.3</span> コメントアウト</h2>
<p>Haslellではコメントアウトは <code>--</code> です. 複数行に渡る場合は <code>{- -}</code> で囲みます.</p>
<div class="warn">
<p>Haskellのプログラムを読んでいると <code>--|</code> や <code>--^</code> というタイプのコメントを良く見ますが, こちらはHaskellのドキュメント生成ライブラリにおいて, ドキュメント中に説明として記述するための記号です.
またコメント中に <code>&gt;&gt;&gt;</code> と記述することでテストが実装できるなどいろいろなものがありますが,本資料では扱いません.</p>
</div>
<div class="sourceCode" id="cb19"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="co">-- コメント</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="co">{- コメント-}</span></span></code></pre></div>
<h2 data-number="3.4" id="複数行モード"><span class="header-section-number">3.4</span> 複数行モード</h2>
<p>ghci上で複数行のプログラムを書く場合には <code>:{ :}</code> でプログラムを囲います. 例えば,先程のフィボナッチ数のプログラムをghci上で実行する場合,位置行ずつ定義すると,定義が更新されてき最後の <code>f n = f (n-1) + f (n-2)</code>のみが記憶されます. この場合,<code>n</code>は無限にマイナスに続いていくため,<code>Stack Overflow</code>エラーが表示されます.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> fib <span class="dv">0</span> <span class="ot">=</span> <span class="dv">1</span> <span class="co">-- fの定義が上書きされる</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> fib <span class="dv">1</span> <span class="ot">=</span> <span class="dv">1</span> <span class="co">-- fの定義が上書きされる</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> f n <span class="ot">=</span> f (n<span class="op">-</span><span class="dv">1</span>) <span class="op">+</span> f (n<span class="op">-</span><span class="dv">2</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> f <span class="dv">12</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="op">***</span> <span class="dt">Exception</span><span class="op">:</span> stack overflow</span></code></pre></div>
<p><code>:{ :}</code>で囲むことでひとまとまりの定義として認識されます.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="op">:</span>{</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">|</span><span class="ot"> fib ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">|</span> fib <span class="dv">0</span> <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">|</span> fib <span class="dv">1</span> <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">|</span> fib n <span class="ot">=</span> fib (n<span class="op">-</span><span class="dv">1</span>) <span class="op">+</span> fib (n<span class="op">-</span><span class="dv">2</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">|</span> <span class="op">:</span>}</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> fib <span class="dv">12</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="dv">233</span></span></code></pre></div>
<p>なお,スクリプトの場合は,<code>:{ :}</code>なしでそのまま改行すれば問題ありません.</p>
<h2 data-number="3.5" id="データ型"><span class="header-section-number">3.5</span> データ型</h2>
<p>型に関しては,かなり奥が深い,というよりHaskellの面白さは自分で型を作っていくことにあります. ただ,いきなりそれをすると,わけがわからなくなるのでまずは代数的データ型などには触れず以下の基礎的な型に関して説明します.</p>
<div class="note">
<ul>
<li>数値型
<ul>
<li>整数 (Int, Integer)</li>
<li>実数 (Float,Double)</li>
</ul></li>
<li>タプル</li>
<li>リスト (List)</li>
<li>文字,文字列 (Char,String,Text)</li>
<li>論理型(Bool)</li>
</ul>
</div>
<p>Haskellにおいて,値のデータ型はある程度自動推論されますが,特定のデータ型を明示したい場合には,値の後ろに<code>:: データ型</code>をつけます.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">1</span><span class="ot"> ::</span> <span class="dt">Int</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">1</span><span class="ot"> ::</span> <span class="dt">Double</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fl">1.0</span></span></code></pre></div>
<p><code>ghci</code>において形の確認は<code>:t</code>あるいは<code>:type</code>コマンドの後ろに確認したいデータを入力することで行えます.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="op">:</span>t <span class="ch">&#39;c&#39;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="ch">&#39;c&#39;</span><span class="ot"> ::</span> <span class="dt">Char</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="op">:</span><span class="kw">type</span> (<span class="dv">1</span><span class="ot"> ::</span> <span class="dt">Int</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span><span class="ot"> ::</span> <span class="dt">Int</span>)<span class="ot"> ::</span> <span class="dt">Int</span></span></code></pre></div>
<h3 data-number="3.5.1" id="数値型"><span class="header-section-number">3.5.1</span> 数値型</h3>
<p>Haskellの基本的な数値型には以下の4つがあります.</p>
<table>
<thead>
<tr class="header">
<th>型</th>
<th>意味</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>Int</code></td>
<td>固定長整数型</td>
</tr>
<tr class="even">
<td><code>Integer</code></td>
<td>多倍長整数型</td>
</tr>
<tr class="odd">
<td><code>Float</code></td>
<td>単精度浮動小数型</td>
</tr>
<tr class="even">
<td><code>Double</code></td>
<td>倍精度浮動小数型</td>
</tr>
</tbody>
</table>
<p><code>Int</code>と<code>Integer</code>は<code>整数</code>, <code>Float</code>と<code>Double</code>は<code>実数</code>を表しています.</p>
<p><code>固定長/多倍長</code>, <code>単精度/倍精度</code> というのはどういう意味でしょうか?</p>
<p>コンピューターでは,データはすべて<code>0</code>と<code>1</code>のいずれかを表す<code>bit</code>の集まりによって表現されます. ちなみに<code>8bit</code>で<code>1byte</code>, <code>1024byte</code>で<code>1Kbyte</code>です.したがって,プログラミングで扱うデータに使用できるデータ量には制限があり,無限の長さの整数や少数を利用することはできません.</p>
<p>コンピューターの計算は主に中央演算処理装置(CPU)で行われますが,その計算過程でデータを一時的に記録するCPU内部の装置のことを汎用レジスタといい,現在では<code>64bit</code>以下の汎用レジスタを持った<code>64bit CPU</code>が良く利用されています.</p>
<p>現在一般的な<code>64bit CPU</code>においてHaskellは整数と小数を表すのに一般的に最大<code>64bit</code>の領域を確保します. したがって,整数では64bitで表せるデータ量(<code>-9223372036854775808 ~ 9223372036854775807</code>)を超えた整数を扱うことはできません.</p>
<p>ちなみにIntの最大値,最小値はghciで以下のように確認できます(
使用しているコンピューターによっては結果が変わる可能性があります).</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span><span class="ot"> minBound ::</span> <span class="dt">Int</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="op">-</span><span class="dv">9223372036854775808</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span><span class="ot"> maxBound ::</span> <span class="dt">Int</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="dv">9223372036854775807</span></span></code></pre></div>
<p>最大(小)値を超えるとオーバーフローします.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">9223372036854775807</span><span class="ot"> ::</span> <span class="dt">Int</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="dv">9223372036854775807</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> (<span class="dv">9223372036854775807</span> <span class="op">+</span> <span class="dv">1</span>)<span class="ot"> ::</span> <span class="dt">Int</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="op">-</span><span class="dv">9223372036854775808</span></span></code></pre></div>
<p>Haskellにおける数値型の基本的な演算子は以下のように定義されています. 実数と整数で挙動が異なるものがあるので注意が必要です.</p>
<p>演算子には優先順位が設定されており,数字が大きいものから順に適用されます(最小0,最大9).
また,式を<code>()</code>で囲むことで,その内部が優先的に計算されます.</p>
<p>また,<code>()</code>が式の最後に来る場合には<code>$</code>記号以下が<code>()</code>に囲まれているとみなすことができます.</p>
<table>
<thead>
<tr class="header">
<th>計算</th>
<th>記号</th>
<th>優先順</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>足し算</td>
<td><code>+</code></td>
<td>6</td>
</tr>
<tr class="even">
<td>引き算</td>
<td><code>-</code></td>
<td>6</td>
</tr>
<tr class="odd">
<td>掛け算</td>
<td><code>*</code></td>
<td>7</td>
</tr>
<tr class="even">
<td>割り算</td>
<td><code>/</code></td>
<td>7</td>
</tr>
<tr class="odd">
<td>冪乗(整数)</td>
<td><code>^</code></td>
<td>8</td>
</tr>
<tr class="even">
<td>冪乗(実数)</td>
<td><code>**</code></td>
<td>8</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb26"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">3</span> <span class="op">*</span> <span class="dv">3</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">9</span> <span class="op">/</span> <span class="dv">3</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="fl">3.0</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">3</span> <span class="op">^</span> <span class="dv">3</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="dv">27</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">3</span> <span class="op">**</span> <span class="dv">3</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="fl">27.0</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">3</span> <span class="op">^</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="co">-- エラー</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>interactive<span class="op">&gt;:</span><span class="dv">7</span><span class="op">:</span><span class="dv">3</span><span class="op">:</span> <span class="fu">error</span><span class="op">:</span> [<span class="dt">GHC</span><span class="op">-</span><span class="dv">39999</span>]</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">3</span> <span class="op">**</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="fl">1.7320508075688772</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">2</span> <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">2</span> <span class="op">*</span> (<span class="dv">3</span> <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">2</span> <span class="op">*</span> <span class="op">$</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span></span></code></pre></div>
<p>これらは中置演算子として定義されていますが演算子を<code>()</code>で囲むことによって前置(逆ポーランド記法)で利用することができます.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> (<span class="op">+</span>) <span class="dv">3</span> <span class="dv">4</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> (<span class="op">*</span>) ((<span class="op">+</span>) <span class="dv">3</span> <span class="dv">4</span>) <span class="dv">2</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="dv">14</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> (<span class="op">*</span>) <span class="dv">2</span> <span class="op">$</span> (<span class="op">+</span>) <span class="dv">3</span> <span class="dv">4</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="dv">14</span></span></code></pre></div>
<p>また, 2引数関数として定義された前置の演算子は <code>``</code> (バッククオート)で囲むことで, 中置演算子として利用できます.</p>
<table>
<thead>
<tr class="header">
<th>計算</th>
<th>記号</th>
<th>優先順</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>整数除算</td>
<td><code>div</code></td>
<td>7</td>
</tr>
<tr class="even">
<td>剰余</td>
<td><code>mod</code></td>
<td>6</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb28"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">5</span> <span class="op">/</span><span class="dv">2</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fl">2.5</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="fu">div</span> <span class="dv">5</span> <span class="dv">2</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">5</span> <span class="ot">`div`</span> <span class="dv">2</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">5</span> <span class="ot">`mod`</span> <span class="dv">2</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span></span></code></pre></div>
<div class="note">
<p>練習問題</p>
</div>
<h3 data-number="3.5.2" id="リスト"><span class="header-section-number">3.5.2</span> リスト</h3>
<p>複数のデータをまとめる方法はいくつかありますが,データを1列に並べた<code>List</code>型は代表的なデータ型です. Haskellには配列もありますが,Listの方がよく利用されます.
リストの操作にはここで扱う以外にも<code>リスト内包表記</code>や<code>高階関数</code>など様々なものがありますが,ここでは最も基本的ないくつかの機能のみに絞って,後ほど詳細を扱います.</p>
<p>Listはリストリテラル<code>[]</code>の中に要素を記入して,<code>,</code>(コンマ)で区切ることで宣言できます.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span></code></pre></div>
<p><code>[]</code>のみで空のリストが生成されます.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> []</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>[]</span></code></pre></div>
<p>注意点として,HaskellはPythonなどの言語のように<code>ダックタイピング</code>が許されていないため異なるデータを単一のリストの要素に含めることはできません.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> [<span class="dv">1</span>,<span class="fl">2.0</span>,<span class="dv">3</span>]</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>[<span class="fl">1.0</span>,<span class="fl">2.0</span>,<span class="fl">3.0</span>]</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> [<span class="dv">1</span><span class="ot">::</span><span class="dt">Int</span>,<span class="dv">2</span><span class="ot">::</span><span class="dt">Double</span>,<span class="dv">3</span><span class="ot">::</span><span class="dt">Int</span>]</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>interactive<span class="op">&gt;:</span><span class="dv">22</span><span class="op">:</span><span class="dv">9</span><span class="op">:</span> <span class="fu">error</span><span class="op">:</span> [<span class="dt">GHC</span><span class="op">-</span><span class="dv">83865</span>]</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">Couldn&#39;t</span> match expected <span class="kw">type</span> ‘<span class="dt">Int</span>’ with actual <span class="kw">type</span> ‘<span class="dt">Double</span>’</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">In</span> the expression<span class="op">:</span> <span class="dv">2</span><span class="ot"> ::</span> <span class="dt">Double</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">In</span> the expression<span class="op">:</span> [<span class="dv">1</span><span class="ot"> ::</span> <span class="dt">Int</span>, <span class="dv">2</span><span class="ot"> ::</span> <span class="dt">Double</span>, <span class="dv">3</span><span class="ot"> ::</span> <span class="dt">Int</span>]</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">In</span> an equation for ‘it’<span class="op">:</span> it <span class="ot">=</span> [<span class="dv">1</span><span class="ot"> ::</span> <span class="dt">Int</span>, <span class="dv">2</span><span class="ot"> ::</span> <span class="dt">Double</span>, <span class="dv">3</span><span class="ot"> ::</span> <span class="dt">Int</span>]</span></code></pre></div>
<p>リストのデータ型は,要素のデータ型をリストリテラル<code>[]</code>で囲んだ形で表されます.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="op">:</span><span class="kw">type</span> ([<span class="dv">1</span><span class="ot">::</span><span class="dt">Int</span>,<span class="dv">2</span><span class="ot">::</span><span class="dt">Int</span>])</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>([<span class="dv">1</span><span class="ot">::</span><span class="dt">Int</span>,<span class="dv">2</span><span class="ot">::</span><span class="dt">Int</span>])<span class="ot"> ::</span> [<span class="dt">Int</span>]</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="op">:</span><span class="kw">type</span> [<span class="ch">&#39;a&#39;</span>,<span class="ch">&#39;b&#39;</span>,<span class="ch">&#39;c&#39;</span>]</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>[<span class="ch">&#39;a&#39;</span>,<span class="ch">&#39;b&#39;</span>,<span class="ch">&#39;c&#39;</span>]<span class="ot"> ::</span> [<span class="dt">Char</span>]</span></code></pre></div>
<p>また,リストは<code>先頭要素 : リスト</code> によって宣言することも可能です. <code>:</code>を<code>cons 構築子</code>といいます. 構築子の意味については後ほど<code>代数的データ型</code>の説明とともに扱います.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">1</span> <span class="op">:</span> []</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>]</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">1</span> <span class="op">:</span> [<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">2</span> <span class="op">:</span> [<span class="dv">3</span>]</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span></code></pre></div>
<p>リストの要素のインデックスによる取得は <code>!!</code>演算子を用いて<code>xs !! インデックス</code>の形で行います. インデックスは0から始まります. インデックスが超過した場合はエラーとなります.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>] <span class="op">!!</span> <span class="dv">0</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>] <span class="op">!!</span> <span class="dv">1</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>] <span class="op">!!</span> <span class="dv">2</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>] <span class="op">!!</span> <span class="dv">3</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="op">***</span> <span class="dt">Exception</span><span class="op">:</span> <span class="op">Prelude.!!:</span> <span class="fu">index</span> too large</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="dt">CallStack</span> (from <span class="dt">HasCallStack</span>)<span class="op">:</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">error</span>, called at libraries<span class="op">/</span>base<span class="op">/</span><span class="dt">GHC</span><span class="op">/</span>List.hs<span class="op">:</span><span class="dv">1366</span><span class="op">:</span><span class="dv">14</span> <span class="kw">in</span> base<span class="op">:</span><span class="dt">GHC.List</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  tooLarge, called at libraries<span class="op">/</span>base<span class="op">/</span><span class="dt">GHC</span><span class="op">/</span>List.hs<span class="op">:</span><span class="dv">1376</span><span class="op">:</span><span class="dv">50</span> <span class="kw">in</span> base<span class="op">:</span><span class="dt">GHC.List</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">!!</span>, called at <span class="op">&lt;</span>interactive<span class="op">&gt;:</span><span class="dv">37</span><span class="op">:</span><span class="dv">9</span> <span class="kw">in</span> interactive<span class="op">:</span><span class="dt">Ghci15</span></span></code></pre></div>
<p><code>m~n</code>までの連続したリストを生成する場合には,<code>[m..n]</code>と記述します.これを<code>数列表記</code>といいます.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> [<span class="dv">1</span> <span class="op">..</span> <span class="dv">10</span>]</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>]</span></code></pre></div>
<p>コンマと併用することで階差数列などを表現することも可能です.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> [<span class="dv">1</span>,<span class="dv">3</span><span class="op">..</span><span class="dv">10</span>]</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">9</span>]</span></code></pre></div>
<p><code>[x..]</code>と終わりを指定しないことで,無限数列も作成できます. ghciでそのまま実行すると永遠に表示が止まりません(<code>ctrl+C</code>で止まります). ここでは,<code>[1,3,5,...]</code>の10番目と100番目の値を取り出してみます.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> [<span class="dv">1</span>,<span class="dv">3</span><span class="op">..</span>] <span class="op">!!</span> <span class="dv">10</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="dv">21</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> [<span class="dv">1</span>,<span class="dv">3</span><span class="op">..</span>] <span class="op">!!</span> <span class="dv">100</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="dv">201</span></span></code></pre></div>
<div class="warn">
<p>Pythonなど言語では,値が宣言/生成されたタイミングでコンピュータがその値を評価する<code>正格(strict)評価</code>が一般的です. 一方HaskellはDefaultでは,実際にその値が呼び出された際に評価される<code>遅延(lazy)評価</code>を採用しており,それによりこのような無限の値を実現することができます.
正格評価で無限に値が続くリストを生成した場合, 生成した時点で永遠に計算が終わりませんが,遅延評価では無限のリストの中の具体的な値を利用するさいにその値が利用されます.</p>
<p>この機能はHaskellの大きな特徴の一つですが,一方でメモリリークや,速度の低下の原因になることがあります. したがって,ある程度大きなプログラムを書く場合には,正格評価と,遅延評価を明示的に切り替えることが推奨されています.</p>
<p>最初は気にする必要はありませんが,パッケージなどの提供するHaskellのデータ型には,strictなものとlazyなものの両方が用意されていることが多いので,違いを覚えておくと後々役に立ちます.</p>
</div>
<p>Haskellでリストを扱う際には,暗黙に<code>x</code>などの単一のアルファベットが要素,<code>xs</code>などの複数形がリストを表している場合が多く<code>x:xs</code>などと記述してリストの最初の要素と残りのリストを表します.</p>
<p>詳細は後ほど扱いますが,<code>束縛</code>されたリストから<code>パターンマッチ</code>によって値を取り出す場合によく利用されます.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> x<span class="op">:</span>xs <span class="ot">=</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> x</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> xs</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">2</span>,<span class="dv">3</span>]</span></code></pre></div>
<p>リスト同士の結合は<code>++</code>演算子によって行います.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> [<span class="dv">1</span>] <span class="op">++</span> [<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span></code></pre></div>
<p>リストの長さは<code>length</code> 関数で取得できます.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="fu">length</span> []</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="fu">length</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span></span></code></pre></div>
<h3 data-number="3.5.3" id="タプル"><span class="header-section-number">3.5.3</span> タプル</h3>
<p>Haskellではデータの組み合わせを表す方法として,後述の<code>直積型</code>がありますが,タプルも良く利用されます.タプルを利用するには要素を<code>()</code>(丸括弧)で囲い,<code>,</code>(コンマ)で区切ります. 要素数に制限はありません.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> (<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> (<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)</span></code></pre></div>
<p>リストと同様に要素数の異なるタプルや,要素のデータ型の異なるタプルは別のデータ型として区別され,同一のリストなどに入れることはできません.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> [(<span class="dv">1</span>,<span class="dv">2</span>),(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)]</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>interactive<span class="op">&gt;:</span><span class="dv">60</span><span class="op">:</span><span class="dv">8</span><span class="op">:</span> <span class="fu">error</span><span class="op">:</span> [<span class="dt">GHC</span><span class="op">-</span><span class="dv">83865</span>]</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">Couldn&#39;t</span> match expected <span class="kw">type</span><span class="op">:</span> (a, b)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>                  with actual <span class="kw">type</span><span class="op">:</span> (a0, b0, c0)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">In</span> the expression<span class="op">:</span> (<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">In</span> the expression<span class="op">:</span> [(<span class="dv">1</span>, <span class="dv">2</span>), (<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)]</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">In</span> an equation for ‘it’<span class="op">:</span> it <span class="ot">=</span> [(<span class="dv">1</span>, <span class="dv">2</span>), (<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)]</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">Relevant</span> bindings include</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="ot">        it ::</span> [(a, b)] (bound at <span class="op">&lt;</span>interactive<span class="op">&gt;:</span><span class="dv">60</span><span class="op">:</span><span class="dv">1</span>)</span></code></pre></div>
<p>要素数が2つのリストに限定して,要素を取り出す関数 <code>fst</code>,<code>snd</code>が用意されていますが,値の取り出しはパターンマッチがよく利用されます.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="fu">fst</span> (<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="fu">snd</span> (<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> (x,y) <span class="ot">=</span> (<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> x</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> y</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span></span></code></pre></div>
<h3 data-number="3.5.4" id="文字列型"><span class="header-section-number">3.5.4</span> 文字列型</h3>
<p>Haskellの文字列型は歴史的に少し複雑な状況になっており,Preludeにおける<code>String</code>型の使い勝手があまり良くありません. なので, <code>text</code>パッケージの提供する<code>Text</code>型を利用するのが一般的です. なので,後ほどTextを導入しますが,一旦String型に関して見てみましょう.</p>
<p>Haskellでは1文字を表す <code>Char</code>型と文字列を表す<code>String</code>型を区別し,<code>Char</code>は<code>''</code>(シングルクォーテーション),<code>String</code>は<code>""</code>(ダブルクオーテーション)で囲みます.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="ch">&#39;c&#39;</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="ch">&#39;c&#39;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="op">:</span>t <span class="ch">&#39;c&#39;</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="ch">&#39;c&#39;</span><span class="ot"> ::</span> <span class="dt">Char</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="st">&quot;String&quot;</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="op">:</span>t <span class="st">&quot;String&quot;</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;String&quot;</span><span class="ot"> ::</span> <span class="dt">String</span></span></code></pre></div>
<p>Haskellにおける文字型<code>Char</code>のリスト<code>[Char]</code>の別名(<code>型シノニム</code>)です. <code>型シノニム</code>は型に別の名前をつけることで,形の用途などを区別する機能です.
型シノニムは,以下のように, <code>type 型シノニム = 元のデータ型</code>という形で定義します.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="dt">String</span> <span class="ot">=</span> [<span class="dt">Char</span>]</span></code></pre></div>
<p>したがって,String型にはListの演算が適用できます.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="st">&quot;String&quot;</span> <span class="op">!!</span> <span class="dv">1</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="ch">&#39;t&#39;</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="ch">&#39;!&#39;</span> <span class="op">:</span> <span class="st">&quot;String&quot;</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;!String&quot;</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="st">&quot;!!&quot;</span> <span class="op">++</span>  <span class="st">&quot;String&quot;</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;!!String&quot;</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="fu">length</span> <span class="st">&quot;String&quot;</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span></span></code></pre></div>
<p>ただし,<code>String</code>型は非効率なため,現在ではあまり使われておらず,基本的に<code>text</code>パッケージの提供する <code>Data.Text</code>を利用することが推奨されています.</p>
<p><code>package.yaml</code>の<code>dependencies</code>に以下のように<code>text</code>を追加します.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> base &gt;= 4.7 &amp;&amp; &lt; 5</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> text</span></span></code></pre></div>
<p>スクリプトの最初に以下のように,記述することで文字列リテラル<code>""</code>が<code>Text</code>型に利用できるようになります.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE OverloadedStrings #-}</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Data.Text</span></span></code></pre></div>
<p><code>{-# LANGUAGE OverloadedStrings #-}</code>は言語拡張を表しており,Haskellの処理系に機能を追加する宣言です. <code>OverloadedString</code>は文字列リテラルをTextなどの他の文字列を表すデータ型に適用できるようにする拡張です.</p>
<p><code>ghci</code>で言語拡張を導入するには,<code>:set</code>に続けて <code>-X言語拡張名</code>を記述します.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="op">:</span><span class="kw">type</span> <span class="st">&quot;Text&quot;</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Text&quot;</span><span class="ot"> ::</span> <span class="dt">String</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="op">:</span>set <span class="op">-</span><span class="dt">XOverloadedStrings</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="kw">import</span> <span class="dt">Data.Text</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="op">:</span><span class="kw">type</span> <span class="st">&quot;Text&quot;</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Text&quot;</span><span class="ot"> ::</span> <span class="dt">Data.String.IsString</span> a <span class="ot">=&gt;</span> a</span></code></pre></div>
<h2 data-number="3.6" id="論理型bool"><span class="header-section-number">3.6</span> 論理型(Bool)</h2>
<p>それが正しいか間違っているか判別できる文を<strong>命題</strong>といいます. 命題の結果を表すものとして真(正しい),偽(間違っている)という値を用います. 真と偽を併せて<strong>真偽値</strong>といいます.</p>
<p>例えば,<code>1は2より大きい</code>という命題は,間違っているので<strong>偽</strong>となります. <code>人間は必ず死ぬ</code>という命題は,今のところ不老不死の人間がいないので<strong>真</strong>です.</p>
<p>真偽値を表すデータ型として<code>Bool</code>があります. <code>Bool</code>は<code>True</code>(真),<code>False</code>(偽)のいずれかです.</p>
<p>Haskellには命題の判定を行う<code>関係演算子</code>として,以下のようなものが準備されています.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">記号</th>
<th style="text-align: center;">意味</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>&gt;</code></td>
<td style="text-align: center;">より大きい</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>&gt;=</code></td>
<td style="text-align: center;">以上</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>&lt;</code></td>
<td style="text-align: center;">より小さい</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>&lt;=</code></td>
<td style="text-align: center;">以下</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>==</code></td>
<td style="text-align: center;">等しい</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>/=</code></td>
<td style="text-align: center;">等しくない</td>
</tr>
</tbody>
</table>
<p>数値などの大小関係を調べるときには,比較演算子 <code>&gt;</code>,<code>&gt;=</code>.<code>&lt;</code>,<code>&lt;=</code>を利用します. 演算子の左右に数値を書くと,結果に応じて真偽値が帰ってきます.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">1</span> <span class="op">&gt;</span> <span class="dv">2</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="dt">False</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">1</span> <span class="op">&lt;</span> <span class="fl">1.5</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="dt">True</span></span></code></pre></div>
<p>値が等しいか/等しくないかを判定するには,<code>==</code>と<code>!=</code>を利用します.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">4</span> <span class="op">==</span> <span class="dv">4</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="dt">True</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="st">&quot;cat&quot;</span> <span class="op">/=</span> <span class="st">&quot;cat&quot;</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="dt">False</span></span></code></pre></div>
<p><code>True</code> や <code>False</code>などの<code>Bool</code>値は, <code>AND</code>(かつ),<code>OR</code>(または),<code>NOT</code>という演算で計算することができます(<code>XOR</code>というのもあるが省略).
HaskellではAND は <code>&amp;&amp;</code>, OR は <code>||</code>, NOT は <code>not</code> という演算子が提供されています.</p>
<p>A,Bが命題だとして,<code>A &amp;&amp; B</code>は両方<code>True</code>のときに,<code>True</code>となります. <code>A || B</code>は片方どちらかが<code>True</code>のときに<code>True</code>となります.</p>
<p>例えば,</p>
<ul>
<li><p><code>1は2より大きい かつ 2は0より大きい</code> という命題は,<code>2は0より大きい</code>は正しいですが,<code>1は2より大きい</code>が間違っているので全体として,<code>False</code>です.</p></li>
<li><p><code>ネコは哺乳類である または ネコは鳥類である</code>という命題は <code>ネコは鳥類である</code>が間違っていますが全体としては<code>True</code>です.</p></li>
</ul>
<p>演算の結果は,それぞれ以下のようになります. これを真偽値表といいます. ここでは,最低限の例だけを紹介しますが,より深く理解したい人は論理学などの講義を受講しましょう.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">命題Aの値</th>
<th style="text-align: center;">Bの値</th>
<th style="text-align: center;"><code>A &amp;&amp; B</code></th>
<th style="text-align: center;"><code>A || B</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">True</td>
<td style="text-align: center;">False</td>
<td style="text-align: center;">True</td>
<td style="text-align: center;">True</td>
</tr>
<tr class="even">
<td style="text-align: center;">False</td>
<td style="text-align: center;">True</td>
<td style="text-align: center;">False</td>
<td style="text-align: center;">True</td>
</tr>
<tr class="odd">
<td style="text-align: center;">True</td>
<td style="text-align: center;">False</td>
<td style="text-align: center;">False</td>
<td style="text-align: center;">True</td>
</tr>
<tr class="even">
<td style="text-align: center;">False</td>
<td style="text-align: center;">False</td>
<td style="text-align: center;">False</td>
<td style="text-align: center;">True</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb52"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">1</span> <span class="op">&gt;</span> <span class="dv">2</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="dt">False</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">2</span> <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="dt">True</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">1</span> <span class="op">&gt;</span> <span class="dv">2</span> <span class="op">&amp;&amp;</span> <span class="dv">2</span> <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="dt">False</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="dv">1</span> <span class="op">&gt;</span> <span class="dv">2</span> <span class="op">||</span> <span class="dv">2</span> <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="dt">True</span></span></code></pre></div>
<p><code>not</code> は命題の否定を表しており <code>True</code>が<code>False</code>,<code>False</code>が<code>True</code>になります.<code>not</code>は命題の前に書きます.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ghci</span><span class="op">&gt;</span> 1 <span class="op">&gt;</span> 2</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="ex">False</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="ex">ghci</span><span class="op">&gt;</span> not <span class="er">(</span><span class="ex">1</span> <span class="op">&gt;</span> 2<span class="kw">)</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="ex">True</span></span></code></pre></div>
<div class="note">
<p><strong>演習</strong></p>
<p>ある値が偶数かどうかは,2で割った余りが0かどうかを判定することで判定できます.
<code>x=101</code>,<code>y=202</code>として, 以下の命題の真偽をPythonで計算してください.</p>
<ul>
<li>xが偶数</li>
<li>yが偶数</li>
<li>xが偶数かつyが偶数</li>
<li>xが偶数またはyが偶数</li>
<li>x + y が奇数</li>
</ul>
</div>
</details>
<h1 data-number="4" id="関数"><span class="header-section-number">4</span> 関数</h1>
<details open>
<summary>
開く/閉じる
</summary>
<p>Haskellは関数型言語なので,関数の記述がプログラミングにおける花形です. この章ではHaskellの関数に関する記法を学びましょう.</p>
<h2 data-number="4.1" id="スクリプトファイルの実行"><span class="header-section-number">4.1</span> スクリプトファイルの実行</h2>
<div class="warn">
<p>ここから先は,コードが複数行に渡ることが多くなるので,ghciの利用をやめてスクリプトを書きます.</p>
<p><code>app</code> フォルダ内に <code>practice.hs</code>を作成しそこで事例の勉強をしましょう.</p>
</div>
<p><code>practice.hs</code> ファイルを作成したら,ファイルを以下のように記述しましょう.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE OverloadedStrings #-}</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Data.Text</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="fu">putStrLn</span> <span class="st">&quot;practice&quot;</span></span></code></pre></div>
<div class="warn">
<p><code>module XXX () where</code></p>
<p>という記述は,他のファイルからインポート可能なmodule化を行うための宣言です.
また,Stackでは,<strong>大文字で始まる<code>*.hs</code>ファイルは,moduleとして認識されます.</strong></p>
<p>したがって,一つのプロジェクトに複数の実行可能ファイルを生成する場合には,</p>
<p><code>module XXX () where</code></p>
<p>の記述をなくし, ファイル名を小文字ではじめる必要があります.</p>
<p>これは,<code>Hello World</code>のために編集した<code>Main.hs</code>も同様であるため,<code>Main.hs</code>を<code>hello.hs</code>に名前を変更し,ファイル内の <code>module Main (main) where</code>の記述も削除し,以下のように変更しましょう.</p>
<p>cf. <a href="https://www.reddit.com/r/haskell/comments/capuz7/multiple_executable_in_project/">他にもいくつかの方法があるようです</a></p>
</div>
<div class="sourceCode" id="cb55"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Lib</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> helloWorld</span></code></pre></div>
<p><code>package.yaml</code>の<code>executables:</code>を以下のように編集して<code>hello.hs</code>と<code>practice.hs</code>を実行可能ファイルとして登録します. <code>Data.Text</code>を利用するために,<code>dependencies:</code>以下に<code>- text</code>を追加しておきましょう.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> base &gt;= 4.7 &amp;&amp; &lt; 5</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> text</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co">#ghc-options:</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span><span class="kw">:</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">source-dirs</span><span class="kw">:</span><span class="at"> src</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="fu">executables</span><span class="kw">:</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">hello</span><span class="kw">:</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">main</span><span class="kw">:</span><span class="at">                main.hs</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">source-dirs</span><span class="kw">:</span><span class="at">         app</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ghc-options</span><span class="kw">:</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> -threaded</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> -rtsopts</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> -with-rtsopts=-N</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> hello-world</span></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">practice</span><span class="kw">:</span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">main</span><span class="kw">:</span><span class="at">                practice.hs</span></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">source-dirs</span><span class="kw">:</span><span class="at">         app</span></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ghc-options</span><span class="kw">:</span></span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> -threaded</span></span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> -rtsopts</span></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> -with-rtsopts=-N</span></span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> hello-world</span></span></code></pre></div>
<p><code>stack run practice</code> で<code>practice!</code>と表示されれば成功です.</p>
<p>これからスクリプトで実行していくにあたって,<code>practice.hs</code>の中身をもう少し詳しく見てみましょう.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Lib</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="fu">putStrLn</span> <span class="st">&quot;practice!!&quot;</span></span></code></pre></div>
<p>haskellのプログラムを実行すると, <code>main関数</code>のみが実行されます.</p>
<p>Haskellは関数型言語なので,これから<code>import Lib</code>と<code>main</code>の間に関数を定義していき,<code>main</code>の中で実行していくことになります.</p>
<p>main 関数で行うことは関数として実行することになりますが,これから学習する通常の関数の定義で記述するのは今は難しいので,<code>do</code>記法を紹介します. main 関数の=以下に<code>do</code>と書くことで,do以下のインデントブロックに記述された内容が手続き型的に1行ずつ実行されます.</p>
<p>以下のプログラムでは, <code>"practice1"</code>,<code>"practice2"</code>,<code>"practice3"</code>の順に標準出力されます.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Lib</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">putStrLn</span> <span class="st">&quot;practice1&quot;</span> <span class="co">-- &gt;&gt;&gt; &quot;practice1&quot;</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">putStrLn</span> <span class="st">&quot;practice2&quot;</span> <span class="co">-- &gt;&gt;&gt; &quot;practice2&quot;</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">putStrLn</span> <span class="st">&quot;practice3&quot;</span> <span class="co">-- &gt;&gt;&gt; &quot;practice3&quot;</span></span></code></pre></div>
<p><code>stack run practice</code>の結果を確認すると以下のようになります.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> stack <span class="ex">run</span> practice</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;practice1&quot;</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;practice2&quot;</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;practice3&quot;</span></span></code></pre></div>
<p>また,ghciと異なって,出力結果が同じ画面に現れないので,
以降のコード例では, その行の結果をコメント内で<code>&gt;&gt;&gt;</code>に続けて書くこととします. コメント部分は,記述しなくても結果は変わらないので,省略しても構いません.</p>
<h2 data-number="4.2" id="関数と演算子"><span class="header-section-number">4.2</span> 関数と演算子</h2>
<p>関数型言語では関数を組み合わせてプログラムを書きます. 関数の正確な定義は後に譲るとして,ここでは取り敢えず｢特定のデータ型の値を受け取って,特定のデータ型の値を返すもの｣という定義にしましょう.このとき受け取る値を<strong>引数</strong>,返す値を<strong>返り値</strong>といいます.</p>
<p>Haskellでは,数学の記法と非常に近い方法で関数を定義します.
例えば,</p>
<p><span class="math display">\[
f : \mathbb{Z} \rightarrow \mathbb{Z} \\
f(x) = x + 1
\]</span></p>
<p>という,整数<code>x</code>を受け取って整数<code>x + 1</code>を返すだけの関数について考えましょう.</p>
<p>Haskellでは上の関数は以下のように定義されます.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="ot">f ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>f x <span class="ot">=</span> x <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span> <span class="op">$</span> f <span class="dv">4</span> <span class="co">-- &gt;&gt;&gt; 5</span></span></code></pre></div>
<p><code>()</code>の代わりにスペースを使う点以外は全く同じ書き方で, <code>=</code>の左側に関数名と引数,右側に返り値を書きます.
関数名は小文字の英字で始めれるというルールがあります.</p>
<p><code>f :: Int -&gt; Int</code>は型注釈であり,この<code>f</code>という関数が,引数に<code>Int</code>を取り,返り値として<code>Int</code>を返すということを指定しています.</p>
<p><code>do</code>以下の記述で, <code>f 4</code>の結果を確認しています. <code>print</code>は,文字列に変換可能な値を受取,標準出力する関数です. また <code>(f 4)</code>を省略して<code>$ f 4</code> としています.</p>
<p>引数は何個でも利用できます. 例えば2引数関数</p>
<p><span class="math display">\[ multiple(x,y) = x * y \]</span></p>
<p>は以下のように定義できます.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="ot">multiple ::</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> <span class="dt">Double</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>multiple x y <span class="ot">=</span> x <span class="op">*</span> y</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>multiple <span class="dv">3</span> <span class="dv">4</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span> <span class="op">$</span> multiple <span class="dv">3</span> <span class="dv">4</span> <span class="co">-- &gt;&gt;&gt; 12.0</span></span></code></pre></div>
<p>また,以下の記号を組み合わせて中置演算子名として利用することも可能です.</p>
<div class="note">
<p>~ ! # $ % &amp; * + = . / &lt; &gt; ? @   ^ | -</p>
</div>
<div class="sourceCode" id="cb62"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="ot">(.*) ::</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> <span class="dt">Double</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">.*</span> y <span class="ot">=</span> x <span class="op">*</span> y</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span> <span class="op">$</span> <span class="dv">3</span> <span class="op">.*</span> <span class="dv">4</span> <span class="co">-- &gt;&gt;&gt; 12.0</span></span></code></pre></div>
<p>絵文字などのUnicode記号も利用することができます.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>(✖)<span class="ot"> ::</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> <span class="dt">Double</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>x ✖ y <span class="ot">=</span> x <span class="op">*</span> y</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span> <span class="op">$</span> <span class="dv">3</span> ✖ <span class="dv">4</span> <span class="co">-- &gt;&gt;&gt; 12.0</span></span></code></pre></div>
<p>記号を利用して関数を定義する場合には,定義時に<code>()</code> で囲うことで一般の関数のように定義することができます.
例えば, 乗算を新たに定義するとして,以下のように書くことができます.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="ot">(.*) ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>(<span class="op">.*</span>) x y <span class="ot">=</span> x <span class="op">*</span> y</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span> <span class="op">$</span> <span class="dv">3</span> <span class="op">.*</span> <span class="dv">4</span> <span class="co">-- &gt;&gt;&gt; 12</span></span></code></pre></div>
<p>前置の2引数関数も<code>``</code> (バッククオート)で囲むことで中置演算子として定義することができます.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">`multiple`</span> y <span class="ot">=</span> x <span class="op">*</span> y</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span> <span class="op">$</span> <span class="dv">3</span> <span class="ot">`multiple `</span> <span class="dv">4</span> <span class="co">-- &gt;&gt;&gt; 12</span></span></code></pre></div>
<h3 data-number="4.2.1" id="結合性"><span class="header-section-number">4.2.1</span> 結合性</h3>
<p>先に述べたように異なる複数の演算子が連なっている式は, 演算子の優先順位に従って計算される順位が変わります.</p>
<p>例えば,<code>*</code> の優先順位は7で, <code>+</code> の優先順位は6なので,<code>2 * 3 + 3</code> という式は,</p>
<pre><code>   2 * 3  + 3
= (2 * 3) + 3
= 6 + 3
= 9</code></pre>
<p>と言う風に<code>*</code>が優先して計算されます.</p>
<p>では,同じ演算子が複数回連なっている場合にはどのような順序で計算されるのでしょうか? このルールを決めるのが <strong>結合性(Associativity)</strong> です.</p>
<div class="note">
<p>結合性には, <strong>左結合(Left-associative)</strong>, <strong>右結合(Right-associative)</strong>, <strong>非結合(Non-associative)</strong> の3種類があり,ユーザーが定義することができます.</p>
<ul>
<li><strong>左結合(Left-associative)</strong></li>
</ul>
<p>左結合の場合, 演算子は左から右へと評価されます. 例えば, <code>+</code> は左結合であり,式 <code>a + b + c</code> は <code>(a + b) + c</code> として評価されます</p>
<ul>
<li><strong>右結合(Right-associative)</strong></li>
</ul>
<p>右結合演算子の場合,演算子は右から左へと評価されます.例えば、<code>^</code>は右結合です。式 <code>a ^ b ^ c</code> は <code>a ^ (b ^ c)</code> として評価されます</p>
<ul>
<li><strong>非結合(Non-associative)</strong></li>
</ul>
<p>非結合演算子は,同じ式内で連続して使用することは許されていません. 非結合演算子の例としては,比較演算子（<code>&lt;</code>,<code>&gt;</code> など）があります.</p>
<p>式 <code>a &lt; b &lt; c</code> は Haskell では文法的に不正です. 比較を連鎖させる場合は,<code>a &lt; b &amp;&amp; b &lt; c</code>のように明確に分けて記述する必要があります.</p>
</div>
<p>ユーザーが作成した演算子の結合性を指定するには,右,左,非の順に<code>infixr</code>,<code>infixl</code>,<code>infix</code>宣言を利用します. いずれも, <code>infix(r/l/なし) 優先順位 記号</code> の順に書きます.</p>
<p>例えば先程作成した,<code>.*</code> を右結合の優先順位7で指定するには,以下のように書きます.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">.*</span> y <span class="ot">=</span> x <span class="op">*</span> y</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="kw">infixr</span> <span class="dv">7</span> <span class="op">.*</span></span></code></pre></div>
<h2 data-number="4.3" id="分岐"><span class="header-section-number">4.3</span> 分岐</h2>
<p>関数型言語において,手続き型言語におけるIF文に相当するのが<strong>パターンマッチ</strong>と<strong>指示関数(特性関数)</strong>です.</p>
<h3 data-number="4.3.1" id="パターンマッチ"><span class="header-section-number">4.3.1</span> パターンマッチ</h3>
<p>パターンマッチに近い概念は既にフィボナッチ数の漸化式として出てきています.フィボナッチ数の漸化式は,以下のように表されます.</p>
<div class="note">
<p><span class="math display">\[ F_0 = 1 \]</span>
<span class="math display">\[ F_1 = 1 \]</span>
<span class="math display">\[ F_n = F_{n-1} + F_{n-2} (n &gt;= 2)  \]</span></p>
</div>
<p>この関数はPythonでは,以下のようにif文による分岐で記述されるのが一般的です.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fib(x):</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> x <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> fib(x<span class="op">-</span><span class="dv">1</span>) <span class="op">+</span> f(x<span class="op">-</span><span class="dv">2</span>)</span></code></pre></div>
<p>これをHaskellでパターンマッチを利用して以下のように定義することができます.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="ot">fib ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>fib <span class="dv">0</span> <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>fib <span class="dv">1</span> <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>fib n <span class="ot">=</span> fib (n <span class="op">-</span> <span class="dv">1</span>) <span class="op">+</span> fib (n <span class="op">-</span> <span class="dv">2</span>)</span></code></pre></div>
<p>このHaskellのコードは,</p>
<ul>
<li><p>関数<code>fib</code>の引数が<code>0</code>のときには返り値として<code>1</code>を返し,</p></li>
<li><p>関数<code>fib</code>の引数が<code>1</code>のときには返り値として<code>1</code>を返し,</p></li>
<li><p>関数<code>fib</code>の引数が<code>それ以外</code>のときには返り値として<code>fib (n - 1) + fib (n - 2)</code>を返します.</p></li>
</ul>
<p>この最後の<code>fib n = fib (n - 1) + fib (n - 2)</code>は再帰関数といって後ほど扱いますが,取り敢えず,特定の引数に対して特定の返り値を指定するこのような関数の記述方法を<strong>パターンマッチ</strong>といいます.</p>
<p>パターンマッチは,数値以外の引数に関しても適用可能であり,リストではリストの要素数に応じて使い分けることが多いです.</p>
<p>以下の,<code>strHead</code>関数は,リストの先頭の要素を文字列として表示する関数です.リストが空のときには<code>"Empty"</code>,要素が一つのときにはその要素,それ以外のときには先頭の要素を文字列にして返します.</p>
<p><code>show</code>の詳細は後ほど扱いますが,どの様に標準出力に表示するかを定めてあるデータ型を文字列に変換する関数です.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="ot">strHead ::</span> <span class="dt">Show</span> a <span class="ot">=&gt;</span> [a] <span class="ot">-&gt;</span> <span class="dt">String</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>strHead []     <span class="ot">=</span> <span class="st">&quot;Empty&quot;</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>strHead [x]    <span class="ot">=</span> <span class="fu">show</span> x</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>strHead (x<span class="op">:</span>xs) <span class="ot">=</span> <span class="fu">show</span> x</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span> <span class="op">$</span> strHead [] <span class="co">-- &gt;&gt;&gt; &quot;Empty&quot;</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span> <span class="op">$</span> strHead [<span class="dv">3</span>,<span class="dv">4</span>] <span class="co">-- &gt;&gt;&gt; &quot;3&quot;</span></span></code></pre></div>
<p>パターンマッチはこのようにリスト<code>x:xs</code>の先頭部分<code>x</code>を指定するなどの利用法が可能です. 値の特定の部分を取得する用法として頻出なのがタプルを引数に取るパターンマッチです.</p>
<p>以下のコードは,3つ組のタプル<code>(x,y,z)</code>から指定した位置の値を取り出す関数<code>getFromTuple</code>です.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>getFromTuple (x,y,z) <span class="dv">0</span> <span class="ot">=</span> x</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>getFromTuple (x,y,z) <span class="dv">1</span> <span class="ot">=</span> y</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>getFromTuple (x,y,z) <span class="dv">2</span> <span class="ot">=</span> z</span></code></pre></div>
<p>このような用法は後に紹介する代数的データ型を扱う際にも頻出します.</p>
<h3 data-number="4.3.2" id="ガード"><span class="header-section-number">4.3.2</span> ガード</h3>
<p>数式における分岐は,指示関数を用いて行うこともできます.</p>
<div class="note">
<p><span class="math display">\[
fib(n) =
\begin{cases}
1, ~if~n = 0 \\
1, ~if~n = 1 \\
fib(n-1) + fib(n-2),~if~n &gt;=2
\end{cases}
\]</span></p>
</div>
<p>Haskellにおいて指示関数の記法に相当するのが<strong>ガード</strong>です.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="ot">fib ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>fib n <span class="op">|</span> n <span class="op">==</span> <span class="dv">0</span> <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>      <span class="op">|</span> n <span class="op">==</span> <span class="dv">1</span> <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>      <span class="op">|</span> n <span class="op">&gt;=</span> <span class="dv">2</span> <span class="ot">=</span> fib (n<span class="op">-</span><span class="dv">1</span>) <span class="op">+</span> fib (n<span class="op">-</span><span class="dv">2</span>)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span> <span class="op">$</span> fib <span class="dv">5</span> <span class="co">-- &gt;&gt;&gt; 8</span></span></code></pre></div>
<p>特徴関数におけるifの位置が先に来ている以外は,基本的に対応関係にあるのがわかるかと思います.</p>
<h3 data-number="4.3.3" id="case式"><span class="header-section-number">4.3.3</span> case式</h3>
<p>パターンマッチをインデントブロックで実現する手法として<strong>case式</strong>があります. パターンマッチで判定する変数を<code>case 変数 of</code> のあとに指定して, それぞれのパターンとその結果を<code>-&gt;</code>でつなげる記法です. 指定のパターンに当てはまらないものすべて(これを<strong>ワイルドカード</strong>といいます)を指定するために<code>_</code>を利用します.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="ot">fib ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>fib n <span class="ot">=</span> <span class="kw">case</span> n <span class="kw">of</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span> <span class="ot">-&gt;</span> <span class="dv">1</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span> <span class="ot">-&gt;</span> <span class="dv">1</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>        _ <span class="ot">-&gt;</span> fib (n<span class="op">-</span><span class="dv">1</span>) <span class="op">+</span> fib (n<span class="op">-</span><span class="dv">2</span>)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span> <span class="op">$</span> fib <span class="dv">5</span> <span class="co">-- &gt;&gt;&gt; 8</span></span></code></pre></div>
<p>ワイルドカードはどのような値に対しても同じ値を返す関数を実装する場合などにも利用されます.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="ot">return10 ::</span> a <span class="ot">-&gt;</span> <span class="dt">Int</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>return10 _ <span class="ot">=</span> <span class="dv">10</span></span></code></pre></div>
<h3 data-number="4.3.4" id="if式"><span class="header-section-number">4.3.4</span> if式</h3>
<p>Haskellにはifも存在します. <code>if 条件</code>に当てはまる場合の返り値を<code>then</code>で指定します. <code>else if</code> で条件を追加し, <code>else</code>でそれ以外のパターンを指定します. Pythonなどのif文と異なり,式なので<code>else</code>の場合の返り値も必ず指定する必要があります.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="ot">fib ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>fib n <span class="ot">=</span> <span class="kw">if</span> n <span class="op">==</span> <span class="dv">0</span> <span class="kw">then</span> <span class="dv">1</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">else</span> <span class="kw">if</span> n <span class="op">==</span> <span class="dv">1</span> <span class="kw">then</span> <span class="dv">1</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">else</span> fib (n<span class="op">-</span><span class="dv">1</span>) <span class="op">+</span> fib (n<span class="op">-</span><span class="dv">2</span>)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span> <span class="op">$</span> fib <span class="dv">5</span> <span class="co">-- &gt;&gt;&gt; 8</span></span></code></pre></div>
<p>Haskellではあまりif式は利用されませんが,
1行で書けるため,式の中で部分的に利用する場合に便利です.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="ot">fib ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>fib n <span class="ot">=</span> <span class="kw">if</span> n <span class="op">==</span> <span class="dv">0</span> <span class="kw">then</span> <span class="dv">1</span> <span class="kw">else</span> <span class="kw">if</span> n <span class="op">==</span> <span class="dv">1</span> <span class="kw">then</span> <span class="dv">1</span> <span class="kw">else</span> fib (n<span class="op">-</span><span class="dv">1</span>) <span class="op">+</span> fib (n<span class="op">-</span><span class="dv">2</span>)</span></code></pre></div>
<h2 data-number="4.4" id="再帰"><span class="header-section-number">4.4</span> 再帰</h2>
<p>Haskellにおいてもfor文に相当する記法は存在しますが,基本的にループは<strong>再帰</strong>によって実装されます.
再帰とは関数内で自分自身を呼び出すことです. これまで何度も登場していた<code>fib</code>も再帰を利用していましたが,
もう少し細かく見てみましょう.</p>
<p>以下のPythonにおけるfor文を事例に考えてみましょう.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> total(xs):</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> xs:</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>        result <span class="op">+=</span> x</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span></code></pre></div>
<p>これと同値なプログラムをHaskellで記述すると以下のようになります.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="ot">total ::</span> [<span class="dt">Int</span>] <span class="ot">-&gt;</span> <span class="dt">Int</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>total []  <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>total [x] <span class="ot">=</span> x</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>total (x<span class="op">:</span>xs) <span class="ot">=</span> x <span class="op">+</span> (total xs)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="fu">print</span> <span class="op">$</span> tatal [<span class="dv">1</span><span class="op">..</span><span class="dv">10</span>] <span class="co">-- &gt;&gt;&gt; 55</span></span></code></pre></div>
<p>このtotal関数は,与えられたリストが空の場合0を返し,要素が一つの場合その要素を返します.
要素が複数あるリストの場合には,先頭の要素<code>x</code>をそれ以降の要素<code>xs</code>の合計に足すという処理を行います.</p>
<p><code>total [1,2,3]</code>における処理の流れを追っていくと以下のようになります.</p>
<pre><code>total [1,2,3]
= 1 + (total [2,3])
= 1 + (2 + (total [3]))
= 1 + 2 + 3 + (total [])
= 1 + 2 + 3 + 0
= 6</code></pre>
<p>再帰の基本は,<strong>ループの終了状態</strong>をパターンマッチなどで指定して,そこに至るまでの状態の変化を再帰で記述することです.
処理がどのような状態になったら終わるのかを意識して記述しないと永遠に終了しないプログラムになるので注意しましょう.</p>
<div class="note">
<p>練習問題</p>
<ol type="1">
<li><p>リストの長さを返す<code>length2 :: [a] -&gt; Int</code> 関数を新しく実装してください.</p></li>
<li><p>与えられた整数のリストを引数にとり,要素毎にFizzBuzzを実行した結果を文字列のリストで返す関数
<code>fizzBuzz :: [Int] -&gt; [String]</code>実装してください.</p></li>
</ol>
</div>
<h2 data-number="4.5" id="ラムダ式"><span class="header-section-number">4.5</span> ラムダ式</h2>
<h2 data-number="4.6" id="高階関数"><span class="header-section-number">4.6</span> 高階関数</h2>
<p>map, fold, zip</p>
<h2 data-number="4.7" id="合成"><span class="header-section-number">4.7</span> 合成</h2>
<h2 data-number="4.8" id="値の束縛"><span class="header-section-number">4.8</span> 値の束縛</h2>
<p>Pythonなどの言語では,特定の変数に値を代入することができます.例えば,以下の最大値を求めるプログラムでは,変数<code>m</code>に最初の中身はリストの最初の要素が代入された後,次々とより大きな変数が代入されていきます. <code>変数</code>は名前の通り,次々とその値を変更していきます.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> [<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">1</span>]</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>m  <span class="op">=</span> xs[<span class="dv">0</span>]</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> xs[<span class="dv">1</span>:]:</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">&gt;</span> m:</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> x</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;max value:&#39;</span>,m)</span></code></pre></div>
<p>一方でHaskellでは,変数に一度値を割り当てると,その変数の値を後から変更することができません. 変数に値を再代入するという操作が許されていないのです. この性質を<code>普遍性</code> （immutability）といいます. したがって,Haskellでは代入という言葉を使わず<code>束縛</code>といいます.
これは,通常の手続き型言語との大きな違いになります.</p>
<div class="warn">
<p>※1 値を変えられないなら｢変数じゃない｣じゃないという意見もありますが,数学において変数と呼ばれているものに近い概念だと考えましょう.</p>
<p>※2 実は後にでてくるStateやSTなどHaskellでも<code>再代入(破壊的代入)</code>を扱うことはできますが,特定の仕組みによって以下の純粋関数型言語の特徴を保っています.</p>
</div>
<p>例えば,以下のように一度値を束縛した変数に新しく変数を代入しようとすると<code>xという変数に複数の宣言をしている</code>というエラーが出ます(ghciでやる場合には,<code>:{ :}</code>を入れる必要があり余計にややこしいですね.すみません).</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="op">:</span>{</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">|</span> x <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">|</span> x <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">|</span> <span class="op">:</span>}</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>interactive<span class="op">&gt;:</span><span class="dv">5</span><span class="op">:</span><span class="dv">1</span><span class="op">:</span> <span class="fu">error</span><span class="op">:</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Multiple</span> declarations <span class="kw">of</span> ‘x’</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Declared</span> at<span class="op">:</span> <span class="op">&lt;</span>interactive<span class="op">&gt;:</span><span class="dv">4</span><span class="op">:</span><span class="dv">1</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>                 <span class="op">&lt;</span>interactive<span class="op">&gt;:</span><span class="dv">5</span><span class="op">:</span><span class="dv">1</span></span></code></pre></div>
<p>これは一見非常に不便なように感じられますが,これによって関数型プログラムでは,プログラムの安全性を高めています.</p>
<p>例えばPythonにおける以下のプログラムについて考えてみましょう.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>counter <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_plus(x):</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> counter</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    counter <span class="op">+=</span> x</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> counter</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(count(<span class="dv">1</span>))  <span class="co"># 出力: 1</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(count(<span class="dv">1</span>))  <span class="co"># 出力: 2</span></span></code></pre></div>
<p>このプログラムでは,<code>count()</code>関数に対して同じ引数1を与えているにもかかわらず,関数を呼び出すたびに,グローバル変数<code>counter</code>が変更されて,結果が変わります. 同じ関数を呼び出しても,結果が変わるために関数のみから,関数の挙動を把握することができません.</p>
<p>一方でHaskellでは,常に同じ関数は,同じ入力に対して,同じ返り値を返します. このような特性を<strong>参照透過性(Referential Transparency)</strong>と呼び,これによってプログラムの挙動を把握しやすくしています.</p>
<p>また,上記のPythonのプログラムは,関数を実行するたびに,関数の外にある,<code>counter</code>という変数の状態が変化しています. このような,関数が実行されることで単に値を返す以外に何らかの｢外部の状態を変化させる｣ことを関数の<strong>副作用(Side Effect)</strong>といいます. これは言い換えれば,関数の実行によるプログラム全体への影響が,関数以外の外部の状態に依存していることを意味しており,プログラムの挙動を予測することを難しくします. Haskell</p>
<p>参照透過性と副作用は相互に結びついた概念ですが,Haskellでは参照透過性を保ち,副作用を排除するようにプログラムが設計されています.
このように, <strong>｢参照透過性｣</strong> と <strong>｢副作用の排除｣</strong> の両方を持った関数型言語を <strong>純粋関数型言語</strong> と呼びHaskellの大きな特徴の一つです.</p>
<p>Haskellにおいて,変数への再代入が禁止されていることのメリットは理解していただけたかと思いますが,Haskellにも変数自体はあります.</p>
<p>トップレベル変数</p>
<p>ローカル変数
where
let</p>
</details>
<h1 data-number="5" id="代数的データ型"><span class="header-section-number">5</span> 代数的データ型</h1>
<details open>
<summary>
開く/閉じる
</summary>
<p>Haskellのデータ型はすべて代数的データ型です. 代数的データ型には, <strong>列挙型</strong>,<strong>直積型</strong>,<strong>直和型</strong>があり,構文として<strong>レコード構文</strong>などが存在します.</p>
<p>集合論の説明と対応したコードの書き方.
(圏論で書けというのはそのうちやりたい.)</p>
<h2 data-number="5.1" id="命題と条件式"><span class="header-section-number">5.1</span> 命題と条件式</h2>
<p>集合を定義するにあたって,数理的な定義の記法に用いる演算子を導入する. 数理的な定義の内,そこで述べられた言説が,「真か偽のいずれかに分類可能とされるもの」を命題といい,条件が与えられた命題を条件式という.</p>
<p><code>x</code>に関する条件式を
<span class="math inline">\(P(x)≔***\)</span> や <span class="math inline">\(Q(x)\)</span>
と書き，<code>***</code>の部分に,命題が記述される．</p>
<p>命題の記述には以下の論理演算子が用いられる．</p>
<ul>
<li><p><span class="math inline">\(P(x) \lor Q(x)\)</span>： <span class="math inline">\(P(x)\)</span>または<span class="math inline">\(Q(x)\)</span></p></li>
<li><p><span class="math inline">\(P(x) \land Q(x)\)</span>：P(x)かつQ(x)</p></li>
<li><p><span class="math inline">\(p(x) \Rightarrow q(x)\)</span>：<span class="math inline">\(p(x)\)</span>ならば<span class="math inline">\(q(x)\)</span></p></li>
<li><p><span class="math inline">\(p(x) \Leftrightarrow q(x) ∶\)</span> <span class="math inline">\(p(x)\)</span>ならば <span class="math inline">\(q(x)\)</span> かつ <span class="math inline">\(q(x)\)</span> ならば <span class="math inline">\(p(x)\)</span></p></li>
<li><p>$ p(x):p(x)$ の否定</p></li>
</ul>
<p>なお, <span class="math inline">\(p(x) \Rightarrow q(x) \Leftrightarrow \neg p(x) \lor q(x)\)</span></p>
<h2 data-number="5.2" id="集合"><span class="header-section-number">5.2</span> 集合</h2>
<p>Haskellではデータ型を集合と<strong>みなすこと</strong>ができます(むしろ良く議論されるのは集合の圏 <strong><span class="math inline">\(\mathbb{Set}\)</span></strong>
ですが,集合論の範囲でしばらく話しを進めます). Haskellの型はあくまで型であり,厳密には集合ではありません. また,このあと出てくるリストを使った<code>内包表記</code>などの<strong>集合論的な書き方</strong>も数学における集合ではありません.
あくまで類似したものです.</p>
<p>しかし,Haskellを集合とみなすことで,関数型プログラミングや,代数的データ型の意味がより直感的に理解できるようになります. しばらく,集合論とHaskellの対応について考えてみましょう.</p>
<div class="note">
<p>特定のモノがそこに｢属するか判定可能なモノの集まり｣を｢集合｣という．</p>
</div>
<p>集合の細かな定義は置いておいて,この講義では取り敢えずこのくらいの認識で問題ありません. しかし,ただのモノの集まりではなく,特定のモノがそこに属するかどうかを判定できる必要があるので注意が必要です.</p>
<p>例えば, ｢頭の良い人の集合｣のようなものは,｢頭が良い基準｣が人によって異なるので,集合とはみなせません.</p>
<p>ノーベル賞受賞者の集合,フィールズ賞受賞者の集合,メンサ会員の集合,XX模試の偏差値が70以上の人の集合,特定の科目で85点以上取った人の集合,など,誰でも判別可能な定義が必要です.</p>
<p>私が過去に飼ったことのある犬の種類の集合を<code>MyDogs</code>という名前で呼ぶと,<code>MyDogs</code>に属するモノたちを<code>{ }</code>を使って以下のように書くことができます.</p>
<p><span class="math display">\[\begin{align*}
MyDogs = &amp; \{ GoldenRetriever \\
         &amp;, BlackRetriever    \\
         &amp;, ShetlandSheepdog \\
         &amp;, StandardPoodle \\
         &amp;, StandardPoodle \}
\end{align*}\]</span></p>
<p>このとき,<code>GoldenRetriever</code>や,<code>ShetlandSheepdog</code>は<code>MyDogs</code>の<code>要素</code>であるといい,要素が特定の集合に属するとき,</p>
<p><span class="math display">\[ GoldenRetriever \in MyPets \]</span> の様に書きます. 要素に属さないことは <span class="math inline">\(Chihuahua \notin MyPet\)</span>と書きます.</p>
<p>Haskellにおいて,このようなデータ型を以下の様に定義することが可能です.
データ型の宣言は, <code>data</code>のあとに続いて,<code>データ型の名前(型構築子)</code>を書き,<code>=</code>の後ろにその<code>中身(コンストラクタ/データ構築子)</code>を書きます.
型構築子やデータ構築子は,大文字の英字で始めるのが規則です.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">MyDogs</span> <span class="ot">=</span> <span class="dt">GoldenRetriever</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>            <span class="op">|</span> <span class="dt">BlackRetriever</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>            <span class="op">|</span> <span class="dt">ShetlandSheepdog</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">|</span> <span class="dt">StandardPoodle</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">|</span> <span class="dt">StandardPoodle</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>            <span class="kw">deriving</span> <span class="dt">Show</span></span></code></pre></div>
<p>この様にそこに属する要素をすべて書き出す(列挙する)データ型を<code>列挙型</code>といいます.</p>
<div class="warn">
<p>ちなみに,大文字の英字で始まってさえいればUTF-8の文字や絵文字,記号は使用できるので,以下のような記述も可能ですが,あまりおすすめしません.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">My</span>🐶   <span class="ot">=</span> <span class="dt">P</span>ゴールデンレトリーバー</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>            <span class="op">|</span> <span class="dt">P</span>ブラックレトリーバー</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>            <span class="op">|</span> <span class="dt">P</span>シェットランドシープドッグ</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">|</span> <span class="dt">P</span>スタンダードプードル</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">|</span> <span class="dt">P</span>ビーグル</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>            <span class="kw">deriving</span> <span class="dt">Show</span></span></code></pre></div>
</div>
<p><code>deriving Show</code>はコンストラクタを文字列に変換する関する<code>show</code>を自動で導入するための記法です. 自分で定義することも可能ですが,詳細に関しては後ほど扱います.</p>
<p><code>deriving Show</code>を入れていない状態で</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span> <span class="dt">GoldenRetriever</span></span></code></pre></div>
<p>などを実行すると,以下のエラーがでますが,<code>deriving Show</code>を追加することで,表示することが可能となります.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="op">:</span>{</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">|</span> <span class="kw">data</span> <span class="dt">MyDogs</span> <span class="ot">=</span> <span class="dt">GoldenRetriever</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">|</span>             <span class="op">|</span> <span class="dt">BlackRetriever</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">|</span> <span class="op">:</span>}</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="fu">print</span> <span class="dt">GoldenRetriever</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>interactive<span class="op">&gt;:</span><span class="dv">17</span><span class="op">:</span><span class="dv">1</span><span class="op">:</span> <span class="fu">error</span><span class="op">:</span> [<span class="dt">GHC</span><span class="op">-</span><span class="dv">39999</span>]</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">No</span> <span class="kw">instance</span> for ‘<span class="dt">Show</span> <span class="dt">MyDogs</span>’ arising from a use <span class="kw">of</span> ‘print’</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>    • <span class="dt">In</span> the expression<span class="op">:</span> <span class="fu">print</span> <span class="dt">GoldenRetriever</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">In</span> an equation for ‘it’<span class="op">:</span> it <span class="ot">=</span> <span class="fu">print</span> <span class="dt">GoldenRetriever</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="op">:</span>{</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">|</span> <span class="kw">data</span> <span class="dt">MyDogs</span> <span class="ot">=</span> <span class="dt">GoldenRetriever</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">|</span>             <span class="op">|</span> <span class="dt">BlackRetriever</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">|</span>             <span class="kw">deriving</span> <span class="dt">Show</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">|</span> <span class="op">:</span>}</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> <span class="fu">print</span> <span class="dt">GoldenRetriever</span></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a><span class="dt">GoldenRetriever</span></span></code></pre></div>
<p>なお, <code>print</code>の<a href="https://hackage.haskell.org/package/base-4.19.1.0/docs/src/System.IO.html#print">実装</a>は</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="ot"> ::</span> <span class="dt">Show</span> a <span class="ot">=&gt;</span> a <span class="ot">-&gt;</span> <span class="dt">IO</span> ()</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span> x <span class="ot">=</span> <span class="fu">putStrLn</span> (<span class="fu">show</span> x)</span></code></pre></div>
<p>となっています.</p>
<p>要素が一つも属さない集合を<code>空集合</code>といい,記号<span class="math inline">\(\phi\)</span> または<span class="math inline">\(｛｝\)</span>によって表されます．
Haskellでは空集合を表すデータ型として<code>Data.Void</code>に定義された<code>Void</code>が存在します. データ型として<code>ボトム型</code>,記号では<code>⊥</code>で表される場合もあります.</p>
<p><code>Void</code>と同じ値を持たないデータ型は,コンストラクタを記述しないことで自分で実装することもできます. 例えば私が犬を今までに一匹もかったことがなければ, <span class="math display">\[ MyPet = \phi \]</span> となり,データ型としては以下のように定義されます. 値が存在しない空集合と対応していることが分かります.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Mypet</span></span></code></pre></div>
<p><code>Void</code>型は値が存在しないため実行することはできませんが,コンパイルを通すことはできます. ただし,あまり実用する機会はないので,以下の部分は興味がある人だけ開いて読んでください.</p>
<div class="note">
<details>
<summary>
Voidの利用例 開く/閉じる
</summary>
<p><code>Void</code>型を利用したコードを記述する方法はいくつかありますが, <code>undefined</code>した実装などが良く用いられます.
<code>undefined</code>は遅延評価を利用した値で,具体的な値や式の記述を省略することができます.
未実装の部分を含めたコードを取り敢えず部分的にコンパイルしてみたい場合や, エラー処理などで利用されます.</p>
<p>以下のコードはコンパイルは通りますが,実行時には<code>undefined, called</code>エラーが発生します.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="ot">somFunc ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>someFunc <span class="ot">=</span> <span class="fu">undefined</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="fu">print</span> <span class="op">$</span> someFunc <span class="dv">1</span></span></code></pre></div>
<p><code>Void</code>型を利用するケースは非常に限定的ですが,値が無いことを明示的に示したい場合などに利用されます.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE EmptyCase #-}</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE EmptyDataDeriving #-}</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Empty</span> <span class="kw">deriving</span> <span class="dt">Show</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="ot">head&#39; ::</span> <span class="dt">Show</span> a <span class="ot">=&gt;</span> [a] <span class="ot">-&gt;</span> <span class="dt">Empty</span> <span class="ot">-&gt;</span>  a</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>head&#39; []     e <span class="ot">=</span> <span class="kw">case</span> e <span class="kw">of</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>head&#39; (x<span class="op">:</span>[]) _ <span class="ot">=</span> x</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>head&#39; (x<span class="op">:</span>xs) _ <span class="ot">=</span> x</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="fu">print</span> <span class="op">$</span> head&#39; ([]<span class="ot">::</span>[<span class="dt">Int</span>]) <span class="fu">undefined</span> <span class="co">-- &gt;&gt;&gt; undefined, called at</span></span></code></pre></div>
<p>このコードでは, 明示的に<code>先頭の値</code>が存在しないことを<code>Empty</code>で表し,<code>EmptyDataDeriving</code>拡張で<code>undefined</code>を評価することでエラーを発生させています.</p>
<p>しかし,こういったパターンでは,以下の<code>error</code>による実装や,後に説明する<code>Maybe型</code>を利用するほうが一般的です.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="ot">head&#39;&#39; ::</span> <span class="dt">Show</span> a <span class="ot">=&gt;</span> [a] <span class="ot">-&gt;</span>  a</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>head&#39;&#39; []     <span class="ot">=</span> <span class="fu">error</span> <span class="st">&quot;Empty List&quot;</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>head&#39;&#39; (x<span class="op">:</span>[]) <span class="ot">=</span> x</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>head&#39;&#39; (x<span class="op">:</span>xs) <span class="ot">=</span> x</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="fu">print</span> <span class="op">$</span> head&#39;&#39; ([]<span class="ot">::</span>[<span class="dt">Int</span>]) <span class="co">-- practice: Empty List error, called at</span></span></code></pre></div>
</details>
</div>
<p>単一の要素だけが存在するデータ型として<code>Unit</code>型も準備されており,<code>()</code>のような空のタプルとして表されます.</p>
<p>集合の表記法には，外延的表記及び内包的表記という2通りが存在する．外延的表記とは，集合Sに含まれる要素を全て記述する方法で，x,yを要素とする集合を，
S={x,y}
と書く．集合には順番は関係ないため，{x,y}={y,z}である．また，一つの集合に同じ要素は2つ以上属することができず，{x,x}のような集合は定義できない．</p>
<p>内包的表記とは，その集合に何が属するのかを定義する方法で集合Sに属する要素の集合をｘとすると，ｘがどの集合の要素であるか，どのような条件を持つかなどによって表記する．xの属する集合をX，条件式p(x)とすると，内包的表記では
S={x│x∈ X,p(x)}
と書かれる．また，内包表記において，関数や定数を定義することも許されており，
関数をf[x]で表すと，
S={f(x)|x∈X,f(x)=x+1}
のように表記される．
条件の例として，R<sup>+を非負の実数としたとき，R</sup>+５以下の非負の実数を，以下のように書く．
{x|x∈R^+,x≤5}
集合には，集合が属することも可能で，集合SがTに属するときS∈ Tが成り立つ．
また，集合Sの要素を幾つか取り出した集合TをSの部分集合といい，
T⊂S
と表記される．
S={x,y,z}のとき，Sの部分集合は
{x},{x,y},{x,z},{z,y},{x,y,z},ϕ
となる．任意の集合Sに対して
ϕ⊂S
は成り立つ．
また，集合Sの部分集合全体の集合を冪集合といい，pow[S]または2^S と書く．
pow[{x,y,z}]={{x},{x,y},{x,z},{z,y},{x,y,z},ϕ}</p>
<h2 data-number="5.3" id="型注釈と関数"><span class="header-section-number">5.3</span> 型注釈と関数</h2>
<h3 data-number="5.3.1" id="内包表記"><span class="header-section-number">5.3.1</span> 内包表記</h3>
<h2 data-number="5.4" id="包含"><span class="header-section-number">5.4</span> 包含</h2>
<h2 data-number="5.5" id="積と和"><span class="header-section-number">5.5</span> 積と和</h2>
<h1 data-number="6" id="代数とクラス"><span class="header-section-number">6</span> 代数とクラス</h1>
<h2 data-number="6.1" id="マグマ"><span class="header-section-number">6.1</span> マグマ</h2>
<h2 data-number="6.2" id="半群"><span class="header-section-number">6.2</span> 半群</h2>
<h2 data-number="6.3" id="モノイド"><span class="header-section-number">6.3</span> モノイド</h2>
<h2 data-number="6.4" id="群"><span class="header-section-number">6.4</span> 群</h2>
<h2 data-number="6.5" id="リスト-1"><span class="header-section-number">6.5</span> リスト</h2>
<h2 data-number="6.6" id="ツリー"><span class="header-section-number">6.6</span> ツリー</h2>
<h2 data-number="6.7" id="ネットワーク"><span class="header-section-number">6.7</span> ネットワーク</h2>
</details>
<h1 data-number="7" id="手続き型haskell"><span class="header-section-number">7</span> 手続き型Haskell</h1>
<h1 data-number="8" id="圏論とhaskell"><span class="header-section-number">8</span> 圏論とHaskell</h1>
<h1 data-number="9" id="発展会計プログラム"><span class="header-section-number">9</span> 発展:会計プログラム</h1>
<p>yakagika</p>
]]></description>
    <pubDate>Fri, 29 Mar 2024 00:00:00 UT</pubDate>
    <guid>/lectures/2024-03-29-introduction-to-algebraic-programing.html</guid>
    <dc:creator>yakagika</dc:creator>
</item>

    </channel>
</rss>
